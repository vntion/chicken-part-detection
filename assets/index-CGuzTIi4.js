(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();var If=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function th(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function q$(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var i=function n(){var s=!1;try{s=this instanceof n}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var s=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(i,n,s.get?s:{enumerable:!0,get:function(){return t[n]}})}),i}var rg={exports:{}},gd={};var L2;function j$(){if(L2)return gd;L2=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function i(n,s,o){var l=null;if(o!==void 0&&(l=""+o),s.key!==void 0&&(l=""+s.key),"key"in s){o={};for(var c in s)c!=="key"&&(o[c]=s[c])}else o=s;return s=o.ref,{$$typeof:t,type:n,key:l,ref:s!==void 0?s:null,props:o}}return gd.Fragment=e,gd.jsx=i,gd.jsxs=i,gd}var U2;function H$(){return U2||(U2=1,rg.exports=j$()),rg.exports}var He=H$(),sg={exports:{}},yt={};var P2;function V$(){if(P2)return yt;P2=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),_=Symbol.for("react.activity"),E=Symbol.iterator;function w(P){return P===null||typeof P!="object"?null:(P=E&&P[E]||P["@@iterator"],typeof P=="function"?P:null)}var A={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,M={};function O(P,ne,ye){this.props=P,this.context=ne,this.refs=M,this.updater=ye||A}O.prototype.isReactComponent={},O.prototype.setState=function(P,ne){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,ne,"setState")},O.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function $(){}$.prototype=O.prototype;function B(P,ne,ye){this.props=P,this.context=ne,this.refs=M,this.updater=ye||A}var U=B.prototype=new $;U.constructor=B,C(U,O.prototype),U.isPureReactComponent=!0;var j=Array.isArray;function W(){}var z={H:null,A:null,T:null,S:null},Y=Object.prototype.hasOwnProperty;function L(P,ne,ye){var ke=ye.ref;return{$$typeof:t,type:P,key:ne,ref:ke!==void 0?ke:null,props:ye}}function H(P,ne){return L(P.type,ne,P.props)}function se(P){return typeof P=="object"&&P!==null&&P.$$typeof===t}function ae(P){var ne={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(ye){return ne[ye]})}var ce=/\/+/g;function fe(P,ne){return typeof P=="object"&&P!==null&&P.key!=null?ae(""+P.key):ne.toString(36)}function be(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(W,W):(P.status="pending",P.then(function(ne){P.status==="pending"&&(P.status="fulfilled",P.value=ne)},function(ne){P.status==="pending"&&(P.status="rejected",P.reason=ne)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function J(P,ne,ye,ke,le){var ze=typeof P;(ze==="undefined"||ze==="boolean")&&(P=null);var it=!1;if(P===null)it=!0;else switch(ze){case"bigint":case"string":case"number":it=!0;break;case"object":switch(P.$$typeof){case t:case e:it=!0;break;case m:return it=P._init,J(it(P._payload),ne,ye,ke,le)}}if(it)return le=le(P),it=ke===""?"."+fe(P,0):ke,j(le)?(ye="",it!=null&&(ye=it.replace(ce,"$&/")+"/"),J(le,ne,ye,"",function(bt){return bt})):le!=null&&(se(le)&&(le=H(le,ye+(le.key==null||P&&P.key===le.key?"":(""+le.key).replace(ce,"$&/")+"/")+it)),ne.push(le)),1;it=0;var Je=ke===""?".":ke+":";if(j(P))for(var Qe=0;Qe<P.length;Qe++)ke=P[Qe],ze=Je+fe(ke,Qe),it+=J(ke,ne,ye,ze,le);else if(Qe=w(P),typeof Qe=="function")for(P=Qe.call(P),Qe=0;!(ke=P.next()).done;)ke=ke.value,ze=Je+fe(ke,Qe++),it+=J(ke,ne,ye,ze,le);else if(ze==="object"){if(typeof P.then=="function")return J(be(P),ne,ye,ke,le);throw ne=String(P),Error("Objects are not valid as a React child (found: "+(ne==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":ne)+"). If you meant to render a collection of children, use an array instead.")}return it}function ee(P,ne,ye){if(P==null)return P;var ke=[],le=0;return J(P,ke,"","",function(ze){return ne.call(ye,ze,le++)}),ke}function de(P){if(P._status===-1){var ne=P._result;ne=ne(),ne.then(function(ye){(P._status===0||P._status===-1)&&(P._status=1,P._result=ye)},function(ye){(P._status===0||P._status===-1)&&(P._status=2,P._result=ye)}),P._status===-1&&(P._status=0,P._result=ne)}if(P._status===1)return P._result.default;throw P._result}var ue=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ne=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent(ne))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)},ve={map:ee,forEach:function(P,ne,ye){ee(P,function(){ne.apply(this,arguments)},ye)},count:function(P){var ne=0;return ee(P,function(){ne++}),ne},toArray:function(P){return ee(P,function(ne){return ne})||[]},only:function(P){if(!se(P))throw Error("React.Children.only expected to receive a single React element child.");return P}};return yt.Activity=_,yt.Children=ve,yt.Component=O,yt.Fragment=i,yt.Profiler=s,yt.PureComponent=B,yt.StrictMode=n,yt.Suspense=h,yt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=z,yt.__COMPILER_RUNTIME={__proto__:null,c:function(P){return z.H.useMemoCache(P)}},yt.cache=function(P){return function(){return P.apply(null,arguments)}},yt.cacheSignal=function(){return null},yt.cloneElement=function(P,ne,ye){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var ke=C({},P.props),le=P.key;if(ne!=null)for(ze in ne.key!==void 0&&(le=""+ne.key),ne)!Y.call(ne,ze)||ze==="key"||ze==="__self"||ze==="__source"||ze==="ref"&&ne.ref===void 0||(ke[ze]=ne[ze]);var ze=arguments.length-2;if(ze===1)ke.children=ye;else if(1<ze){for(var it=Array(ze),Je=0;Je<ze;Je++)it[Je]=arguments[Je+2];ke.children=it}return L(P.type,le,ke)},yt.createContext=function(P){return P={$$typeof:l,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:o,_context:P},P},yt.createElement=function(P,ne,ye){var ke,le={},ze=null;if(ne!=null)for(ke in ne.key!==void 0&&(ze=""+ne.key),ne)Y.call(ne,ke)&&ke!=="key"&&ke!=="__self"&&ke!=="__source"&&(le[ke]=ne[ke]);var it=arguments.length-2;if(it===1)le.children=ye;else if(1<it){for(var Je=Array(it),Qe=0;Qe<it;Qe++)Je[Qe]=arguments[Qe+2];le.children=Je}if(P&&P.defaultProps)for(ke in it=P.defaultProps,it)le[ke]===void 0&&(le[ke]=it[ke]);return L(P,ze,le)},yt.createRef=function(){return{current:null}},yt.forwardRef=function(P){return{$$typeof:c,render:P}},yt.isValidElement=se,yt.lazy=function(P){return{$$typeof:m,_payload:{_status:-1,_result:P},_init:de}},yt.memo=function(P,ne){return{$$typeof:f,type:P,compare:ne===void 0?null:ne}},yt.startTransition=function(P){var ne=z.T,ye={};z.T=ye;try{var ke=P(),le=z.S;le!==null&&le(ye,ke),typeof ke=="object"&&ke!==null&&typeof ke.then=="function"&&ke.then(W,ue)}catch(ze){ue(ze)}finally{ne!==null&&ye.types!==null&&(ne.types=ye.types),z.T=ne}},yt.unstable_useCacheRefresh=function(){return z.H.useCacheRefresh()},yt.use=function(P){return z.H.use(P)},yt.useActionState=function(P,ne,ye){return z.H.useActionState(P,ne,ye)},yt.useCallback=function(P,ne){return z.H.useCallback(P,ne)},yt.useContext=function(P){return z.H.useContext(P)},yt.useDebugValue=function(){},yt.useDeferredValue=function(P,ne){return z.H.useDeferredValue(P,ne)},yt.useEffect=function(P,ne){return z.H.useEffect(P,ne)},yt.useEffectEvent=function(P){return z.H.useEffectEvent(P)},yt.useId=function(){return z.H.useId()},yt.useImperativeHandle=function(P,ne,ye){return z.H.useImperativeHandle(P,ne,ye)},yt.useInsertionEffect=function(P,ne){return z.H.useInsertionEffect(P,ne)},yt.useLayoutEffect=function(P,ne){return z.H.useLayoutEffect(P,ne)},yt.useMemo=function(P,ne){return z.H.useMemo(P,ne)},yt.useOptimistic=function(P,ne){return z.H.useOptimistic(P,ne)},yt.useReducer=function(P,ne,ye){return z.H.useReducer(P,ne,ye)},yt.useRef=function(P){return z.H.useRef(P)},yt.useState=function(P){return z.H.useState(P)},yt.useSyncExternalStore=function(P,ne,ye){return z.H.useSyncExternalStore(P,ne,ye)},yt.useTransition=function(){return z.H.useTransition()},yt.version="19.2.0",yt}var z2;function $y(){return z2||(z2=1,sg.exports=V$()),sg.exports}var gi=$y(),ag={exports:{}},yd={},og={exports:{}},lg={};var F2;function G$(){return F2||(F2=1,(function(t){function e(J,ee){var de=J.length;J.push(ee);e:for(;0<de;){var ue=de-1>>>1,ve=J[ue];if(0<s(ve,ee))J[ue]=ee,J[de]=ve,de=ue;else break e}}function i(J){return J.length===0?null:J[0]}function n(J){if(J.length===0)return null;var ee=J[0],de=J.pop();if(de!==ee){J[0]=de;e:for(var ue=0,ve=J.length,P=ve>>>1;ue<P;){var ne=2*(ue+1)-1,ye=J[ne],ke=ne+1,le=J[ke];if(0>s(ye,de))ke<ve&&0>s(le,ye)?(J[ue]=le,J[ke]=de,ue=ke):(J[ue]=ye,J[ne]=de,ue=ne);else if(ke<ve&&0>s(le,de))J[ue]=le,J[ke]=de,ue=ke;else break e}}return ee}function s(J,ee){var de=J.sortIndex-ee.sortIndex;return de!==0?de:J.id-ee.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,c=l.now();t.unstable_now=function(){return l.now()-c}}var h=[],f=[],m=1,_=null,E=3,w=!1,A=!1,C=!1,M=!1,O=typeof setTimeout=="function"?setTimeout:null,$=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;function U(J){for(var ee=i(f);ee!==null;){if(ee.callback===null)n(f);else if(ee.startTime<=J)n(f),ee.sortIndex=ee.expirationTime,e(h,ee);else break;ee=i(f)}}function j(J){if(C=!1,U(J),!A)if(i(h)!==null)A=!0,W||(W=!0,ae());else{var ee=i(f);ee!==null&&be(j,ee.startTime-J)}}var W=!1,z=-1,Y=5,L=-1;function H(){return M?!0:!(t.unstable_now()-L<Y)}function se(){if(M=!1,W){var J=t.unstable_now();L=J;var ee=!0;try{e:{A=!1,C&&(C=!1,$(z),z=-1),w=!0;var de=E;try{t:{for(U(J),_=i(h);_!==null&&!(_.expirationTime>J&&H());){var ue=_.callback;if(typeof ue=="function"){_.callback=null,E=_.priorityLevel;var ve=ue(_.expirationTime<=J);if(J=t.unstable_now(),typeof ve=="function"){_.callback=ve,U(J),ee=!0;break t}_===i(h)&&n(h),U(J)}else n(h);_=i(h)}if(_!==null)ee=!0;else{var P=i(f);P!==null&&be(j,P.startTime-J),ee=!1}}break e}finally{_=null,E=de,w=!1}ee=void 0}}finally{ee?ae():W=!1}}}var ae;if(typeof B=="function")ae=function(){B(se)};else if(typeof MessageChannel<"u"){var ce=new MessageChannel,fe=ce.port2;ce.port1.onmessage=se,ae=function(){fe.postMessage(null)}}else ae=function(){O(se,0)};function be(J,ee){z=O(function(){J(t.unstable_now())},ee)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(J){J.callback=null},t.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Y=0<J?Math.floor(1e3/J):5},t.unstable_getCurrentPriorityLevel=function(){return E},t.unstable_next=function(J){switch(E){case 1:case 2:case 3:var ee=3;break;default:ee=E}var de=E;E=ee;try{return J()}finally{E=de}},t.unstable_requestPaint=function(){M=!0},t.unstable_runWithPriority=function(J,ee){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var de=E;E=J;try{return ee()}finally{E=de}},t.unstable_scheduleCallback=function(J,ee,de){var ue=t.unstable_now();switch(typeof de=="object"&&de!==null?(de=de.delay,de=typeof de=="number"&&0<de?ue+de:ue):de=ue,J){case 1:var ve=-1;break;case 2:ve=250;break;case 5:ve=1073741823;break;case 4:ve=1e4;break;default:ve=5e3}return ve=de+ve,J={id:m++,callback:ee,priorityLevel:J,startTime:de,expirationTime:ve,sortIndex:-1},de>ue?(J.sortIndex=de,e(f,J),i(h)===null&&J===i(f)&&(C?($(z),z=-1):C=!0,be(j,de-ue))):(J.sortIndex=ve,e(h,J),A||w||(A=!0,W||(W=!0,ae()))),J},t.unstable_shouldYield=H,t.unstable_wrapCallback=function(J){var ee=E;return function(){var de=E;E=ee;try{return J.apply(this,arguments)}finally{E=de}}}})(lg)),lg}var q2;function W$(){return q2||(q2=1,og.exports=G$()),og.exports}var ug={exports:{}},$n={};var j2;function X$(){if(j2)return $n;j2=1;var t=$y();function e(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)f+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var n={d:{f:i,r:function(){throw Error(e(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},s=Symbol.for("react.portal");function o(h,f,m){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:_==null?null:""+_,children:h,containerInfo:f,implementation:m}}var l=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(h,f){if(h==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return $n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,$n.createPortal=function(h,f){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return o(h,f,null,m)},$n.flushSync=function(h){var f=l.T,m=n.p;try{if(l.T=null,n.p=2,h)return h()}finally{l.T=f,n.p=m,n.d.f()}},$n.preconnect=function(h,f){typeof h=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,n.d.C(h,f))},$n.prefetchDNS=function(h){typeof h=="string"&&n.d.D(h)},$n.preinit=function(h,f){if(typeof h=="string"&&f&&typeof f.as=="string"){var m=f.as,_=c(m,f.crossOrigin),E=typeof f.integrity=="string"?f.integrity:void 0,w=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;m==="style"?n.d.S(h,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:_,integrity:E,fetchPriority:w}):m==="script"&&n.d.X(h,{crossOrigin:_,integrity:E,fetchPriority:w,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},$n.preinitModule=function(h,f){if(typeof h=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var m=c(f.as,f.crossOrigin);n.d.M(h,{crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&n.d.M(h)},$n.preload=function(h,f){if(typeof h=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var m=f.as,_=c(m,f.crossOrigin);n.d.L(h,m,{crossOrigin:_,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},$n.preloadModule=function(h,f){if(typeof h=="string")if(f){var m=c(f.as,f.crossOrigin);n.d.m(h,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else n.d.m(h)},$n.requestFormReset=function(h){n.d.r(h)},$n.unstable_batchedUpdates=function(h,f){return h(f)},$n.useFormState=function(h,f,m){return l.H.useFormState(h,f,m)},$n.useFormStatus=function(){return l.H.useHostTransitionStatus()},$n.version="19.2.0",$n}var H2;function K$(){if(H2)return ug.exports;H2=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),ug.exports=X$(),ug.exports}var V2;function Y$(){if(V2)return yd;V2=1;var t=W$(),e=$y(),i=K$();function n(r){var a="https://react.dev/errors/"+r;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)a+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+r+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function o(r){var a=r,u=r;if(r.alternate)for(;a.return;)a=a.return;else{r=a;do a=r,(a.flags&4098)!==0&&(u=a.return),r=a.return;while(r)}return a.tag===3?u:null}function l(r){if(r.tag===13){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function c(r){if(r.tag===31){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function h(r){if(o(r)!==r)throw Error(n(188))}function f(r){var a=r.alternate;if(!a){if(a=o(r),a===null)throw Error(n(188));return a!==r?null:r}for(var u=r,d=a;;){var y=u.return;if(y===null)break;var v=y.alternate;if(v===null){if(d=y.return,d!==null){u=d;continue}break}if(y.child===v.child){for(v=y.child;v;){if(v===u)return h(y),r;if(v===d)return h(y),a;v=v.sibling}throw Error(n(188))}if(u.return!==d.return)u=y,d=v;else{for(var R=!1,G=y.child;G;){if(G===u){R=!0,u=y,d=v;break}if(G===d){R=!0,d=y,u=v;break}G=G.sibling}if(!R){for(G=v.child;G;){if(G===u){R=!0,u=v,d=y;break}if(G===d){R=!0,d=v,u=y;break}G=G.sibling}if(!R)throw Error(n(189))}}if(u.alternate!==d)throw Error(n(190))}if(u.tag!==3)throw Error(n(188));return u.stateNode.current===u?r:a}function m(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r;for(r=r.child;r!==null;){if(a=m(r),a!==null)return a;r=r.sibling}return null}var _=Object.assign,E=Symbol.for("react.element"),w=Symbol.for("react.transitional.element"),A=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),O=Symbol.for("react.profiler"),$=Symbol.for("react.consumer"),B=Symbol.for("react.context"),U=Symbol.for("react.forward_ref"),j=Symbol.for("react.suspense"),W=Symbol.for("react.suspense_list"),z=Symbol.for("react.memo"),Y=Symbol.for("react.lazy"),L=Symbol.for("react.activity"),H=Symbol.for("react.memo_cache_sentinel"),se=Symbol.iterator;function ae(r){return r===null||typeof r!="object"?null:(r=se&&r[se]||r["@@iterator"],typeof r=="function"?r:null)}var ce=Symbol.for("react.client.reference");function fe(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===ce?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case C:return"Fragment";case O:return"Profiler";case M:return"StrictMode";case j:return"Suspense";case W:return"SuspenseList";case L:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case A:return"Portal";case B:return r.displayName||"Context";case $:return(r._context.displayName||"Context")+".Consumer";case U:var a=r.render;return r=r.displayName,r||(r=a.displayName||a.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case z:return a=r.displayName||null,a!==null?a:fe(r.type)||"Memo";case Y:a=r._payload,r=r._init;try{return fe(r(a))}catch{}}return null}var be=Array.isArray,J=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,de={pending:!1,data:null,method:null,action:null},ue=[],ve=-1;function P(r){return{current:r}}function ne(r){0>ve||(r.current=ue[ve],ue[ve]=null,ve--)}function ye(r,a){ve++,ue[ve]=r.current,r.current=a}var ke=P(null),le=P(null),ze=P(null),it=P(null);function Je(r,a){switch(ye(ze,a),ye(le,r),ye(ke,null),a.nodeType){case 9:case 11:r=(r=a.documentElement)&&(r=r.namespaceURI)?a2(r):0;break;default:if(r=a.tagName,a=a.namespaceURI)a=a2(a),r=o2(a,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}ne(ke),ye(ke,r)}function Qe(){ne(ke),ne(le),ne(ze)}function bt(r){r.memoizedState!==null&&ye(it,r);var a=ke.current,u=o2(a,r.type);a!==u&&(ye(le,r),ye(ke,u))}function ri(r){le.current===r&&(ne(ke),ne(le)),it.current===r&&(ne(it),hd._currentValue=de)}var fi,mn;function Lt(r){if(fi===void 0)try{throw Error()}catch(u){var a=u.stack.trim().match(/\n( *(at )?)/);fi=a&&a[1]||"",mn=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+fi+r+mn}var Nn=!1;function Ut(r,a){if(!r||Nn)return"";Nn=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(a){var Le=function(){throw Error()};if(Object.defineProperty(Le.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Le,[])}catch(De){var we=De}Reflect.construct(r,[],Le)}else{try{Le.call()}catch(De){we=De}r.call(Le.prototype)}}else{try{throw Error()}catch(De){we=De}(Le=r())&&typeof Le.catch=="function"&&Le.catch(function(){})}}catch(De){if(De&&we&&typeof De.stack=="string")return[De.stack,we.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var v=d.DetermineComponentFrameRoot(),R=v[0],G=v[1];if(R&&G){var oe=R.split(`
`),Se=G.split(`
`);for(y=d=0;d<oe.length&&!oe[d].includes("DetermineComponentFrameRoot");)d++;for(;y<Se.length&&!Se[y].includes("DetermineComponentFrameRoot");)y++;if(d===oe.length||y===Se.length)for(d=oe.length-1,y=Se.length-1;1<=d&&0<=y&&oe[d]!==Se[y];)y--;for(;1<=d&&0<=y;d--,y--)if(oe[d]!==Se[y]){if(d!==1||y!==1)do if(d--,y--,0>y||oe[d]!==Se[y]){var Me=`
`+oe[d].replace(" at new "," at ");return r.displayName&&Me.includes("<anonymous>")&&(Me=Me.replace("<anonymous>",r.displayName)),Me}while(1<=d&&0<=y);break}}}finally{Nn=!1,Error.prepareStackTrace=u}return(u=r?r.displayName||r.name:"")?Lt(u):""}function rs(r,a){switch(r.tag){case 26:case 27:case 5:return Lt(r.type);case 16:return Lt("Lazy");case 13:return r.child!==a&&a!==null?Lt("Suspense Fallback"):Lt("Suspense");case 19:return Lt("SuspenseList");case 0:case 15:return Ut(r.type,!1);case 11:return Ut(r.type.render,!1);case 1:return Ut(r.type,!0);case 31:return Lt("Activity");default:return""}}function Ui(r){try{var a="",u=null;do a+=rs(r,u),u=r,r=r.return;while(r);return a}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}var Wi=Object.prototype.hasOwnProperty,ft=t.unstable_scheduleCallback,Pt=t.unstable_cancelCallback,Ot=t.unstable_shouldYield,Dt=t.unstable_requestPaint,si=t.unstable_now,Rr=t.unstable_getCurrentPriorityLevel,Wn=t.unstable_ImmediatePriority,Pi=t.unstable_UserBlockingPriority,Xi=t.unstable_NormalPriority,Rs=t.unstable_LowPriority,Sn=t.unstable_IdlePriority,ss=t.log,It=t.unstable_setDisableYieldValue,Xn=null,yi=null;function Bn(r){if(typeof ss=="function"&&It(r),yi&&typeof yi.setStrictMode=="function")try{yi.setStrictMode(Xn,r)}catch{}}var zi=Math.clz32?Math.clz32:ha,da=Math.log,Mr=Math.LN2;function ha(r){return r>>>=0,r===0?32:31-(da(r)/Mr|0)|0}var hr=256,Nr=262144,q=4194304;function V(r){var a=r&42;if(a!==0)return a;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function re(r,a,u){var d=r.pendingLanes;if(d===0)return 0;var y=0,v=r.suspendedLanes,R=r.pingedLanes;r=r.warmLanes;var G=d&134217727;return G!==0?(d=G&~v,d!==0?y=V(d):(R&=G,R!==0?y=V(R):u||(u=G&~r,u!==0&&(y=V(u))))):(G=d&~v,G!==0?y=V(G):R!==0?y=V(R):u||(u=d&~r,u!==0&&(y=V(u)))),y===0?0:a!==0&&a!==y&&(a&v)===0&&(v=y&-y,u=a&-a,v>=u||v===32&&(u&4194048)!==0)?a:y}function xe(r,a){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&a)===0}function qe(r,a){switch(r){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function nt(){var r=q;return q<<=1,(q&62914560)===0&&(q=4194304),r}function Rt(r){for(var a=[],u=0;31>u;u++)a.push(r);return a}function pi(r,a){r.pendingLanes|=a,a!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function tn(r,a,u,d,y,v){var R=r.pendingLanes;r.pendingLanes=u,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=u,r.entangledLanes&=u,r.errorRecoveryDisabledLanes&=u,r.shellSuspendCounter=0;var G=r.entanglements,oe=r.expirationTimes,Se=r.hiddenUpdates;for(u=R&~u;0<u;){var Me=31-zi(u),Le=1<<Me;G[Me]=0,oe[Me]=-1;var we=Se[Me];if(we!==null)for(Se[Me]=null,Me=0;Me<we.length;Me++){var De=we[Me];De!==null&&(De.lane&=-536870913)}u&=~Le}d!==0&&wn(r,d,0),v!==0&&y===0&&r.tag!==0&&(r.suspendedLanes|=v&~(R&~a))}function wn(r,a,u){r.pendingLanes|=a,r.suspendedLanes&=~a;var d=31-zi(a);r.entangledLanes|=a,r.entanglements[d]=r.entanglements[d]|1073741824|u&261930}function nn(r,a){var u=r.entangledLanes|=a;for(r=r.entanglements;u;){var d=31-zi(u),y=1<<d;y&a|r[d]&a&&(r[d]|=a),u&=~y}}function gn(r,a){var u=a&-a;return u=(u&42)!==0?1:Ki(u),(u&(r.suspendedLanes|a))!==0?0:u}function Ki(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Wt(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function rn(){var r=ee.p;return r!==0?r:(r=window.event,r===void 0?32:$2(r.type))}function Ln(r,a){var u=ee.p;try{return ee.p=r,a()}finally{ee.p=u}}var Ii=Math.random().toString(36).slice(2),rt="__reactFiber$"+Ii,ci="__reactProps$"+Ii,gt="__reactContainer$"+Ii,Un="__reactEvents$"+Ii,En="__reactListeners$"+Ii,fa="__reactHandles$"+Ii,ou="__reactResources$"+Ii,Ai="__reactMarker$"+Ii;function Ht(r){delete r[rt],delete r[ci],delete r[Un],delete r[En],delete r[fa]}function fr(r){var a=r[rt];if(a)return a;for(var u=r.parentNode;u;){if(a=u[gt]||u[rt]){if(u=a.alternate,a.child!==null||u!==null&&u.child!==null)for(r=p2(r);r!==null;){if(u=r[rt])return u;r=p2(r)}return a}r=u,u=r.parentNode}return null}function Ri(r){if(r=r[rt]||r[gt]){var a=r.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return r}return null}function as(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r.stateNode;throw Error(n(33))}function _i(r){var a=r[ou];return a||(a=r[ou]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function Nt(r){r[Ai]=!0}var pa=new Set,io={};function pr(r,a){os(r,a),os(r+"Capture",a)}function os(r,a){for(io[r]=a,r=0;r<a.length;r++)pa.add(a[r])}var Cc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),lu={},ma={};function Kn(r){return Wi.call(ma,r)?!0:Wi.call(lu,r)?!1:Cc.test(r)?ma[r]=!0:(lu[r]=!0,!1)}function ls(r,a,u){if(Kn(a))if(u===null)r.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":r.removeAttribute(a);return;case"boolean":var d=a.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){r.removeAttribute(a);return}}r.setAttribute(a,""+u)}}function Br(r,a,u){if(u===null)r.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(a);return}r.setAttribute(a,""+u)}}function sn(r,a,u,d){if(d===null)r.removeAttribute(u);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(u);return}r.setAttributeNS(a,u,""+d)}}function Fi(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Ms(r){var a=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Ac(r,a,u){var d=Object.getOwnPropertyDescriptor(r.constructor.prototype,a);if(!r.hasOwnProperty(a)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var y=d.get,v=d.set;return Object.defineProperty(r,a,{configurable:!0,get:function(){return y.call(this)},set:function(R){u=""+R,v.call(this,R)}}),Object.defineProperty(r,a,{enumerable:d.enumerable}),{getValue:function(){return u},setValue:function(R){u=""+R},stopTracking:function(){r._valueTracker=null,delete r[a]}}}}function no(r){if(!r._valueTracker){var a=Ms(r)?"checked":"value";r._valueTracker=Ac(r,a,""+r[a])}}function uu(r){if(!r)return!1;var a=r._valueTracker;if(!a)return!0;var u=a.getValue(),d="";return r&&(d=Ms(r)?r.checked?"true":"false":r.value),r=d,r!==u?(a.setValue(r),!0):!1}function ro(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Lr=/[\n"\\]/g;function Yi(r){return r.replace(Lr,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function rl(r,a,u,d,y,v,R,G){r.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?r.type=R:r.removeAttribute("type"),a!=null?R==="number"?(a===0&&r.value===""||r.value!=a)&&(r.value=""+Fi(a)):r.value!==""+Fi(a)&&(r.value=""+Fi(a)):R!=="submit"&&R!=="reset"||r.removeAttribute("value"),a!=null?us(r,R,Fi(a)):u!=null?us(r,R,Fi(u)):d!=null&&r.removeAttribute("value"),y==null&&v!=null&&(r.defaultChecked=!!v),y!=null&&(r.checked=y&&typeof y!="function"&&typeof y!="symbol"),G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"?r.name=""+Fi(G):r.removeAttribute("name")}function Ns(r,a,u,d,y,v,R,G){if(v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(r.type=v),a!=null||u!=null){if(!(v!=="submit"&&v!=="reset"||a!=null)){no(r);return}u=u!=null?""+Fi(u):"",a=a!=null?""+Fi(a):u,G||a===r.value||(r.value=a),r.defaultValue=a}d=d??y,d=typeof d!="function"&&typeof d!="symbol"&&!!d,r.checked=G?r.checked:!!d,r.defaultChecked=!!d,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(r.name=R),no(r)}function us(r,a,u){a==="number"&&ro(r.ownerDocument)===r||r.defaultValue===""+u||(r.defaultValue=""+u)}function Si(r,a,u,d){if(r=r.options,a){a={};for(var y=0;y<u.length;y++)a["$"+u[y]]=!0;for(u=0;u<r.length;u++)y=a.hasOwnProperty("$"+r[u].value),r[u].selected!==y&&(r[u].selected=y),y&&d&&(r[u].defaultSelected=!0)}else{for(u=""+Fi(u),a=null,y=0;y<r.length;y++){if(r[y].value===u){r[y].selected=!0,d&&(r[y].defaultSelected=!0);return}a!==null||r[y].disabled||(a=r[y])}a!==null&&(a.selected=!0)}}function cu(r,a,u){if(a!=null&&(a=""+Fi(a),a!==r.value&&(r.value=a),u==null)){r.defaultValue!==a&&(r.defaultValue=a);return}r.defaultValue=u!=null?""+Fi(u):""}function cs(r,a,u,d){if(a==null){if(d!=null){if(u!=null)throw Error(n(92));if(be(d)){if(1<d.length)throw Error(n(93));d=d[0]}u=d}u==null&&(u=""),a=u}u=Fi(a),r.defaultValue=u,d=r.textContent,d===u&&d!==""&&d!==null&&(r.value=d),no(r)}function Yn(r,a){if(a){var u=r.firstChild;if(u&&u===r.lastChild&&u.nodeType===3){u.nodeValue=a;return}}r.textContent=a}var so=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ds(r,a,u){var d=a.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?d?r.setProperty(a,""):a==="float"?r.cssFloat="":r[a]="":d?r.setProperty(a,u):typeof u!="number"||u===0||so.has(a)?a==="float"?r.cssFloat=u:r[a]=(""+u).trim():r[a]=u+"px"}function ao(r,a,u){if(a!=null&&typeof a!="object")throw Error(n(62));if(r=r.style,u!=null){for(var d in u)!u.hasOwnProperty(d)||a!=null&&a.hasOwnProperty(d)||(d.indexOf("--")===0?r.setProperty(d,""):d==="float"?r.cssFloat="":r[d]="");for(var y in a)d=a[y],a.hasOwnProperty(y)&&u[y]!==d&&ds(r,y,d)}else for(var v in a)a.hasOwnProperty(v)&&ds(r,v,a[v])}function hs(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var oo=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Dc=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function lo(r){return Dc.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Cn(){}var yn=null;function _n(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var fs=null,Qn=null;function sl(r){var a=Ri(r);if(a&&(r=a.stateNode)){var u=r[ci]||null;e:switch(r=a.stateNode,a.type){case"input":if(rl(r,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),a=u.name,u.type==="radio"&&a!=null){for(u=r;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+Yi(""+a)+'"][type="radio"]'),a=0;a<u.length;a++){var d=u[a];if(d!==r&&d.form===r.form){var y=d[ci]||null;if(!y)throw Error(n(90));rl(d,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(a=0;a<u.length;a++)d=u[a],d.form===r.form&&uu(d)}break e;case"textarea":cu(r,u.value,u.defaultValue);break e;case"select":a=u.value,a!=null&&Si(r,!!u.multiple,a,!1)}}}var ga=!1;function du(r,a,u){if(ga)return r(a,u);ga=!0;try{var d=r(a);return d}finally{if(ga=!1,(fs!==null||Qn!==null)&&(Uh(),fs&&(a=fs,r=Qn,Qn=fs=null,sl(a),r)))for(a=0;a<r.length;a++)sl(r[a])}}function Zn(r,a){var u=r.stateNode;if(u===null)return null;var d=u[ci]||null;if(d===null)return null;u=d[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(r=r.type,d=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!d;break e;default:r=!1}if(r)return null;if(u&&typeof u!="function")throw Error(n(231,a,typeof u));return u}var An=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ya=!1;if(An)try{var _a={};Object.defineProperty(_a,"passive",{get:function(){ya=!0}}),window.addEventListener("test",_a,_a),window.removeEventListener("test",_a,_a)}catch{ya=!1}var Pn=null,uo=null,va=null;function ba(){if(va)return va;var r,a=uo,u=a.length,d,y="value"in Pn?Pn.value:Pn.textContent,v=y.length;for(r=0;r<u&&a[r]===y[r];r++);var R=u-r;for(d=1;d<=R&&a[u-d]===y[v-d];d++);return va=y.slice(r,1<d?1-d:void 0)}function Ta(r){var a=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&a===13&&(r=13)):r=a,r===10&&(r=13),32<=r||r===13?r:0}function co(){return!0}function al(){return!1}function an(r){function a(u,d,y,v,R){this._reactName=u,this._targetInst=y,this.type=d,this.nativeEvent=v,this.target=R,this.currentTarget=null;for(var G in r)r.hasOwnProperty(G)&&(u=r[G],this[G]=u?u(v):v[G]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?co:al,this.isPropagationStopped=al,this}return _(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=co)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=co)},persist:function(){},isPersistent:co}),a}var ps={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ho=an(ps),xa=_({},ps,{view:0,detail:0}),ol=an(xa),ll,fo,Ur,po=_({},xa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mo,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Ur&&(Ur&&r.type==="mousemove"?(ll=r.screenX-Ur.screenX,fo=r.screenY-Ur.screenY):fo=ll=0,Ur=r),ll)},movementY:function(r){return"movementY"in r?r.movementY:fo}}),hu=an(po),kc=_({},po,{dataTransfer:0}),$c=an(kc),Oc=_({},xa,{relatedTarget:0}),Bs=an(Oc),Sa=_({},ps,{animationName:0,elapsedTime:0,pseudoElement:0}),Ls=an(Sa),wa=_({},ps,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Dn=an(wa),mr=_({},ps,{data:0}),Ea=an(mr),ul={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fu={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ca={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ic(r){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(r):(r=Ca[r])?!!a[r]:!1}function mo(){return Ic}var pu=_({},xa,{key:function(r){if(r.key){var a=ul[r.key]||r.key;if(a!=="Unidentified")return a}return r.type==="keypress"?(r=Ta(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?fu[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mo,charCode:function(r){return r.type==="keypress"?Ta(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Ta(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),mu=an(pu),go=_({},po,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Pr=an(go),Aa=_({},xa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mo}),ms=an(Aa),Rc=_({},ps,{propertyName:0,elapsedTime:0,pseudoElement:0}),gu=an(Rc),yu=_({},po,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),_u=an(yu),Mc=_({},ps,{newState:0,oldState:0}),Nc=an(Mc),Bc=[9,13,27,32],Us=An&&"CompositionEvent"in window,zr=null;An&&"documentMode"in document&&(zr=document.documentMode);var Ps=An&&"TextEvent"in window&&!zr,cl=An&&(!Us||zr&&8<zr&&11>=zr),vu=" ",dl=!1;function zs(r,a){switch(r){case"keyup":return Bc.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function yo(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var gs=!1;function bu(r,a){switch(r){case"compositionend":return yo(a);case"keypress":return a.which!==32?null:(dl=!0,vu);case"textInput":return r=a.data,r===vu&&dl?null:r;default:return null}}function _o(r,a){if(gs)return r==="compositionend"||!Us&&zs(r,a)?(r=ba(),va=uo=Pn=null,gs=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return cl&&a.locale!=="ko"?null:a.data;default:return null}}var Tu={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vo(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a==="input"?!!Tu[r.type]:a==="textarea"}function hl(r,a,u,d){fs?Qn?Qn.push(d):Qn=[d]:fs=d,a=Vh(a,"onChange"),0<a.length&&(u=new ho("onChange","change",null,u,d),r.push({event:u,listeners:a}))}var Da=null,ys=null;function xu(r){e2(r,0)}function Fr(r){var a=as(r);if(uu(a))return r}function fl(r,a){if(r==="change")return a}var ka=!1;if(An){var pl;if(An){var ml="oninput"in document;if(!ml){var $e=document.createElement("div");$e.setAttribute("oninput","return;"),ml=typeof $e.oninput=="function"}pl=ml}else pl=!1;ka=pl&&(!document.documentMode||9<document.documentMode)}function gl(){Da&&(Da.detachEvent("onpropertychange",yl),ys=Da=null)}function yl(r){if(r.propertyName==="value"&&Fr(ys)){var a=[];hl(a,ys,r,_n(r)),du(xu,a)}}function _l(r,a,u){r==="focusin"?(gl(),Da=a,ys=u,Da.attachEvent("onpropertychange",yl)):r==="focusout"&&gl()}function gr(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Fr(ys)}function $a(r,a){if(r==="click")return Fr(a)}function vl(r,a){if(r==="input"||r==="change")return Fr(a)}function Fs(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var Qi=typeof Object.is=="function"?Object.is:Fs;function yr(r,a){if(Qi(r,a))return!0;if(typeof r!="object"||r===null||typeof a!="object"||a===null)return!1;var u=Object.keys(r),d=Object.keys(a);if(u.length!==d.length)return!1;for(d=0;d<u.length;d++){var y=u[d];if(!Wi.call(a,y)||!Qi(r[y],a[y]))return!1}return!0}function qr(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function ai(r,a){var u=qr(r);r=0;for(var d;u;){if(u.nodeType===3){if(d=r+u.textContent.length,r<=a&&d>=a)return{node:u,offset:a-r};r=d}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=qr(u)}}function jr(r,a){return r&&a?r===a?!0:r&&r.nodeType===3?!1:a&&a.nodeType===3?jr(r,a.parentNode):"contains"in r?r.contains(a):r.compareDocumentPosition?!!(r.compareDocumentPosition(a)&16):!1:!1}function Oa(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var a=ro(r.document);a instanceof r.HTMLIFrameElement;){try{var u=typeof a.contentWindow.location.href=="string"}catch{u=!1}if(u)r=a.contentWindow;else break;a=ro(r.document)}return a}function qs(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a&&(a==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||a==="textarea"||r.contentEditable==="true")}var bl=An&&"documentMode"in document&&11>=document.documentMode,Hr=null,bo=null,_s=null,Ia=!1;function To(r,a,u){var d=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;Ia||Hr==null||Hr!==ro(d)||(d=Hr,"selectionStart"in d&&qs(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),_s&&yr(_s,d)||(_s=d,d=Vh(bo,"onSelect"),0<d.length&&(a=new ho("onSelect","select",null,a,u),r.push({event:a,listeners:d}),a.target=Hr)))}function _r(r,a){var u={};return u[r.toLowerCase()]=a.toLowerCase(),u["Webkit"+r]="webkit"+a,u["Moz"+r]="moz"+a,u}var g={animationend:_r("Animation","AnimationEnd"),animationiteration:_r("Animation","AnimationIteration"),animationstart:_r("Animation","AnimationStart"),transitionrun:_r("Transition","TransitionRun"),transitionstart:_r("Transition","TransitionStart"),transitioncancel:_r("Transition","TransitionCancel"),transitionend:_r("Transition","TransitionEnd")},T={},k={};An&&(k=document.createElement("div").style,"AnimationEvent"in window||(delete g.animationend.animation,delete g.animationiteration.animation,delete g.animationstart.animation),"TransitionEvent"in window||delete g.transitionend.transition);function N(r){if(T[r])return T[r];if(!g[r])return r;var a=g[r],u;for(u in a)if(a.hasOwnProperty(u)&&u in k)return T[r]=a[u];return r}var F=N("animationend"),Q=N("animationiteration"),pe=N("animationstart"),Ee=N("transitionrun"),Be=N("transitionstart"),Pe=N("transitioncancel"),Ve=N("transitionend"),tt=new Map,ct="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ct.push("scrollEnd");function dt(r,a){tt.set(r,a),pr(a,[r])}var Xt=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},Zt=[],on=0,vr=0;function Vr(){for(var r=on,a=vr=on=0;a<r;){var u=Zt[a];Zt[a++]=null;var d=Zt[a];Zt[a++]=null;var y=Zt[a];Zt[a++]=null;var v=Zt[a];if(Zt[a++]=null,d!==null&&y!==null){var R=d.pending;R===null?y.next=y:(y.next=R.next,R.next=y),d.pending=y}v!==0&&lh(u,y,v)}}function js(r,a,u,d){Zt[on++]=r,Zt[on++]=a,Zt[on++]=u,Zt[on++]=d,vr|=d,r.lanes|=d,r=r.alternate,r!==null&&(r.lanes|=d)}function Tl(r,a,u,d){return js(r,a,u,d),Su(r)}function Ra(r,a){return js(r,null,null,a),Su(r)}function lh(r,a,u){r.lanes|=u;var d=r.alternate;d!==null&&(d.lanes|=u);for(var y=!1,v=r.return;v!==null;)v.childLanes|=u,d=v.alternate,d!==null&&(d.childLanes|=u),v.tag===22&&(r=v.stateNode,r===null||r._visibility&1||(y=!0)),r=v,v=v.return;return r.tag===3?(v=r.stateNode,y&&a!==null&&(y=31-zi(u),r=v.hiddenUpdates,d=r[y],d===null?r[y]=[a]:d.push(a),a.lane=u|536870912),v):null}function Su(r){if(50<sd)throw sd=0,Dm=null,Error(n(185));for(var a=r.return;a!==null;)r=a,a=r.return;return r.tag===3?r.stateNode:null}var xo={};function Op(r,a,u,d){this.tag=r,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Di(r,a,u,d){return new Op(r,a,u,d)}function Lc(r){return r=r.prototype,!(!r||!r.isReactComponent)}function vs(r,a){var u=r.alternate;return u===null?(u=Di(r.tag,a,r.key,r.mode),u.elementType=r.elementType,u.type=r.type,u.stateNode=r.stateNode,u.alternate=r,r.alternate=u):(u.pendingProps=a,u.type=r.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=r.flags&65011712,u.childLanes=r.childLanes,u.lanes=r.lanes,u.child=r.child,u.memoizedProps=r.memoizedProps,u.memoizedState=r.memoizedState,u.updateQueue=r.updateQueue,a=r.dependencies,u.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},u.sibling=r.sibling,u.index=r.index,u.ref=r.ref,u.refCleanup=r.refCleanup,u}function uh(r,a){r.flags&=65011714;var u=r.alternate;return u===null?(r.childLanes=0,r.lanes=a,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=u.childLanes,r.lanes=u.lanes,r.child=u.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=u.memoizedProps,r.memoizedState=u.memoizedState,r.updateQueue=u.updateQueue,r.type=u.type,a=u.dependencies,r.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),r}function Uc(r,a,u,d,y,v){var R=0;if(d=r,typeof r=="function")Lc(r)&&(R=1);else if(typeof r=="string")R=$$(r,u,ke.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case L:return r=Di(31,u,a,y),r.elementType=L,r.lanes=v,r;case C:return Hs(u.children,y,v,a);case M:R=8,y|=24;break;case O:return r=Di(12,u,a,y|2),r.elementType=O,r.lanes=v,r;case j:return r=Di(13,u,a,y),r.elementType=j,r.lanes=v,r;case W:return r=Di(19,u,a,y),r.elementType=W,r.lanes=v,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case B:R=10;break e;case $:R=9;break e;case U:R=11;break e;case z:R=14;break e;case Y:R=16,d=null;break e}R=29,u=Error(n(130,r===null?"null":typeof r,"")),d=null}return a=Di(R,u,a,y),a.elementType=r,a.type=d,a.lanes=v,a}function Hs(r,a,u,d){return r=Di(7,r,d,a),r.lanes=u,r}function xl(r,a,u){return r=Di(6,r,null,a),r.lanes=u,r}function Pc(r){var a=Di(18,null,null,0);return a.stateNode=r,a}function So(r,a,u){return a=Di(4,r.children!==null?r.children:[],r.key,a),a.lanes=u,a.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},a}var Sl=new WeakMap;function Jn(r,a){if(typeof r=="object"&&r!==null){var u=Sl.get(r);return u!==void 0?u:(a={value:r,source:a,stack:Ui(a)},Sl.set(r,a),a)}return{value:r,source:a,stack:Ui(a)}}var wo=[],Eo=0,wu=null,wl=0,kn=[],er=0,Vs=null,br=1,vn="";function xt(r,a){wo[Eo++]=wl,wo[Eo++]=wu,wu=r,wl=a}function Gs(r,a,u){kn[er++]=br,kn[er++]=vn,kn[er++]=Vs,Vs=r;var d=br;r=vn;var y=32-zi(d)-1;d&=~(1<<y),u+=1;var v=32-zi(a)+y;if(30<v){var R=y-y%5;v=(d&(1<<R)-1).toString(32),d>>=R,y-=R,br=1<<32-zi(a)+y|u<<y|d,vn=v+r}else br=1<<v|u<<y|d,vn=r}function Zi(r){r.return!==null&&(xt(r,1),Gs(r,1,0))}function tr(r){for(;r===wu;)wu=wo[--Eo],wo[Eo]=null,wl=wo[--Eo],wo[Eo]=null;for(;r===Vs;)Vs=kn[--er],kn[er]=null,vn=kn[--er],kn[er]=null,br=kn[--er],kn[er]=null}function ch(r,a){kn[er++]=br,kn[er++]=vn,kn[er++]=Vs,br=a.id,vn=a.overflow,Vs=r}var qi=null,oi=null,wt=!1,Ws=null,ir=!1,zc=Error(n(519));function Xs(r){var a=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw x(Jn(a,r)),zc}function dh(r){var a=r.stateNode,u=r.type,d=r.memoizedProps;switch(a[rt]=r,a[ci]=d,u){case"dialog":Ct("cancel",a),Ct("close",a);break;case"iframe":case"object":case"embed":Ct("load",a);break;case"video":case"audio":for(u=0;u<od.length;u++)Ct(od[u],a);break;case"source":Ct("error",a);break;case"img":case"image":case"link":Ct("error",a),Ct("load",a);break;case"details":Ct("toggle",a);break;case"input":Ct("invalid",a),Ns(a,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":Ct("invalid",a);break;case"textarea":Ct("invalid",a),cs(a,d.value,d.defaultValue,d.children)}u=d.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||a.textContent===""+u||d.suppressHydrationWarning===!0||r2(a.textContent,u)?(d.popover!=null&&(Ct("beforetoggle",a),Ct("toggle",a)),d.onScroll!=null&&Ct("scroll",a),d.onScrollEnd!=null&&Ct("scrollend",a),d.onClick!=null&&(a.onclick=Cn),a=!0):a=!1,a||Xs(r,!0)}function Fc(r){for(qi=r.return;qi;)switch(qi.tag){case 5:case 31:case 13:ir=!1;return;case 27:case 3:ir=!0;return;default:qi=qi.return}}function p(r){if(r!==qi)return!1;if(!wt)return Fc(r),wt=!0,!1;var a=r.tag,u;if((u=a!==3&&a!==27)&&((u=a===5)&&(u=r.type,u=!(u!=="form"&&u!=="button")||jm(r.type,r.memoizedProps)),u=!u),u&&oi&&Xs(r),Fc(r),a===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(317));oi=f2(r)}else if(a===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(317));oi=f2(r)}else a===27?(a=oi,Uo(r.type)?(r=Xm,Xm=null,oi=r):oi=a):oi=qi?Xr(r.stateNode.nextSibling):null;return!0}function b(){oi=qi=null,wt=!1}function S(){var r=Ws;return r!==null&&(ar===null?ar=r:ar.push.apply(ar,r),Ws=null),r}function x(r){Ws===null?Ws=[r]:Ws.push(r)}var D=P(null),I=null,X=null;function K(r,a,u){ye(D,a._currentValue),a._currentValue=u}function Z(r){r._currentValue=D.current,ne(D)}function ie(r,a,u){for(;r!==null;){var d=r.alternate;if((r.childLanes&a)!==a?(r.childLanes|=a,d!==null&&(d.childLanes|=a)):d!==null&&(d.childLanes&a)!==a&&(d.childLanes|=a),r===u)break;r=r.return}}function me(r,a,u,d){var y=r.child;for(y!==null&&(y.return=r);y!==null;){var v=y.dependencies;if(v!==null){var R=y.child;v=v.firstContext;e:for(;v!==null;){var G=v;v=y;for(var oe=0;oe<a.length;oe++)if(G.context===a[oe]){v.lanes|=u,G=v.alternate,G!==null&&(G.lanes|=u),ie(v.return,u,r),d||(R=null);break e}v=G.next}}else if(y.tag===18){if(R=y.return,R===null)throw Error(n(341));R.lanes|=u,v=R.alternate,v!==null&&(v.lanes|=u),ie(R,u,r),R=null}else R=y.child;if(R!==null)R.return=y;else for(R=y;R!==null;){if(R===r){R=null;break}if(y=R.sibling,y!==null){y.return=R.return,R=y;break}R=R.return}y=R}}function Ce(r,a,u,d){r=null;for(var y=a,v=!1;y!==null;){if(!v){if((y.flags&524288)!==0)v=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var R=y.alternate;if(R===null)throw Error(n(387));if(R=R.memoizedProps,R!==null){var G=y.type;Qi(y.pendingProps.value,R.value)||(r!==null?r.push(G):r=[G])}}else if(y===it.current){if(R=y.alternate,R===null)throw Error(n(387));R.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(r!==null?r.push(hd):r=[hd])}y=y.return}r!==null&&me(a,r,u,d),a.flags|=262144}function je(r){for(r=r.firstContext;r!==null;){if(!Qi(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Ie(r){I=r,X=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Ge(r){return Mi(I,r)}function pt(r,a){return I===null&&Ie(r),Mi(r,a)}function Mi(r,a){var u=a._currentValue;if(a={context:a,memoizedValue:u,next:null},X===null){if(r===null)throw Error(n(308));X=a,r.dependencies={lanes:0,firstContext:a},r.flags|=524288}else X=X.next=a;return u}var zn=typeof AbortController<"u"?AbortController:function(){var r=[],a=this.signal={aborted:!1,addEventListener:function(u,d){r.push(d)}};this.abort=function(){a.aborted=!0,r.forEach(function(u){return u()})}},Ks=t.unstable_scheduleCallback,El=t.unstable_NormalPriority,di={$$typeof:B,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ma(){return{controller:new zn,data:new Map,refCount:0}}function bs(r){r.refCount--,r.refCount===0&&Ks(El,function(){r.controller.abort()})}var Ys=null,Kt=0,Gr=0,ln=null;function kk(r,a){if(Ys===null){var u=Ys=[];Kt=0,Gr=Mm(),ln={status:"pending",value:void 0,then:function(d){u.push(d)}}}return Kt++,a.then(H_,H_),a}function H_(){if(--Kt===0&&Ys!==null){ln!==null&&(ln.status="fulfilled");var r=Ys;Ys=null,Gr=0,ln=null;for(var a=0;a<r.length;a++)(0,r[a])()}}function $k(r,a){var u=[],d={status:"pending",value:null,reason:null,then:function(y){u.push(y)}};return r.then(function(){d.status="fulfilled",d.value=a;for(var y=0;y<u.length;y++)(0,u[y])(a)},function(y){for(d.status="rejected",d.reason=y,y=0;y<u.length;y++)(0,u[y])(void 0)}),d}var V_=J.S;J.S=function(r,a){Db=si(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&kk(r,a),V_!==null&&V_(r,a)};var Cl=P(null);function Ip(){var r=Cl.current;return r!==null?r:li.pooledCache}function hh(r,a){a===null?ye(Cl,Cl.current):ye(Cl,a.pool)}function G_(){var r=Ip();return r===null?null:{parent:di._currentValue,pool:r}}var Eu=Error(n(460)),Rp=Error(n(474)),fh=Error(n(542)),ph={then:function(){}};function W_(r){return r=r.status,r==="fulfilled"||r==="rejected"}function X_(r,a,u){switch(u=r[u],u===void 0?r.push(a):u!==a&&(a.then(Cn,Cn),a=u),a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,Y_(r),r;default:if(typeof a.status=="string")a.then(Cn,Cn);else{if(r=li,r!==null&&100<r.shellSuspendCounter)throw Error(n(482));r=a,r.status="pending",r.then(function(d){if(a.status==="pending"){var y=a;y.status="fulfilled",y.value=d}},function(d){if(a.status==="pending"){var y=a;y.status="rejected",y.reason=d}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,Y_(r),r}throw Dl=a,Eu}}function Al(r){try{var a=r._init;return a(r._payload)}catch(u){throw u!==null&&typeof u=="object"&&typeof u.then=="function"?(Dl=u,Eu):u}}var Dl=null;function K_(){if(Dl===null)throw Error(n(459));var r=Dl;return Dl=null,r}function Y_(r){if(r===Eu||r===fh)throw Error(n(483))}var Cu=null,qc=0;function mh(r){var a=qc;return qc+=1,Cu===null&&(Cu=[]),X_(Cu,r,a)}function jc(r,a){a=a.props.ref,r.ref=a!==void 0?a:null}function gh(r,a){throw a.$$typeof===E?Error(n(525)):(r=Object.prototype.toString.call(a),Error(n(31,r==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":r)))}function Q_(r){function a(ge,he){if(r){var Te=ge.deletions;Te===null?(ge.deletions=[he],ge.flags|=16):Te.push(he)}}function u(ge,he){if(!r)return null;for(;he!==null;)a(ge,he),he=he.sibling;return null}function d(ge){for(var he=new Map;ge!==null;)ge.key!==null?he.set(ge.key,ge):he.set(ge.index,ge),ge=ge.sibling;return he}function y(ge,he){return ge=vs(ge,he),ge.index=0,ge.sibling=null,ge}function v(ge,he,Te){return ge.index=Te,r?(Te=ge.alternate,Te!==null?(Te=Te.index,Te<he?(ge.flags|=67108866,he):Te):(ge.flags|=67108866,he)):(ge.flags|=1048576,he)}function R(ge){return r&&ge.alternate===null&&(ge.flags|=67108866),ge}function G(ge,he,Te,Ne){return he===null||he.tag!==6?(he=xl(Te,ge.mode,Ne),he.return=ge,he):(he=y(he,Te),he.return=ge,he)}function oe(ge,he,Te,Ne){var st=Te.type;return st===C?Me(ge,he,Te.props.children,Ne,Te.key):he!==null&&(he.elementType===st||typeof st=="object"&&st!==null&&st.$$typeof===Y&&Al(st)===he.type)?(he=y(he,Te.props),jc(he,Te),he.return=ge,he):(he=Uc(Te.type,Te.key,Te.props,null,ge.mode,Ne),jc(he,Te),he.return=ge,he)}function Se(ge,he,Te,Ne){return he===null||he.tag!==4||he.stateNode.containerInfo!==Te.containerInfo||he.stateNode.implementation!==Te.implementation?(he=So(Te,ge.mode,Ne),he.return=ge,he):(he=y(he,Te.children||[]),he.return=ge,he)}function Me(ge,he,Te,Ne,st){return he===null||he.tag!==7?(he=Hs(Te,ge.mode,Ne,st),he.return=ge,he):(he=y(he,Te),he.return=ge,he)}function Le(ge,he,Te){if(typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint")return he=xl(""+he,ge.mode,Te),he.return=ge,he;if(typeof he=="object"&&he!==null){switch(he.$$typeof){case w:return Te=Uc(he.type,he.key,he.props,null,ge.mode,Te),jc(Te,he),Te.return=ge,Te;case A:return he=So(he,ge.mode,Te),he.return=ge,he;case Y:return he=Al(he),Le(ge,he,Te)}if(be(he)||ae(he))return he=Hs(he,ge.mode,Te,null),he.return=ge,he;if(typeof he.then=="function")return Le(ge,mh(he),Te);if(he.$$typeof===B)return Le(ge,pt(ge,he),Te);gh(ge,he)}return null}function we(ge,he,Te,Ne){var st=he!==null?he.key:null;if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return st!==null?null:G(ge,he,""+Te,Ne);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case w:return Te.key===st?oe(ge,he,Te,Ne):null;case A:return Te.key===st?Se(ge,he,Te,Ne):null;case Y:return Te=Al(Te),we(ge,he,Te,Ne)}if(be(Te)||ae(Te))return st!==null?null:Me(ge,he,Te,Ne,null);if(typeof Te.then=="function")return we(ge,he,mh(Te),Ne);if(Te.$$typeof===B)return we(ge,he,pt(ge,Te),Ne);gh(ge,Te)}return null}function De(ge,he,Te,Ne,st){if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number"||typeof Ne=="bigint")return ge=ge.get(Te)||null,G(he,ge,""+Ne,st);if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case w:return ge=ge.get(Ne.key===null?Te:Ne.key)||null,oe(he,ge,Ne,st);case A:return ge=ge.get(Ne.key===null?Te:Ne.key)||null,Se(he,ge,Ne,st);case Y:return Ne=Al(Ne),De(ge,he,Te,Ne,st)}if(be(Ne)||ae(Ne))return ge=ge.get(Te)||null,Me(he,ge,Ne,st,null);if(typeof Ne.then=="function")return De(ge,he,Te,mh(Ne),st);if(Ne.$$typeof===B)return De(ge,he,Te,pt(he,Ne),st);gh(he,Ne)}return null}function Ke(ge,he,Te,Ne){for(var st=null,zt=null,et=he,Tt=he=0,$t=null;et!==null&&Tt<Te.length;Tt++){et.index>Tt?($t=et,et=null):$t=et.sibling;var Ft=we(ge,et,Te[Tt],Ne);if(Ft===null){et===null&&(et=$t);break}r&&et&&Ft.alternate===null&&a(ge,et),he=v(Ft,he,Tt),zt===null?st=Ft:zt.sibling=Ft,zt=Ft,et=$t}if(Tt===Te.length)return u(ge,et),wt&&xt(ge,Tt),st;if(et===null){for(;Tt<Te.length;Tt++)et=Le(ge,Te[Tt],Ne),et!==null&&(he=v(et,he,Tt),zt===null?st=et:zt.sibling=et,zt=et);return wt&&xt(ge,Tt),st}for(et=d(et);Tt<Te.length;Tt++)$t=De(et,ge,Tt,Te[Tt],Ne),$t!==null&&(r&&$t.alternate!==null&&et.delete($t.key===null?Tt:$t.key),he=v($t,he,Tt),zt===null?st=$t:zt.sibling=$t,zt=$t);return r&&et.forEach(function(jo){return a(ge,jo)}),wt&&xt(ge,Tt),st}function lt(ge,he,Te,Ne){if(Te==null)throw Error(n(151));for(var st=null,zt=null,et=he,Tt=he=0,$t=null,Ft=Te.next();et!==null&&!Ft.done;Tt++,Ft=Te.next()){et.index>Tt?($t=et,et=null):$t=et.sibling;var jo=we(ge,et,Ft.value,Ne);if(jo===null){et===null&&(et=$t);break}r&&et&&jo.alternate===null&&a(ge,et),he=v(jo,he,Tt),zt===null?st=jo:zt.sibling=jo,zt=jo,et=$t}if(Ft.done)return u(ge,et),wt&&xt(ge,Tt),st;if(et===null){for(;!Ft.done;Tt++,Ft=Te.next())Ft=Le(ge,Ft.value,Ne),Ft!==null&&(he=v(Ft,he,Tt),zt===null?st=Ft:zt.sibling=Ft,zt=Ft);return wt&&xt(ge,Tt),st}for(et=d(et);!Ft.done;Tt++,Ft=Te.next())Ft=De(et,ge,Tt,Ft.value,Ne),Ft!==null&&(r&&Ft.alternate!==null&&et.delete(Ft.key===null?Tt:Ft.key),he=v(Ft,he,Tt),zt===null?st=Ft:zt.sibling=Ft,zt=Ft);return r&&et.forEach(function(F$){return a(ge,F$)}),wt&&xt(ge,Tt),st}function ti(ge,he,Te,Ne){if(typeof Te=="object"&&Te!==null&&Te.type===C&&Te.key===null&&(Te=Te.props.children),typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case w:e:{for(var st=Te.key;he!==null;){if(he.key===st){if(st=Te.type,st===C){if(he.tag===7){u(ge,he.sibling),Ne=y(he,Te.props.children),Ne.return=ge,ge=Ne;break e}}else if(he.elementType===st||typeof st=="object"&&st!==null&&st.$$typeof===Y&&Al(st)===he.type){u(ge,he.sibling),Ne=y(he,Te.props),jc(Ne,Te),Ne.return=ge,ge=Ne;break e}u(ge,he);break}else a(ge,he);he=he.sibling}Te.type===C?(Ne=Hs(Te.props.children,ge.mode,Ne,Te.key),Ne.return=ge,ge=Ne):(Ne=Uc(Te.type,Te.key,Te.props,null,ge.mode,Ne),jc(Ne,Te),Ne.return=ge,ge=Ne)}return R(ge);case A:e:{for(st=Te.key;he!==null;){if(he.key===st)if(he.tag===4&&he.stateNode.containerInfo===Te.containerInfo&&he.stateNode.implementation===Te.implementation){u(ge,he.sibling),Ne=y(he,Te.children||[]),Ne.return=ge,ge=Ne;break e}else{u(ge,he);break}else a(ge,he);he=he.sibling}Ne=So(Te,ge.mode,Ne),Ne.return=ge,ge=Ne}return R(ge);case Y:return Te=Al(Te),ti(ge,he,Te,Ne)}if(be(Te))return Ke(ge,he,Te,Ne);if(ae(Te)){if(st=ae(Te),typeof st!="function")throw Error(n(150));return Te=st.call(Te),lt(ge,he,Te,Ne)}if(typeof Te.then=="function")return ti(ge,he,mh(Te),Ne);if(Te.$$typeof===B)return ti(ge,he,pt(ge,Te),Ne);gh(ge,Te)}return typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint"?(Te=""+Te,he!==null&&he.tag===6?(u(ge,he.sibling),Ne=y(he,Te),Ne.return=ge,ge=Ne):(u(ge,he),Ne=xl(Te,ge.mode,Ne),Ne.return=ge,ge=Ne),R(ge)):u(ge,he)}return function(ge,he,Te,Ne){try{qc=0;var st=ti(ge,he,Te,Ne);return Cu=null,st}catch(et){if(et===Eu||et===fh)throw et;var zt=Di(29,et,null,ge.mode);return zt.lanes=Ne,zt.return=ge,zt}finally{}}}var kl=Q_(!0),Z_=Q_(!1),Co=!1;function Mp(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Np(r,a){r=r.updateQueue,a.updateQueue===r&&(a.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Ao(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Do(r,a,u){var d=r.updateQueue;if(d===null)return null;if(d=d.shared,(qt&2)!==0){var y=d.pending;return y===null?a.next=a:(a.next=y.next,y.next=a),d.pending=a,a=Su(r),lh(r,null,u),a}return js(r,d,a,u),Su(r)}function Hc(r,a,u){if(a=a.updateQueue,a!==null&&(a=a.shared,(u&4194048)!==0)){var d=a.lanes;d&=r.pendingLanes,u|=d,a.lanes=u,nn(r,u)}}function Bp(r,a){var u=r.updateQueue,d=r.alternate;if(d!==null&&(d=d.updateQueue,u===d)){var y=null,v=null;if(u=u.firstBaseUpdate,u!==null){do{var R={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};v===null?y=v=R:v=v.next=R,u=u.next}while(u!==null);v===null?y=v=a:v=v.next=a}else y=v=a;u={baseState:d.baseState,firstBaseUpdate:y,lastBaseUpdate:v,shared:d.shared,callbacks:d.callbacks},r.updateQueue=u;return}r=u.lastBaseUpdate,r===null?u.firstBaseUpdate=a:r.next=a,u.lastBaseUpdate=a}var Lp=!1;function Vc(){if(Lp){var r=ln;if(r!==null)throw r}}function Gc(r,a,u,d){Lp=!1;var y=r.updateQueue;Co=!1;var v=y.firstBaseUpdate,R=y.lastBaseUpdate,G=y.shared.pending;if(G!==null){y.shared.pending=null;var oe=G,Se=oe.next;oe.next=null,R===null?v=Se:R.next=Se,R=oe;var Me=r.alternate;Me!==null&&(Me=Me.updateQueue,G=Me.lastBaseUpdate,G!==R&&(G===null?Me.firstBaseUpdate=Se:G.next=Se,Me.lastBaseUpdate=oe))}if(v!==null){var Le=y.baseState;R=0,Me=Se=oe=null,G=v;do{var we=G.lane&-536870913,De=we!==G.lane;if(De?(kt&we)===we:(d&we)===we){we!==0&&we===Gr&&(Lp=!0),Me!==null&&(Me=Me.next={lane:0,tag:G.tag,payload:G.payload,callback:null,next:null});e:{var Ke=r,lt=G;we=a;var ti=u;switch(lt.tag){case 1:if(Ke=lt.payload,typeof Ke=="function"){Le=Ke.call(ti,Le,we);break e}Le=Ke;break e;case 3:Ke.flags=Ke.flags&-65537|128;case 0:if(Ke=lt.payload,we=typeof Ke=="function"?Ke.call(ti,Le,we):Ke,we==null)break e;Le=_({},Le,we);break e;case 2:Co=!0}}we=G.callback,we!==null&&(r.flags|=64,De&&(r.flags|=8192),De=y.callbacks,De===null?y.callbacks=[we]:De.push(we))}else De={lane:we,tag:G.tag,payload:G.payload,callback:G.callback,next:null},Me===null?(Se=Me=De,oe=Le):Me=Me.next=De,R|=we;if(G=G.next,G===null){if(G=y.shared.pending,G===null)break;De=G,G=De.next,De.next=null,y.lastBaseUpdate=De,y.shared.pending=null}}while(!0);Me===null&&(oe=Le),y.baseState=oe,y.firstBaseUpdate=Se,y.lastBaseUpdate=Me,v===null&&(y.shared.lanes=0),Ro|=R,r.lanes=R,r.memoizedState=Le}}function J_(r,a){if(typeof r!="function")throw Error(n(191,r));r.call(a)}function ev(r,a){var u=r.callbacks;if(u!==null)for(r.callbacks=null,r=0;r<u.length;r++)J_(u[r],a)}var Au=P(null),yh=P(0);function tv(r,a){r=ja,ye(yh,r),ye(Au,a),ja=r|a.baseLanes}function Up(){ye(yh,ja),ye(Au,Au.current)}function Pp(){ja=yh.current,ne(Au),ne(yh)}var Tr=P(null),Wr=null;function ko(r){var a=r.alternate;ye(Ni,Ni.current&1),ye(Tr,r),Wr===null&&(a===null||Au.current!==null||a.memoizedState!==null)&&(Wr=r)}function zp(r){ye(Ni,Ni.current),ye(Tr,r),Wr===null&&(Wr=r)}function iv(r){r.tag===22?(ye(Ni,Ni.current),ye(Tr,r),Wr===null&&(Wr=r)):$o()}function $o(){ye(Ni,Ni.current),ye(Tr,Tr.current)}function xr(r){ne(Tr),Wr===r&&(Wr=null),ne(Ni)}var Ni=P(0);function _h(r){for(var a=r;a!==null;){if(a.tag===13){var u=a.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||Gm(u)||Wm(u)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Na=0,vt=null,Jt=null,ji=null,vh=!1,Du=!1,$l=!1,bh=0,Wc=0,ku=null,Ok=0;function ki(){throw Error(n(321))}function Fp(r,a){if(a===null)return!1;for(var u=0;u<a.length&&u<r.length;u++)if(!Qi(r[u],a[u]))return!1;return!0}function qp(r,a,u,d,y,v){return Na=v,vt=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,J.H=r===null||r.memoizedState===null?Pv:nm,$l=!1,v=u(d,y),$l=!1,Du&&(v=rv(a,u,d,y)),nv(r),v}function nv(r){J.H=Yc;var a=Jt!==null&&Jt.next!==null;if(Na=0,ji=Jt=vt=null,vh=!1,Wc=0,ku=null,a)throw Error(n(300));r===null||Hi||(r=r.dependencies,r!==null&&je(r)&&(Hi=!0))}function rv(r,a,u,d){vt=r;var y=0;do{if(Du&&(ku=null),Wc=0,Du=!1,25<=y)throw Error(n(301));if(y+=1,ji=Jt=null,r.updateQueue!=null){var v=r.updateQueue;v.lastEffect=null,v.events=null,v.stores=null,v.memoCache!=null&&(v.memoCache.index=0)}J.H=zv,v=a(u,d)}while(Du);return v}function Ik(){var r=J.H,a=r.useState()[0];return a=typeof a.then=="function"?Xc(a):a,r=r.useState()[0],(Jt!==null?Jt.memoizedState:null)!==r&&(vt.flags|=1024),a}function jp(){var r=bh!==0;return bh=0,r}function Hp(r,a,u){a.updateQueue=r.updateQueue,a.flags&=-2053,r.lanes&=~u}function Vp(r){if(vh){for(r=r.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}vh=!1}Na=0,ji=Jt=vt=null,Du=!1,Wc=bh=0,ku=null}function Fn(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ji===null?vt.memoizedState=ji=r:ji=ji.next=r,ji}function Bi(){if(Jt===null){var r=vt.alternate;r=r!==null?r.memoizedState:null}else r=Jt.next;var a=ji===null?vt.memoizedState:ji.next;if(a!==null)ji=a,Jt=r;else{if(r===null)throw vt.alternate===null?Error(n(467)):Error(n(310));Jt=r,r={memoizedState:Jt.memoizedState,baseState:Jt.baseState,baseQueue:Jt.baseQueue,queue:Jt.queue,next:null},ji===null?vt.memoizedState=ji=r:ji=ji.next=r}return ji}function Th(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Xc(r){var a=Wc;return Wc+=1,ku===null&&(ku=[]),r=X_(ku,r,a),a=vt,(ji===null?a.memoizedState:ji.next)===null&&(a=a.alternate,J.H=a===null||a.memoizedState===null?Pv:nm),r}function xh(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Xc(r);if(r.$$typeof===B)return Ge(r)}throw Error(n(438,String(r)))}function Gp(r){var a=null,u=vt.updateQueue;if(u!==null&&(a=u.memoCache),a==null){var d=vt.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(a={data:d.data.map(function(y){return y.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),u===null&&(u=Th(),vt.updateQueue=u),u.memoCache=a,u=a.data[a.index],u===void 0)for(u=a.data[a.index]=Array(r),d=0;d<r;d++)u[d]=H;return a.index++,u}function Ba(r,a){return typeof a=="function"?a(r):a}function Sh(r){var a=Bi();return Wp(a,Jt,r)}function Wp(r,a,u){var d=r.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=u;var y=r.baseQueue,v=d.pending;if(v!==null){if(y!==null){var R=y.next;y.next=v.next,v.next=R}a.baseQueue=y=v,d.pending=null}if(v=r.baseState,y===null)r.memoizedState=v;else{a=y.next;var G=R=null,oe=null,Se=a,Me=!1;do{var Le=Se.lane&-536870913;if(Le!==Se.lane?(kt&Le)===Le:(Na&Le)===Le){var we=Se.revertLane;if(we===0)oe!==null&&(oe=oe.next={lane:0,revertLane:0,gesture:null,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null}),Le===Gr&&(Me=!0);else if((Na&we)===we){Se=Se.next,we===Gr&&(Me=!0);continue}else Le={lane:0,revertLane:Se.revertLane,gesture:null,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null},oe===null?(G=oe=Le,R=v):oe=oe.next=Le,vt.lanes|=we,Ro|=we;Le=Se.action,$l&&u(v,Le),v=Se.hasEagerState?Se.eagerState:u(v,Le)}else we={lane:Le,revertLane:Se.revertLane,gesture:Se.gesture,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null},oe===null?(G=oe=we,R=v):oe=oe.next=we,vt.lanes|=Le,Ro|=Le;Se=Se.next}while(Se!==null&&Se!==a);if(oe===null?R=v:oe.next=G,!Qi(v,r.memoizedState)&&(Hi=!0,Me&&(u=ln,u!==null)))throw u;r.memoizedState=v,r.baseState=R,r.baseQueue=oe,d.lastRenderedState=v}return y===null&&(d.lanes=0),[r.memoizedState,d.dispatch]}function Xp(r){var a=Bi(),u=a.queue;if(u===null)throw Error(n(311));u.lastRenderedReducer=r;var d=u.dispatch,y=u.pending,v=a.memoizedState;if(y!==null){u.pending=null;var R=y=y.next;do v=r(v,R.action),R=R.next;while(R!==y);Qi(v,a.memoizedState)||(Hi=!0),a.memoizedState=v,a.baseQueue===null&&(a.baseState=v),u.lastRenderedState=v}return[v,d]}function sv(r,a,u){var d=vt,y=Bi(),v=wt;if(v){if(u===void 0)throw Error(n(407));u=u()}else u=a();var R=!Qi((Jt||y).memoizedState,u);if(R&&(y.memoizedState=u,Hi=!0),y=y.queue,Qp(lv.bind(null,d,y,r),[r]),y.getSnapshot!==a||R||ji!==null&&ji.memoizedState.tag&1){if(d.flags|=2048,$u(9,{destroy:void 0},ov.bind(null,d,y,u,a),null),li===null)throw Error(n(349));v||(Na&127)!==0||av(d,a,u)}return u}function av(r,a,u){r.flags|=16384,r={getSnapshot:a,value:u},a=vt.updateQueue,a===null?(a=Th(),vt.updateQueue=a,a.stores=[r]):(u=a.stores,u===null?a.stores=[r]:u.push(r))}function ov(r,a,u,d){a.value=u,a.getSnapshot=d,uv(a)&&cv(r)}function lv(r,a,u){return u(function(){uv(a)&&cv(r)})}function uv(r){var a=r.getSnapshot;r=r.value;try{var u=a();return!Qi(r,u)}catch{return!0}}function cv(r){var a=Ra(r,2);a!==null&&or(a,r,2)}function Kp(r){var a=Fn();if(typeof r=="function"){var u=r;if(r=u(),$l){Bn(!0);try{u()}finally{Bn(!1)}}}return a.memoizedState=a.baseState=r,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ba,lastRenderedState:r},a}function dv(r,a,u,d){return r.baseState=u,Wp(r,Jt,typeof d=="function"?d:Ba)}function Rk(r,a,u,d,y){if(Ch(r))throw Error(n(485));if(r=a.action,r!==null){var v={payload:y,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){v.listeners.push(R)}};J.T!==null?u(!0):v.isTransition=!1,d(v),u=a.pending,u===null?(v.next=a.pending=v,hv(a,v)):(v.next=u.next,a.pending=u.next=v)}}function hv(r,a){var u=a.action,d=a.payload,y=r.state;if(a.isTransition){var v=J.T,R={};J.T=R;try{var G=u(y,d),oe=J.S;oe!==null&&oe(R,G),fv(r,a,G)}catch(Se){Yp(r,a,Se)}finally{v!==null&&R.types!==null&&(v.types=R.types),J.T=v}}else try{v=u(y,d),fv(r,a,v)}catch(Se){Yp(r,a,Se)}}function fv(r,a,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(d){pv(r,a,d)},function(d){return Yp(r,a,d)}):pv(r,a,u)}function pv(r,a,u){a.status="fulfilled",a.value=u,mv(a),r.state=u,a=r.pending,a!==null&&(u=a.next,u===a?r.pending=null:(u=u.next,a.next=u,hv(r,u)))}function Yp(r,a,u){var d=r.pending;if(r.pending=null,d!==null){d=d.next;do a.status="rejected",a.reason=u,mv(a),a=a.next;while(a!==d)}r.action=null}function mv(r){r=r.listeners;for(var a=0;a<r.length;a++)(0,r[a])()}function gv(r,a){return a}function yv(r,a){if(wt){var u=li.formState;if(u!==null){e:{var d=vt;if(wt){if(oi){t:{for(var y=oi,v=ir;y.nodeType!==8;){if(!v){y=null;break t}if(y=Xr(y.nextSibling),y===null){y=null;break t}}v=y.data,y=v==="F!"||v==="F"?y:null}if(y){oi=Xr(y.nextSibling),d=y.data==="F!";break e}}Xs(d)}d=!1}d&&(a=u[0])}}return u=Fn(),u.memoizedState=u.baseState=a,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gv,lastRenderedState:a},u.queue=d,u=Bv.bind(null,vt,d),d.dispatch=u,d=Kp(!1),v=im.bind(null,vt,!1,d.queue),d=Fn(),y={state:a,dispatch:null,action:r,pending:null},d.queue=y,u=Rk.bind(null,vt,y,v,u),y.dispatch=u,d.memoizedState=r,[a,u,!1]}function _v(r){var a=Bi();return vv(a,Jt,r)}function vv(r,a,u){if(a=Wp(r,a,gv)[0],r=Sh(Ba)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var d=Xc(a)}catch(R){throw R===Eu?fh:R}else d=a;a=Bi();var y=a.queue,v=y.dispatch;return u!==a.memoizedState&&(vt.flags|=2048,$u(9,{destroy:void 0},Mk.bind(null,y,u),null)),[d,v,r]}function Mk(r,a){r.action=a}function bv(r){var a=Bi(),u=Jt;if(u!==null)return vv(a,u,r);Bi(),a=a.memoizedState,u=Bi();var d=u.queue.dispatch;return u.memoizedState=r,[a,d,!1]}function $u(r,a,u,d){return r={tag:r,create:u,deps:d,inst:a,next:null},a=vt.updateQueue,a===null&&(a=Th(),vt.updateQueue=a),u=a.lastEffect,u===null?a.lastEffect=r.next=r:(d=u.next,u.next=r,r.next=d,a.lastEffect=r),r}function Tv(){return Bi().memoizedState}function wh(r,a,u,d){var y=Fn();vt.flags|=r,y.memoizedState=$u(1|a,{destroy:void 0},u,d===void 0?null:d)}function Eh(r,a,u,d){var y=Bi();d=d===void 0?null:d;var v=y.memoizedState.inst;Jt!==null&&d!==null&&Fp(d,Jt.memoizedState.deps)?y.memoizedState=$u(a,v,u,d):(vt.flags|=r,y.memoizedState=$u(1|a,v,u,d))}function xv(r,a){wh(8390656,8,r,a)}function Qp(r,a){Eh(2048,8,r,a)}function Nk(r){vt.flags|=4;var a=vt.updateQueue;if(a===null)a=Th(),vt.updateQueue=a,a.events=[r];else{var u=a.events;u===null?a.events=[r]:u.push(r)}}function Sv(r){var a=Bi().memoizedState;return Nk({ref:a,nextImpl:r}),function(){if((qt&2)!==0)throw Error(n(440));return a.impl.apply(void 0,arguments)}}function wv(r,a){return Eh(4,2,r,a)}function Ev(r,a){return Eh(4,4,r,a)}function Cv(r,a){if(typeof a=="function"){r=r();var u=a(r);return function(){typeof u=="function"?u():a(null)}}if(a!=null)return r=r(),a.current=r,function(){a.current=null}}function Av(r,a,u){u=u!=null?u.concat([r]):null,Eh(4,4,Cv.bind(null,a,r),u)}function Zp(){}function Dv(r,a){var u=Bi();a=a===void 0?null:a;var d=u.memoizedState;return a!==null&&Fp(a,d[1])?d[0]:(u.memoizedState=[r,a],r)}function kv(r,a){var u=Bi();a=a===void 0?null:a;var d=u.memoizedState;if(a!==null&&Fp(a,d[1]))return d[0];if(d=r(),$l){Bn(!0);try{r()}finally{Bn(!1)}}return u.memoizedState=[d,a],d}function Jp(r,a,u){return u===void 0||(Na&1073741824)!==0&&(kt&261930)===0?r.memoizedState=a:(r.memoizedState=u,r=$b(),vt.lanes|=r,Ro|=r,u)}function $v(r,a,u,d){return Qi(u,a)?u:Au.current!==null?(r=Jp(r,u,d),Qi(r,a)||(Hi=!0),r):(Na&42)===0||(Na&1073741824)!==0&&(kt&261930)===0?(Hi=!0,r.memoizedState=u):(r=$b(),vt.lanes|=r,Ro|=r,a)}function Ov(r,a,u,d,y){var v=ee.p;ee.p=v!==0&&8>v?v:8;var R=J.T,G={};J.T=G,im(r,!1,a,u);try{var oe=y(),Se=J.S;if(Se!==null&&Se(G,oe),oe!==null&&typeof oe=="object"&&typeof oe.then=="function"){var Me=$k(oe,d);Kc(r,a,Me,Er(r))}else Kc(r,a,d,Er(r))}catch(Le){Kc(r,a,{then:function(){},status:"rejected",reason:Le},Er())}finally{ee.p=v,R!==null&&G.types!==null&&(R.types=G.types),J.T=R}}function Bk(){}function em(r,a,u,d){if(r.tag!==5)throw Error(n(476));var y=Iv(r).queue;Ov(r,y,a,de,u===null?Bk:function(){return Rv(r),u(d)})}function Iv(r){var a=r.memoizedState;if(a!==null)return a;a={memoizedState:de,baseState:de,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ba,lastRenderedState:de},next:null};var u={};return a.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ba,lastRenderedState:u},next:null},r.memoizedState=a,r=r.alternate,r!==null&&(r.memoizedState=a),a}function Rv(r){var a=Iv(r);a.next===null&&(a=r.alternate.memoizedState),Kc(r,a.next.queue,{},Er())}function tm(){return Ge(hd)}function Mv(){return Bi().memoizedState}function Nv(){return Bi().memoizedState}function Lk(r){for(var a=r.return;a!==null;){switch(a.tag){case 24:case 3:var u=Er();r=Ao(u);var d=Do(a,r,u);d!==null&&(or(d,a,u),Hc(d,a,u)),a={cache:Ma()},r.payload=a;return}a=a.return}}function Uk(r,a,u){var d=Er();u={lane:d,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Ch(r)?Lv(a,u):(u=Tl(r,a,u,d),u!==null&&(or(u,r,d),Uv(u,a,d)))}function Bv(r,a,u){var d=Er();Kc(r,a,u,d)}function Kc(r,a,u,d){var y={lane:d,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null};if(Ch(r))Lv(a,y);else{var v=r.alternate;if(r.lanes===0&&(v===null||v.lanes===0)&&(v=a.lastRenderedReducer,v!==null))try{var R=a.lastRenderedState,G=v(R,u);if(y.hasEagerState=!0,y.eagerState=G,Qi(G,R))return js(r,a,y,0),li===null&&Vr(),!1}catch{}finally{}if(u=Tl(r,a,y,d),u!==null)return or(u,r,d),Uv(u,a,d),!0}return!1}function im(r,a,u,d){if(d={lane:2,revertLane:Mm(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},Ch(r)){if(a)throw Error(n(479))}else a=Tl(r,u,d,2),a!==null&&or(a,r,2)}function Ch(r){var a=r.alternate;return r===vt||a!==null&&a===vt}function Lv(r,a){Du=vh=!0;var u=r.pending;u===null?a.next=a:(a.next=u.next,u.next=a),r.pending=a}function Uv(r,a,u){if((u&4194048)!==0){var d=a.lanes;d&=r.pendingLanes,u|=d,a.lanes=u,nn(r,u)}}var Yc={readContext:Ge,use:xh,useCallback:ki,useContext:ki,useEffect:ki,useImperativeHandle:ki,useLayoutEffect:ki,useInsertionEffect:ki,useMemo:ki,useReducer:ki,useRef:ki,useState:ki,useDebugValue:ki,useDeferredValue:ki,useTransition:ki,useSyncExternalStore:ki,useId:ki,useHostTransitionStatus:ki,useFormState:ki,useActionState:ki,useOptimistic:ki,useMemoCache:ki,useCacheRefresh:ki};Yc.useEffectEvent=ki;var Pv={readContext:Ge,use:xh,useCallback:function(r,a){return Fn().memoizedState=[r,a===void 0?null:a],r},useContext:Ge,useEffect:xv,useImperativeHandle:function(r,a,u){u=u!=null?u.concat([r]):null,wh(4194308,4,Cv.bind(null,a,r),u)},useLayoutEffect:function(r,a){return wh(4194308,4,r,a)},useInsertionEffect:function(r,a){wh(4,2,r,a)},useMemo:function(r,a){var u=Fn();a=a===void 0?null:a;var d=r();if($l){Bn(!0);try{r()}finally{Bn(!1)}}return u.memoizedState=[d,a],d},useReducer:function(r,a,u){var d=Fn();if(u!==void 0){var y=u(a);if($l){Bn(!0);try{u(a)}finally{Bn(!1)}}}else y=a;return d.memoizedState=d.baseState=y,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:y},d.queue=r,r=r.dispatch=Uk.bind(null,vt,r),[d.memoizedState,r]},useRef:function(r){var a=Fn();return r={current:r},a.memoizedState=r},useState:function(r){r=Kp(r);var a=r.queue,u=Bv.bind(null,vt,a);return a.dispatch=u,[r.memoizedState,u]},useDebugValue:Zp,useDeferredValue:function(r,a){var u=Fn();return Jp(u,r,a)},useTransition:function(){var r=Kp(!1);return r=Ov.bind(null,vt,r.queue,!0,!1),Fn().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,a,u){var d=vt,y=Fn();if(wt){if(u===void 0)throw Error(n(407));u=u()}else{if(u=a(),li===null)throw Error(n(349));(kt&127)!==0||av(d,a,u)}y.memoizedState=u;var v={value:u,getSnapshot:a};return y.queue=v,xv(lv.bind(null,d,v,r),[r]),d.flags|=2048,$u(9,{destroy:void 0},ov.bind(null,d,v,u,a),null),u},useId:function(){var r=Fn(),a=li.identifierPrefix;if(wt){var u=vn,d=br;u=(d&~(1<<32-zi(d)-1)).toString(32)+u,a="_"+a+"R_"+u,u=bh++,0<u&&(a+="H"+u.toString(32)),a+="_"}else u=Ok++,a="_"+a+"r_"+u.toString(32)+"_";return r.memoizedState=a},useHostTransitionStatus:tm,useFormState:yv,useActionState:yv,useOptimistic:function(r){var a=Fn();a.memoizedState=a.baseState=r;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=u,a=im.bind(null,vt,!0,u),u.dispatch=a,[r,a]},useMemoCache:Gp,useCacheRefresh:function(){return Fn().memoizedState=Lk.bind(null,vt)},useEffectEvent:function(r){var a=Fn(),u={impl:r};return a.memoizedState=u,function(){if((qt&2)!==0)throw Error(n(440));return u.impl.apply(void 0,arguments)}}},nm={readContext:Ge,use:xh,useCallback:Dv,useContext:Ge,useEffect:Qp,useImperativeHandle:Av,useInsertionEffect:wv,useLayoutEffect:Ev,useMemo:kv,useReducer:Sh,useRef:Tv,useState:function(){return Sh(Ba)},useDebugValue:Zp,useDeferredValue:function(r,a){var u=Bi();return $v(u,Jt.memoizedState,r,a)},useTransition:function(){var r=Sh(Ba)[0],a=Bi().memoizedState;return[typeof r=="boolean"?r:Xc(r),a]},useSyncExternalStore:sv,useId:Mv,useHostTransitionStatus:tm,useFormState:_v,useActionState:_v,useOptimistic:function(r,a){var u=Bi();return dv(u,Jt,r,a)},useMemoCache:Gp,useCacheRefresh:Nv};nm.useEffectEvent=Sv;var zv={readContext:Ge,use:xh,useCallback:Dv,useContext:Ge,useEffect:Qp,useImperativeHandle:Av,useInsertionEffect:wv,useLayoutEffect:Ev,useMemo:kv,useReducer:Xp,useRef:Tv,useState:function(){return Xp(Ba)},useDebugValue:Zp,useDeferredValue:function(r,a){var u=Bi();return Jt===null?Jp(u,r,a):$v(u,Jt.memoizedState,r,a)},useTransition:function(){var r=Xp(Ba)[0],a=Bi().memoizedState;return[typeof r=="boolean"?r:Xc(r),a]},useSyncExternalStore:sv,useId:Mv,useHostTransitionStatus:tm,useFormState:bv,useActionState:bv,useOptimistic:function(r,a){var u=Bi();return Jt!==null?dv(u,Jt,r,a):(u.baseState=r,[r,u.queue.dispatch])},useMemoCache:Gp,useCacheRefresh:Nv};zv.useEffectEvent=Sv;function rm(r,a,u,d){a=r.memoizedState,u=u(d,a),u=u==null?a:_({},a,u),r.memoizedState=u,r.lanes===0&&(r.updateQueue.baseState=u)}var sm={enqueueSetState:function(r,a,u){r=r._reactInternals;var d=Er(),y=Ao(d);y.payload=a,u!=null&&(y.callback=u),a=Do(r,y,d),a!==null&&(or(a,r,d),Hc(a,r,d))},enqueueReplaceState:function(r,a,u){r=r._reactInternals;var d=Er(),y=Ao(d);y.tag=1,y.payload=a,u!=null&&(y.callback=u),a=Do(r,y,d),a!==null&&(or(a,r,d),Hc(a,r,d))},enqueueForceUpdate:function(r,a){r=r._reactInternals;var u=Er(),d=Ao(u);d.tag=2,a!=null&&(d.callback=a),a=Do(r,d,u),a!==null&&(or(a,r,u),Hc(a,r,u))}};function Fv(r,a,u,d,y,v,R){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(d,v,R):a.prototype&&a.prototype.isPureReactComponent?!yr(u,d)||!yr(y,v):!0}function qv(r,a,u,d){r=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(u,d),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(u,d),a.state!==r&&sm.enqueueReplaceState(a,a.state,null)}function Ol(r,a){var u=a;if("ref"in a){u={};for(var d in a)d!=="ref"&&(u[d]=a[d])}if(r=r.defaultProps){u===a&&(u=_({},u));for(var y in r)u[y]===void 0&&(u[y]=r[y])}return u}function jv(r){Xt(r)}function Hv(r){console.error(r)}function Vv(r){Xt(r)}function Ah(r,a){try{var u=r.onUncaughtError;u(a.value,{componentStack:a.stack})}catch(d){setTimeout(function(){throw d})}}function Gv(r,a,u){try{var d=r.onCaughtError;d(u.value,{componentStack:u.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function am(r,a,u){return u=Ao(u),u.tag=3,u.payload={element:null},u.callback=function(){Ah(r,a)},u}function Wv(r){return r=Ao(r),r.tag=3,r}function Xv(r,a,u,d){var y=u.type.getDerivedStateFromError;if(typeof y=="function"){var v=d.value;r.payload=function(){return y(v)},r.callback=function(){Gv(a,u,d)}}var R=u.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(r.callback=function(){Gv(a,u,d),typeof y!="function"&&(Mo===null?Mo=new Set([this]):Mo.add(this));var G=d.stack;this.componentDidCatch(d.value,{componentStack:G!==null?G:""})})}function Pk(r,a,u,d,y){if(u.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(a=u.alternate,a!==null&&Ce(a,u,y,!0),u=Tr.current,u!==null){switch(u.tag){case 31:case 13:return Wr===null?Ph():u.alternate===null&&$i===0&&($i=3),u.flags&=-257,u.flags|=65536,u.lanes=y,d===ph?u.flags|=16384:(a=u.updateQueue,a===null?u.updateQueue=new Set([d]):a.add(d),Om(r,d,y)),!1;case 22:return u.flags|=65536,d===ph?u.flags|=16384:(a=u.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([d])},u.updateQueue=a):(u=a.retryQueue,u===null?a.retryQueue=new Set([d]):u.add(d)),Om(r,d,y)),!1}throw Error(n(435,u.tag))}return Om(r,d,y),Ph(),!1}if(wt)return a=Tr.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=y,d!==zc&&(r=Error(n(422),{cause:d}),x(Jn(r,u)))):(d!==zc&&(a=Error(n(423),{cause:d}),x(Jn(a,u))),r=r.current.alternate,r.flags|=65536,y&=-y,r.lanes|=y,d=Jn(d,u),y=am(r.stateNode,d,y),Bp(r,y),$i!==4&&($i=2)),!1;var v=Error(n(520),{cause:d});if(v=Jn(v,u),rd===null?rd=[v]:rd.push(v),$i!==4&&($i=2),a===null)return!0;d=Jn(d,u),u=a;do{switch(u.tag){case 3:return u.flags|=65536,r=y&-y,u.lanes|=r,r=am(u.stateNode,d,r),Bp(u,r),!1;case 1:if(a=u.type,v=u.stateNode,(u.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Mo===null||!Mo.has(v))))return u.flags|=65536,y&=-y,u.lanes|=y,y=Wv(y),Xv(y,r,u,d),Bp(u,y),!1}u=u.return}while(u!==null);return!1}var om=Error(n(461)),Hi=!1;function bn(r,a,u,d){a.child=r===null?Z_(a,null,u,d):kl(a,r.child,u,d)}function Kv(r,a,u,d,y){u=u.render;var v=a.ref;if("ref"in d){var R={};for(var G in d)G!=="ref"&&(R[G]=d[G])}else R=d;return Ie(a),d=qp(r,a,u,R,v,y),G=jp(),r!==null&&!Hi?(Hp(r,a,y),La(r,a,y)):(wt&&G&&Zi(a),a.flags|=1,bn(r,a,d,y),a.child)}function Yv(r,a,u,d,y){if(r===null){var v=u.type;return typeof v=="function"&&!Lc(v)&&v.defaultProps===void 0&&u.compare===null?(a.tag=15,a.type=v,Qv(r,a,v,d,y)):(r=Uc(u.type,null,d,a,a.mode,y),r.ref=a.ref,r.return=a,a.child=r)}if(v=r.child,!mm(r,y)){var R=v.memoizedProps;if(u=u.compare,u=u!==null?u:yr,u(R,d)&&r.ref===a.ref)return La(r,a,y)}return a.flags|=1,r=vs(v,d),r.ref=a.ref,r.return=a,a.child=r}function Qv(r,a,u,d,y){if(r!==null){var v=r.memoizedProps;if(yr(v,d)&&r.ref===a.ref)if(Hi=!1,a.pendingProps=d=v,mm(r,y))(r.flags&131072)!==0&&(Hi=!0);else return a.lanes=r.lanes,La(r,a,y)}return lm(r,a,u,d,y)}function Zv(r,a,u,d){var y=d.children,v=r!==null?r.memoizedState:null;if(r===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.mode==="hidden"){if((a.flags&128)!==0){if(v=v!==null?v.baseLanes|u:u,r!==null){for(d=a.child=r.child,y=0;d!==null;)y=y|d.lanes|d.childLanes,d=d.sibling;d=y&~v}else d=0,a.child=null;return Jv(r,a,v,u,d)}if((u&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},r!==null&&hh(a,v!==null?v.cachePool:null),v!==null?tv(a,v):Up(),iv(a);else return d=a.lanes=536870912,Jv(r,a,v!==null?v.baseLanes|u:u,u,d)}else v!==null?(hh(a,v.cachePool),tv(a,v),$o(),a.memoizedState=null):(r!==null&&hh(a,null),Up(),$o());return bn(r,a,y,u),a.child}function Qc(r,a){return r!==null&&r.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Jv(r,a,u,d,y){var v=Ip();return v=v===null?null:{parent:di._currentValue,pool:v},a.memoizedState={baseLanes:u,cachePool:v},r!==null&&hh(a,null),Up(),iv(a),r!==null&&Ce(r,a,d,!0),a.childLanes=y,null}function Dh(r,a){return a=$h({mode:a.mode,children:a.children},r.mode),a.ref=r.ref,r.child=a,a.return=r,a}function eb(r,a,u){return kl(a,r.child,null,u),r=Dh(a,a.pendingProps),r.flags|=2,xr(a),a.memoizedState=null,r}function zk(r,a,u){var d=a.pendingProps,y=(a.flags&128)!==0;if(a.flags&=-129,r===null){if(wt){if(d.mode==="hidden")return r=Dh(a,d),a.lanes=536870912,Qc(null,r);if(zp(a),(r=oi)?(r=h2(r,ir),r=r!==null&&r.data==="&"?r:null,r!==null&&(a.memoizedState={dehydrated:r,treeContext:Vs!==null?{id:br,overflow:vn}:null,retryLane:536870912,hydrationErrors:null},u=Pc(r),u.return=a,a.child=u,qi=a,oi=null)):r=null,r===null)throw Xs(a);return a.lanes=536870912,null}return Dh(a,d)}var v=r.memoizedState;if(v!==null){var R=v.dehydrated;if(zp(a),y)if(a.flags&256)a.flags&=-257,a=eb(r,a,u);else if(a.memoizedState!==null)a.child=r.child,a.flags|=128,a=null;else throw Error(n(558));else if(Hi||Ce(r,a,u,!1),y=(u&r.childLanes)!==0,Hi||y){if(d=li,d!==null&&(R=gn(d,u),R!==0&&R!==v.retryLane))throw v.retryLane=R,Ra(r,R),or(d,r,R),om;Ph(),a=eb(r,a,u)}else r=v.treeContext,oi=Xr(R.nextSibling),qi=a,wt=!0,Ws=null,ir=!1,r!==null&&ch(a,r),a=Dh(a,d),a.flags|=4096;return a}return r=vs(r.child,{mode:d.mode,children:d.children}),r.ref=a.ref,a.child=r,r.return=a,r}function kh(r,a){var u=a.ref;if(u===null)r!==null&&r.ref!==null&&(a.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(n(284));(r===null||r.ref!==u)&&(a.flags|=4194816)}}function lm(r,a,u,d,y){return Ie(a),u=qp(r,a,u,d,void 0,y),d=jp(),r!==null&&!Hi?(Hp(r,a,y),La(r,a,y)):(wt&&d&&Zi(a),a.flags|=1,bn(r,a,u,y),a.child)}function tb(r,a,u,d,y,v){return Ie(a),a.updateQueue=null,u=rv(a,d,u,y),nv(r),d=jp(),r!==null&&!Hi?(Hp(r,a,v),La(r,a,v)):(wt&&d&&Zi(a),a.flags|=1,bn(r,a,u,v),a.child)}function ib(r,a,u,d,y){if(Ie(a),a.stateNode===null){var v=xo,R=u.contextType;typeof R=="object"&&R!==null&&(v=Ge(R)),v=new u(d,v),a.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=sm,a.stateNode=v,v._reactInternals=a,v=a.stateNode,v.props=d,v.state=a.memoizedState,v.refs={},Mp(a),R=u.contextType,v.context=typeof R=="object"&&R!==null?Ge(R):xo,v.state=a.memoizedState,R=u.getDerivedStateFromProps,typeof R=="function"&&(rm(a,u,R,d),v.state=a.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(R=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),R!==v.state&&sm.enqueueReplaceState(v,v.state,null),Gc(a,d,v,y),Vc(),v.state=a.memoizedState),typeof v.componentDidMount=="function"&&(a.flags|=4194308),d=!0}else if(r===null){v=a.stateNode;var G=a.memoizedProps,oe=Ol(u,G);v.props=oe;var Se=v.context,Me=u.contextType;R=xo,typeof Me=="object"&&Me!==null&&(R=Ge(Me));var Le=u.getDerivedStateFromProps;Me=typeof Le=="function"||typeof v.getSnapshotBeforeUpdate=="function",G=a.pendingProps!==G,Me||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(G||Se!==R)&&qv(a,v,d,R),Co=!1;var we=a.memoizedState;v.state=we,Gc(a,d,v,y),Vc(),Se=a.memoizedState,G||we!==Se||Co?(typeof Le=="function"&&(rm(a,u,Le,d),Se=a.memoizedState),(oe=Co||Fv(a,u,oe,d,we,Se,R))?(Me||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(a.flags|=4194308)):(typeof v.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=d,a.memoizedState=Se),v.props=d,v.state=Se,v.context=R,d=oe):(typeof v.componentDidMount=="function"&&(a.flags|=4194308),d=!1)}else{v=a.stateNode,Np(r,a),R=a.memoizedProps,Me=Ol(u,R),v.props=Me,Le=a.pendingProps,we=v.context,Se=u.contextType,oe=xo,typeof Se=="object"&&Se!==null&&(oe=Ge(Se)),G=u.getDerivedStateFromProps,(Se=typeof G=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(R!==Le||we!==oe)&&qv(a,v,d,oe),Co=!1,we=a.memoizedState,v.state=we,Gc(a,d,v,y),Vc();var De=a.memoizedState;R!==Le||we!==De||Co||r!==null&&r.dependencies!==null&&je(r.dependencies)?(typeof G=="function"&&(rm(a,u,G,d),De=a.memoizedState),(Me=Co||Fv(a,u,Me,d,we,De,oe)||r!==null&&r.dependencies!==null&&je(r.dependencies))?(Se||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(d,De,oe),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(d,De,oe)),typeof v.componentDidUpdate=="function"&&(a.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof v.componentDidUpdate!="function"||R===r.memoizedProps&&we===r.memoizedState||(a.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||R===r.memoizedProps&&we===r.memoizedState||(a.flags|=1024),a.memoizedProps=d,a.memoizedState=De),v.props=d,v.state=De,v.context=oe,d=Me):(typeof v.componentDidUpdate!="function"||R===r.memoizedProps&&we===r.memoizedState||(a.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||R===r.memoizedProps&&we===r.memoizedState||(a.flags|=1024),d=!1)}return v=d,kh(r,a),d=(a.flags&128)!==0,v||d?(v=a.stateNode,u=d&&typeof u.getDerivedStateFromError!="function"?null:v.render(),a.flags|=1,r!==null&&d?(a.child=kl(a,r.child,null,y),a.child=kl(a,null,u,y)):bn(r,a,u,y),a.memoizedState=v.state,r=a.child):r=La(r,a,y),r}function nb(r,a,u,d){return b(),a.flags|=256,bn(r,a,u,d),a.child}var um={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function cm(r){return{baseLanes:r,cachePool:G_()}}function dm(r,a,u){return r=r!==null?r.childLanes&~u:0,a&&(r|=wr),r}function rb(r,a,u){var d=a.pendingProps,y=!1,v=(a.flags&128)!==0,R;if((R=v)||(R=r!==null&&r.memoizedState===null?!1:(Ni.current&2)!==0),R&&(y=!0,a.flags&=-129),R=(a.flags&32)!==0,a.flags&=-33,r===null){if(wt){if(y?ko(a):$o(),(r=oi)?(r=h2(r,ir),r=r!==null&&r.data!=="&"?r:null,r!==null&&(a.memoizedState={dehydrated:r,treeContext:Vs!==null?{id:br,overflow:vn}:null,retryLane:536870912,hydrationErrors:null},u=Pc(r),u.return=a,a.child=u,qi=a,oi=null)):r=null,r===null)throw Xs(a);return Wm(r)?a.lanes=32:a.lanes=536870912,null}var G=d.children;return d=d.fallback,y?($o(),y=a.mode,G=$h({mode:"hidden",children:G},y),d=Hs(d,y,u,null),G.return=a,d.return=a,G.sibling=d,a.child=G,d=a.child,d.memoizedState=cm(u),d.childLanes=dm(r,R,u),a.memoizedState=um,Qc(null,d)):(ko(a),hm(a,G))}var oe=r.memoizedState;if(oe!==null&&(G=oe.dehydrated,G!==null)){if(v)a.flags&256?(ko(a),a.flags&=-257,a=fm(r,a,u)):a.memoizedState!==null?($o(),a.child=r.child,a.flags|=128,a=null):($o(),G=d.fallback,y=a.mode,d=$h({mode:"visible",children:d.children},y),G=Hs(G,y,u,null),G.flags|=2,d.return=a,G.return=a,d.sibling=G,a.child=d,kl(a,r.child,null,u),d=a.child,d.memoizedState=cm(u),d.childLanes=dm(r,R,u),a.memoizedState=um,a=Qc(null,d));else if(ko(a),Wm(G)){if(R=G.nextSibling&&G.nextSibling.dataset,R)var Se=R.dgst;R=Se,d=Error(n(419)),d.stack="",d.digest=R,x({value:d,source:null,stack:null}),a=fm(r,a,u)}else if(Hi||Ce(r,a,u,!1),R=(u&r.childLanes)!==0,Hi||R){if(R=li,R!==null&&(d=gn(R,u),d!==0&&d!==oe.retryLane))throw oe.retryLane=d,Ra(r,d),or(R,r,d),om;Gm(G)||Ph(),a=fm(r,a,u)}else Gm(G)?(a.flags|=192,a.child=r.child,a=null):(r=oe.treeContext,oi=Xr(G.nextSibling),qi=a,wt=!0,Ws=null,ir=!1,r!==null&&ch(a,r),a=hm(a,d.children),a.flags|=4096);return a}return y?($o(),G=d.fallback,y=a.mode,oe=r.child,Se=oe.sibling,d=vs(oe,{mode:"hidden",children:d.children}),d.subtreeFlags=oe.subtreeFlags&65011712,Se!==null?G=vs(Se,G):(G=Hs(G,y,u,null),G.flags|=2),G.return=a,d.return=a,d.sibling=G,a.child=d,Qc(null,d),d=a.child,G=r.child.memoizedState,G===null?G=cm(u):(y=G.cachePool,y!==null?(oe=di._currentValue,y=y.parent!==oe?{parent:oe,pool:oe}:y):y=G_(),G={baseLanes:G.baseLanes|u,cachePool:y}),d.memoizedState=G,d.childLanes=dm(r,R,u),a.memoizedState=um,Qc(r.child,d)):(ko(a),u=r.child,r=u.sibling,u=vs(u,{mode:"visible",children:d.children}),u.return=a,u.sibling=null,r!==null&&(R=a.deletions,R===null?(a.deletions=[r],a.flags|=16):R.push(r)),a.child=u,a.memoizedState=null,u)}function hm(r,a){return a=$h({mode:"visible",children:a},r.mode),a.return=r,r.child=a}function $h(r,a){return r=Di(22,r,null,a),r.lanes=0,r}function fm(r,a,u){return kl(a,r.child,null,u),r=hm(a,a.pendingProps.children),r.flags|=2,a.memoizedState=null,r}function sb(r,a,u){r.lanes|=a;var d=r.alternate;d!==null&&(d.lanes|=a),ie(r.return,a,u)}function pm(r,a,u,d,y,v){var R=r.memoizedState;R===null?r.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:d,tail:u,tailMode:y,treeForkCount:v}:(R.isBackwards=a,R.rendering=null,R.renderingStartTime=0,R.last=d,R.tail=u,R.tailMode=y,R.treeForkCount=v)}function ab(r,a,u){var d=a.pendingProps,y=d.revealOrder,v=d.tail;d=d.children;var R=Ni.current,G=(R&2)!==0;if(G?(R=R&1|2,a.flags|=128):R&=1,ye(Ni,R),bn(r,a,d,u),d=wt?wl:0,!G&&r!==null&&(r.flags&128)!==0)e:for(r=a.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&sb(r,u,a);else if(r.tag===19)sb(r,u,a);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(y){case"forwards":for(u=a.child,y=null;u!==null;)r=u.alternate,r!==null&&_h(r)===null&&(y=u),u=u.sibling;u=y,u===null?(y=a.child,a.child=null):(y=u.sibling,u.sibling=null),pm(a,!1,y,u,v,d);break;case"backwards":case"unstable_legacy-backwards":for(u=null,y=a.child,a.child=null;y!==null;){if(r=y.alternate,r!==null&&_h(r)===null){a.child=y;break}r=y.sibling,y.sibling=u,u=y,y=r}pm(a,!0,u,null,v,d);break;case"together":pm(a,!1,null,null,void 0,d);break;default:a.memoizedState=null}return a.child}function La(r,a,u){if(r!==null&&(a.dependencies=r.dependencies),Ro|=a.lanes,(u&a.childLanes)===0)if(r!==null){if(Ce(r,a,u,!1),(u&a.childLanes)===0)return null}else return null;if(r!==null&&a.child!==r.child)throw Error(n(153));if(a.child!==null){for(r=a.child,u=vs(r,r.pendingProps),a.child=u,u.return=a;r.sibling!==null;)r=r.sibling,u=u.sibling=vs(r,r.pendingProps),u.return=a;u.sibling=null}return a.child}function mm(r,a){return(r.lanes&a)!==0?!0:(r=r.dependencies,!!(r!==null&&je(r)))}function Fk(r,a,u){switch(a.tag){case 3:Je(a,a.stateNode.containerInfo),K(a,di,r.memoizedState.cache),b();break;case 27:case 5:bt(a);break;case 4:Je(a,a.stateNode.containerInfo);break;case 10:K(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,zp(a),null;break;case 13:var d=a.memoizedState;if(d!==null)return d.dehydrated!==null?(ko(a),a.flags|=128,null):(u&a.child.childLanes)!==0?rb(r,a,u):(ko(a),r=La(r,a,u),r!==null?r.sibling:null);ko(a);break;case 19:var y=(r.flags&128)!==0;if(d=(u&a.childLanes)!==0,d||(Ce(r,a,u,!1),d=(u&a.childLanes)!==0),y){if(d)return ab(r,a,u);a.flags|=128}if(y=a.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),ye(Ni,Ni.current),d)break;return null;case 22:return a.lanes=0,Zv(r,a,u,a.pendingProps);case 24:K(a,di,r.memoizedState.cache)}return La(r,a,u)}function ob(r,a,u){if(r!==null)if(r.memoizedProps!==a.pendingProps)Hi=!0;else{if(!mm(r,u)&&(a.flags&128)===0)return Hi=!1,Fk(r,a,u);Hi=(r.flags&131072)!==0}else Hi=!1,wt&&(a.flags&1048576)!==0&&Gs(a,wl,a.index);switch(a.lanes=0,a.tag){case 16:e:{var d=a.pendingProps;if(r=Al(a.elementType),a.type=r,typeof r=="function")Lc(r)?(d=Ol(r,d),a.tag=1,a=ib(null,a,r,d,u)):(a.tag=0,a=lm(null,a,r,d,u));else{if(r!=null){var y=r.$$typeof;if(y===U){a.tag=11,a=Kv(null,a,r,d,u);break e}else if(y===z){a.tag=14,a=Yv(null,a,r,d,u);break e}}throw a=fe(r)||r,Error(n(306,a,""))}}return a;case 0:return lm(r,a,a.type,a.pendingProps,u);case 1:return d=a.type,y=Ol(d,a.pendingProps),ib(r,a,d,y,u);case 3:e:{if(Je(a,a.stateNode.containerInfo),r===null)throw Error(n(387));d=a.pendingProps;var v=a.memoizedState;y=v.element,Np(r,a),Gc(a,d,null,u);var R=a.memoizedState;if(d=R.cache,K(a,di,d),d!==v.cache&&me(a,[di],u,!0),Vc(),d=R.element,v.isDehydrated)if(v={element:d,isDehydrated:!1,cache:R.cache},a.updateQueue.baseState=v,a.memoizedState=v,a.flags&256){a=nb(r,a,d,u);break e}else if(d!==y){y=Jn(Error(n(424)),a),x(y),a=nb(r,a,d,u);break e}else{switch(r=a.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(oi=Xr(r.firstChild),qi=a,wt=!0,Ws=null,ir=!0,u=Z_(a,null,d,u),a.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(b(),d===y){a=La(r,a,u);break e}bn(r,a,d,u)}a=a.child}return a;case 26:return kh(r,a),r===null?(u=_2(a.type,null,a.pendingProps,null))?a.memoizedState=u:wt||(u=a.type,r=a.pendingProps,d=Gh(ze.current).createElement(u),d[rt]=a,d[ci]=r,Tn(d,u,r),Nt(d),a.stateNode=d):a.memoizedState=_2(a.type,r.memoizedProps,a.pendingProps,r.memoizedState),null;case 27:return bt(a),r===null&&wt&&(d=a.stateNode=m2(a.type,a.pendingProps,ze.current),qi=a,ir=!0,y=oi,Uo(a.type)?(Xm=y,oi=Xr(d.firstChild)):oi=y),bn(r,a,a.pendingProps.children,u),kh(r,a),r===null&&(a.flags|=4194304),a.child;case 5:return r===null&&wt&&((y=d=oi)&&(d=y$(d,a.type,a.pendingProps,ir),d!==null?(a.stateNode=d,qi=a,oi=Xr(d.firstChild),ir=!1,y=!0):y=!1),y||Xs(a)),bt(a),y=a.type,v=a.pendingProps,R=r!==null?r.memoizedProps:null,d=v.children,jm(y,v)?d=null:R!==null&&jm(y,R)&&(a.flags|=32),a.memoizedState!==null&&(y=qp(r,a,Ik,null,null,u),hd._currentValue=y),kh(r,a),bn(r,a,d,u),a.child;case 6:return r===null&&wt&&((r=u=oi)&&(u=_$(u,a.pendingProps,ir),u!==null?(a.stateNode=u,qi=a,oi=null,r=!0):r=!1),r||Xs(a)),null;case 13:return rb(r,a,u);case 4:return Je(a,a.stateNode.containerInfo),d=a.pendingProps,r===null?a.child=kl(a,null,d,u):bn(r,a,d,u),a.child;case 11:return Kv(r,a,a.type,a.pendingProps,u);case 7:return bn(r,a,a.pendingProps,u),a.child;case 8:return bn(r,a,a.pendingProps.children,u),a.child;case 12:return bn(r,a,a.pendingProps.children,u),a.child;case 10:return d=a.pendingProps,K(a,a.type,d.value),bn(r,a,d.children,u),a.child;case 9:return y=a.type._context,d=a.pendingProps.children,Ie(a),y=Ge(y),d=d(y),a.flags|=1,bn(r,a,d,u),a.child;case 14:return Yv(r,a,a.type,a.pendingProps,u);case 15:return Qv(r,a,a.type,a.pendingProps,u);case 19:return ab(r,a,u);case 31:return zk(r,a,u);case 22:return Zv(r,a,u,a.pendingProps);case 24:return Ie(a),d=Ge(di),r===null?(y=Ip(),y===null&&(y=li,v=Ma(),y.pooledCache=v,v.refCount++,v!==null&&(y.pooledCacheLanes|=u),y=v),a.memoizedState={parent:d,cache:y},Mp(a),K(a,di,y)):((r.lanes&u)!==0&&(Np(r,a),Gc(a,null,null,u),Vc()),y=r.memoizedState,v=a.memoizedState,y.parent!==d?(y={parent:d,cache:d},a.memoizedState=y,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=y),K(a,di,d)):(d=v.cache,K(a,di,d),d!==y.cache&&me(a,[di],u,!0))),bn(r,a,a.pendingProps.children,u),a.child;case 29:throw a.pendingProps}throw Error(n(156,a.tag))}function Ua(r){r.flags|=4}function gm(r,a,u,d,y){if((a=(r.mode&32)!==0)&&(a=!1),a){if(r.flags|=16777216,(y&335544128)===y)if(r.stateNode.complete)r.flags|=8192;else if(Mb())r.flags|=8192;else throw Dl=ph,Rp}else r.flags&=-16777217}function lb(r,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!S2(a))if(Mb())r.flags|=8192;else throw Dl=ph,Rp}function Oh(r,a){a!==null&&(r.flags|=4),r.flags&16384&&(a=r.tag!==22?nt():536870912,r.lanes|=a,Mu|=a)}function Zc(r,a){if(!wt)switch(r.tailMode){case"hidden":a=r.tail;for(var u=null;a!==null;)a.alternate!==null&&(u=a),a=a.sibling;u===null?r.tail=null:u.sibling=null;break;case"collapsed":u=r.tail;for(var d=null;u!==null;)u.alternate!==null&&(d=u),u=u.sibling;d===null?a||r.tail===null?r.tail=null:r.tail.sibling=null:d.sibling=null}}function mi(r){var a=r.alternate!==null&&r.alternate.child===r.child,u=0,d=0;if(a)for(var y=r.child;y!==null;)u|=y.lanes|y.childLanes,d|=y.subtreeFlags&65011712,d|=y.flags&65011712,y.return=r,y=y.sibling;else for(y=r.child;y!==null;)u|=y.lanes|y.childLanes,d|=y.subtreeFlags,d|=y.flags,y.return=r,y=y.sibling;return r.subtreeFlags|=d,r.childLanes=u,a}function qk(r,a,u){var d=a.pendingProps;switch(tr(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return mi(a),null;case 1:return mi(a),null;case 3:return u=a.stateNode,d=null,r!==null&&(d=r.memoizedState.cache),a.memoizedState.cache!==d&&(a.flags|=2048),Z(di),Qe(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(r===null||r.child===null)&&(p(a)?Ua(a):r===null||r.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,S())),mi(a),null;case 26:var y=a.type,v=a.memoizedState;return r===null?(Ua(a),v!==null?(mi(a),lb(a,v)):(mi(a),gm(a,y,null,d,u))):v?v!==r.memoizedState?(Ua(a),mi(a),lb(a,v)):(mi(a),a.flags&=-16777217):(r=r.memoizedProps,r!==d&&Ua(a),mi(a),gm(a,y,r,d,u)),null;case 27:if(ri(a),u=ze.current,y=a.type,r!==null&&a.stateNode!=null)r.memoizedProps!==d&&Ua(a);else{if(!d){if(a.stateNode===null)throw Error(n(166));return mi(a),null}r=ke.current,p(a)?dh(a):(r=m2(y,d,u),a.stateNode=r,Ua(a))}return mi(a),null;case 5:if(ri(a),y=a.type,r!==null&&a.stateNode!=null)r.memoizedProps!==d&&Ua(a);else{if(!d){if(a.stateNode===null)throw Error(n(166));return mi(a),null}if(v=ke.current,p(a))dh(a);else{var R=Gh(ze.current);switch(v){case 1:v=R.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:v=R.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":v=R.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":v=R.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":v=R.createElement("div"),v.innerHTML="<script><\/script>",v=v.removeChild(v.firstChild);break;case"select":v=typeof d.is=="string"?R.createElement("select",{is:d.is}):R.createElement("select"),d.multiple?v.multiple=!0:d.size&&(v.size=d.size);break;default:v=typeof d.is=="string"?R.createElement(y,{is:d.is}):R.createElement(y)}}v[rt]=a,v[ci]=d;e:for(R=a.child;R!==null;){if(R.tag===5||R.tag===6)v.appendChild(R.stateNode);else if(R.tag!==4&&R.tag!==27&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===a)break e;for(;R.sibling===null;){if(R.return===null||R.return===a)break e;R=R.return}R.sibling.return=R.return,R=R.sibling}a.stateNode=v;e:switch(Tn(v,y,d),y){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}d&&Ua(a)}}return mi(a),gm(a,a.type,r===null?null:r.memoizedProps,a.pendingProps,u),null;case 6:if(r&&a.stateNode!=null)r.memoizedProps!==d&&Ua(a);else{if(typeof d!="string"&&a.stateNode===null)throw Error(n(166));if(r=ze.current,p(a)){if(r=a.stateNode,u=a.memoizedProps,d=null,y=qi,y!==null)switch(y.tag){case 27:case 5:d=y.memoizedProps}r[rt]=a,r=!!(r.nodeValue===u||d!==null&&d.suppressHydrationWarning===!0||r2(r.nodeValue,u)),r||Xs(a,!0)}else r=Gh(r).createTextNode(d),r[rt]=a,a.stateNode=r}return mi(a),null;case 31:if(u=a.memoizedState,r===null||r.memoizedState!==null){if(d=p(a),u!==null){if(r===null){if(!d)throw Error(n(318));if(r=a.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(557));r[rt]=a}else b(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;mi(a),r=!1}else u=S(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=u),r=!0;if(!r)return a.flags&256?(xr(a),a):(xr(a),null);if((a.flags&128)!==0)throw Error(n(558))}return mi(a),null;case 13:if(d=a.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(y=p(a),d!==null&&d.dehydrated!==null){if(r===null){if(!y)throw Error(n(318));if(y=a.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(n(317));y[rt]=a}else b(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;mi(a),y=!1}else y=S(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=y),y=!0;if(!y)return a.flags&256?(xr(a),a):(xr(a),null)}return xr(a),(a.flags&128)!==0?(a.lanes=u,a):(u=d!==null,r=r!==null&&r.memoizedState!==null,u&&(d=a.child,y=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(y=d.alternate.memoizedState.cachePool.pool),v=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(v=d.memoizedState.cachePool.pool),v!==y&&(d.flags|=2048)),u!==r&&u&&(a.child.flags|=8192),Oh(a,a.updateQueue),mi(a),null);case 4:return Qe(),r===null&&Um(a.stateNode.containerInfo),mi(a),null;case 10:return Z(a.type),mi(a),null;case 19:if(ne(Ni),d=a.memoizedState,d===null)return mi(a),null;if(y=(a.flags&128)!==0,v=d.rendering,v===null)if(y)Zc(d,!1);else{if($i!==0||r!==null&&(r.flags&128)!==0)for(r=a.child;r!==null;){if(v=_h(r),v!==null){for(a.flags|=128,Zc(d,!1),r=v.updateQueue,a.updateQueue=r,Oh(a,r),a.subtreeFlags=0,r=u,u=a.child;u!==null;)uh(u,r),u=u.sibling;return ye(Ni,Ni.current&1|2),wt&&xt(a,d.treeForkCount),a.child}r=r.sibling}d.tail!==null&&si()>Bh&&(a.flags|=128,y=!0,Zc(d,!1),a.lanes=4194304)}else{if(!y)if(r=_h(v),r!==null){if(a.flags|=128,y=!0,r=r.updateQueue,a.updateQueue=r,Oh(a,r),Zc(d,!0),d.tail===null&&d.tailMode==="hidden"&&!v.alternate&&!wt)return mi(a),null}else 2*si()-d.renderingStartTime>Bh&&u!==536870912&&(a.flags|=128,y=!0,Zc(d,!1),a.lanes=4194304);d.isBackwards?(v.sibling=a.child,a.child=v):(r=d.last,r!==null?r.sibling=v:a.child=v,d.last=v)}return d.tail!==null?(r=d.tail,d.rendering=r,d.tail=r.sibling,d.renderingStartTime=si(),r.sibling=null,u=Ni.current,ye(Ni,y?u&1|2:u&1),wt&&xt(a,d.treeForkCount),r):(mi(a),null);case 22:case 23:return xr(a),Pp(),d=a.memoizedState!==null,r!==null?r.memoizedState!==null!==d&&(a.flags|=8192):d&&(a.flags|=8192),d?(u&536870912)!==0&&(a.flags&128)===0&&(mi(a),a.subtreeFlags&6&&(a.flags|=8192)):mi(a),u=a.updateQueue,u!==null&&Oh(a,u.retryQueue),u=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(u=r.memoizedState.cachePool.pool),d=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),d!==u&&(a.flags|=2048),r!==null&&ne(Cl),null;case 24:return u=null,r!==null&&(u=r.memoizedState.cache),a.memoizedState.cache!==u&&(a.flags|=2048),Z(di),mi(a),null;case 25:return null;case 30:return null}throw Error(n(156,a.tag))}function jk(r,a){switch(tr(a),a.tag){case 1:return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 3:return Z(di),Qe(),r=a.flags,(r&65536)!==0&&(r&128)===0?(a.flags=r&-65537|128,a):null;case 26:case 27:case 5:return ri(a),null;case 31:if(a.memoizedState!==null){if(xr(a),a.alternate===null)throw Error(n(340));b()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 13:if(xr(a),r=a.memoizedState,r!==null&&r.dehydrated!==null){if(a.alternate===null)throw Error(n(340));b()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 19:return ne(Ni),null;case 4:return Qe(),null;case 10:return Z(a.type),null;case 22:case 23:return xr(a),Pp(),r!==null&&ne(Cl),r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 24:return Z(di),null;case 25:return null;default:return null}}function ub(r,a){switch(tr(a),a.tag){case 3:Z(di),Qe();break;case 26:case 27:case 5:ri(a);break;case 4:Qe();break;case 31:a.memoizedState!==null&&xr(a);break;case 13:xr(a);break;case 19:ne(Ni);break;case 10:Z(a.type);break;case 22:case 23:xr(a),Pp(),r!==null&&ne(Cl);break;case 24:Z(di)}}function Jc(r,a){try{var u=a.updateQueue,d=u!==null?u.lastEffect:null;if(d!==null){var y=d.next;u=y;do{if((u.tag&r)===r){d=void 0;var v=u.create,R=u.inst;d=v(),R.destroy=d}u=u.next}while(u!==y)}}catch(G){Qt(a,a.return,G)}}function Oo(r,a,u){try{var d=a.updateQueue,y=d!==null?d.lastEffect:null;if(y!==null){var v=y.next;d=v;do{if((d.tag&r)===r){var R=d.inst,G=R.destroy;if(G!==void 0){R.destroy=void 0,y=a;var oe=u,Se=G;try{Se()}catch(Me){Qt(y,oe,Me)}}}d=d.next}while(d!==v)}}catch(Me){Qt(a,a.return,Me)}}function cb(r){var a=r.updateQueue;if(a!==null){var u=r.stateNode;try{ev(a,u)}catch(d){Qt(r,r.return,d)}}}function db(r,a,u){u.props=Ol(r.type,r.memoizedProps),u.state=r.memoizedState;try{u.componentWillUnmount()}catch(d){Qt(r,a,d)}}function ed(r,a){try{var u=r.ref;if(u!==null){switch(r.tag){case 26:case 27:case 5:var d=r.stateNode;break;case 30:d=r.stateNode;break;default:d=r.stateNode}typeof u=="function"?r.refCleanup=u(d):u.current=d}}catch(y){Qt(r,a,y)}}function Qs(r,a){var u=r.ref,d=r.refCleanup;if(u!==null)if(typeof d=="function")try{d()}catch(y){Qt(r,a,y)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(y){Qt(r,a,y)}else u.current=null}function hb(r){var a=r.type,u=r.memoizedProps,d=r.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":u.autoFocus&&d.focus();break e;case"img":u.src?d.src=u.src:u.srcSet&&(d.srcset=u.srcSet)}}catch(y){Qt(r,r.return,y)}}function ym(r,a,u){try{var d=r.stateNode;d$(d,r.type,u,a),d[ci]=a}catch(y){Qt(r,r.return,y)}}function fb(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&Uo(r.type)||r.tag===4}function _m(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||fb(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&Uo(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function vm(r,a,u){var d=r.tag;if(d===5||d===6)r=r.stateNode,a?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(r,a):(a=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,a.appendChild(r),u=u._reactRootContainer,u!=null||a.onclick!==null||(a.onclick=Cn));else if(d!==4&&(d===27&&Uo(r.type)&&(u=r.stateNode,a=null),r=r.child,r!==null))for(vm(r,a,u),r=r.sibling;r!==null;)vm(r,a,u),r=r.sibling}function Ih(r,a,u){var d=r.tag;if(d===5||d===6)r=r.stateNode,a?u.insertBefore(r,a):u.appendChild(r);else if(d!==4&&(d===27&&Uo(r.type)&&(u=r.stateNode),r=r.child,r!==null))for(Ih(r,a,u),r=r.sibling;r!==null;)Ih(r,a,u),r=r.sibling}function pb(r){var a=r.stateNode,u=r.memoizedProps;try{for(var d=r.type,y=a.attributes;y.length;)a.removeAttributeNode(y[0]);Tn(a,d,u),a[rt]=r,a[ci]=u}catch(v){Qt(r,r.return,v)}}var Pa=!1,Vi=!1,bm=!1,mb=typeof WeakSet=="function"?WeakSet:Set,un=null;function Hk(r,a){if(r=r.containerInfo,Fm=Jh,r=Oa(r),qs(r)){if("selectionStart"in r)var u={start:r.selectionStart,end:r.selectionEnd};else e:{u=(u=r.ownerDocument)&&u.defaultView||window;var d=u.getSelection&&u.getSelection();if(d&&d.rangeCount!==0){u=d.anchorNode;var y=d.anchorOffset,v=d.focusNode;d=d.focusOffset;try{u.nodeType,v.nodeType}catch{u=null;break e}var R=0,G=-1,oe=-1,Se=0,Me=0,Le=r,we=null;t:for(;;){for(var De;Le!==u||y!==0&&Le.nodeType!==3||(G=R+y),Le!==v||d!==0&&Le.nodeType!==3||(oe=R+d),Le.nodeType===3&&(R+=Le.nodeValue.length),(De=Le.firstChild)!==null;)we=Le,Le=De;for(;;){if(Le===r)break t;if(we===u&&++Se===y&&(G=R),we===v&&++Me===d&&(oe=R),(De=Le.nextSibling)!==null)break;Le=we,we=Le.parentNode}Le=De}u=G===-1||oe===-1?null:{start:G,end:oe}}else u=null}u=u||{start:0,end:0}}else u=null;for(qm={focusedElem:r,selectionRange:u},Jh=!1,un=a;un!==null;)if(a=un,r=a.child,(a.subtreeFlags&1028)!==0&&r!==null)r.return=a,un=r;else for(;un!==null;){switch(a=un,v=a.alternate,r=a.flags,a.tag){case 0:if((r&4)!==0&&(r=a.updateQueue,r=r!==null?r.events:null,r!==null))for(u=0;u<r.length;u++)y=r[u],y.ref.impl=y.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&v!==null){r=void 0,u=a,y=v.memoizedProps,v=v.memoizedState,d=u.stateNode;try{var Ke=Ol(u.type,y);r=d.getSnapshotBeforeUpdate(Ke,v),d.__reactInternalSnapshotBeforeUpdate=r}catch(lt){Qt(u,u.return,lt)}}break;case 3:if((r&1024)!==0){if(r=a.stateNode.containerInfo,u=r.nodeType,u===9)Vm(r);else if(u===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Vm(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(n(163))}if(r=a.sibling,r!==null){r.return=a.return,un=r;break}un=a.return}}function gb(r,a,u){var d=u.flags;switch(u.tag){case 0:case 11:case 15:Fa(r,u),d&4&&Jc(5,u);break;case 1:if(Fa(r,u),d&4)if(r=u.stateNode,a===null)try{r.componentDidMount()}catch(R){Qt(u,u.return,R)}else{var y=Ol(u.type,a.memoizedProps);a=a.memoizedState;try{r.componentDidUpdate(y,a,r.__reactInternalSnapshotBeforeUpdate)}catch(R){Qt(u,u.return,R)}}d&64&&cb(u),d&512&&ed(u,u.return);break;case 3:if(Fa(r,u),d&64&&(r=u.updateQueue,r!==null)){if(a=null,u.child!==null)switch(u.child.tag){case 27:case 5:a=u.child.stateNode;break;case 1:a=u.child.stateNode}try{ev(r,a)}catch(R){Qt(u,u.return,R)}}break;case 27:a===null&&d&4&&pb(u);case 26:case 5:Fa(r,u),a===null&&d&4&&hb(u),d&512&&ed(u,u.return);break;case 12:Fa(r,u);break;case 31:Fa(r,u),d&4&&vb(r,u);break;case 13:Fa(r,u),d&4&&bb(r,u),d&64&&(r=u.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(u=Jk.bind(null,u),v$(r,u))));break;case 22:if(d=u.memoizedState!==null||Pa,!d){a=a!==null&&a.memoizedState!==null||Vi,y=Pa;var v=Vi;Pa=d,(Vi=a)&&!v?qa(r,u,(u.subtreeFlags&8772)!==0):Fa(r,u),Pa=y,Vi=v}break;case 30:break;default:Fa(r,u)}}function yb(r){var a=r.alternate;a!==null&&(r.alternate=null,yb(a)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(a=r.stateNode,a!==null&&Ht(a)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var vi=null,nr=!1;function za(r,a,u){for(u=u.child;u!==null;)_b(r,a,u),u=u.sibling}function _b(r,a,u){if(yi&&typeof yi.onCommitFiberUnmount=="function")try{yi.onCommitFiberUnmount(Xn,u)}catch{}switch(u.tag){case 26:Vi||Qs(u,a),za(r,a,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:Vi||Qs(u,a);var d=vi,y=nr;Uo(u.type)&&(vi=u.stateNode,nr=!1),za(r,a,u),ud(u.stateNode),vi=d,nr=y;break;case 5:Vi||Qs(u,a);case 6:if(d=vi,y=nr,vi=null,za(r,a,u),vi=d,nr=y,vi!==null)if(nr)try{(vi.nodeType===9?vi.body:vi.nodeName==="HTML"?vi.ownerDocument.body:vi).removeChild(u.stateNode)}catch(v){Qt(u,a,v)}else try{vi.removeChild(u.stateNode)}catch(v){Qt(u,a,v)}break;case 18:vi!==null&&(nr?(r=vi,c2(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,u.stateNode),qu(r)):c2(vi,u.stateNode));break;case 4:d=vi,y=nr,vi=u.stateNode.containerInfo,nr=!0,za(r,a,u),vi=d,nr=y;break;case 0:case 11:case 14:case 15:Oo(2,u,a),Vi||Oo(4,u,a),za(r,a,u);break;case 1:Vi||(Qs(u,a),d=u.stateNode,typeof d.componentWillUnmount=="function"&&db(u,a,d)),za(r,a,u);break;case 21:za(r,a,u);break;case 22:Vi=(d=Vi)||u.memoizedState!==null,za(r,a,u),Vi=d;break;default:za(r,a,u)}}function vb(r,a){if(a.memoizedState===null&&(r=a.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{qu(r)}catch(u){Qt(a,a.return,u)}}}function bb(r,a){if(a.memoizedState===null&&(r=a.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{qu(r)}catch(u){Qt(a,a.return,u)}}function Vk(r){switch(r.tag){case 31:case 13:case 19:var a=r.stateNode;return a===null&&(a=r.stateNode=new mb),a;case 22:return r=r.stateNode,a=r._retryCache,a===null&&(a=r._retryCache=new mb),a;default:throw Error(n(435,r.tag))}}function Rh(r,a){var u=Vk(r);a.forEach(function(d){if(!u.has(d)){u.add(d);var y=e$.bind(null,r,d);d.then(y,y)}})}function rr(r,a){var u=a.deletions;if(u!==null)for(var d=0;d<u.length;d++){var y=u[d],v=r,R=a,G=R;e:for(;G!==null;){switch(G.tag){case 27:if(Uo(G.type)){vi=G.stateNode,nr=!1;break e}break;case 5:vi=G.stateNode,nr=!1;break e;case 3:case 4:vi=G.stateNode.containerInfo,nr=!0;break e}G=G.return}if(vi===null)throw Error(n(160));_b(v,R,y),vi=null,nr=!1,v=y.alternate,v!==null&&(v.return=null),y.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)Tb(a,r),a=a.sibling}var Ts=null;function Tb(r,a){var u=r.alternate,d=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:rr(a,r),sr(r),d&4&&(Oo(3,r,r.return),Jc(3,r),Oo(5,r,r.return));break;case 1:rr(a,r),sr(r),d&512&&(Vi||u===null||Qs(u,u.return)),d&64&&Pa&&(r=r.updateQueue,r!==null&&(d=r.callbacks,d!==null&&(u=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=u===null?d:u.concat(d))));break;case 26:var y=Ts;if(rr(a,r),sr(r),d&512&&(Vi||u===null||Qs(u,u.return)),d&4){var v=u!==null?u.memoizedState:null;if(d=r.memoizedState,u===null)if(d===null)if(r.stateNode===null){e:{d=r.type,u=r.memoizedProps,y=y.ownerDocument||y;t:switch(d){case"title":v=y.getElementsByTagName("title")[0],(!v||v[Ai]||v[rt]||v.namespaceURI==="http://www.w3.org/2000/svg"||v.hasAttribute("itemprop"))&&(v=y.createElement(d),y.head.insertBefore(v,y.querySelector("head > title"))),Tn(v,d,u),v[rt]=r,Nt(v),d=v;break e;case"link":var R=T2("link","href",y).get(d+(u.href||""));if(R){for(var G=0;G<R.length;G++)if(v=R[G],v.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&v.getAttribute("rel")===(u.rel==null?null:u.rel)&&v.getAttribute("title")===(u.title==null?null:u.title)&&v.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){R.splice(G,1);break t}}v=y.createElement(d),Tn(v,d,u),y.head.appendChild(v);break;case"meta":if(R=T2("meta","content",y).get(d+(u.content||""))){for(G=0;G<R.length;G++)if(v=R[G],v.getAttribute("content")===(u.content==null?null:""+u.content)&&v.getAttribute("name")===(u.name==null?null:u.name)&&v.getAttribute("property")===(u.property==null?null:u.property)&&v.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&v.getAttribute("charset")===(u.charSet==null?null:u.charSet)){R.splice(G,1);break t}}v=y.createElement(d),Tn(v,d,u),y.head.appendChild(v);break;default:throw Error(n(468,d))}v[rt]=r,Nt(v),d=v}r.stateNode=d}else x2(y,r.type,r.stateNode);else r.stateNode=b2(y,d,r.memoizedProps);else v!==d?(v===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):v.count--,d===null?x2(y,r.type,r.stateNode):b2(y,d,r.memoizedProps)):d===null&&r.stateNode!==null&&ym(r,r.memoizedProps,u.memoizedProps)}break;case 27:rr(a,r),sr(r),d&512&&(Vi||u===null||Qs(u,u.return)),u!==null&&d&4&&ym(r,r.memoizedProps,u.memoizedProps);break;case 5:if(rr(a,r),sr(r),d&512&&(Vi||u===null||Qs(u,u.return)),r.flags&32){y=r.stateNode;try{Yn(y,"")}catch(Ke){Qt(r,r.return,Ke)}}d&4&&r.stateNode!=null&&(y=r.memoizedProps,ym(r,y,u!==null?u.memoizedProps:y)),d&1024&&(bm=!0);break;case 6:if(rr(a,r),sr(r),d&4){if(r.stateNode===null)throw Error(n(162));d=r.memoizedProps,u=r.stateNode;try{u.nodeValue=d}catch(Ke){Qt(r,r.return,Ke)}}break;case 3:if(Kh=null,y=Ts,Ts=Wh(a.containerInfo),rr(a,r),Ts=y,sr(r),d&4&&u!==null&&u.memoizedState.isDehydrated)try{qu(a.containerInfo)}catch(Ke){Qt(r,r.return,Ke)}bm&&(bm=!1,xb(r));break;case 4:d=Ts,Ts=Wh(r.stateNode.containerInfo),rr(a,r),sr(r),Ts=d;break;case 12:rr(a,r),sr(r);break;case 31:rr(a,r),sr(r),d&4&&(d=r.updateQueue,d!==null&&(r.updateQueue=null,Rh(r,d)));break;case 13:rr(a,r),sr(r),r.child.flags&8192&&r.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(Nh=si()),d&4&&(d=r.updateQueue,d!==null&&(r.updateQueue=null,Rh(r,d)));break;case 22:y=r.memoizedState!==null;var oe=u!==null&&u.memoizedState!==null,Se=Pa,Me=Vi;if(Pa=Se||y,Vi=Me||oe,rr(a,r),Vi=Me,Pa=Se,sr(r),d&8192)e:for(a=r.stateNode,a._visibility=y?a._visibility&-2:a._visibility|1,y&&(u===null||oe||Pa||Vi||Il(r)),u=null,a=r;;){if(a.tag===5||a.tag===26){if(u===null){oe=u=a;try{if(v=oe.stateNode,y)R=v.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{G=oe.stateNode;var Le=oe.memoizedProps.style,we=Le!=null&&Le.hasOwnProperty("display")?Le.display:null;G.style.display=we==null||typeof we=="boolean"?"":(""+we).trim()}}catch(Ke){Qt(oe,oe.return,Ke)}}}else if(a.tag===6){if(u===null){oe=a;try{oe.stateNode.nodeValue=y?"":oe.memoizedProps}catch(Ke){Qt(oe,oe.return,Ke)}}}else if(a.tag===18){if(u===null){oe=a;try{var De=oe.stateNode;y?d2(De,!0):d2(oe.stateNode,!1)}catch(Ke){Qt(oe,oe.return,Ke)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===r)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break e;for(;a.sibling===null;){if(a.return===null||a.return===r)break e;u===a&&(u=null),a=a.return}u===a&&(u=null),a.sibling.return=a.return,a=a.sibling}d&4&&(d=r.updateQueue,d!==null&&(u=d.retryQueue,u!==null&&(d.retryQueue=null,Rh(r,u))));break;case 19:rr(a,r),sr(r),d&4&&(d=r.updateQueue,d!==null&&(r.updateQueue=null,Rh(r,d)));break;case 30:break;case 21:break;default:rr(a,r),sr(r)}}function sr(r){var a=r.flags;if(a&2){try{for(var u,d=r.return;d!==null;){if(fb(d)){u=d;break}d=d.return}if(u==null)throw Error(n(160));switch(u.tag){case 27:var y=u.stateNode,v=_m(r);Ih(r,v,y);break;case 5:var R=u.stateNode;u.flags&32&&(Yn(R,""),u.flags&=-33);var G=_m(r);Ih(r,G,R);break;case 3:case 4:var oe=u.stateNode.containerInfo,Se=_m(r);vm(r,Se,oe);break;default:throw Error(n(161))}}catch(Me){Qt(r,r.return,Me)}r.flags&=-3}a&4096&&(r.flags&=-4097)}function xb(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var a=r;xb(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),r=r.sibling}}function Fa(r,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)gb(r,a.alternate,a),a=a.sibling}function Il(r){for(r=r.child;r!==null;){var a=r;switch(a.tag){case 0:case 11:case 14:case 15:Oo(4,a,a.return),Il(a);break;case 1:Qs(a,a.return);var u=a.stateNode;typeof u.componentWillUnmount=="function"&&db(a,a.return,u),Il(a);break;case 27:ud(a.stateNode);case 26:case 5:Qs(a,a.return),Il(a);break;case 22:a.memoizedState===null&&Il(a);break;case 30:Il(a);break;default:Il(a)}r=r.sibling}}function qa(r,a,u){for(u=u&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var d=a.alternate,y=r,v=a,R=v.flags;switch(v.tag){case 0:case 11:case 15:qa(y,v,u),Jc(4,v);break;case 1:if(qa(y,v,u),d=v,y=d.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(Se){Qt(d,d.return,Se)}if(d=v,y=d.updateQueue,y!==null){var G=d.stateNode;try{var oe=y.shared.hiddenCallbacks;if(oe!==null)for(y.shared.hiddenCallbacks=null,y=0;y<oe.length;y++)J_(oe[y],G)}catch(Se){Qt(d,d.return,Se)}}u&&R&64&&cb(v),ed(v,v.return);break;case 27:pb(v);case 26:case 5:qa(y,v,u),u&&d===null&&R&4&&hb(v),ed(v,v.return);break;case 12:qa(y,v,u);break;case 31:qa(y,v,u),u&&R&4&&vb(y,v);break;case 13:qa(y,v,u),u&&R&4&&bb(y,v);break;case 22:v.memoizedState===null&&qa(y,v,u),ed(v,v.return);break;case 30:break;default:qa(y,v,u)}a=a.sibling}}function Tm(r,a){var u=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(u=r.memoizedState.cachePool.pool),r=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(r=a.memoizedState.cachePool.pool),r!==u&&(r!=null&&r.refCount++,u!=null&&bs(u))}function xm(r,a){r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&bs(r))}function xs(r,a,u,d){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Sb(r,a,u,d),a=a.sibling}function Sb(r,a,u,d){var y=a.flags;switch(a.tag){case 0:case 11:case 15:xs(r,a,u,d),y&2048&&Jc(9,a);break;case 1:xs(r,a,u,d);break;case 3:xs(r,a,u,d),y&2048&&(r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&bs(r)));break;case 12:if(y&2048){xs(r,a,u,d),r=a.stateNode;try{var v=a.memoizedProps,R=v.id,G=v.onPostCommit;typeof G=="function"&&G(R,a.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(oe){Qt(a,a.return,oe)}}else xs(r,a,u,d);break;case 31:xs(r,a,u,d);break;case 13:xs(r,a,u,d);break;case 23:break;case 22:v=a.stateNode,R=a.alternate,a.memoizedState!==null?v._visibility&2?xs(r,a,u,d):td(r,a):v._visibility&2?xs(r,a,u,d):(v._visibility|=2,Ou(r,a,u,d,(a.subtreeFlags&10256)!==0||!1)),y&2048&&Tm(R,a);break;case 24:xs(r,a,u,d),y&2048&&xm(a.alternate,a);break;default:xs(r,a,u,d)}}function Ou(r,a,u,d,y){for(y=y&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var v=r,R=a,G=u,oe=d,Se=R.flags;switch(R.tag){case 0:case 11:case 15:Ou(v,R,G,oe,y),Jc(8,R);break;case 23:break;case 22:var Me=R.stateNode;R.memoizedState!==null?Me._visibility&2?Ou(v,R,G,oe,y):td(v,R):(Me._visibility|=2,Ou(v,R,G,oe,y)),y&&Se&2048&&Tm(R.alternate,R);break;case 24:Ou(v,R,G,oe,y),y&&Se&2048&&xm(R.alternate,R);break;default:Ou(v,R,G,oe,y)}a=a.sibling}}function td(r,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var u=r,d=a,y=d.flags;switch(d.tag){case 22:td(u,d),y&2048&&Tm(d.alternate,d);break;case 24:td(u,d),y&2048&&xm(d.alternate,d);break;default:td(u,d)}a=a.sibling}}var id=8192;function Iu(r,a,u){if(r.subtreeFlags&id)for(r=r.child;r!==null;)wb(r,a,u),r=r.sibling}function wb(r,a,u){switch(r.tag){case 26:Iu(r,a,u),r.flags&id&&r.memoizedState!==null&&O$(u,Ts,r.memoizedState,r.memoizedProps);break;case 5:Iu(r,a,u);break;case 3:case 4:var d=Ts;Ts=Wh(r.stateNode.containerInfo),Iu(r,a,u),Ts=d;break;case 22:r.memoizedState===null&&(d=r.alternate,d!==null&&d.memoizedState!==null?(d=id,id=16777216,Iu(r,a,u),id=d):Iu(r,a,u));break;default:Iu(r,a,u)}}function Eb(r){var a=r.alternate;if(a!==null&&(r=a.child,r!==null)){a.child=null;do a=r.sibling,r.sibling=null,r=a;while(r!==null)}}function nd(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var u=0;u<a.length;u++){var d=a[u];un=d,Ab(d,r)}Eb(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Cb(r),r=r.sibling}function Cb(r){switch(r.tag){case 0:case 11:case 15:nd(r),r.flags&2048&&Oo(9,r,r.return);break;case 3:nd(r);break;case 12:nd(r);break;case 22:var a=r.stateNode;r.memoizedState!==null&&a._visibility&2&&(r.return===null||r.return.tag!==13)?(a._visibility&=-3,Mh(r)):nd(r);break;default:nd(r)}}function Mh(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var u=0;u<a.length;u++){var d=a[u];un=d,Ab(d,r)}Eb(r)}for(r=r.child;r!==null;){switch(a=r,a.tag){case 0:case 11:case 15:Oo(8,a,a.return),Mh(a);break;case 22:u=a.stateNode,u._visibility&2&&(u._visibility&=-3,Mh(a));break;default:Mh(a)}r=r.sibling}}function Ab(r,a){for(;un!==null;){var u=un;switch(u.tag){case 0:case 11:case 15:Oo(8,u,a);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var d=u.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:bs(u.memoizedState.cache)}if(d=u.child,d!==null)d.return=u,un=d;else e:for(u=r;un!==null;){d=un;var y=d.sibling,v=d.return;if(yb(d),d===u){un=null;break e}if(y!==null){y.return=v,un=y;break e}un=v}}}var Gk={getCacheForType:function(r){var a=Ge(di),u=a.data.get(r);return u===void 0&&(u=r(),a.data.set(r,u)),u},cacheSignal:function(){return Ge(di).controller.signal}},Wk=typeof WeakMap=="function"?WeakMap:Map,qt=0,li=null,Et=null,kt=0,Yt=0,Sr=null,Io=!1,Ru=!1,Sm=!1,ja=0,$i=0,Ro=0,Rl=0,wm=0,wr=0,Mu=0,rd=null,ar=null,Em=!1,Nh=0,Db=0,Bh=1/0,Lh=null,Mo=null,Ji=0,No=null,Nu=null,Ha=0,Cm=0,Am=null,kb=null,sd=0,Dm=null;function Er(){return(qt&2)!==0&&kt!==0?kt&-kt:J.T!==null?Mm():rn()}function $b(){if(wr===0)if((kt&536870912)===0||wt){var r=Nr;Nr<<=1,(Nr&3932160)===0&&(Nr=262144),wr=r}else wr=536870912;return r=Tr.current,r!==null&&(r.flags|=32),wr}function or(r,a,u){(r===li&&(Yt===2||Yt===9)||r.cancelPendingCommit!==null)&&(Bu(r,0),Bo(r,kt,wr,!1)),pi(r,u),((qt&2)===0||r!==li)&&(r===li&&((qt&2)===0&&(Rl|=u),$i===4&&Bo(r,kt,wr,!1)),Zs(r))}function Ob(r,a,u){if((qt&6)!==0)throw Error(n(327));var d=!u&&(a&127)===0&&(a&r.expiredLanes)===0||xe(r,a),y=d?Yk(r,a):$m(r,a,!0),v=d;do{if(y===0){Ru&&!d&&Bo(r,a,0,!1);break}else{if(u=r.current.alternate,v&&!Xk(u)){y=$m(r,a,!1),v=!1;continue}if(y===2){if(v=a,r.errorRecoveryDisabledLanes&v)var R=0;else R=r.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){a=R;e:{var G=r;y=rd;var oe=G.current.memoizedState.isDehydrated;if(oe&&(Bu(G,R).flags|=256),R=$m(G,R,!1),R!==2){if(Sm&&!oe){G.errorRecoveryDisabledLanes|=v,Rl|=v,y=4;break e}v=ar,ar=y,v!==null&&(ar===null?ar=v:ar.push.apply(ar,v))}y=R}if(v=!1,y!==2)continue}}if(y===1){Bu(r,0),Bo(r,a,0,!0);break}e:{switch(d=r,v=y,v){case 0:case 1:throw Error(n(345));case 4:if((a&4194048)!==a)break;case 6:Bo(d,a,wr,!Io);break e;case 2:ar=null;break;case 3:case 5:break;default:throw Error(n(329))}if((a&62914560)===a&&(y=Nh+300-si(),10<y)){if(Bo(d,a,wr,!Io),re(d,0,!0)!==0)break e;Ha=a,d.timeoutHandle=l2(Ib.bind(null,d,u,ar,Lh,Em,a,wr,Rl,Mu,Io,v,"Throttled",-0,0),y);break e}Ib(d,u,ar,Lh,Em,a,wr,Rl,Mu,Io,v,null,-0,0)}}break}while(!0);Zs(r)}function Ib(r,a,u,d,y,v,R,G,oe,Se,Me,Le,we,De){if(r.timeoutHandle=-1,Le=a.subtreeFlags,Le&8192||(Le&16785408)===16785408){Le={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Cn},wb(a,v,Le);var Ke=(v&62914560)===v?Nh-si():(v&4194048)===v?Db-si():0;if(Ke=I$(Le,Ke),Ke!==null){Ha=v,r.cancelPendingCommit=Ke(zb.bind(null,r,a,v,u,d,y,R,G,oe,Me,Le,null,we,De)),Bo(r,v,R,!Se);return}}zb(r,a,v,u,d,y,R,G,oe)}function Xk(r){for(var a=r;;){var u=a.tag;if((u===0||u===11||u===15)&&a.flags&16384&&(u=a.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var d=0;d<u.length;d++){var y=u[d],v=y.getSnapshot;y=y.value;try{if(!Qi(v(),y))return!1}catch{return!1}}if(u=a.child,a.subtreeFlags&16384&&u!==null)u.return=a,a=u;else{if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Bo(r,a,u,d){a&=~wm,a&=~Rl,r.suspendedLanes|=a,r.pingedLanes&=~a,d&&(r.warmLanes|=a),d=r.expirationTimes;for(var y=a;0<y;){var v=31-zi(y),R=1<<v;d[v]=-1,y&=~R}u!==0&&wn(r,u,a)}function Uh(){return(qt&6)===0?(ad(0),!1):!0}function km(){if(Et!==null){if(Yt===0)var r=Et.return;else r=Et,X=I=null,Vp(r),Cu=null,qc=0,r=Et;for(;r!==null;)ub(r.alternate,r),r=r.return;Et=null}}function Bu(r,a){var u=r.timeoutHandle;u!==-1&&(r.timeoutHandle=-1,p$(u)),u=r.cancelPendingCommit,u!==null&&(r.cancelPendingCommit=null,u()),Ha=0,km(),li=r,Et=u=vs(r.current,null),kt=a,Yt=0,Sr=null,Io=!1,Ru=xe(r,a),Sm=!1,Mu=wr=wm=Rl=Ro=$i=0,ar=rd=null,Em=!1,(a&8)!==0&&(a|=a&32);var d=r.entangledLanes;if(d!==0)for(r=r.entanglements,d&=a;0<d;){var y=31-zi(d),v=1<<y;a|=r[y],d&=~v}return ja=a,Vr(),u}function Rb(r,a){vt=null,J.H=Yc,a===Eu||a===fh?(a=K_(),Yt=3):a===Rp?(a=K_(),Yt=4):Yt=a===om?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Sr=a,Et===null&&($i=1,Ah(r,Jn(a,r.current)))}function Mb(){var r=Tr.current;return r===null?!0:(kt&4194048)===kt?Wr===null:(kt&62914560)===kt||(kt&536870912)!==0?r===Wr:!1}function Nb(){var r=J.H;return J.H=Yc,r===null?Yc:r}function Bb(){var r=J.A;return J.A=Gk,r}function Ph(){$i=4,Io||(kt&4194048)!==kt&&Tr.current!==null||(Ru=!0),(Ro&134217727)===0&&(Rl&134217727)===0||li===null||Bo(li,kt,wr,!1)}function $m(r,a,u){var d=qt;qt|=2;var y=Nb(),v=Bb();(li!==r||kt!==a)&&(Lh=null,Bu(r,a)),a=!1;var R=$i;e:do try{if(Yt!==0&&Et!==null){var G=Et,oe=Sr;switch(Yt){case 8:km(),R=6;break e;case 3:case 2:case 9:case 6:Tr.current===null&&(a=!0);var Se=Yt;if(Yt=0,Sr=null,Lu(r,G,oe,Se),u&&Ru){R=0;break e}break;default:Se=Yt,Yt=0,Sr=null,Lu(r,G,oe,Se)}}Kk(),R=$i;break}catch(Me){Rb(r,Me)}while(!0);return a&&r.shellSuspendCounter++,X=I=null,qt=d,J.H=y,J.A=v,Et===null&&(li=null,kt=0,Vr()),R}function Kk(){for(;Et!==null;)Lb(Et)}function Yk(r,a){var u=qt;qt|=2;var d=Nb(),y=Bb();li!==r||kt!==a?(Lh=null,Bh=si()+500,Bu(r,a)):Ru=xe(r,a);e:do try{if(Yt!==0&&Et!==null){a=Et;var v=Sr;t:switch(Yt){case 1:Yt=0,Sr=null,Lu(r,a,v,1);break;case 2:case 9:if(W_(v)){Yt=0,Sr=null,Ub(a);break}a=function(){Yt!==2&&Yt!==9||li!==r||(Yt=7),Zs(r)},v.then(a,a);break e;case 3:Yt=7;break e;case 4:Yt=5;break e;case 7:W_(v)?(Yt=0,Sr=null,Ub(a)):(Yt=0,Sr=null,Lu(r,a,v,7));break;case 5:var R=null;switch(Et.tag){case 26:R=Et.memoizedState;case 5:case 27:var G=Et;if(R?S2(R):G.stateNode.complete){Yt=0,Sr=null;var oe=G.sibling;if(oe!==null)Et=oe;else{var Se=G.return;Se!==null?(Et=Se,zh(Se)):Et=null}break t}}Yt=0,Sr=null,Lu(r,a,v,5);break;case 6:Yt=0,Sr=null,Lu(r,a,v,6);break;case 8:km(),$i=6;break e;default:throw Error(n(462))}}Qk();break}catch(Me){Rb(r,Me)}while(!0);return X=I=null,J.H=d,J.A=y,qt=u,Et!==null?0:(li=null,kt=0,Vr(),$i)}function Qk(){for(;Et!==null&&!Ot();)Lb(Et)}function Lb(r){var a=ob(r.alternate,r,ja);r.memoizedProps=r.pendingProps,a===null?zh(r):Et=a}function Ub(r){var a=r,u=a.alternate;switch(a.tag){case 15:case 0:a=tb(u,a,a.pendingProps,a.type,void 0,kt);break;case 11:a=tb(u,a,a.pendingProps,a.type.render,a.ref,kt);break;case 5:Vp(a);default:ub(u,a),a=Et=uh(a,ja),a=ob(u,a,ja)}r.memoizedProps=r.pendingProps,a===null?zh(r):Et=a}function Lu(r,a,u,d){X=I=null,Vp(a),Cu=null,qc=0;var y=a.return;try{if(Pk(r,y,a,u,kt)){$i=1,Ah(r,Jn(u,r.current)),Et=null;return}}catch(v){if(y!==null)throw Et=y,v;$i=1,Ah(r,Jn(u,r.current)),Et=null;return}a.flags&32768?(wt||d===1?r=!0:Ru||(kt&536870912)!==0?r=!1:(Io=r=!0,(d===2||d===9||d===3||d===6)&&(d=Tr.current,d!==null&&d.tag===13&&(d.flags|=16384))),Pb(a,r)):zh(a)}function zh(r){var a=r;do{if((a.flags&32768)!==0){Pb(a,Io);return}r=a.return;var u=qk(a.alternate,a,ja);if(u!==null){Et=u;return}if(a=a.sibling,a!==null){Et=a;return}Et=a=r}while(a!==null);$i===0&&($i=5)}function Pb(r,a){do{var u=jk(r.alternate,r);if(u!==null){u.flags&=32767,Et=u;return}if(u=r.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!a&&(r=r.sibling,r!==null)){Et=r;return}Et=r=u}while(r!==null);$i=6,Et=null}function zb(r,a,u,d,y,v,R,G,oe){r.cancelPendingCommit=null;do Fh();while(Ji!==0);if((qt&6)!==0)throw Error(n(327));if(a!==null){if(a===r.current)throw Error(n(177));if(v=a.lanes|a.childLanes,v|=vr,tn(r,u,v,R,G,oe),r===li&&(Et=li=null,kt=0),Nu=a,No=r,Ha=u,Cm=v,Am=y,kb=d,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,t$(Xi,function(){return Vb(),null})):(r.callbackNode=null,r.callbackPriority=0),d=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||d){d=J.T,J.T=null,y=ee.p,ee.p=2,R=qt,qt|=4;try{Hk(r,a,u)}finally{qt=R,ee.p=y,J.T=d}}Ji=1,Fb(),qb(),jb()}}function Fb(){if(Ji===1){Ji=0;var r=No,a=Nu,u=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||u){u=J.T,J.T=null;var d=ee.p;ee.p=2;var y=qt;qt|=4;try{Tb(a,r);var v=qm,R=Oa(r.containerInfo),G=v.focusedElem,oe=v.selectionRange;if(R!==G&&G&&G.ownerDocument&&jr(G.ownerDocument.documentElement,G)){if(oe!==null&&qs(G)){var Se=oe.start,Me=oe.end;if(Me===void 0&&(Me=Se),"selectionStart"in G)G.selectionStart=Se,G.selectionEnd=Math.min(Me,G.value.length);else{var Le=G.ownerDocument||document,we=Le&&Le.defaultView||window;if(we.getSelection){var De=we.getSelection(),Ke=G.textContent.length,lt=Math.min(oe.start,Ke),ti=oe.end===void 0?lt:Math.min(oe.end,Ke);!De.extend&&lt>ti&&(R=ti,ti=lt,lt=R);var ge=ai(G,lt),he=ai(G,ti);if(ge&&he&&(De.rangeCount!==1||De.anchorNode!==ge.node||De.anchorOffset!==ge.offset||De.focusNode!==he.node||De.focusOffset!==he.offset)){var Te=Le.createRange();Te.setStart(ge.node,ge.offset),De.removeAllRanges(),lt>ti?(De.addRange(Te),De.extend(he.node,he.offset)):(Te.setEnd(he.node,he.offset),De.addRange(Te))}}}}for(Le=[],De=G;De=De.parentNode;)De.nodeType===1&&Le.push({element:De,left:De.scrollLeft,top:De.scrollTop});for(typeof G.focus=="function"&&G.focus(),G=0;G<Le.length;G++){var Ne=Le[G];Ne.element.scrollLeft=Ne.left,Ne.element.scrollTop=Ne.top}}Jh=!!Fm,qm=Fm=null}finally{qt=y,ee.p=d,J.T=u}}r.current=a,Ji=2}}function qb(){if(Ji===2){Ji=0;var r=No,a=Nu,u=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||u){u=J.T,J.T=null;var d=ee.p;ee.p=2;var y=qt;qt|=4;try{gb(r,a.alternate,a)}finally{qt=y,ee.p=d,J.T=u}}Ji=3}}function jb(){if(Ji===4||Ji===3){Ji=0,Dt();var r=No,a=Nu,u=Ha,d=kb;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?Ji=5:(Ji=0,Nu=No=null,Hb(r,r.pendingLanes));var y=r.pendingLanes;if(y===0&&(Mo=null),Wt(u),a=a.stateNode,yi&&typeof yi.onCommitFiberRoot=="function")try{yi.onCommitFiberRoot(Xn,a,void 0,(a.current.flags&128)===128)}catch{}if(d!==null){a=J.T,y=ee.p,ee.p=2,J.T=null;try{for(var v=r.onRecoverableError,R=0;R<d.length;R++){var G=d[R];v(G.value,{componentStack:G.stack})}}finally{J.T=a,ee.p=y}}(Ha&3)!==0&&Fh(),Zs(r),y=r.pendingLanes,(u&261930)!==0&&(y&42)!==0?r===Dm?sd++:(sd=0,Dm=r):sd=0,ad(0)}}function Hb(r,a){(r.pooledCacheLanes&=a)===0&&(a=r.pooledCache,a!=null&&(r.pooledCache=null,bs(a)))}function Fh(){return Fb(),qb(),jb(),Vb()}function Vb(){if(Ji!==5)return!1;var r=No,a=Cm;Cm=0;var u=Wt(Ha),d=J.T,y=ee.p;try{ee.p=32>u?32:u,J.T=null,u=Am,Am=null;var v=No,R=Ha;if(Ji=0,Nu=No=null,Ha=0,(qt&6)!==0)throw Error(n(331));var G=qt;if(qt|=4,Cb(v.current),Sb(v,v.current,R,u),qt=G,ad(0,!1),yi&&typeof yi.onPostCommitFiberRoot=="function")try{yi.onPostCommitFiberRoot(Xn,v)}catch{}return!0}finally{ee.p=y,J.T=d,Hb(r,a)}}function Gb(r,a,u){a=Jn(u,a),a=am(r.stateNode,a,2),r=Do(r,a,2),r!==null&&(pi(r,2),Zs(r))}function Qt(r,a,u){if(r.tag===3)Gb(r,r,u);else for(;a!==null;){if(a.tag===3){Gb(a,r,u);break}else if(a.tag===1){var d=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Mo===null||!Mo.has(d))){r=Jn(u,r),u=Wv(2),d=Do(a,u,2),d!==null&&(Xv(u,d,a,r),pi(d,2),Zs(d));break}}a=a.return}}function Om(r,a,u){var d=r.pingCache;if(d===null){d=r.pingCache=new Wk;var y=new Set;d.set(a,y)}else y=d.get(a),y===void 0&&(y=new Set,d.set(a,y));y.has(u)||(Sm=!0,y.add(u),r=Zk.bind(null,r,a,u),a.then(r,r))}function Zk(r,a,u){var d=r.pingCache;d!==null&&d.delete(a),r.pingedLanes|=r.suspendedLanes&u,r.warmLanes&=~u,li===r&&(kt&u)===u&&($i===4||$i===3&&(kt&62914560)===kt&&300>si()-Nh?(qt&2)===0&&Bu(r,0):wm|=u,Mu===kt&&(Mu=0)),Zs(r)}function Wb(r,a){a===0&&(a=nt()),r=Ra(r,a),r!==null&&(pi(r,a),Zs(r))}function Jk(r){var a=r.memoizedState,u=0;a!==null&&(u=a.retryLane),Wb(r,u)}function e$(r,a){var u=0;switch(r.tag){case 31:case 13:var d=r.stateNode,y=r.memoizedState;y!==null&&(u=y.retryLane);break;case 19:d=r.stateNode;break;case 22:d=r.stateNode._retryCache;break;default:throw Error(n(314))}d!==null&&d.delete(a),Wb(r,u)}function t$(r,a){return ft(r,a)}var qh=null,Uu=null,Im=!1,jh=!1,Rm=!1,Lo=0;function Zs(r){r!==Uu&&r.next===null&&(Uu===null?qh=Uu=r:Uu=Uu.next=r),jh=!0,Im||(Im=!0,n$())}function ad(r,a){if(!Rm&&jh){Rm=!0;do for(var u=!1,d=qh;d!==null;){if(r!==0){var y=d.pendingLanes;if(y===0)var v=0;else{var R=d.suspendedLanes,G=d.pingedLanes;v=(1<<31-zi(42|r)+1)-1,v&=y&~(R&~G),v=v&201326741?v&201326741|1:v?v|2:0}v!==0&&(u=!0,Qb(d,v))}else v=kt,v=re(d,d===li?v:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(v&3)===0||xe(d,v)||(u=!0,Qb(d,v));d=d.next}while(u);Rm=!1}}function i$(){Xb()}function Xb(){jh=Im=!1;var r=0;Lo!==0&&f$()&&(r=Lo);for(var a=si(),u=null,d=qh;d!==null;){var y=d.next,v=Kb(d,a);v===0?(d.next=null,u===null?qh=y:u.next=y,y===null&&(Uu=u)):(u=d,(r!==0||(v&3)!==0)&&(jh=!0)),d=y}Ji!==0&&Ji!==5||ad(r),Lo!==0&&(Lo=0)}function Kb(r,a){for(var u=r.suspendedLanes,d=r.pingedLanes,y=r.expirationTimes,v=r.pendingLanes&-62914561;0<v;){var R=31-zi(v),G=1<<R,oe=y[R];oe===-1?((G&u)===0||(G&d)!==0)&&(y[R]=qe(G,a)):oe<=a&&(r.expiredLanes|=G),v&=~G}if(a=li,u=kt,u=re(r,r===a?u:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),d=r.callbackNode,u===0||r===a&&(Yt===2||Yt===9)||r.cancelPendingCommit!==null)return d!==null&&d!==null&&Pt(d),r.callbackNode=null,r.callbackPriority=0;if((u&3)===0||xe(r,u)){if(a=u&-u,a===r.callbackPriority)return a;switch(d!==null&&Pt(d),Wt(u)){case 2:case 8:u=Pi;break;case 32:u=Xi;break;case 268435456:u=Sn;break;default:u=Xi}return d=Yb.bind(null,r),u=ft(u,d),r.callbackPriority=a,r.callbackNode=u,a}return d!==null&&d!==null&&Pt(d),r.callbackPriority=2,r.callbackNode=null,2}function Yb(r,a){if(Ji!==0&&Ji!==5)return r.callbackNode=null,r.callbackPriority=0,null;var u=r.callbackNode;if(Fh()&&r.callbackNode!==u)return null;var d=kt;return d=re(r,r===li?d:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),d===0?null:(Ob(r,d,a),Kb(r,si()),r.callbackNode!=null&&r.callbackNode===u?Yb.bind(null,r):null)}function Qb(r,a){if(Fh())return null;Ob(r,a,!0)}function n$(){m$(function(){(qt&6)!==0?ft(Wn,i$):Xb()})}function Mm(){if(Lo===0){var r=Gr;r===0&&(r=hr,hr<<=1,(hr&261888)===0&&(hr=256)),Lo=r}return Lo}function Zb(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:lo(""+r)}function Jb(r,a){var u=a.ownerDocument.createElement("input");return u.name=a.name,u.value=a.value,r.id&&u.setAttribute("form",r.id),a.parentNode.insertBefore(u,a),r=new FormData(r),u.parentNode.removeChild(u),r}function r$(r,a,u,d,y){if(a==="submit"&&u&&u.stateNode===y){var v=Zb((y[ci]||null).action),R=d.submitter;R&&(a=(a=R[ci]||null)?Zb(a.formAction):R.getAttribute("formAction"),a!==null&&(v=a,R=null));var G=new ho("action","action",null,d,y);r.push({event:G,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(Lo!==0){var oe=R?Jb(y,R):new FormData(y);em(u,{pending:!0,data:oe,method:y.method,action:v},null,oe)}}else typeof v=="function"&&(G.preventDefault(),oe=R?Jb(y,R):new FormData(y),em(u,{pending:!0,data:oe,method:y.method,action:v},v,oe))},currentTarget:y}]})}}for(var Nm=0;Nm<ct.length;Nm++){var Bm=ct[Nm],s$=Bm.toLowerCase(),a$=Bm[0].toUpperCase()+Bm.slice(1);dt(s$,"on"+a$)}dt(F,"onAnimationEnd"),dt(Q,"onAnimationIteration"),dt(pe,"onAnimationStart"),dt("dblclick","onDoubleClick"),dt("focusin","onFocus"),dt("focusout","onBlur"),dt(Ee,"onTransitionRun"),dt(Be,"onTransitionStart"),dt(Pe,"onTransitionCancel"),dt(Ve,"onTransitionEnd"),os("onMouseEnter",["mouseout","mouseover"]),os("onMouseLeave",["mouseout","mouseover"]),os("onPointerEnter",["pointerout","pointerover"]),os("onPointerLeave",["pointerout","pointerover"]),pr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),pr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),pr("onBeforeInput",["compositionend","keypress","textInput","paste"]),pr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),pr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),pr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var od="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),o$=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(od));function e2(r,a){a=(a&4)!==0;for(var u=0;u<r.length;u++){var d=r[u],y=d.event;d=d.listeners;e:{var v=void 0;if(a)for(var R=d.length-1;0<=R;R--){var G=d[R],oe=G.instance,Se=G.currentTarget;if(G=G.listener,oe!==v&&y.isPropagationStopped())break e;v=G,y.currentTarget=Se;try{v(y)}catch(Me){Xt(Me)}y.currentTarget=null,v=oe}else for(R=0;R<d.length;R++){if(G=d[R],oe=G.instance,Se=G.currentTarget,G=G.listener,oe!==v&&y.isPropagationStopped())break e;v=G,y.currentTarget=Se;try{v(y)}catch(Me){Xt(Me)}y.currentTarget=null,v=oe}}}}function Ct(r,a){var u=a[Un];u===void 0&&(u=a[Un]=new Set);var d=r+"__bubble";u.has(d)||(t2(a,r,2,!1),u.add(d))}function Lm(r,a,u){var d=0;a&&(d|=4),t2(u,r,d,a)}var Hh="_reactListening"+Math.random().toString(36).slice(2);function Um(r){if(!r[Hh]){r[Hh]=!0,pa.forEach(function(u){u!=="selectionchange"&&(o$.has(u)||Lm(u,!1,r),Lm(u,!0,r))});var a=r.nodeType===9?r:r.ownerDocument;a===null||a[Hh]||(a[Hh]=!0,Lm("selectionchange",!1,a))}}function t2(r,a,u,d){switch($2(a)){case 2:var y=N$;break;case 8:y=B$;break;default:y=Jm}u=y.bind(null,a,u,r),y=void 0,!ya||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(y=!0),d?y!==void 0?r.addEventListener(a,u,{capture:!0,passive:y}):r.addEventListener(a,u,!0):y!==void 0?r.addEventListener(a,u,{passive:y}):r.addEventListener(a,u,!1)}function Pm(r,a,u,d,y){var v=d;if((a&1)===0&&(a&2)===0&&d!==null)e:for(;;){if(d===null)return;var R=d.tag;if(R===3||R===4){var G=d.stateNode.containerInfo;if(G===y)break;if(R===4)for(R=d.return;R!==null;){var oe=R.tag;if((oe===3||oe===4)&&R.stateNode.containerInfo===y)return;R=R.return}for(;G!==null;){if(R=fr(G),R===null)return;if(oe=R.tag,oe===5||oe===6||oe===26||oe===27){d=v=R;continue e}G=G.parentNode}}d=d.return}du(function(){var Se=v,Me=_n(u),Le=[];e:{var we=tt.get(r);if(we!==void 0){var De=ho,Ke=r;switch(r){case"keypress":if(Ta(u)===0)break e;case"keydown":case"keyup":De=mu;break;case"focusin":Ke="focus",De=Bs;break;case"focusout":Ke="blur",De=Bs;break;case"beforeblur":case"afterblur":De=Bs;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":De=hu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":De=$c;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":De=ms;break;case F:case Q:case pe:De=Ls;break;case Ve:De=gu;break;case"scroll":case"scrollend":De=ol;break;case"wheel":De=_u;break;case"copy":case"cut":case"paste":De=Dn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":De=Pr;break;case"toggle":case"beforetoggle":De=Nc}var lt=(a&4)!==0,ti=!lt&&(r==="scroll"||r==="scrollend"),ge=lt?we!==null?we+"Capture":null:we;lt=[];for(var he=Se,Te;he!==null;){var Ne=he;if(Te=Ne.stateNode,Ne=Ne.tag,Ne!==5&&Ne!==26&&Ne!==27||Te===null||ge===null||(Ne=Zn(he,ge),Ne!=null&&lt.push(ld(he,Ne,Te))),ti)break;he=he.return}0<lt.length&&(we=new De(we,Ke,null,u,Me),Le.push({event:we,listeners:lt}))}}if((a&7)===0){e:{if(we=r==="mouseover"||r==="pointerover",De=r==="mouseout"||r==="pointerout",we&&u!==yn&&(Ke=u.relatedTarget||u.fromElement)&&(fr(Ke)||Ke[gt]))break e;if((De||we)&&(we=Me.window===Me?Me:(we=Me.ownerDocument)?we.defaultView||we.parentWindow:window,De?(Ke=u.relatedTarget||u.toElement,De=Se,Ke=Ke?fr(Ke):null,Ke!==null&&(ti=o(Ke),lt=Ke.tag,Ke!==ti||lt!==5&&lt!==27&&lt!==6)&&(Ke=null)):(De=null,Ke=Se),De!==Ke)){if(lt=hu,Ne="onMouseLeave",ge="onMouseEnter",he="mouse",(r==="pointerout"||r==="pointerover")&&(lt=Pr,Ne="onPointerLeave",ge="onPointerEnter",he="pointer"),ti=De==null?we:as(De),Te=Ke==null?we:as(Ke),we=new lt(Ne,he+"leave",De,u,Me),we.target=ti,we.relatedTarget=Te,Ne=null,fr(Me)===Se&&(lt=new lt(ge,he+"enter",Ke,u,Me),lt.target=Te,lt.relatedTarget=ti,Ne=lt),ti=Ne,De&&Ke)t:{for(lt=l$,ge=De,he=Ke,Te=0,Ne=ge;Ne;Ne=lt(Ne))Te++;Ne=0;for(var st=he;st;st=lt(st))Ne++;for(;0<Te-Ne;)ge=lt(ge),Te--;for(;0<Ne-Te;)he=lt(he),Ne--;for(;Te--;){if(ge===he||he!==null&&ge===he.alternate){lt=ge;break t}ge=lt(ge),he=lt(he)}lt=null}else lt=null;De!==null&&i2(Le,we,De,lt,!1),Ke!==null&&ti!==null&&i2(Le,ti,Ke,lt,!0)}}e:{if(we=Se?as(Se):window,De=we.nodeName&&we.nodeName.toLowerCase(),De==="select"||De==="input"&&we.type==="file")var zt=fl;else if(vo(we))if(ka)zt=vl;else{zt=gr;var et=_l}else De=we.nodeName,!De||De.toLowerCase()!=="input"||we.type!=="checkbox"&&we.type!=="radio"?Se&&hs(Se.elementType)&&(zt=fl):zt=$a;if(zt&&(zt=zt(r,Se))){hl(Le,zt,u,Me);break e}et&&et(r,we,Se),r==="focusout"&&Se&&we.type==="number"&&Se.memoizedProps.value!=null&&us(we,"number",we.value)}switch(et=Se?as(Se):window,r){case"focusin":(vo(et)||et.contentEditable==="true")&&(Hr=et,bo=Se,_s=null);break;case"focusout":_s=bo=Hr=null;break;case"mousedown":Ia=!0;break;case"contextmenu":case"mouseup":case"dragend":Ia=!1,To(Le,u,Me);break;case"selectionchange":if(bl)break;case"keydown":case"keyup":To(Le,u,Me)}var Tt;if(Us)e:{switch(r){case"compositionstart":var $t="onCompositionStart";break e;case"compositionend":$t="onCompositionEnd";break e;case"compositionupdate":$t="onCompositionUpdate";break e}$t=void 0}else gs?zs(r,u)&&($t="onCompositionEnd"):r==="keydown"&&u.keyCode===229&&($t="onCompositionStart");$t&&(cl&&u.locale!=="ko"&&(gs||$t!=="onCompositionStart"?$t==="onCompositionEnd"&&gs&&(Tt=ba()):(Pn=Me,uo="value"in Pn?Pn.value:Pn.textContent,gs=!0)),et=Vh(Se,$t),0<et.length&&($t=new Ea($t,r,null,u,Me),Le.push({event:$t,listeners:et}),Tt?$t.data=Tt:(Tt=yo(u),Tt!==null&&($t.data=Tt)))),(Tt=Ps?bu(r,u):_o(r,u))&&($t=Vh(Se,"onBeforeInput"),0<$t.length&&(et=new Ea("onBeforeInput","beforeinput",null,u,Me),Le.push({event:et,listeners:$t}),et.data=Tt)),r$(Le,r,Se,u,Me)}e2(Le,a)})}function ld(r,a,u){return{instance:r,listener:a,currentTarget:u}}function Vh(r,a){for(var u=a+"Capture",d=[];r!==null;){var y=r,v=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||v===null||(y=Zn(r,u),y!=null&&d.unshift(ld(r,y,v)),y=Zn(r,a),y!=null&&d.push(ld(r,y,v))),r.tag===3)return d;r=r.return}return[]}function l$(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function i2(r,a,u,d,y){for(var v=a._reactName,R=[];u!==null&&u!==d;){var G=u,oe=G.alternate,Se=G.stateNode;if(G=G.tag,oe!==null&&oe===d)break;G!==5&&G!==26&&G!==27||Se===null||(oe=Se,y?(Se=Zn(u,v),Se!=null&&R.unshift(ld(u,Se,oe))):y||(Se=Zn(u,v),Se!=null&&R.push(ld(u,Se,oe)))),u=u.return}R.length!==0&&r.push({event:a,listeners:R})}var u$=/\r\n?/g,c$=/\u0000|\uFFFD/g;function n2(r){return(typeof r=="string"?r:""+r).replace(u$,`
`).replace(c$,"")}function r2(r,a){return a=n2(a),n2(r)===a}function ei(r,a,u,d,y,v){switch(u){case"children":typeof d=="string"?a==="body"||a==="textarea"&&d===""||Yn(r,d):(typeof d=="number"||typeof d=="bigint")&&a!=="body"&&Yn(r,""+d);break;case"className":Br(r,"class",d);break;case"tabIndex":Br(r,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":Br(r,u,d);break;case"style":ao(r,d,v);break;case"data":if(a!=="object"){Br(r,"data",d);break}case"src":case"href":if(d===""&&(a!=="a"||u!=="href")){r.removeAttribute(u);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){r.removeAttribute(u);break}d=lo(""+d),r.setAttribute(u,d);break;case"action":case"formAction":if(typeof d=="function"){r.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof v=="function"&&(u==="formAction"?(a!=="input"&&ei(r,a,"name",y.name,y,null),ei(r,a,"formEncType",y.formEncType,y,null),ei(r,a,"formMethod",y.formMethod,y,null),ei(r,a,"formTarget",y.formTarget,y,null)):(ei(r,a,"encType",y.encType,y,null),ei(r,a,"method",y.method,y,null),ei(r,a,"target",y.target,y,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){r.removeAttribute(u);break}d=lo(""+d),r.setAttribute(u,d);break;case"onClick":d!=null&&(r.onclick=Cn);break;case"onScroll":d!=null&&Ct("scroll",r);break;case"onScrollEnd":d!=null&&Ct("scrollend",r);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(n(61));if(u=d.__html,u!=null){if(y.children!=null)throw Error(n(60));r.innerHTML=u}}break;case"multiple":r.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":r.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){r.removeAttribute("xlink:href");break}u=lo(""+d),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(u,""+d):r.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(u,""):r.removeAttribute(u);break;case"capture":case"download":d===!0?r.setAttribute(u,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?r.setAttribute(u,d):r.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?r.setAttribute(u,d):r.removeAttribute(u);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?r.removeAttribute(u):r.setAttribute(u,d);break;case"popover":Ct("beforetoggle",r),Ct("toggle",r),ls(r,"popover",d);break;case"xlinkActuate":sn(r,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":sn(r,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":sn(r,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":sn(r,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":sn(r,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":sn(r,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":sn(r,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":sn(r,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":sn(r,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":ls(r,"is",d);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=oo.get(u)||u,ls(r,u,d))}}function zm(r,a,u,d,y,v){switch(u){case"style":ao(r,d,v);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(n(61));if(u=d.__html,u!=null){if(y.children!=null)throw Error(n(60));r.innerHTML=u}}break;case"children":typeof d=="string"?Yn(r,d):(typeof d=="number"||typeof d=="bigint")&&Yn(r,""+d);break;case"onScroll":d!=null&&Ct("scroll",r);break;case"onScrollEnd":d!=null&&Ct("scrollend",r);break;case"onClick":d!=null&&(r.onclick=Cn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!io.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(y=u.endsWith("Capture"),a=u.slice(2,y?u.length-7:void 0),v=r[ci]||null,v=v!=null?v[u]:null,typeof v=="function"&&r.removeEventListener(a,v,y),typeof d=="function")){typeof v!="function"&&v!==null&&(u in r?r[u]=null:r.hasAttribute(u)&&r.removeAttribute(u)),r.addEventListener(a,d,y);break e}u in r?r[u]=d:d===!0?r.setAttribute(u,""):ls(r,u,d)}}}function Tn(r,a,u){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ct("error",r),Ct("load",r);var d=!1,y=!1,v;for(v in u)if(u.hasOwnProperty(v)){var R=u[v];if(R!=null)switch(v){case"src":d=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:ei(r,a,v,R,u,null)}}y&&ei(r,a,"srcSet",u.srcSet,u,null),d&&ei(r,a,"src",u.src,u,null);return;case"input":Ct("invalid",r);var G=v=R=y=null,oe=null,Se=null;for(d in u)if(u.hasOwnProperty(d)){var Me=u[d];if(Me!=null)switch(d){case"name":y=Me;break;case"type":R=Me;break;case"checked":oe=Me;break;case"defaultChecked":Se=Me;break;case"value":v=Me;break;case"defaultValue":G=Me;break;case"children":case"dangerouslySetInnerHTML":if(Me!=null)throw Error(n(137,a));break;default:ei(r,a,d,Me,u,null)}}Ns(r,v,G,oe,Se,R,y,!1);return;case"select":Ct("invalid",r),d=R=v=null;for(y in u)if(u.hasOwnProperty(y)&&(G=u[y],G!=null))switch(y){case"value":v=G;break;case"defaultValue":R=G;break;case"multiple":d=G;default:ei(r,a,y,G,u,null)}a=v,u=R,r.multiple=!!d,a!=null?Si(r,!!d,a,!1):u!=null&&Si(r,!!d,u,!0);return;case"textarea":Ct("invalid",r),v=y=d=null;for(R in u)if(u.hasOwnProperty(R)&&(G=u[R],G!=null))switch(R){case"value":d=G;break;case"defaultValue":y=G;break;case"children":v=G;break;case"dangerouslySetInnerHTML":if(G!=null)throw Error(n(91));break;default:ei(r,a,R,G,u,null)}cs(r,d,y,v);return;case"option":for(oe in u)if(u.hasOwnProperty(oe)&&(d=u[oe],d!=null))switch(oe){case"selected":r.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:ei(r,a,oe,d,u,null)}return;case"dialog":Ct("beforetoggle",r),Ct("toggle",r),Ct("cancel",r),Ct("close",r);break;case"iframe":case"object":Ct("load",r);break;case"video":case"audio":for(d=0;d<od.length;d++)Ct(od[d],r);break;case"image":Ct("error",r),Ct("load",r);break;case"details":Ct("toggle",r);break;case"embed":case"source":case"link":Ct("error",r),Ct("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Se in u)if(u.hasOwnProperty(Se)&&(d=u[Se],d!=null))switch(Se){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:ei(r,a,Se,d,u,null)}return;default:if(hs(a)){for(Me in u)u.hasOwnProperty(Me)&&(d=u[Me],d!==void 0&&zm(r,a,Me,d,u,void 0));return}}for(G in u)u.hasOwnProperty(G)&&(d=u[G],d!=null&&ei(r,a,G,d,u,null))}function d$(r,a,u,d){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,v=null,R=null,G=null,oe=null,Se=null,Me=null;for(De in u){var Le=u[De];if(u.hasOwnProperty(De)&&Le!=null)switch(De){case"checked":break;case"value":break;case"defaultValue":oe=Le;default:d.hasOwnProperty(De)||ei(r,a,De,null,d,Le)}}for(var we in d){var De=d[we];if(Le=u[we],d.hasOwnProperty(we)&&(De!=null||Le!=null))switch(we){case"type":v=De;break;case"name":y=De;break;case"checked":Se=De;break;case"defaultChecked":Me=De;break;case"value":R=De;break;case"defaultValue":G=De;break;case"children":case"dangerouslySetInnerHTML":if(De!=null)throw Error(n(137,a));break;default:De!==Le&&ei(r,a,we,De,d,Le)}}rl(r,R,G,oe,Se,Me,v,y);return;case"select":De=R=G=we=null;for(v in u)if(oe=u[v],u.hasOwnProperty(v)&&oe!=null)switch(v){case"value":break;case"multiple":De=oe;default:d.hasOwnProperty(v)||ei(r,a,v,null,d,oe)}for(y in d)if(v=d[y],oe=u[y],d.hasOwnProperty(y)&&(v!=null||oe!=null))switch(y){case"value":we=v;break;case"defaultValue":G=v;break;case"multiple":R=v;default:v!==oe&&ei(r,a,y,v,d,oe)}a=G,u=R,d=De,we!=null?Si(r,!!u,we,!1):!!d!=!!u&&(a!=null?Si(r,!!u,a,!0):Si(r,!!u,u?[]:"",!1));return;case"textarea":De=we=null;for(G in u)if(y=u[G],u.hasOwnProperty(G)&&y!=null&&!d.hasOwnProperty(G))switch(G){case"value":break;case"children":break;default:ei(r,a,G,null,d,y)}for(R in d)if(y=d[R],v=u[R],d.hasOwnProperty(R)&&(y!=null||v!=null))switch(R){case"value":we=y;break;case"defaultValue":De=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(n(91));break;default:y!==v&&ei(r,a,R,y,d,v)}cu(r,we,De);return;case"option":for(var Ke in u)if(we=u[Ke],u.hasOwnProperty(Ke)&&we!=null&&!d.hasOwnProperty(Ke))switch(Ke){case"selected":r.selected=!1;break;default:ei(r,a,Ke,null,d,we)}for(oe in d)if(we=d[oe],De=u[oe],d.hasOwnProperty(oe)&&we!==De&&(we!=null||De!=null))switch(oe){case"selected":r.selected=we&&typeof we!="function"&&typeof we!="symbol";break;default:ei(r,a,oe,we,d,De)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var lt in u)we=u[lt],u.hasOwnProperty(lt)&&we!=null&&!d.hasOwnProperty(lt)&&ei(r,a,lt,null,d,we);for(Se in d)if(we=d[Se],De=u[Se],d.hasOwnProperty(Se)&&we!==De&&(we!=null||De!=null))switch(Se){case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(n(137,a));break;default:ei(r,a,Se,we,d,De)}return;default:if(hs(a)){for(var ti in u)we=u[ti],u.hasOwnProperty(ti)&&we!==void 0&&!d.hasOwnProperty(ti)&&zm(r,a,ti,void 0,d,we);for(Me in d)we=d[Me],De=u[Me],!d.hasOwnProperty(Me)||we===De||we===void 0&&De===void 0||zm(r,a,Me,we,d,De);return}}for(var ge in u)we=u[ge],u.hasOwnProperty(ge)&&we!=null&&!d.hasOwnProperty(ge)&&ei(r,a,ge,null,d,we);for(Le in d)we=d[Le],De=u[Le],!d.hasOwnProperty(Le)||we===De||we==null&&De==null||ei(r,a,Le,we,d,De)}function s2(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function h$(){if(typeof performance.getEntriesByType=="function"){for(var r=0,a=0,u=performance.getEntriesByType("resource"),d=0;d<u.length;d++){var y=u[d],v=y.transferSize,R=y.initiatorType,G=y.duration;if(v&&G&&s2(R)){for(R=0,G=y.responseEnd,d+=1;d<u.length;d++){var oe=u[d],Se=oe.startTime;if(Se>G)break;var Me=oe.transferSize,Le=oe.initiatorType;Me&&s2(Le)&&(oe=oe.responseEnd,R+=Me*(oe<G?1:(G-Se)/(oe-Se)))}if(--d,a+=8*(v+R)/(y.duration/1e3),r++,10<r)break}}if(0<r)return a/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var Fm=null,qm=null;function Gh(r){return r.nodeType===9?r:r.ownerDocument}function a2(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function o2(r,a){if(r===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&a==="foreignObject"?0:r}function jm(r,a){return r==="textarea"||r==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Hm=null;function f$(){var r=window.event;return r&&r.type==="popstate"?r===Hm?!1:(Hm=r,!0):(Hm=null,!1)}var l2=typeof setTimeout=="function"?setTimeout:void 0,p$=typeof clearTimeout=="function"?clearTimeout:void 0,u2=typeof Promise=="function"?Promise:void 0,m$=typeof queueMicrotask=="function"?queueMicrotask:typeof u2<"u"?function(r){return u2.resolve(null).then(r).catch(g$)}:l2;function g$(r){setTimeout(function(){throw r})}function Uo(r){return r==="head"}function c2(r,a){var u=a,d=0;do{var y=u.nextSibling;if(r.removeChild(u),y&&y.nodeType===8)if(u=y.data,u==="/$"||u==="/&"){if(d===0){r.removeChild(y),qu(a);return}d--}else if(u==="$"||u==="$?"||u==="$~"||u==="$!"||u==="&")d++;else if(u==="html")ud(r.ownerDocument.documentElement);else if(u==="head"){u=r.ownerDocument.head,ud(u);for(var v=u.firstChild;v;){var R=v.nextSibling,G=v.nodeName;v[Ai]||G==="SCRIPT"||G==="STYLE"||G==="LINK"&&v.rel.toLowerCase()==="stylesheet"||u.removeChild(v),v=R}}else u==="body"&&ud(r.ownerDocument.body);u=y}while(u);qu(a)}function d2(r,a){var u=r;r=0;do{var d=u.nextSibling;if(u.nodeType===1?a?(u._stashedDisplay=u.style.display,u.style.display="none"):(u.style.display=u._stashedDisplay||"",u.getAttribute("style")===""&&u.removeAttribute("style")):u.nodeType===3&&(a?(u._stashedText=u.nodeValue,u.nodeValue=""):u.nodeValue=u._stashedText||""),d&&d.nodeType===8)if(u=d.data,u==="/$"){if(r===0)break;r--}else u!=="$"&&u!=="$?"&&u!=="$~"&&u!=="$!"||r++;u=d}while(u)}function Vm(r){var a=r.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var u=a;switch(a=a.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":Vm(u),Ht(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}r.removeChild(u)}}function y$(r,a,u,d){for(;r.nodeType===1;){var y=u;if(r.nodeName.toLowerCase()!==a.toLowerCase()){if(!d&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(d){if(!r[Ai])switch(a){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(v=r.getAttribute("rel"),v==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(v!==y.rel||r.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||r.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||r.getAttribute("title")!==(y.title==null?null:y.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(v=r.getAttribute("src"),(v!==(y.src==null?null:y.src)||r.getAttribute("type")!==(y.type==null?null:y.type)||r.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&v&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(a==="input"&&r.type==="hidden"){var v=y.name==null?null:""+y.name;if(y.type==="hidden"&&r.getAttribute("name")===v)return r}else return r;if(r=Xr(r.nextSibling),r===null)break}return null}function _$(r,a,u){if(a==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!u||(r=Xr(r.nextSibling),r===null))return null;return r}function h2(r,a){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!a||(r=Xr(r.nextSibling),r===null))return null;return r}function Gm(r){return r.data==="$?"||r.data==="$~"}function Wm(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function v$(r,a){var u=r.ownerDocument;if(r.data==="$~")r._reactRetry=a;else if(r.data!=="$?"||u.readyState!=="loading")a();else{var d=function(){a(),u.removeEventListener("DOMContentLoaded",d)};u.addEventListener("DOMContentLoaded",d),r._reactRetry=d}}function Xr(r){for(;r!=null;r=r.nextSibling){var a=r.nodeType;if(a===1||a===3)break;if(a===8){if(a=r.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return r}var Xm=null;function f2(r){r=r.nextSibling;for(var a=0;r;){if(r.nodeType===8){var u=r.data;if(u==="/$"||u==="/&"){if(a===0)return Xr(r.nextSibling);a--}else u!=="$"&&u!=="$!"&&u!=="$?"&&u!=="$~"&&u!=="&"||a++}r=r.nextSibling}return null}function p2(r){r=r.previousSibling;for(var a=0;r;){if(r.nodeType===8){var u=r.data;if(u==="$"||u==="$!"||u==="$?"||u==="$~"||u==="&"){if(a===0)return r;a--}else u!=="/$"&&u!=="/&"||a++}r=r.previousSibling}return null}function m2(r,a,u){switch(a=Gh(u),r){case"html":if(r=a.documentElement,!r)throw Error(n(452));return r;case"head":if(r=a.head,!r)throw Error(n(453));return r;case"body":if(r=a.body,!r)throw Error(n(454));return r;default:throw Error(n(451))}}function ud(r){for(var a=r.attributes;a.length;)r.removeAttributeNode(a[0]);Ht(r)}var Kr=new Map,g2=new Set;function Wh(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Va=ee.d;ee.d={f:b$,r:T$,D:x$,C:S$,L:w$,m:E$,X:A$,S:C$,M:D$};function b$(){var r=Va.f(),a=Uh();return r||a}function T$(r){var a=Ri(r);a!==null&&a.tag===5&&a.type==="form"?Rv(a):Va.r(r)}var Pu=typeof document>"u"?null:document;function y2(r,a,u){var d=Pu;if(d&&typeof a=="string"&&a){var y=Yi(a);y='link[rel="'+r+'"][href="'+y+'"]',typeof u=="string"&&(y+='[crossorigin="'+u+'"]'),g2.has(y)||(g2.add(y),r={rel:r,crossOrigin:u,href:a},d.querySelector(y)===null&&(a=d.createElement("link"),Tn(a,"link",r),Nt(a),d.head.appendChild(a)))}}function x$(r){Va.D(r),y2("dns-prefetch",r,null)}function S$(r,a){Va.C(r,a),y2("preconnect",r,a)}function w$(r,a,u){Va.L(r,a,u);var d=Pu;if(d&&r&&a){var y='link[rel="preload"][as="'+Yi(a)+'"]';a==="image"&&u&&u.imageSrcSet?(y+='[imagesrcset="'+Yi(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(y+='[imagesizes="'+Yi(u.imageSizes)+'"]')):y+='[href="'+Yi(r)+'"]';var v=y;switch(a){case"style":v=zu(r);break;case"script":v=Fu(r)}Kr.has(v)||(r=_({rel:"preload",href:a==="image"&&u&&u.imageSrcSet?void 0:r,as:a},u),Kr.set(v,r),d.querySelector(y)!==null||a==="style"&&d.querySelector(cd(v))||a==="script"&&d.querySelector(dd(v))||(a=d.createElement("link"),Tn(a,"link",r),Nt(a),d.head.appendChild(a)))}}function E$(r,a){Va.m(r,a);var u=Pu;if(u&&r){var d=a&&typeof a.as=="string"?a.as:"script",y='link[rel="modulepreload"][as="'+Yi(d)+'"][href="'+Yi(r)+'"]',v=y;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":v=Fu(r)}if(!Kr.has(v)&&(r=_({rel:"modulepreload",href:r},a),Kr.set(v,r),u.querySelector(y)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(dd(v)))return}d=u.createElement("link"),Tn(d,"link",r),Nt(d),u.head.appendChild(d)}}}function C$(r,a,u){Va.S(r,a,u);var d=Pu;if(d&&r){var y=_i(d).hoistableStyles,v=zu(r);a=a||"default";var R=y.get(v);if(!R){var G={loading:0,preload:null};if(R=d.querySelector(cd(v)))G.loading=5;else{r=_({rel:"stylesheet",href:r,"data-precedence":a},u),(u=Kr.get(v))&&Km(r,u);var oe=R=d.createElement("link");Nt(oe),Tn(oe,"link",r),oe._p=new Promise(function(Se,Me){oe.onload=Se,oe.onerror=Me}),oe.addEventListener("load",function(){G.loading|=1}),oe.addEventListener("error",function(){G.loading|=2}),G.loading|=4,Xh(R,a,d)}R={type:"stylesheet",instance:R,count:1,state:G},y.set(v,R)}}}function A$(r,a){Va.X(r,a);var u=Pu;if(u&&r){var d=_i(u).hoistableScripts,y=Fu(r),v=d.get(y);v||(v=u.querySelector(dd(y)),v||(r=_({src:r,async:!0},a),(a=Kr.get(y))&&Ym(r,a),v=u.createElement("script"),Nt(v),Tn(v,"link",r),u.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},d.set(y,v))}}function D$(r,a){Va.M(r,a);var u=Pu;if(u&&r){var d=_i(u).hoistableScripts,y=Fu(r),v=d.get(y);v||(v=u.querySelector(dd(y)),v||(r=_({src:r,async:!0,type:"module"},a),(a=Kr.get(y))&&Ym(r,a),v=u.createElement("script"),Nt(v),Tn(v,"link",r),u.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},d.set(y,v))}}function _2(r,a,u,d){var y=(y=ze.current)?Wh(y):null;if(!y)throw Error(n(446));switch(r){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(a=zu(u.href),u=_i(y).hoistableStyles,d=u.get(a),d||(d={type:"style",instance:null,count:0,state:null},u.set(a,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){r=zu(u.href);var v=_i(y).hoistableStyles,R=v.get(r);if(R||(y=y.ownerDocument||y,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},v.set(r,R),(v=y.querySelector(cd(r)))&&!v._p&&(R.instance=v,R.state.loading=5),Kr.has(r)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},Kr.set(r,u),v||k$(y,r,u,R.state))),a&&d===null)throw Error(n(528,""));return R}if(a&&d!==null)throw Error(n(529,""));return null;case"script":return a=u.async,u=u.src,typeof u=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Fu(u),u=_i(y).hoistableScripts,d=u.get(a),d||(d={type:"script",instance:null,count:0,state:null},u.set(a,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,r))}}function zu(r){return'href="'+Yi(r)+'"'}function cd(r){return'link[rel="stylesheet"]['+r+"]"}function v2(r){return _({},r,{"data-precedence":r.precedence,precedence:null})}function k$(r,a,u,d){r.querySelector('link[rel="preload"][as="style"]['+a+"]")?d.loading=1:(a=r.createElement("link"),d.preload=a,a.addEventListener("load",function(){return d.loading|=1}),a.addEventListener("error",function(){return d.loading|=2}),Tn(a,"link",u),Nt(a),r.head.appendChild(a))}function Fu(r){return'[src="'+Yi(r)+'"]'}function dd(r){return"script[async]"+r}function b2(r,a,u){if(a.count++,a.instance===null)switch(a.type){case"style":var d=r.querySelector('style[data-href~="'+Yi(u.href)+'"]');if(d)return a.instance=d,Nt(d),d;var y=_({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return d=(r.ownerDocument||r).createElement("style"),Nt(d),Tn(d,"style",y),Xh(d,u.precedence,r),a.instance=d;case"stylesheet":y=zu(u.href);var v=r.querySelector(cd(y));if(v)return a.state.loading|=4,a.instance=v,Nt(v),v;d=v2(u),(y=Kr.get(y))&&Km(d,y),v=(r.ownerDocument||r).createElement("link"),Nt(v);var R=v;return R._p=new Promise(function(G,oe){R.onload=G,R.onerror=oe}),Tn(v,"link",d),a.state.loading|=4,Xh(v,u.precedence,r),a.instance=v;case"script":return v=Fu(u.src),(y=r.querySelector(dd(v)))?(a.instance=y,Nt(y),y):(d=u,(y=Kr.get(v))&&(d=_({},u),Ym(d,y)),r=r.ownerDocument||r,y=r.createElement("script"),Nt(y),Tn(y,"link",d),r.head.appendChild(y),a.instance=y);case"void":return null;default:throw Error(n(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(d=a.instance,a.state.loading|=4,Xh(d,u.precedence,r));return a.instance}function Xh(r,a,u){for(var d=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=d.length?d[d.length-1]:null,v=y,R=0;R<d.length;R++){var G=d[R];if(G.dataset.precedence===a)v=G;else if(v!==y)break}v?v.parentNode.insertBefore(r,v.nextSibling):(a=u.nodeType===9?u.head:u,a.insertBefore(r,a.firstChild))}function Km(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.title==null&&(r.title=a.title)}function Ym(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.integrity==null&&(r.integrity=a.integrity)}var Kh=null;function T2(r,a,u){if(Kh===null){var d=new Map,y=Kh=new Map;y.set(u,d)}else y=Kh,d=y.get(u),d||(d=new Map,y.set(u,d));if(d.has(r))return d;for(d.set(r,null),u=u.getElementsByTagName(r),y=0;y<u.length;y++){var v=u[y];if(!(v[Ai]||v[rt]||r==="link"&&v.getAttribute("rel")==="stylesheet")&&v.namespaceURI!=="http://www.w3.org/2000/svg"){var R=v.getAttribute(a)||"";R=r+R;var G=d.get(R);G?G.push(v):d.set(R,[v])}}return d}function x2(r,a,u){r=r.ownerDocument||r,r.head.insertBefore(u,a==="title"?r.querySelector("head > title"):null)}function $$(r,a,u){if(u===1||a.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return r=a.disabled,typeof a.precedence=="string"&&r==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function S2(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function O$(r,a,u,d){if(u.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var y=zu(d.href),v=a.querySelector(cd(y));if(v){a=v._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(r.count++,r=Yh.bind(r),a.then(r,r)),u.state.loading|=4,u.instance=v,Nt(v);return}v=a.ownerDocument||a,d=v2(d),(y=Kr.get(y))&&Km(d,y),v=v.createElement("link"),Nt(v);var R=v;R._p=new Promise(function(G,oe){R.onload=G,R.onerror=oe}),Tn(v,"link",d),u.instance=v}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(u,a),(a=u.state.preload)&&(u.state.loading&3)===0&&(r.count++,u=Yh.bind(r),a.addEventListener("load",u),a.addEventListener("error",u))}}var Qm=0;function I$(r,a){return r.stylesheets&&r.count===0&&Zh(r,r.stylesheets),0<r.count||0<r.imgCount?function(u){var d=setTimeout(function(){if(r.stylesheets&&Zh(r,r.stylesheets),r.unsuspend){var v=r.unsuspend;r.unsuspend=null,v()}},6e4+a);0<r.imgBytes&&Qm===0&&(Qm=62500*h$());var y=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&Zh(r,r.stylesheets),r.unsuspend)){var v=r.unsuspend;r.unsuspend=null,v()}},(r.imgBytes>Qm?50:800)+a);return r.unsuspend=u,function(){r.unsuspend=null,clearTimeout(d),clearTimeout(y)}}:null}function Yh(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Zh(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Qh=null;function Zh(r,a){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Qh=new Map,a.forEach(R$,r),Qh=null,Yh.call(r))}function R$(r,a){if(!(a.state.loading&4)){var u=Qh.get(r);if(u)var d=u.get(null);else{u=new Map,Qh.set(r,u);for(var y=r.querySelectorAll("link[data-precedence],style[data-precedence]"),v=0;v<y.length;v++){var R=y[v];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(u.set(R.dataset.precedence,R),d=R)}d&&u.set(null,d)}y=a.instance,R=y.getAttribute("data-precedence"),v=u.get(R)||d,v===d&&u.set(null,y),u.set(R,y),this.count++,d=Yh.bind(this),y.addEventListener("load",d),y.addEventListener("error",d),v?v.parentNode.insertBefore(y,v.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(y,r.firstChild)),a.state.loading|=4}}var hd={$$typeof:B,Provider:null,Consumer:null,_currentValue:de,_currentValue2:de,_threadCount:0};function M$(r,a,u,d,y,v,R,G,oe){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Rt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Rt(0),this.hiddenUpdates=Rt(null),this.identifierPrefix=d,this.onUncaughtError=y,this.onCaughtError=v,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=oe,this.incompleteTransitions=new Map}function w2(r,a,u,d,y,v,R,G,oe,Se,Me,Le){return r=new M$(r,a,u,R,oe,Se,Me,Le,G),a=1,v===!0&&(a|=24),v=Di(3,null,null,a),r.current=v,v.stateNode=r,a=Ma(),a.refCount++,r.pooledCache=a,a.refCount++,v.memoizedState={element:d,isDehydrated:u,cache:a},Mp(v),r}function E2(r){return r?(r=xo,r):xo}function C2(r,a,u,d,y,v){y=E2(y),d.context===null?d.context=y:d.pendingContext=y,d=Ao(a),d.payload={element:u},v=v===void 0?null:v,v!==null&&(d.callback=v),u=Do(r,d,a),u!==null&&(or(u,r,a),Hc(u,r,a))}function A2(r,a){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var u=r.retryLane;r.retryLane=u!==0&&u<a?u:a}}function Zm(r,a){A2(r,a),(r=r.alternate)&&A2(r,a)}function D2(r){if(r.tag===13||r.tag===31){var a=Ra(r,67108864);a!==null&&or(a,r,67108864),Zm(r,67108864)}}function k2(r){if(r.tag===13||r.tag===31){var a=Er();a=Ki(a);var u=Ra(r,a);u!==null&&or(u,r,a),Zm(r,a)}}var Jh=!0;function N$(r,a,u,d){var y=J.T;J.T=null;var v=ee.p;try{ee.p=2,Jm(r,a,u,d)}finally{ee.p=v,J.T=y}}function B$(r,a,u,d){var y=J.T;J.T=null;var v=ee.p;try{ee.p=8,Jm(r,a,u,d)}finally{ee.p=v,J.T=y}}function Jm(r,a,u,d){if(Jh){var y=eg(d);if(y===null)Pm(r,a,d,ef,u),O2(r,d);else if(U$(y,r,a,u,d))d.stopPropagation();else if(O2(r,d),a&4&&-1<L$.indexOf(r)){for(;y!==null;){var v=Ri(y);if(v!==null)switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var R=V(v.pendingLanes);if(R!==0){var G=v;for(G.pendingLanes|=2,G.entangledLanes|=2;R;){var oe=1<<31-zi(R);G.entanglements[1]|=oe,R&=~oe}Zs(v),(qt&6)===0&&(Bh=si()+500,ad(0))}}break;case 31:case 13:G=Ra(v,2),G!==null&&or(G,v,2),Uh(),Zm(v,2)}if(v=eg(d),v===null&&Pm(r,a,d,ef,u),v===y)break;y=v}y!==null&&d.stopPropagation()}else Pm(r,a,d,null,u)}}function eg(r){return r=_n(r),tg(r)}var ef=null;function tg(r){if(ef=null,r=fr(r),r!==null){var a=o(r);if(a===null)r=null;else{var u=a.tag;if(u===13){if(r=l(a),r!==null)return r;r=null}else if(u===31){if(r=c(a),r!==null)return r;r=null}else if(u===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;r=null}else a!==r&&(r=null)}}return ef=r,null}function $2(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Rr()){case Wn:return 2;case Pi:return 8;case Xi:case Rs:return 32;case Sn:return 268435456;default:return 32}default:return 32}}var ig=!1,Po=null,zo=null,Fo=null,fd=new Map,pd=new Map,qo=[],L$="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function O2(r,a){switch(r){case"focusin":case"focusout":Po=null;break;case"dragenter":case"dragleave":zo=null;break;case"mouseover":case"mouseout":Fo=null;break;case"pointerover":case"pointerout":fd.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":pd.delete(a.pointerId)}}function md(r,a,u,d,y,v){return r===null||r.nativeEvent!==v?(r={blockedOn:a,domEventName:u,eventSystemFlags:d,nativeEvent:v,targetContainers:[y]},a!==null&&(a=Ri(a),a!==null&&D2(a)),r):(r.eventSystemFlags|=d,a=r.targetContainers,y!==null&&a.indexOf(y)===-1&&a.push(y),r)}function U$(r,a,u,d,y){switch(a){case"focusin":return Po=md(Po,r,a,u,d,y),!0;case"dragenter":return zo=md(zo,r,a,u,d,y),!0;case"mouseover":return Fo=md(Fo,r,a,u,d,y),!0;case"pointerover":var v=y.pointerId;return fd.set(v,md(fd.get(v)||null,r,a,u,d,y)),!0;case"gotpointercapture":return v=y.pointerId,pd.set(v,md(pd.get(v)||null,r,a,u,d,y)),!0}return!1}function I2(r){var a=fr(r.target);if(a!==null){var u=o(a);if(u!==null){if(a=u.tag,a===13){if(a=l(u),a!==null){r.blockedOn=a,Ln(r.priority,function(){k2(u)});return}}else if(a===31){if(a=c(u),a!==null){r.blockedOn=a,Ln(r.priority,function(){k2(u)});return}}else if(a===3&&u.stateNode.current.memoizedState.isDehydrated){r.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}r.blockedOn=null}function tf(r){if(r.blockedOn!==null)return!1;for(var a=r.targetContainers;0<a.length;){var u=eg(r.nativeEvent);if(u===null){u=r.nativeEvent;var d=new u.constructor(u.type,u);yn=d,u.target.dispatchEvent(d),yn=null}else return a=Ri(u),a!==null&&D2(a),r.blockedOn=u,!1;a.shift()}return!0}function R2(r,a,u){tf(r)&&u.delete(a)}function P$(){ig=!1,Po!==null&&tf(Po)&&(Po=null),zo!==null&&tf(zo)&&(zo=null),Fo!==null&&tf(Fo)&&(Fo=null),fd.forEach(R2),pd.forEach(R2)}function nf(r,a){r.blockedOn===a&&(r.blockedOn=null,ig||(ig=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,P$)))}var rf=null;function M2(r){rf!==r&&(rf=r,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){rf===r&&(rf=null);for(var a=0;a<r.length;a+=3){var u=r[a],d=r[a+1],y=r[a+2];if(typeof d!="function"){if(tg(d||u)===null)continue;break}var v=Ri(u);v!==null&&(r.splice(a,3),a-=3,em(v,{pending:!0,data:y,method:u.method,action:d},d,y))}}))}function qu(r){function a(oe){return nf(oe,r)}Po!==null&&nf(Po,r),zo!==null&&nf(zo,r),Fo!==null&&nf(Fo,r),fd.forEach(a),pd.forEach(a);for(var u=0;u<qo.length;u++){var d=qo[u];d.blockedOn===r&&(d.blockedOn=null)}for(;0<qo.length&&(u=qo[0],u.blockedOn===null);)I2(u),u.blockedOn===null&&qo.shift();if(u=(r.ownerDocument||r).$$reactFormReplay,u!=null)for(d=0;d<u.length;d+=3){var y=u[d],v=u[d+1],R=y[ci]||null;if(typeof v=="function")R||M2(u);else if(R){var G=null;if(v&&v.hasAttribute("formAction")){if(y=v,R=v[ci]||null)G=R.formAction;else if(tg(y)!==null)continue}else G=R.action;typeof G=="function"?u[d+1]=G:(u.splice(d,3),d-=3),M2(u)}}}function N2(){function r(v){v.canIntercept&&v.info==="react-transition"&&v.intercept({handler:function(){return new Promise(function(R){return y=R})},focusReset:"manual",scroll:"manual"})}function a(){y!==null&&(y(),y=null),d||setTimeout(u,20)}function u(){if(!d&&!navigation.transition){var v=navigation.currentEntry;v&&v.url!=null&&navigation.navigate(v.url,{state:v.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var d=!1,y=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(u,100),function(){d=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),y!==null&&(y(),y=null)}}}function ng(r){this._internalRoot=r}sf.prototype.render=ng.prototype.render=function(r){var a=this._internalRoot;if(a===null)throw Error(n(409));var u=a.current,d=Er();C2(u,d,r,a,null,null)},sf.prototype.unmount=ng.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var a=r.containerInfo;C2(r.current,2,null,r,null,null),Uh(),a[gt]=null}};function sf(r){this._internalRoot=r}sf.prototype.unstable_scheduleHydration=function(r){if(r){var a=rn();r={blockedOn:null,target:r,priority:a};for(var u=0;u<qo.length&&a!==0&&a<qo[u].priority;u++);qo.splice(u,0,r),u===0&&I2(r)}};var B2=e.version;if(B2!=="19.2.0")throw Error(n(527,B2,"19.2.0"));ee.findDOMNode=function(r){var a=r._reactInternals;if(a===void 0)throw typeof r.render=="function"?Error(n(188)):(r=Object.keys(r).join(","),Error(n(268,r)));return r=f(a),r=r!==null?m(r):null,r=r===null?null:r.stateNode,r};var z$={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:J,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var af=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!af.isDisabled&&af.supportsFiber)try{Xn=af.inject(z$),yi=af}catch{}}return yd.createRoot=function(r,a){if(!s(r))throw Error(n(299));var u=!1,d="",y=jv,v=Hv,R=Vv;return a!=null&&(a.unstable_strictMode===!0&&(u=!0),a.identifierPrefix!==void 0&&(d=a.identifierPrefix),a.onUncaughtError!==void 0&&(y=a.onUncaughtError),a.onCaughtError!==void 0&&(v=a.onCaughtError),a.onRecoverableError!==void 0&&(R=a.onRecoverableError)),a=w2(r,1,!1,null,null,u,d,null,y,v,R,N2),r[gt]=a.current,Um(r),new ng(a)},yd.hydrateRoot=function(r,a,u){if(!s(r))throw Error(n(299));var d=!1,y="",v=jv,R=Hv,G=Vv,oe=null;return u!=null&&(u.unstable_strictMode===!0&&(d=!0),u.identifierPrefix!==void 0&&(y=u.identifierPrefix),u.onUncaughtError!==void 0&&(v=u.onUncaughtError),u.onCaughtError!==void 0&&(R=u.onCaughtError),u.onRecoverableError!==void 0&&(G=u.onRecoverableError),u.formState!==void 0&&(oe=u.formState)),a=w2(r,1,!0,a,u??null,d,y,oe,v,R,G,N2),a.context=E2(null),u=a.current,d=Er(),d=Ki(d),y=Ao(d),y.callback=null,Do(u,y,d),u=d,a.current.lanes=u,pi(a,u),Zs(a),r[gt]=a.current,Um(r),new sf(a)},yd.version="19.2.0",yd}var G2;function Q$(){if(G2)return ag.exports;G2=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),ag.exports=Y$(),ag.exports}var Z$=Q$();function J$({children:t}){return He.jsx("div",{className:"flex min-h-screen",children:t})}const eO=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),tO=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,i,n)=>n?n.toUpperCase():i.toLowerCase()),W2=t=>{const e=tO(t);return e.charAt(0).toUpperCase()+e.slice(1)},iE=(...t)=>t.filter((e,i,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===i).join(" ").trim(),iO=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var nO={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const rO=gi.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:i=2,absoluteStrokeWidth:n,className:s="",children:o,iconNode:l,...c},h)=>gi.createElement("svg",{ref:h,...nO,width:e,height:e,stroke:t,strokeWidth:n?Number(i)*24/Number(e):i,className:iE("lucide",s),...!o&&!iO(c)&&{"aria-hidden":"true"},...c},[...l.map(([f,m])=>gi.createElement(f,m)),...Array.isArray(o)?o:[o]]));const op=(t,e)=>{const i=gi.forwardRef(({className:n,...s},o)=>gi.createElement(rO,{ref:o,iconNode:e,className:iE(`lucide-${eO(W2(t))}`,`lucide-${t}`,n),...s}));return i.displayName=W2(t),i};const sO=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],nE=op("cloud-upload",sO);const aO=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],oO=op("image",aO);const lO=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],rE=op("loader-circle",lO);const uO=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],cO=op("video",uO);var Oy=Object.defineProperty,dO=Object.getOwnPropertyDescriptor,hO=Object.getOwnPropertyNames,fO=Object.prototype.hasOwnProperty,pO=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,i)=>(typeof require<"u"?require:e)[i]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')}),Ue=(t,e)=>()=>(t&&(e=t(t=0)),e),_c=(t,e)=>{for(var i in e)Oy(t,i,{get:e[i],enumerable:!0})},mO=(t,e,i,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of hO(e))!fO.call(t,s)&&s!==i&&Oy(t,s,{get:()=>e[s],enumerable:!(n=dO(e,s))||n.enumerable});return t},Xd=t=>mO(Oy({},"__esModule",{value:!0}),t),_d,Ho,Wu,X2,sE,aE=Ue(()=>{_d=new Map,Ho=[],Wu=(t,e,i)=>{if(e&&typeof e.init=="function"&&typeof e.createInferenceSessionHandler=="function"){let n=_d.get(t);if(n===void 0)_d.set(t,{backend:e,priority:i});else{if(n.priority>i)return;if(n.priority===i&&n.backend!==e)throw new Error(`cannot register backend "${t}" using priority ${i}`)}if(i>=0){let s=Ho.indexOf(t);s!==-1&&Ho.splice(s,1);for(let o=0;o<Ho.length;o++)if(_d.get(Ho[o]).priority<=i){Ho.splice(o,0,t);return}Ho.push(t)}return}throw new TypeError("not a valid backend")},X2=async t=>{let e=_d.get(t);if(!e)return"backend not found.";if(e.initialized)return e.backend;if(e.aborted)return e.error;{let i=!!e.initPromise;try{return i||(e.initPromise=e.backend.init(t)),await e.initPromise,e.initialized=!0,e.backend}catch(n){return i||(e.error=`${n}`,e.aborted=!0),e.error}finally{delete e.initPromise}}},sE=async t=>{let e=t.executionProviders||[],i=e.map(h=>typeof h=="string"?h:h.name),n=i.length===0?Ho:i,s,o=[],l=new Set;for(let h of n){let f=await X2(h);typeof f=="string"?o.push({name:h,err:f}):(s||(s=f),s===f&&l.add(h))}if(!s)throw new Error(`no available backend found. ERR: ${o.map(h=>`[${h.name}] ${h.err}`).join(", ")}`);for(let{name:h,err:f}of o)i.includes(h)&&console.warn(`removing requested execution provider "${h}" from session options because it is not available: ${f}`);let c=e.filter(h=>l.has(typeof h=="string"?h:h.name));return[s,new Proxy(t,{get:(h,f)=>f==="executionProviders"?c:Reflect.get(h,f)})]}}),gO=Ue(()=>{aE()}),oE,yO=Ue(()=>{oE="1.23.2"}),cg,cn,lE=Ue(()=>{yO(),cg="warning",cn={wasm:{},webgl:{},webgpu:{},versions:{common:oE},set logLevel(t){if(t!==void 0){if(typeof t!="string"||["verbose","info","warning","error","fatal"].indexOf(t)===-1)throw new Error(`Unsupported logging level: ${t}`);cg=t}},get logLevel(){return cg}},Object.defineProperty(cn,"logLevel",{enumerable:!0})}),ui,_O=Ue(()=>{lE(),ui=cn}),uE,cE,vO=Ue(()=>{uE=(t,e)=>{let i=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);i.width=t.dims[3],i.height=t.dims[2];let n=i.getContext("2d");if(n!=null){let s,o;e?.tensorLayout!==void 0&&e.tensorLayout==="NHWC"?(s=t.dims[2],o=t.dims[3]):(s=t.dims[3],o=t.dims[2]);let l=e?.format!==void 0?e.format:"RGB",c=e?.norm,h,f;c===void 0||c.mean===void 0?h=[255,255,255,255]:typeof c.mean=="number"?h=[c.mean,c.mean,c.mean,c.mean]:(h=[c.mean[0],c.mean[1],c.mean[2],0],c.mean[3]!==void 0&&(h[3]=c.mean[3])),c===void 0||c.bias===void 0?f=[0,0,0,0]:typeof c.bias=="number"?f=[c.bias,c.bias,c.bias,c.bias]:(f=[c.bias[0],c.bias[1],c.bias[2],0],c.bias[3]!==void 0&&(f[3]=c.bias[3]));let m=o*s,_=0,E=m,w=m*2,A=-1;l==="RGBA"?(_=0,E=m,w=m*2,A=m*3):l==="RGB"?(_=0,E=m,w=m*2):l==="RBG"&&(_=0,w=m,E=m*2);for(let C=0;C<o;C++)for(let M=0;M<s;M++){let O=(t.data[_++]-f[0])*h[0],$=(t.data[E++]-f[1])*h[1],B=(t.data[w++]-f[2])*h[2],U=A===-1?255:(t.data[A++]-f[3])*h[3];n.fillStyle="rgba("+O+","+$+","+B+","+U+")",n.fillRect(M,C,1,1)}if("toDataURL"in i)return i.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},cE=(t,e)=>{let i=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),n;if(i!=null){let s,o,l;e?.tensorLayout!==void 0&&e.tensorLayout==="NHWC"?(s=t.dims[2],o=t.dims[1],l=t.dims[3]):(s=t.dims[3],o=t.dims[2],l=t.dims[1]);let c=e!==void 0&&e.format!==void 0?e.format:"RGB",h=e?.norm,f,m;h===void 0||h.mean===void 0?f=[255,255,255,255]:typeof h.mean=="number"?f=[h.mean,h.mean,h.mean,h.mean]:(f=[h.mean[0],h.mean[1],h.mean[2],255],h.mean[3]!==void 0&&(f[3]=h.mean[3])),h===void 0||h.bias===void 0?m=[0,0,0,0]:typeof h.bias=="number"?m=[h.bias,h.bias,h.bias,h.bias]:(m=[h.bias[0],h.bias[1],h.bias[2],0],h.bias[3]!==void 0&&(m[3]=h.bias[3]));let _=o*s;if(e!==void 0&&(e.format!==void 0&&l===4&&e.format!=="RGBA"||l===3&&e.format!=="RGB"&&e.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let E=4,w=0,A=1,C=2,M=3,O=0,$=_,B=_*2,U=-1;c==="RGBA"?(O=0,$=_,B=_*2,U=_*3):c==="RGB"?(O=0,$=_,B=_*2):c==="RBG"&&(O=0,B=_,$=_*2),n=i.createImageData(s,o);for(let j=0;j<o*s;w+=E,A+=E,C+=E,M+=E,j++)n.data[w]=(t.data[O++]-m[0])*f[0],n.data[A]=(t.data[$++]-m[1])*f[1],n.data[C]=(t.data[B++]-m[2])*f[2],n.data[M]=U===-1?255:(t.data[U++]-m[3])*f[3]}else throw new Error("Can not access image data");return n}}),of,dE,hE,fE,pE,mE,bO=Ue(()=>{Iy(),of=(t,e)=>{if(t===void 0)throw new Error("Image buffer must be defined");if(e.height===void 0||e.width===void 0)throw new Error("Image height and width must be defined");if(e.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:i,width:n}=e,s=e.norm??{mean:255,bias:0},o,l;typeof s.mean=="number"?o=[s.mean,s.mean,s.mean,s.mean]:o=[s.mean[0],s.mean[1],s.mean[2],s.mean[3]??255],typeof s.bias=="number"?l=[s.bias,s.bias,s.bias,s.bias]:l=[s.bias[0],s.bias[1],s.bias[2],s.bias[3]??0];let c=e.format!==void 0?e.format:"RGBA",h=e.tensorFormat!==void 0&&e.tensorFormat!==void 0?e.tensorFormat:"RGB",f=i*n,m=h==="RGBA"?new Float32Array(f*4):new Float32Array(f*3),_=4,E=0,w=1,A=2,C=3,M=0,O=f,$=f*2,B=-1;c==="RGB"&&(_=3,E=0,w=1,A=2,C=-1),h==="RGBA"?B=f*3:h==="RBG"?(M=0,$=f,O=f*2):h==="BGR"&&($=0,O=f,M=f*2);for(let U=0;U<f;U++,E+=_,A+=_,w+=_,C+=_)m[M++]=(t[E]+l[0])/o[0],m[O++]=(t[w]+l[1])/o[1],m[$++]=(t[A]+l[2])/o[2],B!==-1&&C!==-1&&(m[B++]=(t[C]+l[3])/o[3]);return h==="RGBA"?new kr("float32",m,[1,4,i,n]):new kr("float32",m,[1,3,i,n])},dE=async(t,e)=>{let i=typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement,n=typeof ImageData<"u"&&t instanceof ImageData,s=typeof ImageBitmap<"u"&&t instanceof ImageBitmap,o=typeof t=="string",l,c=e??{},h=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},f=m=>typeof HTMLCanvasElement<"u"&&m instanceof HTMLCanvasElement||m instanceof OffscreenCanvas?m.getContext("2d"):null;if(i){let m=h();m.width=t.width,m.height=t.height;let _=f(m);if(_!=null){let E=t.height,w=t.width;if(e!==void 0&&e.resizedHeight!==void 0&&e.resizedWidth!==void 0&&(E=e.resizedHeight,w=e.resizedWidth),e!==void 0){if(c=e,e.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");c.tensorFormat="RGBA",c.height=E,c.width=w}else c.tensorFormat="RGBA",c.height=E,c.width=w;_.drawImage(t,0,0),l=_.getImageData(0,0,w,E).data}else throw new Error("Can not access image data")}else if(n){let m,_;if(e!==void 0&&e.resizedWidth!==void 0&&e.resizedHeight!==void 0?(m=e.resizedHeight,_=e.resizedWidth):(m=t.height,_=t.width),e!==void 0&&(c=e),c.format="RGBA",c.height=m,c.width=_,e!==void 0){let E=h();E.width=_,E.height=m;let w=f(E);if(w!=null)w.putImageData(t,0,0),l=w.getImageData(0,0,_,m).data;else throw new Error("Can not access image data")}else l=t.data}else if(s){if(e===void 0)throw new Error("Please provide image config with format for Imagebitmap");let m=h();m.width=t.width,m.height=t.height;let _=f(m);if(_!=null){let E=t.height,w=t.width;return _.drawImage(t,0,0,w,E),l=_.getImageData(0,0,w,E).data,c.height=E,c.width=w,of(l,c)}else throw new Error("Can not access image data")}else{if(o)return new Promise((m,_)=>{let E=h(),w=f(E);if(!t||!w)return _();let A=new Image;A.crossOrigin="Anonymous",A.src=t,A.onload=()=>{E.width=A.width,E.height=A.height,w.drawImage(A,0,0,E.width,E.height);let C=w.getImageData(0,0,E.width,E.height);c.height=E.height,c.width=E.width,m(of(C.data,c))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(l!==void 0)return of(l,c);throw new Error("Input data provided is not supported - aborted tensor creation")},hE=(t,e)=>{let{width:i,height:n,download:s,dispose:o}=e,l=[1,n,i,4];return new kr({location:"texture",type:"float32",texture:t,dims:l,download:s,dispose:o})},fE=(t,e)=>{let{dataType:i,dims:n,download:s,dispose:o}=e;return new kr({location:"gpu-buffer",type:i??"float32",gpuBuffer:t,dims:n,download:s,dispose:o})},pE=(t,e)=>{let{dataType:i,dims:n,download:s,dispose:o}=e;return new kr({location:"ml-tensor",type:i??"float32",mlTensor:t,dims:n,download:s,dispose:o})},mE=(t,e,i)=>new kr({location:"cpu-pinned",type:t,data:e,dims:i??[e.length]})}),Fl,Md,dg,gE,TO=Ue(()=>{Fl=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Md=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),dg=!1,gE=()=>{if(!dg){dg=!0;let t=typeof BigInt64Array<"u"&&BigInt64Array.from,e=typeof BigUint64Array<"u"&&BigUint64Array.from,i=globalThis.Float16Array,n=typeof i<"u"&&i.from;t&&(Fl.set("int64",BigInt64Array),Md.set(BigInt64Array,"int64")),e&&(Fl.set("uint64",BigUint64Array),Md.set(BigUint64Array,"uint64")),n?(Fl.set("float16",i),Md.set(i,"float16")):Fl.set("float16",Uint16Array)}}}),yE,_E,xO=Ue(()=>{Iy(),yE=t=>{let e=1;for(let i=0;i<t.length;i++){let n=t[i];if(typeof n!="number"||!Number.isSafeInteger(n))throw new TypeError(`dims[${i}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${i}] must be a non-negative integer, got: ${n}`);e*=n}return e},_E=(t,e)=>{switch(t.location){case"cpu":return new kr(t.type,t.data,e);case"cpu-pinned":return new kr({location:"cpu-pinned",data:t.data,type:t.type,dims:e});case"texture":return new kr({location:"texture",texture:t.texture,type:t.type,dims:e});case"gpu-buffer":return new kr({location:"gpu-buffer",gpuBuffer:t.gpuBuffer,type:t.type,dims:e});case"ml-tensor":return new kr({location:"ml-tensor",mlTensor:t.mlTensor,type:t.type,dims:e});default:throw new Error(`tensorReshape: tensor location ${t.location} is not supported`)}}}),kr,Iy=Ue(()=>{vO(),bO(),TO(),xO(),kr=class{constructor(t,e,i){gE();let n,s;if(typeof t=="object"&&"location"in t)switch(this.dataLocation=t.location,n=t.type,s=t.dims,t.location){case"cpu-pinned":{let l=Fl.get(n);if(!l)throw new TypeError(`unsupported type "${n}" to create tensor from pinned buffer`);if(!(t.data instanceof l))throw new TypeError(`buffer should be of type ${l.name}`);this.cpuData=t.data;break}case"texture":{if(n!=="float32")throw new TypeError(`unsupported type "${n}" to create tensor from texture`);this.gpuTextureData=t.texture,this.downloader=t.download,this.disposer=t.dispose;break}case"gpu-buffer":{if(n!=="float32"&&n!=="float16"&&n!=="int32"&&n!=="int64"&&n!=="uint32"&&n!=="uint8"&&n!=="bool"&&n!=="uint4"&&n!=="int4")throw new TypeError(`unsupported type "${n}" to create tensor from gpu buffer`);this.gpuBufferData=t.gpuBuffer,this.downloader=t.download,this.disposer=t.dispose;break}case"ml-tensor":{if(n!=="float32"&&n!=="float16"&&n!=="int32"&&n!=="int64"&&n!=="uint32"&&n!=="uint64"&&n!=="int8"&&n!=="uint8"&&n!=="bool"&&n!=="uint4"&&n!=="int4")throw new TypeError(`unsupported type "${n}" to create tensor from MLTensor`);this.mlTensorData=t.mlTensor,this.downloader=t.download,this.disposer=t.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let l,c;if(typeof t=="string")if(n=t,c=i,t==="string"){if(!Array.isArray(e))throw new TypeError("A string tensor's data must be a string array.");l=e}else{let h=Fl.get(t);if(h===void 0)throw new TypeError(`Unsupported tensor type: ${t}.`);if(Array.isArray(e)){if(t==="float16"&&h===Uint16Array||t==="uint4"||t==="int4")throw new TypeError(`Creating a ${t} tensor from number array is not supported. Please use ${h.name} as data.`);t==="uint64"||t==="int64"?l=h.from(e,BigInt):l=h.from(e)}else if(e instanceof h)l=e;else if(e instanceof Uint8ClampedArray)if(t==="uint8")l=Uint8Array.from(e);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(t==="float16"&&e instanceof Uint16Array&&h!==Uint16Array)l=new globalThis.Float16Array(e.buffer,e.byteOffset,e.length);else throw new TypeError(`A ${n} tensor's data must be type of ${h}`)}else if(c=e,Array.isArray(t)){if(t.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let h=typeof t[0];if(h==="string")n="string",l=t;else if(h==="boolean")n="bool",l=Uint8Array.from(t);else throw new TypeError(`Invalid element type of data array: ${h}.`)}else if(t instanceof Uint8ClampedArray)n="uint8",l=Uint8Array.from(t);else{let h=Md.get(t.constructor);if(h===void 0)throw new TypeError(`Unsupported type for tensor data: ${t.constructor}.`);n=h,l=t}if(c===void 0)c=[l.length];else if(!Array.isArray(c))throw new TypeError("A tensor's dims must be a number array");s=c,this.cpuData=l,this.dataLocation="cpu"}let o=yE(s);if(this.cpuData&&o!==this.cpuData.length&&!((n==="uint4"||n==="int4")&&Math.ceil(o/2)===this.cpuData.length))throw new Error(`Tensor's size(${o}) does not match data length(${this.cpuData.length}).`);this.type=n,this.dims=s,this.size=o}static async fromImage(t,e){return dE(t,e)}static fromTexture(t,e){return hE(t,e)}static fromGpuBuffer(t,e){return fE(t,e)}static fromMLTensor(t,e){return pE(t,e)}static fromPinnedBuffer(t,e,i){return mE(t,e,i)}toDataURL(t){return uE(this,t)}toImageData(t){return cE(this,t)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(t){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let e=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=e,t&&this.disposer&&(this.disposer(),this.disposer=void 0),e}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(t){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return _E(this,t)}}}),Zr,vE=Ue(()=>{Iy(),Zr=kr}),Rf,hg,oa,ks,Wl,Xl,bE=Ue(()=>{lE(),Rf=(t,e)=>{(typeof cn.trace>"u"?!cn.wasm.trace:!cn.trace)||console.timeStamp(`${t}::ORT::${e}`)},hg=(t,e)=>{let i=new Error().stack?.split(/\r\n|\r|\n/g)||[],n=!1;for(let s=0;s<i.length;s++){if(n&&!i[s].includes("TRACE_FUNC")){let o=`FUNC_${t}::${i[s].trim().split(" ")[1]}`;e&&(o+=`::${e}`),Rf("CPU",o);return}i[s].includes("TRACE_FUNC")&&(n=!0)}},oa=t=>{(typeof cn.trace>"u"?!cn.wasm.trace:!cn.trace)||hg("BEGIN",t)},ks=t=>{(typeof cn.trace>"u"?!cn.wasm.trace:!cn.trace)||hg("END",t)},Wl=t=>{(typeof cn.trace>"u"?!cn.wasm.trace:!cn.trace)||console.time(`ORT::${t}`)},Xl=t=>{(typeof cn.trace>"u"?!cn.wasm.trace:!cn.trace)||console.timeEnd(`ORT::${t}`)}}),TE,SO=Ue(()=>{aE(),vE(),bE(),TE=class xE{constructor(e){this.handler=e}async run(e,i,n){oa(),Wl("InferenceSession.run");let s={},o={};if(typeof e!="object"||e===null||e instanceof Zr||Array.isArray(e))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let l=!0;if(typeof i=="object"){if(i===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(i instanceof Zr)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(i)){if(i.length===0)throw new TypeError("'fetches' cannot be an empty array.");l=!1;for(let f of i){if(typeof f!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(f)===-1)throw new RangeError(`'fetches' contains invalid output name: ${f}.`);s[f]=null}if(typeof n=="object"&&n!==null)o=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{let f=!1,m=Object.getOwnPropertyNames(i);for(let _ of this.outputNames)if(m.indexOf(_)!==-1){let E=i[_];(E===null||E instanceof Zr)&&(f=!0,l=!1,s[_]=E)}if(f){if(typeof n=="object"&&n!==null)o=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else o=i}}else if(typeof i<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let f of this.inputNames)if(typeof e[f]>"u")throw new Error(`input '${f}' is missing in 'feeds'.`);if(l)for(let f of this.outputNames)s[f]=null;let c=await this.handler.run(e,s,o),h={};for(let f in c)if(Object.hasOwnProperty.call(c,f)){let m=c[f];m instanceof Zr?h[f]=m:h[f]=new Zr(m.type,m.data,m.dims)}return Xl("InferenceSession.run"),ks(),h}async release(){return this.handler.dispose()}static async create(e,i,n,s){oa(),Wl("InferenceSession.create");let o,l={};if(typeof e=="string"){if(o=e,typeof i=="object"&&i!==null)l=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof Uint8Array){if(o=e,typeof i=="object"&&i!==null)l=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer){let m=e,_=0,E=e.byteLength;if(typeof i=="object"&&i!==null)l=i;else if(typeof i=="number"){if(_=i,!Number.isSafeInteger(_))throw new RangeError("'byteOffset' must be an integer.");if(_<0||_>=m.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${m.byteLength}).`);if(E=e.byteLength-_,typeof n=="number"){if(E=n,!Number.isSafeInteger(E))throw new RangeError("'byteLength' must be an integer.");if(E<=0||_+E>m.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${m.byteLength-_}].`);if(typeof s=="object"&&s!==null)l=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof i<"u")throw new TypeError("'options' must be an object.");o=new Uint8Array(m,_,E)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[c,h]=await sE(l),f=await c.createInferenceSessionHandler(o,h);return Xl("InferenceSession.create"),ks(),new xE(f)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),Ry,wO=Ue(()=>{SO(),Ry=TE}),EO=Ue(()=>{}),CO=Ue(()=>{}),AO=Ue(()=>{}),DO=Ue(()=>{}),kO={};_c(kO,{InferenceSession:()=>Ry,TRACE:()=>Rf,TRACE_EVENT_BEGIN:()=>Wl,TRACE_EVENT_END:()=>Xl,TRACE_FUNC_BEGIN:()=>oa,TRACE_FUNC_END:()=>ks,Tensor:()=>Zr,env:()=>ui,registerBackend:()=>Wu});var is=Ue(()=>{gO(),_O(),wO(),vE(),EO(),CO(),bE(),AO(),DO()}),My=Ue(()=>{}),SE={};_c(SE,{default:()=>wE});var fg,pg,wE,$O=Ue(()=>{k3(),su(),Ny(),fg="ort-wasm-proxy-worker",pg=globalThis.self?.name===fg,pg&&(self.onmessage=t=>{let{type:e,in:i}=t.data;try{switch(e){case"init-wasm":By(i.wasm).then(()=>{Jy(i).then(()=>{postMessage({type:e})},n=>{postMessage({type:e,err:n})})},n=>{postMessage({type:e,err:n})});break;case"init-ep":{let{epName:n,env:s}=i;e_(s,n).then(()=>{postMessage({type:e})},o=>{postMessage({type:e,err:o})});break}case"copy-from":{let{buffer:n}=i,s=zf(n);postMessage({type:e,out:s});break}case"create":{let{model:n,options:s}=i;t_(n,s).then(o=>{postMessage({type:e,out:o})},o=>{postMessage({type:e,err:o})});break}case"release":i_(i),postMessage({type:e});break;case"run":{let{sessionId:n,inputIndices:s,inputs:o,outputIndices:l,options:c}=i;n_(n,s,o,l,new Array(l.length).fill(null),c).then(h=>{h.some(f=>f[3]!=="cpu")?postMessage({type:e,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:e,out:h},s_([...o,...h]))},h=>{postMessage({type:e,err:h})});break}case"end-profiling":r_(i),postMessage({type:e});break;default:}}catch(n){postMessage({type:e,err:n})}}),wE=pg?null:t=>new Worker(t??Dr,{type:"module",name:fg})}),EE={};_c(EE,{default:()=>CE});var mg,CE,K2,OO=Ue(()=>{mg=async function(t={}){var e,i,n=t,s=new Promise((g,T)=>{e=g,i=T}),o=typeof window=="object",l=typeof WorkerGlobalScope<"u",c=l&&self.name?.startsWith("em-pthread");n.mountExternalData=(g,T)=>{g.startsWith("./")&&(g=g.substring(2)),(n.Fb||(n.Fb=new Map)).set(g,T)},n.unmountExternalData=()=>{delete n.Fb};var h=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,qc:!0}).buffer.constructor;let f=g=>async(...T)=>{try{if(n.Gb)throw Error("Session already started");let k=n.Gb={ec:T[0],errors:[]},N=await g(...T);if(n.Gb!==k)throw Error("Session mismatch");n.Kb?.flush();let F=k.errors;if(0<F.length){let Q=await Promise.all(F);if(Q=Q.filter(pe=>pe),0<Q.length)throw Error(Q.join(`
`))}return N}finally{n.Gb=null}};n.jsepInit=(g,T)=>{if(g==="webgpu"){[n.Kb,n.Vb,n.Zb,n.Lb,n.Yb,n.Ab,n.$b,n.bc,n.Wb,n.Xb,n.ac]=T;let k=n.Kb;n.jsepRegisterBuffer=(N,F,Q,pe)=>k.registerBuffer(N,F,Q,pe),n.jsepGetBuffer=N=>k.getBuffer(N),n.jsepCreateDownloader=(N,F,Q)=>k.createDownloader(N,F,Q),n.jsepOnCreateSession=N=>{k.onCreateSession(N)},n.jsepOnReleaseSession=N=>{k.onReleaseSession(N)},n.jsepOnRunStart=N=>k.onRunStart(N),n.cc=(N,F)=>{k.upload(N,F)}}else if(g==="webnn"){let k=T[0];[n.oc,n.Ob,n.webnnEnsureTensor,n.Pb,n.webnnDownloadTensor,n.nc,n.webnnEnableTraceEvent]=T.slice(1),n.webnnReleaseTensorId=n.Ob,n.webnnUploadTensor=n.Pb,n.webnnRegisterMLContext=n.nc,n.webnnOnRunStart=N=>k.onRunStart(N),n.webnnOnRunEnd=k.onRunEnd.bind(k),n.webnnOnReleaseSession=N=>{k.onReleaseSession(N)},n.webnnCreateMLTensorDownloader=(N,F)=>k.createMLTensorDownloader(N,F),n.webnnRegisterMLTensor=(N,F,Q,pe)=>k.registerMLTensor(N,F,Q,pe),n.webnnCreateMLContext=N=>k.createMLContext(N),n.webnnRegisterMLConstant=(N,F,Q,pe,Ee,Be)=>k.registerMLConstant(N,F,Q,pe,Ee,n.Fb,Be),n.webnnRegisterGraphInput=k.registerGraphInput.bind(k),n.webnnIsGraphInput=k.isGraphInput.bind(k),n.webnnRegisterGraphOutput=k.registerGraphOutput.bind(k),n.webnnIsGraphOutput=k.isGraphOutput.bind(k),n.webnnCreateTemporaryTensor=k.createTemporaryTensor.bind(k),n.webnnIsGraphInputOutputTypeSupported=k.isGraphInputOutputTypeSupported.bind(k)}};let m=()=>{let g=(T,k,N)=>(...F)=>{let Q=_n,pe=k?.();F=T(...F);let Ee=k?.();return pe!==Ee&&(T=Ee,N(pe),k=N=null),_n!=Q?new Promise((Be,Pe)=>{Zn={resolve:Be,reject:Pe}}):F};(()=>{for(let T of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])n[T]=g(n[T],()=>n[T],k=>n[T]=k)})(),f!==void 0&&(n._OrtRun=f(n._OrtRun),n._OrtRunWithBinding=f(n._OrtRunWithBinding)),m=void 0};n.asyncInit=()=>{m?.()};var _,E,w=(g,T)=>{throw T},A=import.meta.url,C="";if(o||l){try{C=new URL(".",A).href}catch{}l&&(E=g=>{var T=new XMLHttpRequest;return T.open("GET",g,!1),T.responseType="arraybuffer",T.send(null),new Uint8Array(T.response)}),_=async g=>{if(ve(g))return new Promise((k,N)=>{var F=new XMLHttpRequest;F.open("GET",g,!0),F.responseType="arraybuffer",F.onload=()=>{F.status==200||F.status==0&&F.response?k(F.response):N(F.status)},F.onerror=N,F.send(null)});var T=await fetch(g,{credentials:"same-origin"});if(T.ok)return T.arrayBuffer();throw Error(T.status+" : "+T.url)}}var M,O,$,B,U,j,W,z,Y,L,H,se,ae,ce,fe,be=console.log.bind(console),J=console.error.bind(console),ee=be,de=J,ue=!1,ve=g=>g.startsWith("file://");function P(){return O.buffer!=U.buffer&&bt(),U}function ne(){return O.buffer!=U.buffer&&bt(),j}function ye(){return O.buffer!=U.buffer&&bt(),W}function ke(){return O.buffer!=U.buffer&&bt(),z}function le(){return O.buffer!=U.buffer&&bt(),Y}function ze(){return O.buffer!=U.buffer&&bt(),L}function it(){return O.buffer!=U.buffer&&bt(),H}function Je(){return O.buffer!=U.buffer&&bt(),ce}if(c){let g=function(T){try{var k=T.data,N=k.Db;if(N==="load"){let F=[];self.onmessage=Q=>F.push(Q),self.startWorker=()=>{postMessage({Db:"loaded"});for(let Q of F)g(Q);self.onmessage=g};for(let Q of k.Sb)n[Q]&&!n[Q].proxy||(n[Q]=(...pe)=>{postMessage({Db:"callHandler",Rb:Q,args:pe})},Q=="print"&&(ee=n[Q]),Q=="printErr"&&(de=n[Q]));O=k.kc,bt(),fe(k.lc)}else if(N==="run"){Bn(k.Bb),vl(k.Bb,0,0,1,0,0),It(),us(k.Bb),Qe||(yl(),Qe=!0);try{zi(k.hc,k.Jb)}catch(F){if(F!="unwind")throw F}}else k.target!=="setimmediate"&&(N==="checkMailbox"?Qe&&Si():N&&(de(`worker: received unknown command ${N}`),de(k)))}catch(F){throw Fs(),F}};var Qe=!1;self.onunhandledrejection=T=>{throw T.reason||T},self.onmessage=g}function bt(){var g=O.buffer;n.HEAP8=U=new Int8Array(g),W=new Int16Array(g),n.HEAPU8=j=new Uint8Array(g),z=new Uint16Array(g),n.HEAP32=Y=new Int32Array(g),n.HEAPU32=L=new Uint32Array(g),H=new Float32Array(g),ce=new Float64Array(g),se=new BigInt64Array(g),ae=new BigUint64Array(g)}function ri(){c?startWorker(n):$e.Da()}var fi,mn=0,Lt=null;function Nn(){if(--mn==0&&Lt){var g=Lt;Lt=null,g()}}function Ut(g){throw de(g="Aborted("+g+")"),ue=!0,g=new WebAssembly.RuntimeError(g+". Build with -sASSERTIONS for more info."),i(g),g}function rs(){return{a:{L:ml,Aa:pl,b:Mr,$:hr,A:re,pa:xe,X:qe,Z:nt,qa:Rt,na:pi,ga:tn,ma:wn,J:nn,Y:gn,V:Ki,oa:Wt,W:rn,va:Ii,E:ou,Q:Ht,O:pr,D:Cc,v:lu,s:ma,P:Br,z:Lr,R:Yi,ja:rl,T:cu,aa:Yn,M:so,F:ds,ia:us,sa:ao,r:Dc,Ca:lo,w:_a,o:uo,m:Ta,c:as,Ba:co,n:an,j:xa,u:ol,p:ll,f:fo,t:Ur,l:po,e:hu,k:kc,h:$c,g:Oc,d:Bs,da:Sa,ea:mr,fa:Ea,ba:ul,ca:fu,N:mo,xa:pu,ua:go,i:ms,C:Rc,G:gu,ta:mu,x:yu,ra:_u,U:Mc,q:Ic,y:Nc,K:Bc,S:Us,za:vu,ya:dl,ka:bu,la:_o,_:Wn,B:Tu,I:vo,ha:hl,H:ys,a:O,wa:si}}}class Ui{name="ExitStatus";constructor(T){this.message=`Program terminated with exit(${T})`,this.status=T}}var Wi=g=>{g.terminate(),g.onmessage=()=>{}},ft=[],Pt=g=>{Pi.length==0&&(yi(),Xn(Pi[0]));var T=Pi.pop();if(!T)return 6;Xi.push(T),Sn[g.Bb]=T,T.Bb=g.Bb;var k={Db:"run",hc:g.fc,Jb:g.Jb,Bb:g.Bb};return T.postMessage(k,g.Nb),0},Ot=0,Dt=(g,T,...k)=>{for(var N=2*k.length,F=Hr(),Q=bl(8*N),pe=Q>>>3,Ee=0;Ee<k.length;Ee++){var Be=k[Ee];typeof Be=="bigint"?(se[pe+2*Ee]=1n,se[pe+2*Ee+1]=Be):(se[pe+2*Ee]=0n,Je()[pe+2*Ee+1>>>0]=Be)}return g=Qi(g,0,N,Q,T),qs(F),g};function si(g){if(c)return Dt(0,1,g);if(B=g,!(0<Ot)){for(var T of Xi)Wi(T);for(T of Pi)Wi(T);Pi=[],Xi=[],Sn={},ue=!0}w(0,new Ui(g))}function Rr(g){if(c)return Dt(1,0,g);Wn(g)}var Wn=g=>{if(B=g,c)throw Rr(g),"unwind";si(g)},Pi=[],Xi=[],Rs=[],Sn={},ss=g=>{var T=g.Bb;delete Sn[T],Pi.push(g),Xi.splice(Xi.indexOf(g),1),g.Bb=0,yr(T)};function It(){Rs.forEach(g=>g())}var Xn=g=>new Promise(T=>{g.onmessage=F=>{var Q=(F=F.data).Db;if(F.Hb&&F.Hb!=_l()){var pe=Sn[F.Hb];pe?pe.postMessage(F,F.Nb):de(`Internal error! Worker sent a message "${Q}" to target pthread ${F.Hb}, but that thread no longer exists!`)}else Q==="checkMailbox"?Si():Q==="spawnThread"?Pt(F):Q==="cleanupThread"?ss(Sn[F.ic]):Q==="loaded"?(g.loaded=!0,T(g)):F.target==="setimmediate"?g.postMessage(F):Q==="callHandler"?n[F.Rb](...F.args):Q&&de(`worker sent an unknown command ${Q}`)},g.onerror=F=>{throw de(`worker sent an error! ${F.filename}:${F.lineno}: ${F.message}`),F};var k,N=[];for(k of[])n.propertyIsEnumerable(k)&&N.push(k);g.postMessage({Db:"load",Sb:N,kc:O,lc:$})});function yi(){var g=new Worker((()=>{let T=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new T("ort.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});Pi.push(g)}var Bn=g=>{bt();var T=ze()[g+52>>>2>>>0];g=ze()[g+56>>>2>>>0],Oa(T,T-g),qs(T)},zi=(g,T)=>{Ot=0,g=bo(g,T),0<Ot?B=g:qr(g)};class da{constructor(T){this.Ib=T-24}}function Mr(g,T,k){var N=new da(g>>>=0);throw T>>>=0,k>>>=0,ze()[N.Ib+16>>>2>>>0]=0,ze()[N.Ib+4>>>2>>>0]=T,ze()[N.Ib+8>>>2>>>0]=k,g}function ha(g,T,k,N){return c?Dt(2,1,g,T,k,N):hr(g,T,k,N)}function hr(g,T,k,N){if(g>>>=0,k>>>=0,N>>>=0,h===void 0)return 6;var F=[];return c&&F.length===0?ha(g,T>>>=0,k,N):(g={fc:k,Bb:g,Jb:N,Nb:F},c?(g.Db="spawnThread",postMessage(g,F),0):Pt(g))}var Nr=typeof TextDecoder<"u"?new TextDecoder:void 0,q=(g,T=0,k=NaN)=>{var N=(T>>>=0)+k;for(k=T;g[k]&&!(k>=N);)++k;if(16<k-T&&g.buffer&&Nr)return Nr.decode(g.buffer instanceof ArrayBuffer?g.subarray(T,k):g.slice(T,k));for(N="";T<k;){var F=g[T++];if(128&F){var Q=63&g[T++];if((224&F)==192)N+=String.fromCharCode((31&F)<<6|Q);else{var pe=63&g[T++];65536>(F=(240&F)==224?(15&F)<<12|Q<<6|pe:(7&F)<<18|Q<<12|pe<<6|63&g[T++])?N+=String.fromCharCode(F):(F-=65536,N+=String.fromCharCode(55296|F>>10,56320|1023&F))}}else N+=String.fromCharCode(F)}return N},V=(g,T)=>(g>>>=0)?q(ne(),g,T):"";function re(g,T,k){return c?Dt(3,1,g,T,k):0}function xe(g,T){if(c)return Dt(4,1,g,T)}function qe(g,T){if(c)return Dt(5,1,g,T)}function nt(g,T,k){if(c)return Dt(6,1,g,T,k)}function Rt(g,T,k){return c?Dt(7,1,g,T,k):0}function pi(g,T){if(c)return Dt(8,1,g,T)}function tn(g,T,k){if(c)return Dt(9,1,g,T,k)}function wn(g,T,k,N){if(c)return Dt(10,1,g,T,k,N)}function nn(g,T,k,N){if(c)return Dt(11,1,g,T,k,N)}function gn(g,T,k,N){if(c)return Dt(12,1,g,T,k,N)}function Ki(g){if(c)return Dt(13,1,g)}function Wt(g,T){if(c)return Dt(14,1,g,T)}function rn(g,T,k){if(c)return Dt(15,1,g,T,k)}var Ln,Ii=()=>Ut(""),rt=g=>{for(var T="";ne()[g>>>0];)T+=Ln[ne()[g++>>>0]];return T},ci={},gt={},Un=n.BindingError=class extends Error{constructor(g){super(g),this.name="BindingError"}};function En(g,T,k={}){return(function(N,F,Q={}){var pe=F.name;if(!N)throw new Un(`type "${pe}" must have a positive integer typeid pointer`);if(gt.hasOwnProperty(N)){if(Q.Tb)return;throw new Un(`Cannot register type '${pe}' twice`)}gt[N]=F,ci.hasOwnProperty(N)&&(F=ci[N],delete ci[N],F.forEach(Ee=>Ee()))})(g,T,k)}var fa=(g,T,k)=>{switch(T){case 1:return k?N=>P()[N>>>0]:N=>ne()[N>>>0];case 2:return k?N=>ye()[N>>>1>>>0]:N=>ke()[N>>>1>>>0];case 4:return k?N=>le()[N>>>2>>>0]:N=>ze()[N>>>2>>>0];case 8:return k?N=>se[N>>>3]:N=>ae[N>>>3];default:throw new TypeError(`invalid integer width (${T}): ${g}`)}};function ou(g,T,k){k>>>=0,En(g>>>=0,{name:T=rt(T>>>0),fromWireType:N=>N,toWireType:function(N,F){if(typeof F!="bigint"&&typeof F!="number")throw F=F===null?"null":(N=typeof F)=="object"||N==="array"||N==="function"?F.toString():""+F,new TypeError(`Cannot convert "${F}" to ${this.name}`);return typeof F=="number"&&(F=BigInt(F)),F},Cb:Ai,readValueFromPointer:fa(T,k,T.indexOf("u")==-1),Eb:null})}var Ai=8;function Ht(g,T,k,N){En(g>>>=0,{name:T=rt(T>>>0),fromWireType:function(F){return!!F},toWireType:function(F,Q){return Q?k:N},Cb:Ai,readValueFromPointer:function(F){return this.fromWireType(ne()[F>>>0])},Eb:null})}var fr=[],Ri=[];function as(g){9<(g>>>=0)&&--Ri[g+1]==0&&(Ri[g]=void 0,fr.push(g))}var _i=g=>{if(!g)throw new Un(`Cannot use deleted val. handle = ${g}`);return Ri[g]},Nt=g=>{switch(g){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let T=fr.pop()||Ri.length;return Ri[T]=g,Ri[T+1]=1,T}};function pa(g){return this.fromWireType(ze()[g>>>2>>>0])}var io={name:"emscripten::val",fromWireType:g=>{var T=_i(g);return as(g),T},toWireType:(g,T)=>Nt(T),Cb:Ai,readValueFromPointer:pa,Eb:null};function pr(g){return En(g>>>0,io)}var os=(g,T)=>{switch(T){case 4:return function(k){return this.fromWireType(it()[k>>>2>>>0])};case 8:return function(k){return this.fromWireType(Je()[k>>>3>>>0])};default:throw new TypeError(`invalid float width (${T}): ${g}`)}};function Cc(g,T,k){k>>>=0,En(g>>>=0,{name:T=rt(T>>>0),fromWireType:N=>N,toWireType:(N,F)=>F,Cb:Ai,readValueFromPointer:os(T,k),Eb:null})}function lu(g,T,k,N,F){if(g>>>=0,k>>>=0,T=rt(T>>>0),F===-1&&(F=4294967295),F=Ee=>Ee,N===0){var Q=32-8*k;F=Ee=>Ee<<Q>>>Q}var pe=T.includes("unsigned")?function(Ee,Be){return Be>>>0}:function(Ee,Be){return Be};En(g,{name:T,fromWireType:F,toWireType:pe,Cb:Ai,readValueFromPointer:fa(T,k,N!==0),Eb:null})}function ma(g,T,k){function N(Q){var pe=ze()[Q>>>2>>>0];return Q=ze()[Q+4>>>2>>>0],new F(P().buffer,Q,pe)}var F=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][T];En(g>>>=0,{name:k=rt(k>>>0),fromWireType:N,Cb:Ai,readValueFromPointer:N},{Tb:!0})}var Kn=(g,T,k)=>{var N=ne();if(T>>>=0,0<k){var F=T;k=T+k-1;for(var Q=0;Q<g.length;++Q){var pe=g.charCodeAt(Q);if(55296<=pe&&57343>=pe&&(pe=65536+((1023&pe)<<10)|1023&g.charCodeAt(++Q)),127>=pe){if(T>=k)break;N[T++>>>0]=pe}else{if(2047>=pe){if(T+1>=k)break;N[T++>>>0]=192|pe>>6}else{if(65535>=pe){if(T+2>=k)break;N[T++>>>0]=224|pe>>12}else{if(T+3>=k)break;N[T++>>>0]=240|pe>>18,N[T++>>>0]=128|pe>>12&63}N[T++>>>0]=128|pe>>6&63}N[T++>>>0]=128|63&pe}}N[T>>>0]=0,g=T-F}else g=0;return g},ls=g=>{for(var T=0,k=0;k<g.length;++k){var N=g.charCodeAt(k);127>=N?T++:2047>=N?T+=2:55296<=N&&57343>=N?(T+=4,++k):T+=3}return T};function Br(g,T){En(g>>>=0,{name:T=rt(T>>>0),fromWireType:function(k){for(var N,F=ze()[k>>>2>>>0],Q=k+4,pe=Q,Ee=0;Ee<=F;++Ee){var Be=Q+Ee;Ee!=F&&ne()[Be>>>0]!=0||(pe=V(pe,Be-pe),N===void 0?N=pe:(N+="\0",N+=pe),pe=Be+1)}return gr(k),N},toWireType:function(k,N){N instanceof ArrayBuffer&&(N=new Uint8Array(N));var F=typeof N=="string";if(!(F||ArrayBuffer.isView(N)&&N.BYTES_PER_ELEMENT==1))throw new Un("Cannot pass non-string to std::string");var Q=F?ls(N):N.length,pe=$a(4+Q+1),Ee=pe+4;return ze()[pe>>>2>>>0]=Q,F?Kn(N,Ee,Q+1):ne().set(N,Ee>>>0),k!==null&&k.push(gr,pe),pe},Cb:Ai,readValueFromPointer:pa,Eb(k){gr(k)}})}var sn=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Fi=(g,T)=>{for(var k=g>>1,N=k+T/2;!(k>=N)&&ke()[k>>>0];)++k;if(32<(k<<=1)-g&&sn)return sn.decode(ne().slice(g,k));for(k="",N=0;!(N>=T/2);++N){var F=ye()[g+2*N>>>1>>>0];if(F==0)break;k+=String.fromCharCode(F)}return k},Ms=(g,T,k)=>{if(k??=2147483647,2>k)return 0;var N=T;k=(k-=2)<2*g.length?k/2:g.length;for(var F=0;F<k;++F){var Q=g.charCodeAt(F);ye()[T>>>1>>>0]=Q,T+=2}return ye()[T>>>1>>>0]=0,T-N},Ac=g=>2*g.length,no=(g,T)=>{for(var k=0,N="";!(k>=T/4);){var F=le()[g+4*k>>>2>>>0];if(F==0)break;++k,65536<=F?(F-=65536,N+=String.fromCharCode(55296|F>>10,56320|1023&F)):N+=String.fromCharCode(F)}return N},uu=(g,T,k)=>{if(T>>>=0,k??=2147483647,4>k)return 0;var N=T;k=N+k-4;for(var F=0;F<g.length;++F){var Q=g.charCodeAt(F);if(55296<=Q&&57343>=Q&&(Q=65536+((1023&Q)<<10)|1023&g.charCodeAt(++F)),le()[T>>>2>>>0]=Q,(T+=4)+4>k)break}return le()[T>>>2>>>0]=0,T-N},ro=g=>{for(var T=0,k=0;k<g.length;++k){var N=g.charCodeAt(k);55296<=N&&57343>=N&&++k,T+=4}return T};function Lr(g,T,k){if(g>>>=0,T>>>=0,k=rt(k>>>=0),T===2)var N=Fi,F=Ms,Q=Ac,pe=Ee=>ke()[Ee>>>1>>>0];else T===4&&(N=no,F=uu,Q=ro,pe=Ee=>ze()[Ee>>>2>>>0]);En(g,{name:k,fromWireType:Ee=>{for(var Be,Pe=ze()[Ee>>>2>>>0],Ve=Ee+4,tt=0;tt<=Pe;++tt){var ct=Ee+4+tt*T;tt!=Pe&&pe(ct)!=0||(Ve=N(Ve,ct-Ve),Be===void 0?Be=Ve:(Be+="\0",Be+=Ve),Ve=ct+T)}return gr(Ee),Be},toWireType:(Ee,Be)=>{if(typeof Be!="string")throw new Un(`Cannot pass non-string to C++ string type ${k}`);var Pe=Q(Be),Ve=$a(4+Pe+T);return ze()[Ve>>>2>>>0]=Pe/T,F(Be,Ve+4,Pe+T),Ee!==null&&Ee.push(gr,Ve),Ve},Cb:Ai,readValueFromPointer:pa,Eb(Ee){gr(Ee)}})}function Yi(g,T){En(g>>>=0,{Ub:!0,name:T=rt(T>>>0),Cb:0,fromWireType:()=>{},toWireType:()=>{}})}function rl(g){vl(g>>>0,!l,1,!o,131072,!1),It()}var Ns=g=>{if(!ue)try{if(g(),!(0<Ot))try{c?qr(B):Wn(B)}catch(T){T instanceof Ui||T=="unwind"||w(0,T)}}catch(T){T instanceof Ui||T=="unwind"||w(0,T)}};function us(g){g>>>=0,typeof Atomics.jc=="function"&&(Atomics.jc(le(),g>>>2,g).value.then(Si),g+=128,Atomics.store(le(),g>>>2,1))}var Si=()=>{var g=_l();g&&(us(g),Ns(jr))};function cu(g,T){(g>>>=0)==T>>>0?setTimeout(Si):c?postMessage({Hb:g,Db:"checkMailbox"}):(g=Sn[g])&&g.postMessage({Db:"checkMailbox"})}var cs=[];function Yn(g,T,k,N,F){for(T>>>=0,N/=2,cs.length=N,k=F>>>0>>>3,F=0;F<N;F++)cs[F]=se[k+2*F]?se[k+2*F+1]:Je()[k+2*F+1>>>0];return(T?ka[T]:fl[g])(...cs)}var so=()=>{Ot=0};function ds(g){g>>>=0,c?postMessage({Db:"cleanupThread",ic:g}):ss(Sn[g])}function ao(g){}var hs=(g,T)=>{var k=gt[g];if(k===void 0)throw g=gl(g),k=rt(g),gr(g),new Un(`${T} has unknown type ${k}`);return k},oo=(g,T,k)=>{var N=[];return g=g.toWireType(N,k),N.length&&(ze()[T>>>2>>>0]=Nt(N)),g};function Dc(g,T,k){return T>>>=0,k>>>=0,g=_i(g>>>0),T=hs(T,"emval::as"),oo(T,k,g)}function lo(g,T){return T>>>=0,g=_i(g>>>0),(T=hs(T,"emval::as")).toWireType(null,g)}var Cn=g=>{try{g()}catch(T){Ut(T)}},yn=0,_n=null,fs=0,Qn=[],sl={},ga={},du=0,Zn=null,An=[];function ya(g){return(function(T){if(!ue){if(yn===0){var k=!1,N=!1;T((F=0)=>{if(!ue&&(fs=F,k=!0,N)){yn=2,Cn(()=>To(_n)),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.resume(),F=!1;try{var Q=(function(){var Be=le()[_n+8>>>2>>>0];return Be=$e[ga[Be]],--Ot,Be()})()}catch(Be){Q=Be,F=!0}var pe=!1;if(!_n){var Ee=Zn;Ee&&(Zn=null,(F?Ee.reject:Ee.resolve)(Q),pe=!0)}if(F&&!pe)throw Q}}),N=!0,k||(yn=1,_n=(function(){var F=$a(65548),Q=F+12;ze()[F>>>2>>>0]=Q,ze()[F+4>>>2>>>0]=Q+65536,Q=Qn[0];var pe=sl[Q];return pe===void 0&&(pe=du++,sl[Q]=pe,ga[pe]=Q),Q=pe,le()[F+8>>>2>>>0]=Q,F})(),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.pause(),Cn(()=>_s(_n)))}else yn===2?(yn=0,Cn(_r),gr(_n),_n=null,An.forEach(Ns)):Ut(`invalid state: ${yn}`);return fs}})(T=>{g().then(T)})}function _a(g){return g>>>=0,ya(async()=>{var T=await _i(g);return Nt(T)})}var Pn=[];function uo(g,T,k,N){return k>>>=0,N>>>=0,(g=Pn[g>>>0])(null,T=_i(T>>>0),k,N)}var va={},ba=g=>{var T=va[g];return T===void 0?rt(g):T};function Ta(g,T,k,N,F){return k>>>=0,N>>>=0,F>>>=0,(g=Pn[g>>>0])(T=_i(T>>>0),T[k=ba(k)],N,F)}function co(g,T){return T>>>=0,(g=_i(g>>>0))==_i(T)}var al=()=>typeof globalThis=="object"?globalThis:Function("return this")();function an(g){return(g>>>=0)==0?Nt(al()):(g=ba(g),Nt(al()[g]))}var ps=g=>{var T=Pn.length;return Pn.push(g),T},ho=(g,T)=>{for(var k=Array(g),N=0;N<g;++N)k[N]=hs(ze()[T+4*N>>>2>>>0],`parameter ${N}`);return k};function xa(g,T,k){var N=(T=ho(g,T>>>0)).shift();g--;var F=`return function (obj, func, destructorsRef, args) {
`,Q=0,pe=[];k===0&&pe.push("obj");for(var Ee=["retType"],Be=[N],Pe=0;Pe<g;++Pe)pe.push(`arg${Pe}`),Ee.push(`argType${Pe}`),Be.push(T[Pe]),F+=`  var arg${Pe} = argType${Pe}.readValueFromPointer(args${Q?"+"+Q:""});
`,Q+=T[Pe].Cb;return F+=`  var rv = ${k===1?"new func":"func.call"}(${pe.join(", ")});
`,N.Ub||(Ee.push("emval_returnValue"),Be.push(oo),F+=`  return emval_returnValue(retType, destructorsRef, rv);
`),g=new Function(...Ee,F+`};
`)(...Be),k=`methodCaller<(${T.map(Ve=>Ve.name).join(", ")}) => ${N.name}>`,ps(Object.defineProperty(g,"name",{value:k}))}function ol(g){return g=ba(g>>>0),Nt(n[g])}function ll(g,T){return T>>>=0,g=_i(g>>>0),T=_i(T),Nt(g[T])}function fo(g){9<(g>>>=0)&&(Ri[g+1]+=1)}function Ur(){return Nt([])}function po(g){g=_i(g>>>0);for(var T=Array(g.length),k=0;k<g.length;k++)T[k]=g[k];return Nt(T)}function hu(g){return Nt(ba(g>>>0))}function kc(){return Nt({})}function $c(g){for(var T=_i(g>>>=0);T.length;){var k=T.pop();T.pop()(k)}as(g)}function Oc(g,T,k){T>>>=0,k>>>=0,g=_i(g>>>0),T=_i(T),k=_i(k),g[T]=k}function Bs(g,T){return T>>>=0,g=(g=hs(g>>>0,"_emval_take_value")).readValueFromPointer(T),Nt(g)}function Sa(g,T){g=-9007199254740992>g||9007199254740992<g?NaN:Number(g),T>>>=0,g=new Date(1e3*g),le()[T>>>2>>>0]=g.getUTCSeconds(),le()[T+4>>>2>>>0]=g.getUTCMinutes(),le()[T+8>>>2>>>0]=g.getUTCHours(),le()[T+12>>>2>>>0]=g.getUTCDate(),le()[T+16>>>2>>>0]=g.getUTCMonth(),le()[T+20>>>2>>>0]=g.getUTCFullYear()-1900,le()[T+24>>>2>>>0]=g.getUTCDay(),g=(g.getTime()-Date.UTC(g.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,le()[T+28>>>2>>>0]=g}var Ls=g=>g%4==0&&(g%100!=0||g%400==0),wa=[0,31,60,91,121,152,182,213,244,274,305,335],Dn=[0,31,59,90,120,151,181,212,243,273,304,334];function mr(g,T){g=-9007199254740992>g||9007199254740992<g?NaN:Number(g),T>>>=0,g=new Date(1e3*g),le()[T>>>2>>>0]=g.getSeconds(),le()[T+4>>>2>>>0]=g.getMinutes(),le()[T+8>>>2>>>0]=g.getHours(),le()[T+12>>>2>>>0]=g.getDate(),le()[T+16>>>2>>>0]=g.getMonth(),le()[T+20>>>2>>>0]=g.getFullYear()-1900,le()[T+24>>>2>>>0]=g.getDay();var k=(Ls(g.getFullYear())?wa:Dn)[g.getMonth()]+g.getDate()-1|0;le()[T+28>>>2>>>0]=k,le()[T+36>>>2>>>0]=-60*g.getTimezoneOffset(),k=new Date(g.getFullYear(),6,1).getTimezoneOffset();var N=new Date(g.getFullYear(),0,1).getTimezoneOffset();g=0|(k!=N&&g.getTimezoneOffset()==Math.min(N,k)),le()[T+32>>>2>>>0]=g}function Ea(g){g>>>=0;var T=new Date(le()[g+20>>>2>>>0]+1900,le()[g+16>>>2>>>0],le()[g+12>>>2>>>0],le()[g+8>>>2>>>0],le()[g+4>>>2>>>0],le()[g>>>2>>>0],0),k=le()[g+32>>>2>>>0],N=T.getTimezoneOffset(),F=new Date(T.getFullYear(),6,1).getTimezoneOffset(),Q=new Date(T.getFullYear(),0,1).getTimezoneOffset(),pe=Math.min(Q,F);return 0>k?le()[g+32>>>2>>>0]=+(F!=Q&&pe==N):0<k!=(pe==N)&&(F=Math.max(Q,F),T.setTime(T.getTime()+6e4*((0<k?pe:F)-N))),le()[g+24>>>2>>>0]=T.getDay(),k=(Ls(T.getFullYear())?wa:Dn)[T.getMonth()]+T.getDate()-1|0,le()[g+28>>>2>>>0]=k,le()[g>>>2>>>0]=T.getSeconds(),le()[g+4>>>2>>>0]=T.getMinutes(),le()[g+8>>>2>>>0]=T.getHours(),le()[g+12>>>2>>>0]=T.getDate(),le()[g+16>>>2>>>0]=T.getMonth(),le()[g+20>>>2>>>0]=T.getYear(),g=T.getTime(),BigInt(isNaN(g)?-1:g/1e3)}function ul(g,T,k,N,F,Q,pe){return c?Dt(16,1,g,T,k,N,F,Q,pe):-52}function fu(g,T,k,N,F,Q){if(c)return Dt(17,1,g,T,k,N,F,Q)}var Ca={},Ic=()=>performance.timeOrigin+performance.now();function mo(g,T){if(c)return Dt(18,1,g,T);if(Ca[g]&&(clearTimeout(Ca[g].id),delete Ca[g]),!T)return 0;var k=setTimeout(()=>{delete Ca[g],Ns(()=>ai(g,performance.timeOrigin+performance.now()))},T);return Ca[g]={id:k,rc:T},0}function pu(g,T,k,N){g>>>=0,T>>>=0,k>>>=0,N>>>=0;var F=new Date().getFullYear(),Q=new Date(F,0,1).getTimezoneOffset();F=new Date(F,6,1).getTimezoneOffset();var pe=Math.max(Q,F);ze()[g>>>2>>>0]=60*pe,le()[T>>>2>>>0]=+(Q!=F),g=(T=Ee=>{var Be=Math.abs(Ee);return`UTC${0<=Ee?"-":"+"}${String(Math.floor(Be/60)).padStart(2,"0")}${String(Be%60).padStart(2,"0")}`})(Q),T=T(F),F<Q?(Kn(g,k,17),Kn(T,N,17)):(Kn(g,N,17),Kn(T,k,17))}var mu=()=>Date.now();function go(g,T,k){return 0<=g&&3>=g?(g===0?g=Date.now():g=performance.timeOrigin+performance.now(),se[k>>>0>>>3]=BigInt(Math.round(1e6*g)),0):28}var Pr=[],Aa=(g,T)=>{Pr.length=0;for(var k;k=ne()[g++>>>0];){var N=k!=105;T+=(N&=k!=112)&&T%8?4:0,Pr.push(k==112?ze()[T>>>2>>>0]:k==106?se[T>>>3]:k==105?le()[T>>>2>>>0]:Je()[T>>>3>>>0]),T+=N?8:4}return Pr};function ms(g,T,k){return g>>>=0,T=Aa(T>>>0,k>>>0),ka[g](...T)}function Rc(g,T,k){return g>>>=0,T=Aa(T>>>0,k>>>0),ka[g](...T)}var gu=()=>{};function yu(g,T){return de(V(g>>>0,T>>>0))}var _u=()=>{throw Ot+=1,"unwind"};function Mc(){return 4294901760}var Nc=()=>navigator.hardwareConcurrency;function Bc(){return Ut("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function Us(g){g>>>=0;var T=ne().length;if(g<=T||4294901760<g)return!1;for(var k=1;4>=k;k*=2){var N=T*(1+.2/k);N=Math.min(N,g+100663296);e:{N=(Math.min(4294901760,65536*Math.ceil(Math.max(g,N)/65536))-O.buffer.byteLength+65535)/65536|0;try{O.grow(N),bt();var F=1;break e}catch{}F=void 0}if(F)return!0}return!1}var zr=()=>(Ut("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),Ps={},cl=g=>{g.forEach(T=>{zr()})};function vu(){var g=Error().stack.toString().split(`
`);return g[0]=="Error"&&g.shift(),cl(g),Ps.Mb=zr(),Ps.dc=g,Ps.Mb}function dl(g,T,k){if(g>>>=0,T>>>=0,Ps.Mb==g)var N=Ps.dc;else(N=Error().stack.toString().split(`
`))[0]=="Error"&&N.shift(),cl(N);for(var F=3;N[F]&&zr()!=g;)++F;for(g=0;g<k&&N[g+F];++g)le()[T+4*g>>>2>>>0]=zr();return g}var zs,yo={},gs=()=>{if(!zs){var g,T={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(g in yo)yo[g]===void 0?delete T[g]:T[g]=yo[g];var k=[];for(g in T)k.push(`${g}=${T[g]}`);zs=k}return zs};function bu(g,T){if(c)return Dt(19,1,g,T);g>>>=0,T>>>=0;var k,N=0,F=0;for(k of gs()){var Q=T+N;ze()[g+F>>>2>>>0]=Q,N+=Kn(k,Q,1/0)+1,F+=4}return 0}function _o(g,T){if(c)return Dt(20,1,g,T);g>>>=0,T>>>=0;var k=gs();for(var N of(ze()[g>>>2>>>0]=k.length,g=0,k))g+=ls(N)+1;return ze()[T>>>2>>>0]=g,0}function Tu(g){return c?Dt(21,1,g):52}function vo(g,T,k,N){return c?Dt(22,1,g,T,k,N):52}function hl(g,T,k,N){return c?Dt(23,1,g,T,k,N):70}var Da=[null,[],[]];function ys(g,T,k,N){if(c)return Dt(24,1,g,T,k,N);T>>>=0,k>>>=0,N>>>=0;for(var F=0,Q=0;Q<k;Q++){var pe=ze()[T>>>2>>>0],Ee=ze()[T+4>>>2>>>0];T+=8;for(var Be=0;Be<Ee;Be++){var Pe=g,Ve=ne()[pe+Be>>>0],tt=Da[Pe];Ve===0||Ve===10?((Pe===1?ee:de)(q(tt)),tt.length=0):tt.push(Ve)}F+=Ee}return ze()[N>>>2>>>0]=F,0}c||(function(){for(var g=n.numThreads-1;g--;)yi();ft.push(()=>{mn++,(function(T){c?T():Promise.all(Pi.map(Xn)).then(T)})(()=>Nn())})})();for(var xu=Array(256),Fr=0;256>Fr;++Fr)xu[Fr]=String.fromCharCode(Fr);Ln=xu,Ri.push(0,1,void 0,1,null,1,!0,1,!1,1),n.count_emval_handles=()=>Ri.length/2-5-fr.length,c||(O=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),bt()),n.wasmBinary&&(M=n.wasmBinary),n.stackSave=()=>Hr(),n.stackRestore=g=>qs(g),n.stackAlloc=g=>bl(g),n.setValue=function(g,T,k="i8"){switch(k.endsWith("*")&&(k="*"),k){case"i1":case"i8":P()[g>>>0]=T;break;case"i16":ye()[g>>>1>>>0]=T;break;case"i32":le()[g>>>2>>>0]=T;break;case"i64":se[g>>>3]=BigInt(T);break;case"float":it()[g>>>2>>>0]=T;break;case"double":Je()[g>>>3>>>0]=T;break;case"*":ze()[g>>>2>>>0]=T;break;default:Ut(`invalid type for setValue: ${k}`)}},n.getValue=function(g,T="i8"){switch(T.endsWith("*")&&(T="*"),T){case"i1":case"i8":return P()[g>>>0];case"i16":return ye()[g>>>1>>>0];case"i32":return le()[g>>>2>>>0];case"i64":return se[g>>>3];case"float":return it()[g>>>2>>>0];case"double":return Je()[g>>>3>>>0];case"*":return ze()[g>>>2>>>0];default:Ut(`invalid type for getValue: ${T}`)}},n.UTF8ToString=V,n.stringToUTF8=Kn,n.lengthBytesUTF8=ls;var fl=[si,Rr,ha,re,xe,qe,nt,Rt,pi,tn,wn,nn,gn,Ki,Wt,rn,ul,fu,mo,bu,_o,Tu,vo,hl,ys],ka={893836:(g,T,k,N,F)=>{if(n===void 0||!n.Fb)return 1;if((g=V(Number(g>>>0))).startsWith("./")&&(g=g.substring(2)),!(g=n.Fb.get(g)))return 2;if(T=Number(T>>>0),k=Number(k>>>0),N=Number(N>>>0),T+k>g.byteLength)return 3;try{let Q=g.subarray(T,T+k);switch(F){case 0:ne().set(Q,N>>>0);break;case 1:n.mc?n.mc(N,Q):n.cc(N,Q);break;default:return 4}return 0}catch{return 4}},894660:(g,T,k)=>{n.Pb(g,ne().subarray(T>>>0,T+k>>>0))},894724:()=>n.oc(),894766:g=>{n.Ob(g)},894803:()=>{n.Wb()},894834:()=>{n.Xb()},894863:()=>{n.ac()},894888:g=>n.Vb(g),894921:g=>n.Zb(g),894953:(g,T,k)=>{n.Lb(Number(g),Number(T),Number(k),!0)},895016:(g,T,k)=>{n.Lb(Number(g),Number(T),Number(k))},895073:()=>typeof wasmOffsetConverter<"u",895130:g=>{n.Ab("Abs",g,void 0)},895181:g=>{n.Ab("Neg",g,void 0)},895232:g=>{n.Ab("Floor",g,void 0)},895285:g=>{n.Ab("Ceil",g,void 0)},895337:g=>{n.Ab("Reciprocal",g,void 0)},895395:g=>{n.Ab("Sqrt",g,void 0)},895447:g=>{n.Ab("Exp",g,void 0)},895498:g=>{n.Ab("Erf",g,void 0)},895549:g=>{n.Ab("Sigmoid",g,void 0)},895604:(g,T,k)=>{n.Ab("HardSigmoid",g,{alpha:T,beta:k})},895683:g=>{n.Ab("Log",g,void 0)},895734:g=>{n.Ab("Sin",g,void 0)},895785:g=>{n.Ab("Cos",g,void 0)},895836:g=>{n.Ab("Tan",g,void 0)},895887:g=>{n.Ab("Asin",g,void 0)},895939:g=>{n.Ab("Acos",g,void 0)},895991:g=>{n.Ab("Atan",g,void 0)},896043:g=>{n.Ab("Sinh",g,void 0)},896095:g=>{n.Ab("Cosh",g,void 0)},896147:g=>{n.Ab("Asinh",g,void 0)},896200:g=>{n.Ab("Acosh",g,void 0)},896253:g=>{n.Ab("Atanh",g,void 0)},896306:g=>{n.Ab("Tanh",g,void 0)},896358:g=>{n.Ab("Not",g,void 0)},896409:(g,T,k)=>{n.Ab("Clip",g,{min:T,max:k})},896478:g=>{n.Ab("Clip",g,void 0)},896530:(g,T)=>{n.Ab("Elu",g,{alpha:T})},896588:g=>{n.Ab("Gelu",g,void 0)},896640:g=>{n.Ab("Relu",g,void 0)},896692:(g,T)=>{n.Ab("LeakyRelu",g,{alpha:T})},896756:(g,T)=>{n.Ab("ThresholdedRelu",g,{alpha:T})},896826:(g,T)=>{n.Ab("Cast",g,{to:T})},896884:g=>{n.Ab("Add",g,void 0)},896935:g=>{n.Ab("Sub",g,void 0)},896986:g=>{n.Ab("Mul",g,void 0)},897037:g=>{n.Ab("Div",g,void 0)},897088:g=>{n.Ab("Pow",g,void 0)},897139:g=>{n.Ab("Equal",g,void 0)},897192:g=>{n.Ab("Greater",g,void 0)},897247:g=>{n.Ab("GreaterOrEqual",g,void 0)},897309:g=>{n.Ab("Less",g,void 0)},897361:g=>{n.Ab("LessOrEqual",g,void 0)},897420:(g,T,k,N,F)=>{n.Ab("ReduceMean",g,{keepDims:!!T,noopWithEmptyAxes:!!k,axes:N?Array.from(le().subarray(Number(N)>>>0,Number(F)>>>0)):[]})},897595:(g,T,k,N,F)=>{n.Ab("ReduceMax",g,{keepDims:!!T,noopWithEmptyAxes:!!k,axes:N?Array.from(le().subarray(Number(N)>>>0,Number(F)>>>0)):[]})},897769:(g,T,k,N,F)=>{n.Ab("ReduceMin",g,{keepDims:!!T,noopWithEmptyAxes:!!k,axes:N?Array.from(le().subarray(Number(N)>>>0,Number(F)>>>0)):[]})},897943:(g,T,k,N,F)=>{n.Ab("ReduceProd",g,{keepDims:!!T,noopWithEmptyAxes:!!k,axes:N?Array.from(le().subarray(Number(N)>>>0,Number(F)>>>0)):[]})},898118:(g,T,k,N,F)=>{n.Ab("ReduceSum",g,{keepDims:!!T,noopWithEmptyAxes:!!k,axes:N?Array.from(le().subarray(Number(N)>>>0,Number(F)>>>0)):[]})},898292:(g,T,k,N,F)=>{n.Ab("ReduceL1",g,{keepDims:!!T,noopWithEmptyAxes:!!k,axes:N?Array.from(le().subarray(Number(N)>>>0,Number(F)>>>0)):[]})},898465:(g,T,k,N,F)=>{n.Ab("ReduceL2",g,{keepDims:!!T,noopWithEmptyAxes:!!k,axes:N?Array.from(le().subarray(Number(N)>>>0,Number(F)>>>0)):[]})},898638:(g,T,k,N,F)=>{n.Ab("ReduceLogSum",g,{keepDims:!!T,noopWithEmptyAxes:!!k,axes:N?Array.from(le().subarray(Number(N)>>>0,Number(F)>>>0)):[]})},898815:(g,T,k,N,F)=>{n.Ab("ReduceSumSquare",g,{keepDims:!!T,noopWithEmptyAxes:!!k,axes:N?Array.from(le().subarray(Number(N)>>>0,Number(F)>>>0)):[]})},898995:(g,T,k,N,F)=>{n.Ab("ReduceLogSumExp",g,{keepDims:!!T,noopWithEmptyAxes:!!k,axes:N?Array.from(le().subarray(Number(N)>>>0,Number(F)>>>0)):[]})},899175:g=>{n.Ab("Where",g,void 0)},899228:(g,T,k)=>{n.Ab("Transpose",g,{perm:T?Array.from(le().subarray(Number(T)>>>0,Number(k)>>>0)):[]})},899352:(g,T,k,N)=>{n.Ab("DepthToSpace",g,{blocksize:T,mode:V(k),format:N?"NHWC":"NCHW"})},899485:(g,T,k,N)=>{n.Ab("DepthToSpace",g,{blocksize:T,mode:V(k),format:N?"NHWC":"NCHW"})},899618:(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt,Xt)=>{n.Ab("ConvTranspose",g,{format:Be?"NHWC":"NCHW",autoPad:T,dilations:[k],group:N,kernelShape:[F],pads:[Q,pe],strides:[Ee],wIsConst:()=>!!P()[Pe>>>0],outputPadding:Ve?Array.from(le().subarray(Number(Ve)>>>0,Number(tt)>>>0)):[],outputShape:ct?Array.from(le().subarray(Number(ct)>>>0,Number(dt)>>>0)):[],activation:V(Xt)})},900051:(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt)=>{n.Ab("ConvTranspose",g,{format:Ee?"NHWC":"NCHW",autoPad:T,dilations:Array.from(le().subarray(Number(k)>>>0,2+(Number(k)>>>0)>>>0)),group:N,kernelShape:Array.from(le().subarray(Number(F)>>>0,2+(Number(F)>>>0)>>>0)),pads:Array.from(le().subarray(Number(Q)>>>0,4+(Number(Q)>>>0)>>>0)),strides:Array.from(le().subarray(Number(pe)>>>0,2+(Number(pe)>>>0)>>>0)),wIsConst:()=>!!P()[Be>>>0],outputPadding:Pe?Array.from(le().subarray(Number(Pe)>>>0,Number(Ve)>>>0)):[],outputShape:tt?Array.from(le().subarray(Number(tt)>>>0,Number(ct)>>>0)):[],activation:V(dt)})},900712:(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt,Xt)=>{n.Ab("ConvTranspose",g,{format:Be?"NHWC":"NCHW",autoPad:T,dilations:[k],group:N,kernelShape:[F],pads:[Q,pe],strides:[Ee],wIsConst:()=>!!P()[Pe>>>0],outputPadding:Ve?Array.from(le().subarray(Number(Ve)>>>0,Number(tt)>>>0)):[],outputShape:ct?Array.from(le().subarray(Number(ct)>>>0,Number(dt)>>>0)):[],activation:V(Xt)})},901145:(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt)=>{n.Ab("ConvTranspose",g,{format:Ee?"NHWC":"NCHW",autoPad:T,dilations:Array.from(le().subarray(Number(k)>>>0,2+(Number(k)>>>0)>>>0)),group:N,kernelShape:Array.from(le().subarray(Number(F)>>>0,2+(Number(F)>>>0)>>>0)),pads:Array.from(le().subarray(Number(Q)>>>0,4+(Number(Q)>>>0)>>>0)),strides:Array.from(le().subarray(Number(pe)>>>0,2+(Number(pe)>>>0)>>>0)),wIsConst:()=>!!P()[Be>>>0],outputPadding:Pe?Array.from(le().subarray(Number(Pe)>>>0,Number(Ve)>>>0)):[],outputShape:tt?Array.from(le().subarray(Number(tt)>>>0,Number(ct)>>>0)):[],activation:V(dt)})},901806:(g,T)=>{n.Ab("GlobalAveragePool",g,{format:T?"NHWC":"NCHW"})},901897:(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt)=>{n.Ab("AveragePool",g,{format:dt?"NHWC":"NCHW",auto_pad:T,ceil_mode:k,count_include_pad:N,storage_order:F,dilations:Q?Array.from(le().subarray(Number(Q)>>>0,Number(pe)>>>0)):[],kernel_shape:Ee?Array.from(le().subarray(Number(Ee)>>>0,Number(Be)>>>0)):[],pads:Pe?Array.from(le().subarray(Number(Pe)>>>0,Number(Ve)>>>0)):[],strides:tt?Array.from(le().subarray(Number(tt)>>>0,Number(ct)>>>0)):[]})},902376:(g,T)=>{n.Ab("GlobalAveragePool",g,{format:T?"NHWC":"NCHW"})},902467:(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt)=>{n.Ab("AveragePool",g,{format:dt?"NHWC":"NCHW",auto_pad:T,ceil_mode:k,count_include_pad:N,storage_order:F,dilations:Q?Array.from(le().subarray(Number(Q)>>>0,Number(pe)>>>0)):[],kernel_shape:Ee?Array.from(le().subarray(Number(Ee)>>>0,Number(Be)>>>0)):[],pads:Pe?Array.from(le().subarray(Number(Pe)>>>0,Number(Ve)>>>0)):[],strides:tt?Array.from(le().subarray(Number(tt)>>>0,Number(ct)>>>0)):[]})},902946:(g,T)=>{n.Ab("GlobalMaxPool",g,{format:T?"NHWC":"NCHW"})},903033:(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt)=>{n.Ab("MaxPool",g,{format:dt?"NHWC":"NCHW",auto_pad:T,ceil_mode:k,count_include_pad:N,storage_order:F,dilations:Q?Array.from(le().subarray(Number(Q)>>>0,Number(pe)>>>0)):[],kernel_shape:Ee?Array.from(le().subarray(Number(Ee)>>>0,Number(Be)>>>0)):[],pads:Pe?Array.from(le().subarray(Number(Pe)>>>0,Number(Ve)>>>0)):[],strides:tt?Array.from(le().subarray(Number(tt)>>>0,Number(ct)>>>0)):[]})},903508:(g,T)=>{n.Ab("GlobalMaxPool",g,{format:T?"NHWC":"NCHW"})},903595:(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt)=>{n.Ab("MaxPool",g,{format:dt?"NHWC":"NCHW",auto_pad:T,ceil_mode:k,count_include_pad:N,storage_order:F,dilations:Q?Array.from(le().subarray(Number(Q)>>>0,Number(pe)>>>0)):[],kernel_shape:Ee?Array.from(le().subarray(Number(Ee)>>>0,Number(Be)>>>0)):[],pads:Pe?Array.from(le().subarray(Number(Pe)>>>0,Number(Ve)>>>0)):[],strides:tt?Array.from(le().subarray(Number(tt)>>>0,Number(ct)>>>0)):[]})},904070:(g,T,k,N,F)=>{n.Ab("Gemm",g,{alpha:T,beta:k,transA:N,transB:F})},904174:g=>{n.Ab("MatMul",g,void 0)},904228:(g,T,k,N)=>{n.Ab("ArgMax",g,{keepDims:!!T,selectLastIndex:!!k,axis:N})},904336:(g,T,k,N)=>{n.Ab("ArgMin",g,{keepDims:!!T,selectLastIndex:!!k,axis:N})},904444:(g,T)=>{n.Ab("Softmax",g,{axis:T})},904507:(g,T)=>{n.Ab("Concat",g,{axis:T})},904567:(g,T,k,N,F)=>{n.Ab("Split",g,{axis:T,numOutputs:k,splitSizes:N?Array.from(le().subarray(Number(N)>>>0,Number(F)>>>0)):[]})},904723:g=>{n.Ab("Expand",g,void 0)},904777:(g,T)=>{n.Ab("Gather",g,{axis:Number(T)})},904848:(g,T)=>{n.Ab("GatherElements",g,{axis:Number(T)})},904927:(g,T)=>{n.Ab("GatherND",g,{batch_dims:Number(T)})},905006:(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve)=>{n.Ab("Resize",g,{antialias:T,axes:k?Array.from(le().subarray(Number(k)>>>0,Number(N)>>>0)):[],coordinateTransformMode:V(F),cubicCoeffA:Q,excludeOutside:pe,extrapolationValue:Ee,keepAspectRatioPolicy:V(Be),mode:V(Pe),nearestMode:V(Ve)})},905368:(g,T,k,N,F,Q,pe)=>{n.Ab("Slice",g,{starts:T?Array.from(le().subarray(Number(T)>>>0,Number(k)>>>0)):[],ends:N?Array.from(le().subarray(Number(N)>>>0,Number(F)>>>0)):[],axes:Q?Array.from(le().subarray(Number(Q)>>>0,Number(pe)>>>0)):[]})},905632:g=>{n.Ab("Tile",g,void 0)},905684:(g,T,k)=>{n.Ab("InstanceNormalization",g,{epsilon:T,format:k?"NHWC":"NCHW"})},905798:(g,T,k)=>{n.Ab("InstanceNormalization",g,{epsilon:T,format:k?"NHWC":"NCHW"})},905912:g=>{n.Ab("Range",g,void 0)},905965:(g,T)=>{n.Ab("Einsum",g,{equation:V(T)})},906046:(g,T,k,N,F)=>{n.Ab("Pad",g,{mode:T,value:k,pads:N?Array.from(le().subarray(Number(N)>>>0,Number(F)>>>0)):[]})},906189:(g,T,k,N,F,Q)=>{n.Ab("BatchNormalization",g,{epsilon:T,momentum:k,spatial:!!F,trainingMode:!!N,format:Q?"NHWC":"NCHW"})},906358:(g,T,k,N,F,Q)=>{n.Ab("BatchNormalization",g,{epsilon:T,momentum:k,spatial:!!F,trainingMode:!!N,format:Q?"NHWC":"NCHW"})},906527:(g,T,k)=>{n.Ab("CumSum",g,{exclusive:Number(T),reverse:Number(k)})},906624:(g,T,k)=>{n.Ab("DequantizeLinear",g,{axis:T,blockSize:k})},906714:(g,T,k,N,F)=>{n.Ab("GridSample",g,{align_corners:T,mode:V(k),padding_mode:V(N),format:F?"NHWC":"NCHW"})},906884:(g,T,k,N,F)=>{n.Ab("GridSample",g,{align_corners:T,mode:V(k),padding_mode:V(N),format:F?"NHWC":"NCHW"})},907054:(g,T)=>{n.Ab("ScatterND",g,{reduction:V(T)})},907139:(g,T,k,N,F,Q,pe,Ee,Be)=>{n.Ab("Attention",g,{numHeads:T,isUnidirectional:k,maskFilterValue:N,scale:F,doRotary:Q,qkvHiddenSizes:pe?Array.from(le().subarray(Number(Ee)>>>0,Number(Ee)+pe>>>0)):[],pastPresentShareBuffer:!!Be})},907411:g=>{n.Ab("BiasAdd",g,void 0)},907466:g=>{n.Ab("BiasSplitGelu",g,void 0)},907527:g=>{n.Ab("FastGelu",g,void 0)},907583:(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt,Xt,Zt)=>{n.Ab("Conv",g,{format:tt?"NHWC":"NCHW",auto_pad:T,dilations:k?Array.from(le().subarray(Number(k)>>>0,Number(N)>>>0)):[],group:F,kernel_shape:Q?Array.from(le().subarray(Number(Q)>>>0,Number(pe)>>>0)):[],pads:Ee?Array.from(le().subarray(Number(Ee)>>>0,Number(Be)>>>0)):[],strides:Pe?Array.from(le().subarray(Number(Pe)>>>0,Number(Ve)>>>0)):[],w_is_const:()=>!!P()[Number(ct)>>>0],activation:V(dt),activation_params:Xt?Array.from(it().subarray(Number(Xt)>>>0,Number(Zt)>>>0)):[]})},908167:g=>{n.Ab("Gelu",g,void 0)},908219:(g,T,k,N,F,Q,pe,Ee,Be)=>{n.Ab("GroupQueryAttention",g,{numHeads:T,kvNumHeads:k,scale:N,softcap:F,doRotary:Q,rotaryInterleaved:pe,smoothSoftmax:Ee,localWindowSize:Be})},908436:(g,T,k,N)=>{n.Ab("LayerNormalization",g,{axis:T,epsilon:k,simplified:!!N})},908547:(g,T,k,N)=>{n.Ab("LayerNormalization",g,{axis:T,epsilon:k,simplified:!!N})},908658:(g,T,k,N,F,Q)=>{n.Ab("MatMulNBits",g,{k:T,n:k,accuracyLevel:N,bits:F,blockSize:Q})},908785:(g,T,k,N,F,Q)=>{n.Ab("MultiHeadAttention",g,{numHeads:T,isUnidirectional:k,maskFilterValue:N,scale:F,doRotary:Q})},908944:(g,T)=>{n.Ab("QuickGelu",g,{alpha:T})},909008:(g,T,k,N,F)=>{n.Ab("RotaryEmbedding",g,{interleaved:!!T,numHeads:k,rotaryEmbeddingDim:N,scale:F})},909147:(g,T,k)=>{n.Ab("SkipLayerNormalization",g,{epsilon:T,simplified:!!k})},909249:(g,T,k)=>{n.Ab("SkipLayerNormalization",g,{epsilon:T,simplified:!!k})},909351:(g,T,k,N)=>{n.Ab("GatherBlockQuantized",g,{gatherAxis:T,quantizeAxis:k,blockSize:N})},909472:g=>{n.$b(g)},909506:(g,T)=>n.bc(Number(g),Number(T),n.Gb.ec,n.Gb.errors)};function pl(g,T,k){return ya(async()=>{await n.Yb(Number(g),Number(T),Number(k))})}function ml(){return typeof wasmOffsetConverter<"u"}var $e=await(async function(){function g(N,F){return $e=N.exports,$e=(function(){var Q=$e,pe={};for(let[Ee,Be]of Object.entries(Q))pe[Ee]=typeof Be=="function"?(...Pe)=>{Qn.push(Ee);try{return Be(...Pe)}finally{ue||(Qn.pop(),_n&&yn===1&&Qn.length===0&&(yn=0,Ot+=1,Cn(Ia),typeof Fibers<"u"&&Fibers.sc()))}}:Be;return pe})(),$e=(function(){var Q=$e,pe=Be=>Pe=>Be(Pe)>>>0,Ee=Be=>()=>Be()>>>0;return(Q=Object.assign({},Q)).Ea=pe(Q.Ea),Q.gb=Ee(Q.gb),Q.ib=pe(Q.ib),Q.tb=pe(Q.tb),Q.ub=Ee(Q.ub),Q.__cxa_get_exception_ptr=pe(Q.__cxa_get_exception_ptr),Q})(),Rs.push($e.jb),$=F,Nn(),$e}mn++;var T=rs();if(n.instantiateWasm)return new Promise(N=>{n.instantiateWasm(T,(F,Q)=>{N(g(F,Q))})});if(c)return new Promise(N=>{fe=F=>{var Q=new WebAssembly.Instance(F,rs());N(g(Q,F))}});fi??=n.locateFile?n.locateFile?n.locateFile("ort-wasm-simd-threaded.jsep.wasm",C):C+"ort-wasm-simd-threaded.jsep.wasm":new URL("https://github.com/vntion/chicken-part-detection/assets/ort-wasm-simd-threaded.jsep-BGTZ4Y7F.wasm",import.meta.url).href;try{var k=await(async function(N){var F=fi;if(!M&&typeof WebAssembly.instantiateStreaming=="function"&&!ve(F))try{var Q=fetch(F,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(Q,N)}catch(pe){de(`wasm streaming compile failed: ${pe}`),de("falling back to ArrayBuffer instantiation")}return(async function(pe,Ee){try{var Be=await(async function(Pe){if(!M)try{var Ve=await _(Pe);return new Uint8Array(Ve)}catch{}if(Pe==fi&&M)Pe=new Uint8Array(M);else{if(!E)throw"both async and sync fetching of the wasm failed";Pe=E(Pe)}return Pe})(pe);return await WebAssembly.instantiate(Be,Ee)}catch(Pe){de(`failed to asynchronously prepare wasm: ${Pe}`),Ut(Pe)}})(F,N)})(T);return g(k.instance,k.module)}catch(N){return i(N),Promise.reject(N)}})(),gl=g=>(gl=$e.Ea)(g),yl=()=>(yl=$e.Fa)();n._OrtInit=(g,T)=>(n._OrtInit=$e.Ga)(g,T),n._OrtGetLastError=(g,T)=>(n._OrtGetLastError=$e.Ha)(g,T),n._OrtCreateSessionOptions=(g,T,k,N,F,Q,pe,Ee,Be,Pe)=>(n._OrtCreateSessionOptions=$e.Ia)(g,T,k,N,F,Q,pe,Ee,Be,Pe),n._OrtAppendExecutionProvider=(g,T,k,N,F)=>(n._OrtAppendExecutionProvider=$e.Ja)(g,T,k,N,F),n._OrtAddFreeDimensionOverride=(g,T,k)=>(n._OrtAddFreeDimensionOverride=$e.Ka)(g,T,k),n._OrtAddSessionConfigEntry=(g,T,k)=>(n._OrtAddSessionConfigEntry=$e.La)(g,T,k),n._OrtReleaseSessionOptions=g=>(n._OrtReleaseSessionOptions=$e.Ma)(g),n._OrtCreateSession=(g,T,k)=>(n._OrtCreateSession=$e.Na)(g,T,k),n._OrtReleaseSession=g=>(n._OrtReleaseSession=$e.Oa)(g),n._OrtGetInputOutputCount=(g,T,k)=>(n._OrtGetInputOutputCount=$e.Pa)(g,T,k),n._OrtGetInputOutputMetadata=(g,T,k,N)=>(n._OrtGetInputOutputMetadata=$e.Qa)(g,T,k,N),n._OrtFree=g=>(n._OrtFree=$e.Ra)(g),n._OrtCreateTensor=(g,T,k,N,F,Q)=>(n._OrtCreateTensor=$e.Sa)(g,T,k,N,F,Q),n._OrtGetTensorData=(g,T,k,N,F)=>(n._OrtGetTensorData=$e.Ta)(g,T,k,N,F),n._OrtReleaseTensor=g=>(n._OrtReleaseTensor=$e.Ua)(g),n._OrtCreateRunOptions=(g,T,k,N)=>(n._OrtCreateRunOptions=$e.Va)(g,T,k,N),n._OrtAddRunConfigEntry=(g,T,k)=>(n._OrtAddRunConfigEntry=$e.Wa)(g,T,k),n._OrtReleaseRunOptions=g=>(n._OrtReleaseRunOptions=$e.Xa)(g),n._OrtCreateBinding=g=>(n._OrtCreateBinding=$e.Ya)(g),n._OrtBindInput=(g,T,k)=>(n._OrtBindInput=$e.Za)(g,T,k),n._OrtBindOutput=(g,T,k,N)=>(n._OrtBindOutput=$e._a)(g,T,k,N),n._OrtClearBoundOutputs=g=>(n._OrtClearBoundOutputs=$e.$a)(g),n._OrtReleaseBinding=g=>(n._OrtReleaseBinding=$e.ab)(g),n._OrtRunWithBinding=(g,T,k,N,F)=>(n._OrtRunWithBinding=$e.bb)(g,T,k,N,F),n._OrtRun=(g,T,k,N,F,Q,pe,Ee)=>(n._OrtRun=$e.cb)(g,T,k,N,F,Q,pe,Ee),n._OrtEndProfiling=g=>(n._OrtEndProfiling=$e.db)(g),n._JsepOutput=(g,T,k)=>(n._JsepOutput=$e.eb)(g,T,k),n._JsepGetNodeName=g=>(n._JsepGetNodeName=$e.fb)(g);var _l=()=>(_l=$e.gb)(),gr=n._free=g=>(gr=n._free=$e.hb)(g),$a=n._malloc=g=>($a=n._malloc=$e.ib)(g),vl=(g,T,k,N,F,Q)=>(vl=$e.kb)(g,T,k,N,F,Q),Fs=()=>(Fs=$e.lb)(),Qi=(g,T,k,N,F)=>(Qi=$e.mb)(g,T,k,N,F),yr=g=>(yr=$e.nb)(g),qr=g=>(qr=$e.ob)(g),ai=(g,T)=>(ai=$e.pb)(g,T),jr=()=>(jr=$e.qb)(),Oa=(g,T)=>(Oa=$e.rb)(g,T),qs=g=>(qs=$e.sb)(g),bl=g=>(bl=$e.tb)(g),Hr=()=>(Hr=$e.ub)(),bo=n.dynCall_ii=(g,T)=>(bo=n.dynCall_ii=$e.vb)(g,T);n.dynCall_vii=(g,T,k)=>(n.dynCall_vii=$e.dynCall_vii)(g,T,k),n.dynCall_iiiii=(g,T,k,N,F)=>(n.dynCall_iiiii=$e.dynCall_iiiii)(g,T,k,N,F),n.dynCall_iii=(g,T,k)=>(n.dynCall_iii=$e.dynCall_iii)(g,T,k),n.dynCall_iiiiii=(g,T,k,N,F,Q)=>(n.dynCall_iiiiii=$e.dynCall_iiiiii)(g,T,k,N,F,Q),n.dynCall_iiiiiiii=(g,T,k,N,F,Q,pe,Ee)=>(n.dynCall_iiiiiiii=$e.dynCall_iiiiiiii)(g,T,k,N,F,Q,pe,Ee),n.dynCall_iiiiiii=(g,T,k,N,F,Q,pe)=>(n.dynCall_iiiiiii=$e.dynCall_iiiiiii)(g,T,k,N,F,Q,pe),n.dynCall_vi=(g,T)=>(n.dynCall_vi=$e.dynCall_vi)(g,T),n.dynCall_iiii=(g,T,k,N)=>(n.dynCall_iiii=$e.dynCall_iiii)(g,T,k,N),n.dynCall_i=g=>(n.dynCall_i=$e.dynCall_i)(g),n.dynCall_viiiiiiii=(g,T,k,N,F,Q,pe,Ee,Be)=>(n.dynCall_viiiiiiii=$e.dynCall_viiiiiiii)(g,T,k,N,F,Q,pe,Ee,Be),n.dynCall_viii=(g,T,k,N)=>(n.dynCall_viii=$e.dynCall_viii)(g,T,k,N),n.dynCall_viijj=(g,T,k,N,F)=>(n.dynCall_viijj=$e.dynCall_viijj)(g,T,k,N,F),n.dynCall_viiiiii=(g,T,k,N,F,Q,pe)=>(n.dynCall_viiiiii=$e.dynCall_viiiiii)(g,T,k,N,F,Q,pe),n.dynCall_viiii=(g,T,k,N,F)=>(n.dynCall_viiii=$e.dynCall_viiii)(g,T,k,N,F),n.dynCall_viiiii=(g,T,k,N,F,Q)=>(n.dynCall_viiiii=$e.dynCall_viiiii)(g,T,k,N,F,Q),n.dynCall_vfiii=(g,T,k,N,F)=>(n.dynCall_vfiii=$e.dynCall_vfiii)(g,T,k,N,F),n.dynCall_viiiiff=(g,T,k,N,F,Q,pe)=>(n.dynCall_viiiiff=$e.dynCall_viiiiff)(g,T,k,N,F,Q,pe),n.dynCall_viiiiiff=(g,T,k,N,F,Q,pe,Ee)=>(n.dynCall_viiiiiff=$e.dynCall_viiiiiff)(g,T,k,N,F,Q,pe,Ee),n.dynCall_ffff=(g,T,k,N)=>(n.dynCall_ffff=$e.dynCall_ffff)(g,T,k,N),n.dynCall_viiff=(g,T,k,N,F)=>(n.dynCall_viiff=$e.dynCall_viiff)(g,T,k,N,F),n.dynCall_fffffff=(g,T,k,N,F,Q,pe)=>(n.dynCall_fffffff=$e.dynCall_fffffff)(g,T,k,N,F,Q,pe),n.dynCall_jjjjjjj=(g,T,k,N,F,Q,pe)=>(n.dynCall_jjjjjjj=$e.dynCall_jjjjjjj)(g,T,k,N,F,Q,pe),n.dynCall_jjjjjj=(g,T,k,N,F,Q)=>(n.dynCall_jjjjjj=$e.dynCall_jjjjjj)(g,T,k,N,F,Q),n.dynCall_iijjii=(g,T,k,N,F,Q)=>(n.dynCall_iijjii=$e.dynCall_iijjii)(g,T,k,N,F,Q),n.dynCall_viiiiiiiiiiiii=(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt)=>(n.dynCall_viiiiiiiiiiiii=$e.dynCall_viiiiiiiiiiiii)(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt),n.dynCall_viiiiiiiiii=(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve)=>(n.dynCall_viiiiiiiiii=$e.dynCall_viiiiiiiiii)(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve),n.dynCall_viiiiiiiiiii=(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt)=>(n.dynCall_viiiiiiiiiii=$e.dynCall_viiiiiiiiiii)(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt),n.dynCall_viiiiiiiiiiii=(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct)=>(n.dynCall_viiiiiiiiiiii=$e.dynCall_viiiiiiiiiiii)(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct),n.dynCall_viiiiiiiiiiiiiiiiii=(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt,Xt,Zt,on,vr,Vr)=>(n.dynCall_viiiiiiiiiiiiiiiiii=$e.dynCall_viiiiiiiiiiiiiiiiii)(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt,Xt,Zt,on,vr,Vr),n.dynCall_viiiiiiiii=(g,T,k,N,F,Q,pe,Ee,Be,Pe)=>(n.dynCall_viiiiiiiii=$e.dynCall_viiiiiiiii)(g,T,k,N,F,Q,pe,Ee,Be,Pe),n.dynCall_viiiiiiiiiiiiiiiiiii=(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt,Xt,Zt,on,vr,Vr,js)=>(n.dynCall_viiiiiiiiiiiiiiiiiii=$e.dynCall_viiiiiiiiiiiiiiiiiii)(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt,Xt,Zt,on,vr,Vr,js),n.dynCall_viiiiiii=(g,T,k,N,F,Q,pe,Ee)=>(n.dynCall_viiiiiii=$e.dynCall_viiiiiii)(g,T,k,N,F,Q,pe,Ee),n.dynCall_viiiiiiiiiiiiiii=(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt,Xt,Zt)=>(n.dynCall_viiiiiiiiiiiiiii=$e.dynCall_viiiiiiiiiiiiiii)(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt,Xt,Zt),n.dynCall_jiji=(g,T,k,N)=>(n.dynCall_jiji=$e.dynCall_jiji)(g,T,k,N),n.dynCall_v=g=>(n.dynCall_v=$e.dynCall_v)(g),n.dynCall_iidiiii=(g,T,k,N,F,Q,pe)=>(n.dynCall_iidiiii=$e.dynCall_iidiiii)(g,T,k,N,F,Q,pe),n.dynCall_iiiiiiiii=(g,T,k,N,F,Q,pe,Ee,Be)=>(n.dynCall_iiiiiiiii=$e.dynCall_iiiiiiiii)(g,T,k,N,F,Q,pe,Ee,Be),n.dynCall_iiij=(g,T,k,N)=>(n.dynCall_iiij=$e.dynCall_iiij)(g,T,k,N),n.dynCall_iiiiiiiiii=(g,T,k,N,F,Q,pe,Ee,Be,Pe)=>(n.dynCall_iiiiiiiiii=$e.dynCall_iiiiiiiiii)(g,T,k,N,F,Q,pe,Ee,Be,Pe),n.dynCall_iiiiiiiiiiiii=(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct)=>(n.dynCall_iiiiiiiiiiiii=$e.dynCall_iiiiiiiiiiiii)(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct),n.dynCall_iiiiiiiiiii=(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve)=>(n.dynCall_iiiiiiiiiii=$e.dynCall_iiiiiiiiiii)(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve),n.dynCall_ji=(g,T)=>(n.dynCall_ji=$e.dynCall_ji)(g,T),n.dynCall_iijii=(g,T,k,N,F)=>(n.dynCall_iijii=$e.dynCall_iijii)(g,T,k,N,F),n.dynCall_vij=(g,T,k)=>(n.dynCall_vij=$e.dynCall_vij)(g,T,k),n.dynCall_viiijii=(g,T,k,N,F,Q,pe)=>(n.dynCall_viiijii=$e.dynCall_viiijii)(g,T,k,N,F,Q,pe),n.dynCall_viijiiiiiiiiiiiiii=(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt,Xt,Zt,on,vr)=>(n.dynCall_viijiiiiiiiiiiiiii=$e.dynCall_viijiiiiiiiiiiiiii)(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt,Xt,Zt,on,vr),n.dynCall_viiiji=(g,T,k,N,F,Q)=>(n.dynCall_viiiji=$e.dynCall_viiiji)(g,T,k,N,F,Q),n.dynCall_fiii=(g,T,k,N)=>(n.dynCall_fiii=$e.dynCall_fiii)(g,T,k,N),n.dynCall_viijii=(g,T,k,N,F,Q)=>(n.dynCall_viijii=$e.dynCall_viijii)(g,T,k,N,F,Q),n.dynCall_viij=(g,T,k,N)=>(n.dynCall_viij=$e.dynCall_viij)(g,T,k,N),n.dynCall_jiij=(g,T,k,N)=>(n.dynCall_jiij=$e.dynCall_jiij)(g,T,k,N),n.dynCall_fi=(g,T)=>(n.dynCall_fi=$e.dynCall_fi)(g,T),n.dynCall_fii=(g,T,k)=>(n.dynCall_fii=$e.dynCall_fii)(g,T,k),n.dynCall_jii=(g,T,k)=>(n.dynCall_jii=$e.dynCall_jii)(g,T,k),n.dynCall_dii=(g,T,k)=>(n.dynCall_dii=$e.dynCall_dii)(g,T,k),n.dynCall_fiiii=(g,T,k,N,F)=>(n.dynCall_fiiii=$e.dynCall_fiiii)(g,T,k,N,F),n.dynCall_fif=(g,T,k)=>(n.dynCall_fif=$e.dynCall_fif)(g,T,k),n.dynCall_jfi=(g,T,k)=>(n.dynCall_jfi=$e.dynCall_jfi)(g,T,k),n.dynCall_viiiiiiiiiiiiii=(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt,Xt)=>(n.dynCall_viiiiiiiiiiiiii=$e.dynCall_viiiiiiiiiiiiii)(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt,Xt),n.dynCall_viiiiiiiiiiiiiiiiiiii=(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt,Xt,Zt,on,vr,Vr,js,Tl)=>(n.dynCall_viiiiiiiiiiiiiiiiiiii=$e.dynCall_viiiiiiiiiiiiiiiiiiii)(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt,Xt,Zt,on,vr,Vr,js,Tl),n.dynCall_viiiiiiiiiiiiiiii=(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt,Xt,Zt,on)=>(n.dynCall_viiiiiiiiiiiiiiii=$e.dynCall_viiiiiiiiiiiiiiii)(g,T,k,N,F,Q,pe,Ee,Be,Pe,Ve,tt,ct,dt,Xt,Zt,on),n.dynCall_iif=(g,T,k)=>(n.dynCall_iif=$e.dynCall_iif)(g,T,k),n.dynCall_jiiii=(g,T,k,N,F)=>(n.dynCall_jiiii=$e.dynCall_jiiii)(g,T,k,N,F),n.dynCall_jiii=(g,T,k,N)=>(n.dynCall_jiii=$e.dynCall_jiii)(g,T,k,N),n.dynCall_viif=(g,T,k,N)=>(n.dynCall_viif=$e.dynCall_viif)(g,T,k,N),n.dynCall_viiij=(g,T,k,N,F)=>(n.dynCall_viiij=$e.dynCall_viiij)(g,T,k,N,F),n.dynCall_viiiijii=(g,T,k,N,F,Q,pe,Ee)=>(n.dynCall_viiiijii=$e.dynCall_viiiijii)(g,T,k,N,F,Q,pe,Ee),n.dynCall_iiiiij=(g,T,k,N,F,Q)=>(n.dynCall_iiiiij=$e.dynCall_iiiiij)(g,T,k,N,F,Q),n.dynCall_iiiiid=(g,T,k,N,F,Q)=>(n.dynCall_iiiiid=$e.dynCall_iiiiid)(g,T,k,N,F,Q),n.dynCall_iiiiijj=(g,T,k,N,F,Q,pe)=>(n.dynCall_iiiiijj=$e.dynCall_iiiiijj)(g,T,k,N,F,Q,pe),n.dynCall_iiiiiijj=(g,T,k,N,F,Q,pe,Ee)=>(n.dynCall_iiiiiijj=$e.dynCall_iiiiiijj)(g,T,k,N,F,Q,pe,Ee);var _s=g=>(_s=$e.wb)(g),Ia=()=>(Ia=$e.xb)(),To=g=>(To=$e.yb)(g),_r=()=>(_r=$e.zb)();return(function g(){if(0<mn)Lt=g;else if(c)e(n),ri();else{for(;0<ft.length;)ft.shift()(n);0<mn?Lt=g:(n.calledRun=!0,ue||(ri(),e(n)))}})(),n.PTR_SIZE=4,s},CE=mg,K2=globalThis.self?.name?.startsWith("em-pthread"),K2&&mg()}),gg,F0,Y2,Dr,AE,lf,Q2,Z2,yg,J2,_g,DE,vg,kE,Ny=Ue(()=>{My(),gg=typeof location>"u"?void 0:location.origin,F0=import.meta.url>"file:"&&import.meta.url<"file;",Y2=()=>{{if(F0){let t=URL;return new URL(new t("ort.bundle.min.mjs",import.meta.url).href,gg).href}return import.meta.url}},Dr=Y2(),AE=()=>{if(Dr&&!Dr.startsWith("blob:"))return Dr.substring(0,Dr.lastIndexOf("/")+1)},lf=(t,e)=>{try{let i=e??Dr;return(i?new URL(t,i):new URL(t)).origin===gg}catch{return!1}},Q2=(t,e)=>{let i=e??Dr;try{return(i?new URL(t,i):new URL(t)).href}catch{return}},Z2=(t,e)=>`${e??"./"}${t}`,yg=async t=>{let e=await(await fetch(t,{credentials:"same-origin"})).blob();return URL.createObjectURL(e)},J2=async t=>(await import(t)).default,_g=($O(),Xd(SE)).default,DE=async()=>{if(!Dr)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(lf(Dr))return[void 0,_g()];let t=await yg(Dr);return[t,_g(t)]},vg=(OO(),Xd(EE)).default,kE=async(t,e,i,n)=>{let s=vg&&!(t||e);if(s)if(Dr)s=lf(Dr);else if(n&&!i)s=!0;else throw new Error("cannot determine the script source URL.");if(s)return[void 0,vg];{let o="ort-wasm-simd-threaded.jsep.mjs",l=t??Q2(o,e),c=i&&l&&!lf(l,e),h=c?await yg(l):l??Z2(o,e);return[c?h:void 0,await J2(h)]}}}),bg,uf,vd,Tg,e1,t1,i1,By,ii,su=Ue(()=>{Ny(),uf=!1,vd=!1,Tg=!1,e1=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},t1=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},i1=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},By=async t=>{if(uf)return Promise.resolve();if(vd)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Tg)throw new Error("previous call to 'initializeWebAssembly()' failed.");vd=!0;let e=t.initTimeout,i=t.numThreads;if(t.simd!==!1){if(t.simd==="relaxed"){if(!i1())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!t1())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let n=e1();i>1&&!n&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+i+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),t.numThreads=i=1);let s=t.wasmPaths,o=typeof s=="string"?s:void 0,l=s?.mjs,c=l?.href??l,h=s?.wasm,f=h?.href??h,m=t.wasmBinary,[_,E]=await kE(c,o,i>1,!!m||!!f),w=!1,A=[];if(e>0&&A.push(new Promise(C=>{setTimeout(()=>{w=!0,C()},e)})),A.push(new Promise((C,M)=>{let O={numThreads:i};if(m)O.wasmBinary=m;else if(f||o)O.locateFile=$=>f??o+$;else if(c&&c.indexOf("blob:")!==0)O.locateFile=$=>new URL($,c).href;else if(_){let $=AE();$&&(O.locateFile=B=>$+B)}E(O).then($=>{vd=!1,uf=!0,bg=$,C(),_&&URL.revokeObjectURL(_)},$=>{vd=!1,Tg=!0,M($)})})),await Promise.race(A),w)throw new Error(`WebAssembly backend initializing failed due to timeout: ${e}ms`)},ii=()=>{if(uf&&bg)return bg;throw new Error("WebAssembly is not initialized yet.")}}),Ds,Mf,jt,Ly=Ue(()=>{su(),Ds=(t,e)=>{let i=ii(),n=i.lengthBytesUTF8(t)+1,s=i._malloc(n);return i.stringToUTF8(t,s,n),e.push(s),s},Mf=(t,e,i,n)=>{if(typeof t=="object"&&t!==null){if(i.has(t))throw new Error("Circular reference in options");i.add(t)}Object.entries(t).forEach(([s,o])=>{let l=e?e+s:s;if(typeof o=="object")Mf(o,l+".",i,n);else if(typeof o=="string"||typeof o=="number")n(l,o.toString());else if(typeof o=="boolean")n(l,o?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof o}`)})},jt=t=>{let e=ii(),i=e.stackSave();try{let n=e.PTR_SIZE,s=e.stackAlloc(2*n);e._OrtGetLastError(s,s+n);let o=Number(e.getValue(s,n===4?"i32":"i64")),l=e.getValue(s+n,"*"),c=l?e.UTF8ToString(l):"";throw new Error(`${t} ERROR_CODE: ${o}, ERROR_MESSAGE: ${c}`)}finally{e.stackRestore(i)}}}),$E,IO=Ue(()=>{su(),Ly(),$E=t=>{let e=ii(),i=0,n=[],s=t||{};try{if(t?.logSeverityLevel===void 0)s.logSeverityLevel=2;else if(typeof t.logSeverityLevel!="number"||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${t.logSeverityLevel}`);if(t?.logVerbosityLevel===void 0)s.logVerbosityLevel=0;else if(typeof t.logVerbosityLevel!="number"||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);t?.terminate===void 0&&(s.terminate=!1);let o=0;return t?.tag!==void 0&&(o=Ds(t.tag,n)),i=e._OrtCreateRunOptions(s.logSeverityLevel,s.logVerbosityLevel,!!s.terminate,o),i===0&&jt("Can't create run options."),t?.extra!==void 0&&Mf(t.extra,"",new WeakSet,(l,c)=>{let h=Ds(l,n),f=Ds(c,n);e._OrtAddRunConfigEntry(i,h,f)!==0&&jt(`Can't set a run config entry: ${l} - ${c}.`)}),[i,n]}catch(o){throw i!==0&&e._OrtReleaseRunOptions(i),n.forEach(l=>e._free(l)),o}}}),n1,r1,s1,bd,a1,OE,RO=Ue(()=>{su(),Ly(),n1=t=>{switch(t){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${t}`)}},r1=t=>{switch(t){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${t}`)}},s1=t=>{t.extra||(t.extra={}),t.extra.session||(t.extra.session={});let e=t.extra.session;e.use_ort_model_bytes_directly||(e.use_ort_model_bytes_directly="1"),t.executionProviders&&t.executionProviders.some(i=>(typeof i=="string"?i:i.name)==="webgpu")&&(t.enableMemPattern=!1)},bd=(t,e,i,n)=>{let s=Ds(e,n),o=Ds(i,n);ii()._OrtAddSessionConfigEntry(t,s,o)!==0&&jt(`Can't set a session config entry: ${e} - ${i}.`)},a1=async(t,e,i)=>{for(let n of e){let s=typeof n=="string"?n:n.name,o=[];switch(s){case"webnn":if(s="WEBNN",typeof n!="string"){let m=n?.deviceType;m&&bd(t,"deviceType",m,i)}break;case"webgpu":if(s="JS",typeof n!="string"){let m=n;if(m?.preferredLayout){if(m.preferredLayout!=="NCHW"&&m.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${m.preferredLayout}`);bd(t,"preferredLayout",m.preferredLayout,i)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${s}`)}let l=Ds(s,i),c=o.length,h=0,f=0;if(c>0){h=ii()._malloc(c*ii().PTR_SIZE),i.push(h),f=ii()._malloc(c*ii().PTR_SIZE),i.push(f);for(let m=0;m<c;m++)ii().setValue(h+m*ii().PTR_SIZE,o[m][0],"*"),ii().setValue(f+m*ii().PTR_SIZE,o[m][1],"*")}await ii()._OrtAppendExecutionProvider(t,l,h,f,c)!==0&&jt(`Can't append execution provider: ${s}.`)}},OE=async t=>{let e=ii(),i=0,n=[],s=t||{};s1(s);try{let o=n1(s.graphOptimizationLevel??"all"),l=r1(s.executionMode??"sequential"),c=typeof s.logId=="string"?Ds(s.logId,n):0,h=s.logSeverityLevel??2;if(!Number.isInteger(h)||h<0||h>4)throw new Error(`log severity level is not valid: ${h}`);let f=s.logVerbosityLevel??0;if(!Number.isInteger(f)||f<0||f>4)throw new Error(`log verbosity level is not valid: ${f}`);let m=typeof s.optimizedModelFilePath=="string"?Ds(s.optimizedModelFilePath,n):0;if(i=e._OrtCreateSessionOptions(o,!!s.enableCpuMemArena,!!s.enableMemPattern,l,!!s.enableProfiling,0,c,h,f,m),i===0&&jt("Can't create session options."),s.executionProviders&&await a1(i,s.executionProviders,n),s.enableGraphCapture!==void 0){if(typeof s.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${s.enableGraphCapture}`);bd(i,"enableGraphCapture",s.enableGraphCapture.toString(),n)}if(s.freeDimensionOverrides)for(let[_,E]of Object.entries(s.freeDimensionOverrides)){if(typeof _!="string")throw new Error(`free dimension override name must be a string: ${_}`);if(typeof E!="number"||!Number.isInteger(E)||E<0)throw new Error(`free dimension override value must be a non-negative integer: ${E}`);let w=Ds(_,n);e._OrtAddFreeDimensionOverride(i,w,E)!==0&&jt(`Can't set a free dimension override: ${_} - ${E}.`)}return s.extra!==void 0&&Mf(s.extra,"",new WeakSet,(_,E)=>{bd(i,_,E,n)}),[i,n]}catch(o){throw i!==0&&e._OrtReleaseSessionOptions(i)!==0&&jt("Can't release session options."),n.forEach(l=>e._free(l)),o}}}),ql,Xa,jl,lp,Nf,Uy,Py,q0,at=Ue(()=>{ql=t=>{switch(t){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${t}`)}},Xa=t=>{switch(t){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${t}`)}},jl=(t,e)=>{let i=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][t],n=typeof e=="number"?e:e.reduce((s,o)=>s*o,1);return i>0?Math.ceil(n*i):void 0},lp=t=>{switch(t){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${t}`)}},Nf=t=>{switch(t){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${t}`)}},Uy=t=>t==="float32"||t==="float16"||t==="int32"||t==="int64"||t==="uint32"||t==="uint8"||t==="bool"||t==="uint4"||t==="int4",Py=t=>t==="float32"||t==="float16"||t==="int32"||t==="int64"||t==="uint32"||t==="uint64"||t==="int8"||t==="uint8"||t==="bool"||t==="uint4"||t==="int4",q0=t=>{switch(t){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${t}`)}}}),zy,IE=Ue(()=>{My(),zy=async t=>{if(typeof t=="string"){let e=await fetch(t);if(!e.ok)throw new Error(`failed to load external data file: ${t}`);let i=e.headers.get("Content-Length"),n=i?parseInt(i,10):0;if(n<1073741824)return new Uint8Array(await e.arrayBuffer());{if(!e.body)throw new Error(`failed to load external data file: ${t}, no response body.`);let s=e.body.getReader(),o;try{o=new ArrayBuffer(n)}catch(c){if(c instanceof RangeError){let h=Math.ceil(n/65536);o=new WebAssembly.Memory({initial:h,maximum:h}).buffer}else throw c}let l=0;for(;;){let{done:c,value:h}=await s.read();if(c)break;let f=h.byteLength;new Uint8Array(o,l,f).set(h),l+=f}return new Uint8Array(o,0,n)}}else return t instanceof Blob?new Uint8Array(await t.arrayBuffer()):t instanceof Uint8Array?t:new Uint8Array(t)}}),o1,l1,u1,c1,Fy,d1,At,to=Ue(()=>{at(),o1=["V","I","W","E","F"],l1=(t,e)=>{console.log(`[${o1[t]},${new Date().toISOString()}]${e}`)},Fy=(t,e)=>{u1=t,c1=e},d1=(t,e)=>{let i=Nf(t),n=Nf(u1);i>=n&&l1(i,typeof e=="function"?e():e)},At=(...t)=>{c1&&d1(...t)}}),h1,oc,Ae,Bf,RE,ME,NE,ht=Ue(()=>{h1=class{static calcMatMulShape(t,e){return t[1]!==e[0]?void 0:[t[0],e[1]]}},oc=class{static calcShape(t,e,i=!1){let n=t.length,s=e.length;if(n===0)return e;if(s===0)return t;let o=Math.max(t.length,e.length),l=new Array(o);if(i){if(n<2||s<2)return;let c=h1.calcMatMulShape([t[n-2],t[n-1]],[e[s-2],e[s-1]]);if(c===void 0)return;[l[o-2],l[o-1]]=c}for(let c=i?3:1;c<=o;c++){let h=n-c<0?1:t[n-c],f=s-c<0?1:e[s-c];if(h!==f&&h>1&&f>1)return;let m=Math.max(h,f);if(h&&f)l[o-c]=Math.max(h,f);else{if(m>1)return;l[o-c]=0}}return l}static isValidBroadcast(t,e){let i=t.length,n=e.length;if(i>n)return!1;for(let s=1;s<=i;s++)if(t[i-s]!==1&&t[i-s]!==e[n-s])return!1;return!0}},Ae=class Af{static size(e){return Af.getSizeFromDimensionRange(e,0,e.length)}static convertShape(e,i=4){let n=e.length;if(n===0)return[];let s=new Array(n),o=n-1;for(;o>=0;){if(e[o]%i===0){s[o]=e[o]/i;break}if(i%e[o]!==0)throw new Error("cannot convert shape");s[o]=1,i/=e[o],o--}for(o--;o>=0;o--)s[o]=e[o];return s}static sizeFromDimension(e,i){if(i<0||i>e.length)throw new Error(`invalid dimension of ${i} for sizeFromDimension as Tensor has ${e.length} dimensions.`);return Af.getSizeFromDimensionRange(e,i,e.length)}static sizeToDimension(e,i){if(i<0||i>e.length)throw new Error(`invalid dimension of ${i} for sizeToDimension as Tensor has ${e.length} dimensions.`);return Af.getSizeFromDimensionRange(e,0,i)}static getSizeFromDimensionRange(e,i,n){let s=1;for(let o=i;o<n;o++){if(e[o]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");s*=Number(e[o])}return s}static computeStrides(e){let i=e.length;if(i===0)return[];if(i===1)return[1];let n=new Array(i);n[i-1]=1,n[i-2]=e[i-1];for(let s=i-3;s>=0;--s)n[s]=n[s+1]*e[s+1];return n}static normalizeAxis(e,i){if(e<-i&&e>=i)throw new Error("unsupported axis for this operation.");return e<0?e+i:e}static normalizeAxes(e,i){return e.map(n=>this.normalizeAxis(n,i??e.length))}static sortBasedOnPerm(e,i){return i?i.map(n=>e[n]):e.slice().reverse()}static padShape(e,i){let n=e.length;return e.map((s,o)=>s+i[o]+i[o+n])}static areEqual(e,i){return e.length!==i.length?!1:e.every((n,s)=>n===i[s])}},Bf=class Nd{static adjustPoolAttributes(e,i,n,s,o,l){if(!e&&n.length!==i.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(e)for(let c=0;c<i.length-2;c++)c>=n.length?n.push(i[c+2]):n[c]=i[c+2];for(let c=0;c<n.length;c++)if(c<s.length){if(s[c]<0)throw new Error("strides should be greater than or equal to 1")}else s.push(1);for(let c=0;c<n.length;c++)if(c<o.length){if(o[c]<0)throw new Error("dilations should be greater than or equal to 1")}else o.push(1);for(let c=0;c<n.length*2;c++)if(c<l.length){if(l[c]<0)throw new Error("pad should be greater than or equal to 1")}else l.push(0);for(let c=0;c<n.length;c++){if(n[c]<=0)throw new Error("kernel shapes need to be greater than 0");if(l[c]>=n[c]||l[c+n.length]>=n[c])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(e,i,n,s,o,l,c){if(c){if(o.length!==2*(e.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(i.length!==e.length-2)throw new Error("length of strides should be the length of data dimensions");if(s.length!==e.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let h=0;h<e.length-2;h++)Nd.adjustPadAndReturnShape(e[h+(l?1:2)],i[h],n[h],s[h],o,h,h+e.length-2,c)}}static computePoolOutputShape(e,i,n,s,o,l,c){if(i.length<=0)throw new Error("input shape must be of size greater than 0");let h=[i[0],i[1]];return Nd.computeShapeHelper(e,i,h,n,s,o,l,c),h}static computeConvOutputShape(e,i,n,s,o,l,c){if(e.length<=0||i.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let h=[e[0],i[0]];return Nd.computeShapeHelper(!1,e,h,n,s,o,l,c),h}static computeShapeHelper(e,i,n,s,o,l,c,h){if(e)for(let f=0;f<i.length-2;f++)n.push(1);else for(let f=0;f<i.length-2;f++)n.push(Nd.adjustPadAndReturnShape(i[f+2],s[f],o[f],l[f],c,f,f+i.length-2,h))}static adjustPadAndReturnShape(e,i,n,s,o,l,c,h){let f=n*(s-1)+1;if(h&&h!=="NOTSET")switch(h){case"VALID":return o[l]=0,o[c]=0,Math.floor((e-f)/i+1);case"SAME_LOWER":case"SAME_UPPER":if(n!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let m=((e+i-1)/i-1)*i+s-e;return o[l]=Math.floor(h==="SAME_LOWER"?(m+1)/2:m/2),o[c]=m-o[l],Math.floor((e+m-s)/i+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((e+o[l]+o[c]-f)/i+1)}},RE=class{static getShapeOfGemmResult(t,e,i,n,s){if(t.length!==2||i.length!==2)throw new Error("shape need to be of size 2");let o,l,c;e?(o=t[1],l=t[0]):(o=t[0],l=t[1]);let h=-1;if(n?(c=i[0],h=1):(c=i[1],h=0),i[h]!==l)throw new Error("dimension mismatch");if(o<=0||c<=0||l<=0)throw new Error("invalid shape specified");if(s&&!oc.isValidBroadcast(s,[o,c]))throw new Error("gemm: invalid bias shape for broadcast");return[o,c,l]}},ME=-34028234663852886e22,NE=34028234663852886e22}),qy,BE=Ue(()=>{at(),qy=(t,e)=>new(lp(e))(t)}),xg,j0,Sg,f1,wg,p1,Eg,Cg,Ag,m1,LE,MO=Ue(()=>{at(),to(),xg=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),j0=(t,e)=>{if(e==="int32")return t;let i=xg.get(e);if(!i)throw new Error(`WebNN backend does not support data type: ${e}`);let n=i/8;if(t.byteLength%n!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${n}.`);let s=t.byteLength/n,o=new(lp(e))(t.buffer,t.byteOffset,s);switch(e){case"int64":case"uint64":{let l=new Int32Array(s);for(let c=0;c<s;c++){let h=o[c];if(h>2147483647n||h<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");l[c]=Number(h)}return new Uint8Array(l.buffer)}case"int8":case"uint8":case"uint32":{if(e==="uint32"&&o.some(c=>c>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let l=Int32Array.from(o,Number);return new Uint8Array(l.buffer)}default:throw new Error(`Unsupported data conversion from ${e} to 'int32'`)}},Sg=(t,e)=>{if(e==="int32")return t;if(t.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let i=t.byteLength/4,n=new Int32Array(t.buffer,t.byteOffset,i);switch(e){case"int64":{let s=BigInt64Array.from(n,BigInt);return new Uint8Array(s.buffer)}case"uint64":{if(n.some(o=>o<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let s=BigUint64Array.from(n,BigInt);return new Uint8Array(s.buffer)}case"int8":{if(n.some(o=>o<-128||o>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let s=Int8Array.from(n,Number);return new Uint8Array(s.buffer)}case"uint8":{if(n.some(s=>s<0||s>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(n,Number)}case"uint32":{if(n.some(o=>o<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let s=Uint32Array.from(n,Number);return new Uint8Array(s.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${e}`)}},f1=1,wg=()=>f1++,p1=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),Eg=(t,e)=>{let i=xg.get(t);if(!i)throw new Error(`WebNN backend does not support data type: ${t}`);return e.length>0?Math.ceil(e.reduce((n,s)=>n*s)*i/8):0},Cg=class{constructor(t){this.isDataConverted=!1;let{sessionId:e,context:i,tensor:n,dataType:s,shape:o,fallbackDataType:l}=t;this.sessionId=e,this.mlContext=i,this.mlTensor=n,this.dataType=s,this.tensorShape=o,this.fallbackDataType=l}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return Eg(this.dataType,this.tensorShape)}destroy(){At("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(t){this.mlContext.writeTensor(this.mlTensor,t)}async read(t){if(this.fallbackDataType){let e=await this.mlContext.readTensor(this.mlTensor),i=Sg(new Uint8Array(e),this.dataType);if(t){(t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)).set(i);return}else return i.buffer}else return t?this.mlContext.readTensor(this.mlTensor,t):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(t,e,i){return this.mlContext===t&&this.dataType===e&&this.tensorShape.length===i.length&&this.tensorShape.every((n,s)=>n===i[s])}setIsDataConverted(t){this.isDataConverted=t}},Ag=class{constructor(t,e){this.tensorManager=t,this.wrapper=e}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(t,e,i,n){let s=this.tensorManager.getMLContext(t),o;if(!s.opSupportLimits().input.dataTypes.includes(e)){if(o=p1.get(e),!o||!s.opSupportLimits().input.dataTypes.includes(o))throw new Error(`WebNN backend does not support data type: ${e}`);At("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${e} to ${o}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(s,e,i))return this.wrapper.tensor;if(n){if(this.wrapper.byteLength!==Eg(e,i))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let l=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(t,e,i,l,!0,!0,o),n&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(t){let e=t;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")e=j0(t,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(t.byteLength===this.wrapper.byteLength){this.wrapper.write(e);return}else At("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(e):this.activeUpload=new Uint8Array(e)}async download(t){if(this.activeUpload){let e=this.wrapper?.isDataConverted?Sg(this.activeUpload,this.wrapper?.type):this.activeUpload;if(t){t instanceof ArrayBuffer?new Uint8Array(t).set(e):new Uint8Array(t.buffer,t.byteOffset,t.byteLength).set(e);return}else return e.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return t?this.wrapper.read(t):this.wrapper.read()}},m1=class{constructor(t){this.backend=t,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(t){let e=this.backend.getMLContext(t);if(!e)throw new Error("MLContext not found for session.");return e}reserveTensorId(){let t=wg();return this.tensorTrackersById.set(t,new Ag(this)),t}releaseTensorId(t){let e=this.tensorTrackersById.get(t);e&&(this.tensorTrackersById.delete(t),e.tensorWrapper&&this.releaseTensor(e.tensorWrapper))}async ensureTensor(t,e,i,n,s){At("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${e}, dataType: ${i}, shape: ${n}, copyOld: ${s}}`);let o=this.tensorTrackersById.get(e);if(!o)throw new Error("Tensor not found.");return o.ensureTensor(t,i,n,s)}upload(t,e){let i=this.tensorTrackersById.get(t);if(!i)throw new Error("Tensor not found.");i.upload(e)}async download(t,e){At("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${t}, dstBuffer: ${e?.byteLength}}`);let i=this.tensorTrackersById.get(t);if(!i)throw new Error("Tensor not found.");return i.download(e)}releaseTensorsForSession(t){for(let e of this.freeTensors)e.sessionId===t&&e.destroy();this.freeTensors=this.freeTensors.filter(e=>e.sessionId!==t)}registerTensor(t,e,i,n){let s=this.getMLContext(t),o=wg(),l=new Cg({sessionId:t,context:s,tensor:e,dataType:i,shape:n});return this.tensorTrackersById.set(o,new Ag(this,l)),this.externalTensors.add(l),o}async getCachedTensor(t,e,i,n,s,o,l){let c=this.getMLContext(t);for(let[f,m]of this.freeTensors.entries())if(m.canReuseTensor(c,e,i)){At("verbose",()=>`[WebNN] Reusing tensor {dataType: ${e}, ${l?`fallbackDataType: ${l},`:""} shape: ${i}`);let _=this.freeTensors.splice(f,1)[0];return _.sessionId=t,_}At("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${e}, ${l?`fallbackDataType: ${l},`:""} shape: ${i}}`);let h=await c.createTensor({dataType:l??e,shape:i,dimensions:i,usage:n,writable:s,readable:o});return new Cg({sessionId:t,context:c,tensor:h,dataType:e,shape:i,fallbackDataType:l})}releaseTensor(t){this.externalTensors.has(t)&&this.externalTensors.delete(t),this.freeTensors.push(t)}},LE=(...t)=>new m1(...t)}),Td,g1,UE,NO=Ue(()=>{at(),su(),BE(),MO(),to(),Td=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),g1=(t,e)=>{if(t===e)return!0;if(t===void 0||e===void 0)return!1;let i=Object.keys(t).sort(),n=Object.keys(e).sort();return i.length===n.length&&i.every((s,o)=>s===n[o]&&t[s]===e[s])},UE=class{constructor(t){this.tensorManager=LE(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,Fy(t.logLevel,!!t.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(t){At("verbose",()=>`[WebNN] onRunStart {sessionId: ${t}}`),this.activeSessionId=t}onRunEnd(t){At("verbose",()=>`[WebNN] onRunEnd {sessionId: ${t}}`);let e=this.temporarySessionTensorIds.get(t);if(e){for(let i of e)At("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${i}}`),this.tensorManager.releaseTensorId(i);this.temporarySessionTensorIds.delete(t),this.activeSessionId=void 0}}async createMLContext(t){if(t instanceof GPUDevice){let i=this.mlContextCache.findIndex(n=>n.gpuDevice===t);if(i!==-1)return this.mlContextCache[i].mlContext;{let n=await navigator.ml.createContext(t);return this.mlContextCache.push({gpuDevice:t,mlContext:n}),n}}else if(t===void 0){let i=this.mlContextCache.findIndex(n=>n.options===void 0&&n.gpuDevice===void 0);if(i!==-1)return this.mlContextCache[i].mlContext;{let n=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:n}),n}}let e=this.mlContextCache.findIndex(i=>g1(i.options,t));if(e!==-1)return this.mlContextCache[e].mlContext;{let i=await navigator.ml.createContext(t);return this.mlContextCache.push({options:t,mlContext:i}),i}}registerMLContext(t,e){this.mlContextBySessionId.set(t,e);let i=this.sessionIdsByMLContext.get(e);i||(i=new Set,this.sessionIdsByMLContext.set(e,i)),i.add(t),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(t,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(t,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(t){this.sessionGraphInputs.delete(t),this.sessionGraphOutputs.delete(t);let e=this.mlContextBySessionId.get(t);if(!e)return;this.tensorManager.releaseTensorsForSession(t),this.mlContextBySessionId.delete(t);let i=this.sessionIdsByMLContext.get(e);if(i.delete(t),i.size===0){this.sessionIdsByMLContext.delete(e);let n=this.mlContextCache.findIndex(s=>s.mlContext===e);n!==-1&&this.mlContextCache.splice(n,1)}}getMLContext(t){return this.mlContextBySessionId.get(t)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(t){At("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${t}}`),this.tensorManager.releaseTensorId(t)}async ensureTensor(t,e,i,n,s){let o=Td.get(i);if(!o)throw new Error(`Unsupported ONNX data type: ${i}`);return this.tensorManager.ensureTensor(t??this.currentSessionId,e,o,n,s)}async createTemporaryTensor(t,e,i){At("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${e}, shape: ${i}}`);let n=Td.get(e);if(!n)throw new Error(`Unsupported ONNX data type: ${e}`);let s=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(t,s,n,i,!1);let o=this.temporarySessionTensorIds.get(t);return o?o.push(s):this.temporarySessionTensorIds.set(t,[s]),s}uploadTensor(t,e){if(!ii().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");At("verbose",()=>`[WebNN] uploadTensor {tensorId: ${t}, data: ${e.byteLength}}`),this.tensorManager.upload(t,e)}async downloadTensor(t,e){return this.tensorManager.download(t,e)}createMLTensorDownloader(t,e){return async()=>{let i=await this.tensorManager.download(t);return qy(i,e)}}registerMLTensor(t,e,i,n){let s=Td.get(i);if(!s)throw new Error(`Unsupported ONNX data type: ${i}`);let o=this.tensorManager.registerTensor(t,e,s,n);return At("verbose",()=>`[WebNN] registerMLTensor {tensor: ${e}, dataType: ${s}, dimensions: ${n}} -> {tensorId: ${o}}`),o}registerMLConstant(t,e,i,n,s,o,l=!1){if(!o)throw new Error("External mounted files are not available.");let c=t;t.startsWith("./")&&(c=t.substring(2));let h=o.get(c);if(!h)throw new Error(`File with name ${c} not found in preloaded files.`);if(e+i>h.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let f=h.slice(e,e+i).buffer,m;switch(s.dataType){case"float32":m=new Float32Array(f);break;case"float16":m=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(f):new Uint16Array(f);break;case"int32":m=new Int32Array(f);break;case"uint32":m=new Uint32Array(f);break;case"int64":if(l){let _=j0(new Uint8Array(f),"int64");m=new Int32Array(_.buffer),s.dataType="int32"}else m=new BigInt64Array(f);break;case"uint64":m=new BigUint64Array(f);break;case"int8":m=new Int8Array(f);break;case"int4":case"uint4":case"uint8":m=new Uint8Array(f);break;default:throw new Error(`Unsupported data type: ${s.dataType} in creating WebNN Constant from external data.`)}return At("verbose",()=>`[WebNN] registerMLConstant {dataType: ${s.dataType}, shape: ${s.shape}}} ${l?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),n.constant(s,m)}registerGraphInput(t){this.temporaryGraphInputs.push(t)}registerGraphOutput(t){this.temporaryGraphOutputs.push(t)}isGraphInput(t,e){let i=this.sessionGraphInputs.get(t);return i?i.includes(e):!1}isGraphOutput(t,e){let i=this.sessionGraphOutputs.get(t);return i?i.includes(e):!1}isGraphInputOutputTypeSupported(t,e,i=!0){let n=this.mlContextBySessionId.get(t),s=Td.get(ql(e));return typeof s>"u"?!1:i?!!n?.opSupportLimits().input.dataTypes.includes(s):!!n?.opSupportLimits().output.dataTypes.includes(s)}flush(){}}}),jy=Ue(()=>{}),Dg,cf,df,y1,_1,kg,H0,v1,PE,BO=Ue(()=>{to(),jy(),Dg=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),cf=[],df=t=>Math.ceil(Number(t)/16)*16,y1=t=>{for(let e=0;e<cf.length;e++){let i=cf[e];if(t<=i)return i}return Math.ceil(t/16)*16},_1=1,kg=()=>_1++,H0=async(t,e,i,n)=>{let s=df(i),o=t.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let l=t.getCommandEncoder();t.endComputePass(),l.copyBufferToBuffer(e,0,o,0,s),t.flush(),await o.mapAsync(GPUMapMode.READ);let c=o.getMappedRange();if(n){let h=n();return h.set(new Uint8Array(c,0,i)),h}else return new Uint8Array(c.slice(0,i))}finally{o.destroy()}},v1=class{constructor(t){this.backend=t,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[e]of Dg)cf.push(e),this.freeBuffers.set(e,[]),this.freeUniformBuffers.set(e,[]);this.sessionCount=0}upload(t,e){let i=e.buffer,n=e.byteOffset,s=e.byteLength,o=df(s),l=this.storageCache.get(t);if(!l)throw new Error("gpu data for uploading does not exist");if(Number(l.originalSize)!==s)throw new Error(`inconsistent data size. gpu data size=${l.originalSize}, data size=${s}`);let c=this.backend.device.createBuffer({mappedAtCreation:!0,size:o,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),h=c.getMappedRange();new Uint8Array(h).set(new Uint8Array(i,n,s)),c.unmap();let f=this.backend.device.createCommandEncoder();f.copyBufferToBuffer(c,0,l.gpuData.buffer,0,o),this.backend.device.queue.submit([f.finish()]),c.destroy(),At("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${t})`)}memcpy(t,e){let i=this.storageCache.get(t);if(!i)throw new Error("source gpu data for memcpy does not exist");let n=this.storageCache.get(e);if(!n)throw new Error("destination gpu data for memcpy does not exist");if(i.originalSize!==n.originalSize)throw new Error("inconsistent source and destination gpu data size");let s=df(i.originalSize),o=this.backend.getCommandEncoder();this.backend.endComputePass(),o.copyBufferToBuffer(i.gpuData.buffer,0,n.gpuData.buffer,0,s)}registerExternalBuffer(t,e,i){let n;if(i){if(n=i[0],t===i[1])return At("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${e}) => id=${n}, buffer is the same, skip.`),n;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else n=kg();return this.storageCache.set(n,{gpuData:{id:n,type:0,buffer:t},originalSize:e}),At("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${e}) => id=${n}, registered.`),n}unregisterExternalBuffer(t){t!==void 0&&(this.storageCache.delete(t),At("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${t}`))}create(t,e=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let i=y1(t),n,s=(e&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,o=(e&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(s||o){let c=(s?this.freeBuffers:this.freeUniformBuffers).get(i);c?c.length>0?n=c.pop():n=this.backend.device.createBuffer({size:i,usage:e}):n=this.backend.device.createBuffer({size:i,usage:e})}else n=this.backend.device.createBuffer({size:i,usage:e});let l={id:kg(),type:0,buffer:n};return this.storageCache.set(l.id,{gpuData:l,originalSize:Number(t)}),At("verbose",()=>`[WebGPU] GpuDataManager.create(size=${t}) => id=${l.id}`),l}get(t){return this.storageCache.get(t)?.gpuData}release(t){let e=typeof t=="bigint"?Number(t):t,i=this.storageCache.get(e);if(!i){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return At("verbose",()=>`[WebGPU] GpuDataManager.release(id=${e}), gpuDataId=${i.gpuData.id}`),this.storageCache.delete(e),this.buffersPending.push(i.gpuData.buffer),i.originalSize}async download(t,e){let i=this.storageCache.get(Number(t));if(!i)throw new Error("data does not exist");await H0(this.backend,i.gpuData.buffer,i.originalSize,e)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let t of this.buffersPending){let e=Dg.get(t.size);if((t.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let i=this.freeBuffers.get(t.size)||[];e===void 0||i.length>=e?t.destroy():i.push(t)}else if((t.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let i=this.freeUniformBuffers.get(t.size)||[];e===void 0||i.length>=e?t.destroy():i.push(t)}else t.destroy()}this.buffersPending=[]}else{let t=this.capturedPendingBuffers.get(this.backend.currentSessionId);t||(t=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,t));for(let e of this.buffersPending)t.push(e);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(t=>{t.forEach(e=>{e.destroy()})}),this.freeUniformBuffers.forEach(t=>{t.forEach(e=>{e.destroy()})}),this.storageCache.forEach(t=>{t.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(t=>{t.forEach(e=>{e.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(t){let e=this.capturedPendingBuffers.get(t);e&&(e.forEach(i=>{i.destroy()}),this.capturedPendingBuffers.delete(t)),this.sessionCount-=1,this.sessionCount===0&&(At("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(i=>{i.gpuData.buffer.destroy()}),this.storageCache=new Map)}},PE=(...t)=>new v1(...t)}),b1,Bt,Ci=Ue(()=>{b1=class{constructor(t){Object.assign(this,t)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(t=>`${this[t]}`).join(";")),this.key}},Bt=t=>new b1(t)}),lc,hf,en,On,Ze,xi,V0,Xu,Jo,Ye,xd,Re,Xe,zE,Hy,T1,FE,mt=Ue(()=>{at(),ht(),lc=64,hf=(t,e)=>{if(e===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(t)){case 10:return e>1?`vec${e}<f16>`:"f16";case 1:return e>1?`vec${e}<f32>`:"f32";case 6:return e>1?`vec${e}<i32>`:"i32";case 12:return e>1?`vec${e}<u32>`:"u32";case 7:if(e>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(e>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(e!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${t}`)}},en=(t,e=1)=>{let i=hf(t,e);return typeof i=="string"?i:i[0]},On=(t,e=1)=>{let i=hf(t,e);return typeof i=="string"?i:i[1]},Ze=(...t)=>{let e=[];return t.forEach(i=>{i.length!==0&&e.push({type:12,data:i},{type:12,data:Ae.computeStrides(i)})}),e},xi=t=>t%4===0?4:t%2===0?2:1,V0=(t="f32",e,i="0")=>!e||e===1?`${t}(${i})`:`vec${e}<${t}>(${i})`,Xu=(t,e,i)=>t==="f32"?i:e===1?`f32(${i})`:`vec${e}<f32>(${i})`,Jo=(t,e)=>e===4?`(${t}.x + ${t}.y + ${t}.z + ${t}.w)`:e===2?`(${t}.x + ${t}.y)`:e===3?`(${t}.x + ${t}.y + ${t}.z)`:t,Ye=(t,e,i,n)=>t.startsWith("uniforms.")&&i>4?typeof e=="string"?n==="f16"?`${t}[(${e}) / 8][(${e}) % 8 / 4][(${e}) % 8 % 4]`:`${t}[(${e}) / 4][(${e}) % 4]`:n==="f16"?`${t}[${Math.floor(e/8)}][${Math.floor(e%8/4)}][${e%8%4}]`:`${t}[${Math.floor(e/4)}][${e%4}]`:i>1?`${t}[${e}]`:t,xd=(t,e,i,n,s)=>{let o=typeof i=="number",l=o?i:i.length,c=[...new Array(l).keys()],h=l<2?"u32":l<=4?`vec${l}<u32>`:`array<u32, ${l}>`,f=hf(e,s),m=typeof f=="string"?f:f[1],_=typeof f=="string"?f:f[0],E={indices:h,value:m,storage:_,tensor:e},w=P=>typeof P=="string"?P:`${P}u`,A={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},C=o?"uniforms.":"",M=`${C}${t}_shape`,O=`${C}${t}_strides`,$="";for(let P=0;P<l-1;P++)$+=`
    let dim${P} = current / ${Ye(O,P,l)};
    let rest${P} = current % ${Ye(O,P,l)};
    indices[${P}] = dim${P};
    current = rest${P};
    `;$+=`indices[${l-1}] = current;`;let B=l<2?"":`
  fn o2i_${t}(offset: u32) -> ${E.indices} {
    var indices: ${E.indices};
    var current = offset;
    ${$}
    return indices;
  }`,U=P=>(A.offsetToIndices=!0,l<2?P:`o2i_${t}(${P})`),j=[];if(l>=2)for(let P=l-1;P>=0;P--)j.push(`${Ye(O,P,l)} * (indices[${P}])`);let W=l<2?"":`
  fn i2o_${t}(indices: ${E.indices}) -> u32 {
    return ${j.join("+")};
  }`,z=P=>(A.indicesToOffset=!0,l<2?P:`i2o_${t}(${P})`),Y=(...P)=>l===0?"0u":`${E.indices}(${P.map(w).join(",")})`,L=(P,ne)=>l<2?`${P}`:`${Ye(P,ne,l)}`,H=(P,ne,ye)=>l<2?`${P}=${ye};`:`${Ye(P,ne,l)}=${ye};`,se={},ae=(P,ne)=>{A.broadcastedIndicesToOffset=!0;let ye=`${ne.name}broadcastedIndicesTo${t}Offset`;if(ye in se)return`${ye}(${P})`;let ke=[];for(let le=l-1;le>=0;le--){let ze=ne.indicesGet("outputIndices",le+ne.rank-l);ke.push(`${L(O,le)} * (${ze} % ${L(M,le)})`)}return se[ye]=`fn ${ye}(outputIndices: ${ne.type.indices}) -> u32 {
             return ${ke.length>0?ke.join("+"):"0u"};
           }`,`${ye}(${P})`},ce=(P,ne)=>(()=>{if(E.storage===E.value)return`${t}[${P}]=${ne};`;if(E.storage==="vec2<u32>"&&E.value==="i32")return`${t}[${P}]=vec2<u32>(u32(${ne}), select(0u, 0xFFFFFFFFu, ${ne} < 0));`;if(E.storage==="vec2<u32>"&&E.value==="u32")return`${t}[${P}]=vec2<u32>(u32(${ne}), 0u);`;if(E.storage==="u32"&&E.value==="vec4<bool>")return`${t}[${P}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${ne}));`;throw new Error(`not supported combination of storage type ${E.storage} and value type ${E.value} yet`)})(),fe=P=>(()=>{if(E.storage===E.value)return`${t}[${P}]`;if(E.storage==="vec2<u32>"&&E.value==="i32")return`i32(${t}[${P}].x)`;if(E.storage==="vec2<u32>"&&E.value==="u32")return`u32(${t}[${P}].x)`;if(E.storage==="u32"&&E.value==="vec4<bool>")return`vec4<bool>(bool(${t}[${P}] & 0xFFu), bool(${t}[${P}] & 0xFF00u), bool(${t}[${P}] & 0xFF0000u), bool(${t}[${P}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${E.storage} and value type ${E.value} yet`)})(),be=l<2?"":`
  fn get_${t}ByIndices(indices: ${E.indices}) -> ${m} {
    return ${fe(`i2o_${t}(indices)`)};
  }`,J=l<2?"":(()=>{let P=c.map(ye=>`d${ye}: u32`).join(", "),ne=c.map(ye=>`d${ye}`).join(", ");return`
  fn get_${t}(${P}) -> ${m} {
    return get_${t}ByIndices(${Y(ne)});
  }`})(),ee=(...P)=>{if(P.length!==l)throw new Error(`indices length must be ${l}`);let ne=P.map(w).join(",");return l===0?fe("0u"):l===1?fe(ne[0]):(A.get=!0,A.getByIndices=!0,A.indicesToOffset=!0,`get_${t}(${ne})`)},de=P=>l<2?fe(P):(A.getByIndices=!0,A.indicesToOffset=!0,`get_${t}ByIndices(${P})`),ue=l<2?"":`
  fn set_${t}ByIndices(indices: ${E.indices}, value: ${m}) {
    ${ce(`i2o_${t}(indices)`,"value")}
  }`,ve=l<2?"":(()=>{let P=c.map(ye=>`d${ye}: u32`).join(", "),ne=c.map(ye=>`d${ye}`).join(", ");return`
  fn set_${t}(${P}, value: ${m}) {
    set_${t}ByIndices(${Y(ne)}, value);
  }`})();return{impl:()=>{let P=[],ne=!1;return A.offsetToIndices&&(P.push(B),ne=!0),A.indicesToOffset&&(P.push(W),ne=!0),A.broadcastedIndicesToOffset&&(Object.values(se).forEach(ye=>P.push(ye)),ne=!0),A.set&&(P.push(ve),ne=!0),A.setByIndices&&(P.push(ue),ne=!0),A.get&&(P.push(J),ne=!0),A.getByIndices&&(P.push(be),ne=!0),!o&&ne&&P.unshift(`const ${M} = ${E.indices}(${i.join(",")});`,`const ${O} = ${E.indices}(${Ae.computeStrides(i).join(",")});`),P.join(`
`)},type:E,offsetToIndices:U,indicesToOffset:z,broadcastedIndicesToOffset:ae,indices:Y,indicesGet:L,indicesSet:H,set:(...P)=>{if(P.length!==l+1)throw new Error(`indices length must be ${l}`);let ne=P[l];if(typeof ne!="string")throw new Error("value must be string");let ye=P.slice(0,l).map(w).join(",");return l===0?ce("0u",ne):l===1?ce(ye[0],ne):(A.set=!0,A.setByIndices=!0,A.indicesToOffset=!0,`set_${t}(${ye}, ${ne})`)},setByOffset:ce,setByIndices:(P,ne)=>l<2?ce(P,ne):(A.setByIndices=!0,A.indicesToOffset=!0,`set_${t}ByIndices(${P}, ${ne});`),get:ee,getByOffset:fe,getByIndices:de,usage:n,name:t,strides:O,shape:M,rank:l}},Re=(t,e,i,n=1)=>xd(t,e,i,"input",n),Xe=(t,e,i,n=1)=>xd(t,e,i,"output",n),zE=(t,e,i)=>xd(t,e,i,"atomicOutput",1),Hy=(t,e,i,n=1)=>xd(t,e,i,"internal",n),T1=class{constructor(t,e){this.normalizedDispatchGroup=t,this.limits=e,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(t){return`if (global_idx >= ${typeof t=="number"?`${t}u`:t}) { return; }`}mainStart(t=lc){let e=typeof t=="number"?t:t[0],i=typeof t=="number"?1:t[1],n=typeof t=="number"?1:t[2];if(e>this.limits.maxComputeWorkgroupSizeX||i>this.limits.maxComputeWorkgroupSizeY||n>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${e}, ${i}, ${n}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(e*i*n>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${e}, ${i}, ${n}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let s=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,o=s?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,l=s?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${e*i*n}u + local_idx;`;return`@compute @workgroup_size(${e}, ${i}, ${n})
  fn main(${o}) {
    ${l}
  `}appendVariableUniforms(t){t.rank!==0&&(t.shape.startsWith("uniforms.")&&this.uniforms.push({name:t.shape.replace("uniforms.",""),type:"u32",length:t.rank}),t.strides.startsWith("uniforms.")&&this.uniforms.push({name:t.strides.replace("uniforms.",""),type:"u32",length:t.rank}))}declareVariable(t,e){if(t.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(t),this.appendVariableUniforms(t);let i=t.usage==="input"?"read":"read_write",n=t.usage==="atomicOutput"?"atomic<i32>":t.type.storage;return`@group(0) @binding(${e}) var<storage, ${i}> ${t.name}: array<${n}>;`}declareVariables(...t){return t.map(e=>this.declareVariable(e,this.variableIndex++)).join(`
`)}registerInternalVariable(t){if(t.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(t),this.appendVariableUniforms(t)}registerInternalVariables(...t){return t.forEach(e=>this.registerInternalVariable(e)),this}registerUniform(t,e,i=1){return this.uniforms.push({name:t,type:e,length:i}),this}registerUniforms(t){return this.uniforms=this.uniforms.concat(t),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let t=[];for(let{name:e,type:i,length:n}of this.uniforms)if(n&&n>4)i==="f16"?t.push(`@align(16) ${e}:array<mat2x4<${i}>, ${Math.ceil(n/8)}>`):t.push(`${e}:array<vec4<${i}>, ${Math.ceil(n/4)}>`);else{let s=n==null||n===1?i:`vec${n}<${i}>`;t.push(`${e}:${s}`)}return`
      struct Uniforms { ${t.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(t=>t.impl()).join(`
`)+this.internalVariables.map(t=>t.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let t=e=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(e)];return this.uniforms.map(e=>[t(e.type),e.length??1])}},FE=(t,e)=>new T1(t,e)}),x1,$g,S1,w1,E1,C1,$r,qE,jE,il=Ue(()=>{at(),ht(),Ci(),mt(),x1=(t,e)=>{if(!t||t.length!==1)throw new Error("Transpose requires 1 input.");if(e.length!==0&&e.length!==t[0].dims.length)throw new Error(`perm size ${e.length} does not match input rank ${t[0].dims.length}`)},$g=(t,e)=>e.length!==0?e:[...new Array(t).keys()].reverse(),S1=(t,e)=>Ae.sortBasedOnPerm(t,$g(t.length,e)),w1=(t,e,i,n)=>{let s=`fn perm(i: ${n.type.indices}) -> ${i.type.indices} {
    var a: ${i.type.indices};`;for(let o=0;o<e;++o)s+=`a[${t[o]}]=i[${o}];`;return s+="return a;}"},E1=(t,e)=>{let i=[],n=[];for(let s=0;s<t.length;++s)t[s]!==1&&i.push(t[s]),t[e[s]]!==1&&n.push(e[s]);return{newShape:i,newPerm:n}},C1=(t,e)=>{let i=0;for(let n=0;n<t.length;++n)if(e[t[n]]!==1){if(t[n]<i)return!1;i=t[n]}return!0},$r=(t,e)=>{let i=t.dataType,n=t.dims.length,s=$g(n,e),o=S1(t.dims,s),l=t.dims,c=o,h=n<2||C1(s,t.dims),f;if(h)return f=A=>{let C=Re("input",i,l,4),M=Xe("output",i,c,4);return`
  ${A.registerUniform("output_size","u32").declareVariables(C,M)}
  ${A.mainStart()}
    ${A.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let A=Ae.size(o);return{outputs:[{dims:o,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(A/64/4)},programUniforms:[{type:12,data:Math.ceil(A/4)}]}},getShaderSource:f};let{newShape:m,newPerm:_}=E1(t.dims,s),E=Ae.areEqual(_,[2,3,1]),w=Ae.areEqual(_,[3,1,2]);if(m.length===2||E||w){l=E?[m[0],m[1]*m[2]]:w?[m[0]*m[1],m[2]]:m,c=[l[1],l[0]];let A=16;return f=C=>{let M=Re("a",i,l.length),O=Xe("output",i,c.length);return`
  ${C.registerUniform("output_size","u32").declareVariables(M,O)}
  var<workgroup> tile : array<array<${O.type.value}, ${A+1}>, ${A}>;
  ${C.mainStart([A,A,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${A} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${A}u + local_id.x;
    let input_row = workgroup_id_x * ${A}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${M.getByIndices(`${M.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${A}u + local_id.x;
    let output_row = workgroup_id_y * ${A}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${O.setByIndices(`${O.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let C=Ae.size(o);return{outputs:[{dims:o,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(c[1]/A),y:Math.ceil(c[0]/A)},programUniforms:[{type:12,data:C},...Ze(l,c)]}},getShaderSource:f}}return f=A=>{let C=Re("a",i,l.length),M=Xe("output",i,c.length);return`
  ${A.registerUniform("output_size","u32").declareVariables(C,M)}

  ${w1(s,n,C,M)}

  ${A.mainStart()}
    ${A.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${M.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${M.setByOffset("global_idx",C.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${e}`,inputDependencies:["rank"]},getRunData:()=>{let A=Ae.size(o);return{outputs:[{dims:o,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(A/64)},programUniforms:[{type:12,data:A},...Ze(l,c)]}},getShaderSource:f}},qE=(t,e)=>{x1(t.inputs,e.perm),t.compute($r(t.inputs[0],e.perm))},jE=t=>Bt({perm:t.perm})}),A1,D1,k1,$1,O1,I1,R1,M1,N1,B1,Ss,HE,VE,GE,WE,XE,KE,YE,QE,ZE,JE,LO=Ue(()=>{at(),ht(),mt(),Vy(),il(),A1={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},D1={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},k1={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},$1={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},O1=(t,e)=>{let i=[];for(let n=e-t;n<e;++n)i.push(n);return i},I1=(t,e)=>{let i=[],n=t.length;for(let o=0;o<n;o++)e.indexOf(o)===-1&&i.push(t[o]);let s=e.map(o=>t[o]);return[i,s]},R1=(t,e)=>{let i=t.length+e.length,n=[],s=0;for(let o=0;o<i;o++)e.indexOf(o)===-1?n.push(t[s++]):n.push(1);return n},M1=(t,e)=>{for(let i=0;i<t.length;++i)if(t[t.length-i-1]!==e-1-i)return!1;return!0},N1=(t,e)=>{let i=[];if(!M1(t,e)){for(let n=0;n<e;++n)t.indexOf(n)===-1&&i.push(n);t.forEach(n=>i.push(n))}return i},B1=(t,e,i,n,s,o,l)=>{let c=i[0].dims,h=Ae.size(o),f=Ae.size(l),m=Re("_A",i[0].dataType,c),_=Xe("output",s,o),E=64;h===1&&(E=256);let w=`
          var<workgroup> aBestValues : array<f32, ${E}>;
       `,A=C=>`
        ${C.registerUniform("reduceSize","u32").declareVariables(m,_)}
        ${w}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${C.mainStart(E)}

          let outputIndex = global_idx / ${E};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${k1[n]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${E}) {
           let candidate = f32(${m.getByOffset("offset + k")});
           bestValue = ${A1[n]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${E}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${D1[n]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${_.setByOffset("outputIndex",`${n==="mean"?`${_.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${_.type.storage}(${$1[n]})`}`)};
         }
        }`;return{name:t,shaderCache:{hint:`${e};${E}`,inputDependencies:["type"]},getShaderSource:A,getRunData:()=>({outputs:[{dims:o,dataType:s}],dispatchGroup:{x:h},programUniforms:[{type:12,data:f}]})}},Ss=(t,e,i,n)=>{let s=t.inputs.length===1?i:G0(t.inputs,i),o=s.axes;o.length===0&&!s.noopWithEmptyAxes&&(o=t.inputs[0].dims.map((w,A)=>A));let l=Ae.normalizeAxes(o,t.inputs[0].dims.length),c=l,h=t.inputs[0],f=N1(c,t.inputs[0].dims.length);f.length>0&&(h=t.compute($r(t.inputs[0],f),{inputs:[0],outputs:[-1]})[0],c=O1(c.length,h.dims.length));let[m,_]=I1(h.dims,c),E=m;s.keepDims&&(E=R1(m,l)),t.compute(B1(e,s.cacheKey,[h],n,t.inputs[0].dataType,E,_),{inputs:[h]})},HE=(t,e)=>{Ss(t,"ReduceMeanShared",e,"mean")},VE=(t,e)=>{Ss(t,"ReduceL1Shared",e,"l1")},GE=(t,e)=>{Ss(t,"ReduceL2Shared",e,"l2")},WE=(t,e)=>{Ss(t,"ReduceLogSumExpShared",e,"logSumExp")},XE=(t,e)=>{Ss(t,"ReduceMaxShared",e,"max")},KE=(t,e)=>{Ss(t,"ReduceMinShared",e,"min")},YE=(t,e)=>{Ss(t,"ReduceProdShared",e,"prod")},QE=(t,e)=>{Ss(t,"ReduceSumShared",e,"sum")},ZE=(t,e)=>{Ss(t,"ReduceSumSquareShared",e,"sumSquare")},JE=(t,e)=>{Ss(t,"ReduceLogSumShared",e,"logSum")}}),ws,L1,Lf,G0,Es,U1,P1,z1,F1,q1,j1,H1,V1,G1,W1,Cs,eC,tC,iC,nC,rC,sC,aC,oC,lC,uC,Vy=Ue(()=>{at(),ht(),Ci(),mt(),LO(),ws=t=>{if(!t||t.length===0||t.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(t.length===2&&t[1].dims.length!==1)throw new Error("Invalid axes input dims.")},L1=t=>["","",`var value = ${t.getByIndices("input_indices")};`,""],Lf=(t,e,i,n,s,o,l=!1,c=!1)=>{let h=[],f=i[0].dims,m=f.length,_=Ae.normalizeAxes(s,m),E=!c&&_.length===0;f.forEach((C,M)=>{E||_.indexOf(M)>=0?l&&h.push(1):h.push(C)});let w=h.length,A=Ae.size(h);return{name:t,shaderCache:e,getShaderSource:C=>{let M=[],O=Re("_A",i[0].dataType,m),$=Xe("output",o,w),B=n(O,$,_),U=B[2];for(let j=0,W=0;j<m;j++)E||_.indexOf(j)>=0?(l&&W++,U=`for(var j${j}: u32 = 0; j${j} < ${f[j]}; j${j}++) {
                  ${B[2].includes("last_index")?`let last_index = j${j};`:""}
                  ${O.indicesSet("input_indices",j,`j${j}`)}
                  ${U}
                }`):(M.push(`${O.indicesSet("input_indices",j,$.indicesGet("output_indices",W))};`),W++);return`

        ${C.registerUniform("output_size","u32").declareVariables(O,$)}

        ${C.mainStart()}
          ${C.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${O.type.indices};
          let output_indices = ${$.offsetToIndices("global_idx")};

          ${M.join(`
`)}
          ${B[0]}       // init ops for reduce max/min
          ${B[1]}
          ${U}
          ${B[3]}
          ${B.length===4?$.setByOffset("global_idx","value"):B.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:h,dataType:o}],dispatchGroup:{x:Math.ceil(A/64)},programUniforms:[{type:12,data:A},...Ze(f,h)]})}},G0=(t,e)=>{let i=[];return t[1].dims[0]>0&&t[1].getBigInt64Array().forEach(n=>i.push(Number(n))),Bt({axes:i,keepDims:e.keepDims,noopWithEmptyAxes:e.noopWithEmptyAxes})},Es=(t,e,i,n)=>{let s=t.inputs,o=s.length===1?i:G0(s,i);t.compute(Lf(e,{hint:o.cacheKey,inputDependencies:["rank"]},[s[0]],o.noopWithEmptyAxes&&o.axes.length===0?L1:n,o.axes,s[0].dataType,o.keepDims,o.noopWithEmptyAxes),{inputs:[0]})},U1=(t,e)=>{ws(t.inputs),Es(t,"ReduceLogSum",e,(i,n)=>[`var value = ${n.type.storage}(0);`,"",`value += ${i.getByIndices("input_indices")};`,"value = log(value);"])},P1=(t,e)=>{ws(t.inputs),Es(t,"ReduceL1",e,(i,n)=>[`var value = ${n.type.storage}(0);`,"",`value += abs(${i.getByIndices("input_indices")});`,""])},z1=(t,e)=>{ws(t.inputs),Es(t,"ReduceL2",e,(i,n)=>[`var t = ${n.type.value}(0); var value = ${n.type.value}(0);`,"",`t = ${i.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},F1=(t,e)=>{ws(t.inputs),Es(t,"ReduceLogSumExp",e,(i,n)=>[`var value = ${n.type.storage}(0);`,"",`value += exp(${i.getByIndices("input_indices")});`,"value = log(value);"])},q1=(t,e)=>{ws(t.inputs),Es(t,"ReduceMax",e,(i,n,s)=>{let o=[];for(let l=0;l<i.rank;l++)(s.indexOf(l)>=0||s.length===0)&&o.push(i.indicesSet("input_indices",l,0));return[`${o.join(`
`)}`,`var value = ${i.getByIndices("input_indices")};`,`value = max(value, ${i.getByIndices("input_indices")});`,""]})},j1=(t,e)=>{ws(t.inputs),Es(t,"ReduceMean",e,(i,n,s)=>{let o=1;for(let l=0;l<i.rank;l++)(s.indexOf(l)>=0||s.length===0)&&(o*=t.inputs[0].dims[l]);return["var sum = f32(0);","",`sum += f32(${i.getByIndices("input_indices")});`,`let value = ${n.type.value}(sum / ${o});`]})},H1=(t,e)=>{ws(t.inputs),Es(t,"ReduceMin",e,(i,n,s)=>{let o=[];for(let l=0;l<i.rank;l++)(s.indexOf(l)>=0||s.length===0)&&o.push(`input_indices[${l}] = 0;`);return[`${o.join(`
`)}`,`var value = ${i.getByIndices("input_indices")};`,`value = min(value, ${i.getByIndices("input_indices")});`,""]})},V1=(t,e)=>{ws(t.inputs),Es(t,"ReduceProd",e,(i,n)=>[`var value = ${n.type.storage}(1);`,"",`value *= ${i.getByIndices("input_indices")};`,""])},G1=(t,e)=>{ws(t.inputs),Es(t,"ReduceSum",e,(i,n)=>[`var value = ${n.type.storage}(0);`,"",`value += ${i.getByIndices("input_indices")};`,""])},W1=(t,e)=>{ws(t.inputs),Es(t,"ReduceSumSquare",e,(i,n)=>[`var t = ${n.type.value}(0); var value = ${n.type.value}(0);`,"",`t = ${i.getByIndices("input_indices")}; value += t * t;`,""])},Cs=(t,e,i)=>{if(e.length===0)return i;let n=1,s=1;for(let o=0;o<e.length;o++)e.indexOf(o)===-1?n*=t[o]:s*=t[o];return s<32&&n>1024},eC=(t,e)=>{Cs(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?j1(t,e):HE(t,e)},tC=(t,e)=>{Cs(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?P1(t,e):VE(t,e)},iC=(t,e)=>{Cs(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?z1(t,e):GE(t,e)},nC=(t,e)=>{Cs(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?F1(t,e):WE(t,e)},rC=(t,e)=>{Cs(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?q1(t,e):XE(t,e)},sC=(t,e)=>{Cs(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?H1(t,e):KE(t,e)},aC=(t,e)=>{Cs(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?V1(t,e):YE(t,e)},oC=(t,e)=>{Cs(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?G1(t,e):QE(t,e)},lC=(t,e)=>{Cs(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?W1(t,e):ZE(t,e)},uC=(t,e)=>{Cs(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?U1(t,e):JE(t,e)}}),Og,cC,dC,W0,UO=Ue(()=>{at(),Ci(),Vy(),Og=t=>{if(!t||t.length===0||t.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(t[0].dataType!==1)throw new Error("Invalid input type.")},cC=(t,e)=>{Og(t.inputs);let i=(n,s,o)=>{let l=[];for(let c=0;c<n.rank;c++)(o.indexOf(c)>=0||o.length===0)&&l.push(`input_indices[${c}] = 0;`);return[`${l.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${n.getByIndices("input_indices")} ${e.selectLastIndex>0?"<=":"<"} value) {
         value = ${n.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",s.setByOffset("global_idx","best_index")]};t.compute(Lf("ArgMin",{hint:e.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],i,[e.axis],7,e.keepDims),{inputs:[0]})},dC=(t,e)=>{Og(t.inputs);let i=(n,s,o)=>{let l=[];for(let c=0;c<n.rank;c++)(o.indexOf(c)>=0||o.length===0)&&l.push(`input_indices[${c}] = 0;`);return[`${l.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${n.getByIndices("input_indices")} ${e.selectLastIndex>0?">=":">"} value) {
         value = ${n.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",s.setByOffset("global_idx","best_index")]};t.compute(Lf("argMax",{hint:e.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],i,[e.axis],7,e.keepDims),{inputs:[0]})},W0=t=>Bt(t)}),X1,ff,K1,Y1,Q1,Kd,Z1,hC,Gy=Ue(()=>{at(),ht(),jy(),mt(),X1=(t,e)=>{let i=t[0],n=t[1],s=t[2],o=t[3],l=t[4],c=t[5];if(l&&c)throw new Error("Attention cannot have both past and attention_bias");if(i.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let h=i.dims[0],f=i.dims[1],m=i.dims[2];if(s.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(n.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(n.dims[0]!==m)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(s.dims[0]!==n.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let _=s.dims[0]/3,E=_,w=E;if(e.qkvHiddenSizes.length>0){if(e.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let B of e.qkvHiddenSizes)if(B%e.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");_=e.qkvHiddenSizes[0],E=e.qkvHiddenSizes[1],w=e.qkvHiddenSizes[2]}let A=f;if(_!==E)throw new Error("qkv_hidden_sizes first element should be same as the second");if(s.dims[0]!==_+E+w)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let C=0;if(l){if(E!==w)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(l.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(l.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(l.dims[1]!==h)throw new Error('Input "past" second dimension must be batch_size');if(l.dims[2]!==e.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(l.dims[4]!==E/e.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');e.pastPresentShareBuffer||(C=l.dims[3])}let M=A+C,O=-1,$=0;if(o)throw new Error("Mask not supported");if(l)throw new Error("past is not supported");if(c){if(c.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(c.dims[0]!==h||c.dims[1]!==e.numHeads||c.dims[2]!==f||c.dims[3]!==M)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:h,sequenceLength:f,pastSequenceLength:C,kvSequenceLength:A,totalSequenceLength:M,maxSequenceLength:O,inputHiddenSize:m,hiddenSize:_,vHiddenSize:w,headSize:Math.floor(_/e.numHeads),vHeadSize:Math.floor(w/e.numHeads),numHeads:e.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:e.maskFilterValue,maskType:$,scale:e.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},ff=(t,e,i)=>e&&t?`
      let total_sequence_length_input = u32(${e.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${t?.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${i?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,K1=(t,e,i,n,s,o,l,c)=>{let h=xi(l?1:o),f=64,m=o/h;m<f&&(f=32);let _=Math.ceil(o/h/f),E=[{type:12,data:e},{type:12,data:i},{type:12,data:n},{type:12,data:s},{type:12,data:m},{type:12,data:_}],w=en(t.dataType,h),A=On(1,h),C=["type"];l&&C.push("type"),c&&C.push("type");let M=O=>{let $=Xe("x",t.dataType,t.dims,h),B=[$],U=l?Re("seq_lens",l.dataType,l.dims):void 0;U&&B.push(U);let j=c?Re("total_sequence_length_input",c.dataType,c.dims):void 0;j&&B.push(j);let W=On(t.dataType),z=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${f}>;
  var<workgroup> thread_sum: array<f32, ${f}>;
  ${O.registerUniforms(z).declareVariables(...B)}
  ${O.mainStart([f,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${ff(U,j,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${f}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${l?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${A}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${A}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(h){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${h}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${f}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${A}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${A}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(h){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${h}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${f}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${$.type.value}(${W}(1.0) / ${W}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${A}(x[offset + i]);
        x[offset + i] = ${$.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${l?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${$.type.value}(${W}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${f};${w};${h}`,inputDependencies:C},getShaderSource:M,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:s,z:e*i},programUniforms:E})}},Y1=(t,e,i,n,s,o,l,c,h)=>{let f=l+o.kvSequenceLength,m=[o.batchSize,o.numHeads,o.sequenceLength,f],_=t>1&&n,E=o.kvNumHeads?o.kvNumHeads:o.numHeads,w=_?[o.batchSize,E,f,o.headSize]:void 0,A=o.nReps?o.nReps:1,C=o.scale===0?1/Math.sqrt(o.headSize):o.scale,M=xi(o.headSize),O=o.headSize/M,$=12,B={x:Math.ceil(f/$),y:Math.ceil(o.sequenceLength/$),z:o.batchSize*o.numHeads},U=[{type:12,data:o.sequenceLength},{type:12,data:O},{type:12,data:f},{type:12,data:o.numHeads},{type:12,data:o.headSize},{type:1,data:C},{type:12,data:l},{type:12,data:o.kvSequenceLength},{type:12,data:A}],j=_&&n&&Ae.size(n.dims)>0,W=["type","type"];j&&W.push("type"),s&&W.push("type"),c&&W.push("type"),h&&W.push("type");let z=[{dims:m,dataType:e.dataType,gpuDataType:0}];_&&z.push({dims:w,dataType:e.dataType,gpuDataType:0});let Y=L=>{let H=Re("q",e.dataType,e.dims,M),se=Re("key",i.dataType,i.dims,M),ae=[H,se];if(j){let ue=Re("past_key",n.dataType,n.dims,M);ae.push(ue)}s&&ae.push(Re("attention_bias",s.dataType,s.dims));let ce=c?Re("seq_lens",c.dataType,c.dims):void 0;ce&&ae.push(ce);let fe=h?Re("total_sequence_length_input",h.dataType,h.dims):void 0;fe&&ae.push(fe);let be=Xe("output",e.dataType,m),J=[be];_&&J.push(Xe("present_key",e.dataType,w,M));let ee=On(1,M),de=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${$}u;

  var<workgroup> tileQ: array<${H.type.storage}, ${$*$}>;
  var<workgroup> tileK: array<${H.type.storage}, ${$*$}>;
  ${L.registerUniforms(de).declareVariables(...ae,...J)}
  ${L.mainStart([$,$,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${A===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${A===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${ff(ce,fe,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${j&&_?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${_?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${ee}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${j&&_?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${_?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${ee}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(M){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${M}`)}})()};
        output[outputIdx] = ${be.type.value} (sum * uniforms.alpha) + ${s?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${M};${s!==void 0};${n!==void 0};${t}`,inputDependencies:W},getRunData:()=>({outputs:z,dispatchGroup:B,programUniforms:U}),getShaderSource:Y}},Q1=(t,e,i,n,s,o,l=void 0,c=void 0)=>{let h=o+s.kvSequenceLength,f=s.nReps?s.nReps:1,m=s.vHiddenSize*f,_=t>1&&n,E=s.kvNumHeads?s.kvNumHeads:s.numHeads,w=_?[s.batchSize,E,h,s.headSize]:void 0,A=[s.batchSize,s.sequenceLength,m],C=12,M={x:Math.ceil(s.vHeadSize/C),y:Math.ceil(s.sequenceLength/C),z:s.batchSize*s.numHeads},O=[{type:12,data:s.sequenceLength},{type:12,data:h},{type:12,data:s.vHeadSize},{type:12,data:s.numHeads},{type:12,data:s.headSize},{type:12,data:m},{type:12,data:o},{type:12,data:s.kvSequenceLength},{type:12,data:f}],$=_&&n&&Ae.size(n.dims)>0,B=["type","type"];$&&B.push("type"),l&&B.push("type"),c&&B.push("type");let U=[{dims:A,dataType:e.dataType,gpuDataType:0}];_&&U.push({dims:w,dataType:e.dataType,gpuDataType:0});let j=W=>{let z=Re("probs",e.dataType,e.dims),Y=Re("v",i.dataType,i.dims),L=[z,Y];$&&L.push(Re("past_value",n.dataType,n.dims));let H=l?Re("seq_lens",l.dataType,l.dims):void 0;l&&L.push(H);let se=c?Re("total_sequence_length_input",c.dataType,c.dims):void 0;c&&L.push(se);let ae=[Xe("output",e.dataType,A)];_&&ae.push(Xe("present_value",e.dataType,w));let ce=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${C}u;
  var<workgroup> tileQ: array<${z.type.value}, ${C*C}>;
  var<workgroup> tileV: array<${z.type.value}, ${C*C}>;
  ${W.registerUniforms(ce).declareVariables(...L,...ae)}
  ${W.mainStart([C,C,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${f===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${f===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${ff(H,se,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${$&&_?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${_?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${z.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${$&&_?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${_?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${n!==void 0};${t}`,inputDependencies:B},getRunData:()=>({outputs:U,dispatchGroup:M,programUniforms:O}),getShaderSource:j}},Kd=(t,e,i,n,s,o,l,c,h,f,m=void 0,_=void 0)=>{let E=Math.min(t.outputCount,1+(l?1:0)+(c?1:0)),w=E>1?f.pastSequenceLength:0,A=w+f.kvSequenceLength,C=h&&Ae.size(h.dims)>0?h:void 0,M=[e,i];E>1&&l&&Ae.size(l.dims)>0&&M.push(l),C&&M.push(C),m&&M.push(m),_&&M.push(_);let O=t.compute(Y1(E,e,i,l,C,f,w,m,_),{inputs:M,outputs:E>1?[-1,1]:[-1]})[0];t.compute(K1(O,f.batchSize,f.numHeads,w,f.sequenceLength,A,m,_),{inputs:m&&_?[O,m,_]:[O],outputs:[]});let $=[O,n];E>1&&c&&Ae.size(c.dims)>0&&$.push(c),m&&$.push(m),_&&$.push(_),t.compute(Q1(E,O,n,c,f,w,m,_),{inputs:$,outputs:E>1?[0,2]:[0]})},Z1=(t,e)=>{let i=[e.batchSize,e.numHeads,e.sequenceLength,e.headSize],n=e.sequenceLength,s=e.inputHiddenSize,o=e.headSize,l=12,c={x:Math.ceil(e.headSize/l),y:Math.ceil(e.sequenceLength/l),z:e.batchSize*e.numHeads},h=[t.inputs[0],t.inputs[1],t.inputs[2]],f=[{type:12,data:n},{type:12,data:s},{type:12,data:o},{type:12,data:e.numHeads},{type:12,data:e.headSize},{type:12,data:e.hiddenSize},{type:12,data:e.hiddenSize+e.hiddenSize+e.vHiddenSize}],m=_=>{let E=Xe("output_q",h[0].dataType,i),w=Xe("output_k",h[0].dataType,i),A=Xe("output_v",h[0].dataType,i),C=Re("input",h[0].dataType,h[0].dims),M=Re("weight",h[1].dataType,h[1].dims),O=Re("bias",h[2].dataType,h[2].dims),$=C.type.storage,B=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${l}u;
  var<workgroup> tileInput: array<${$}, ${l*l}>;
  var<workgroup> tileWeightQ: array<${$}, ${l*l}>;
  var<workgroup> tileWeightK: array<${$}, ${l*l}>;
  var<workgroup> tileWeightV: array<${$}, ${l*l}>;
  ${_.registerUniforms(B).declareVariables(C,M,O,E,w,A)}
  ${_.mainStart([l,l,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${$}(0);
    var valueK = ${$}(0);
    var valueV = ${$}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return t.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:i,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:i,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:i,dataType:t.inputs[0].dataType,gpuDataType:0}],dispatchGroup:c,programUniforms:f}),getShaderSource:m},{inputs:h,outputs:[-1,-1,-1]})},hC=(t,e)=>{let i=X1(t.inputs,e),[n,s,o]=Z1(t,i);return Kd(t,n,s,o,t.inputs[4],void 0,void 0,void 0,t.inputs[5],i)}}),J1,eT,tT,fC,PO=Ue(()=>{is(),at(),ht(),Ci(),mt(),J1=(t,e)=>{if(!t||t.length!==5)throw new Error("BatchNormalization requires 5 inputs");let i=(n,s,o)=>{let l=s.length;if(l!==n.length)throw new Error(`${o}: num dimensions != ${l}`);s.forEach((c,h)=>{if(c!==n[h])throw new Error(`${o}: dim[${h}] do not match`)})};if(t[0].dims.length>1){let n=e.format==="NHWC"?e.spatial?t[0].dims.slice(-1):t[0].dims.slice(-1).concat(t[0].dims.slice(1,t[0].dims.length-1)):t[0].dims.slice(1,e.spatial?2:void 0);i(t[1].dims,n,"Invalid input scale"),i(t[2].dims,n,"Invalid input B"),i(t[3].dims,n,"Invalid input mean"),i(t[4].dims,n,"Invalid input var")}else i(t[1].dims,[1],"Invalid input scale"),i(t[2].dims,[1],"Invalid input B"),i(t[3].dims,[1],"Invalid input mean"),i(t[4].dims,[1],"Invalid input var")},eT=(t,e)=>{let{epsilon:i,spatial:n,format:s}=e,o=t[0].dims,l=n?xi(o[o.length-1]):1,c=s==="NHWC"&&o.length>1?l:1,h=Ae.size(o)/l,f=n,m=f?o.length:o,_=Re("x",t[0].dataType,t[0].dims,l),E=Re("scale",t[1].dataType,t[1].dims,c),w=Re("bias",t[2].dataType,t[2].dims,c),A=Re("inputMean",t[3].dataType,t[3].dims,c),C=Re("inputVar",t[4].dataType,t[4].dims,c),M=Xe("y",t[0].dataType,m,l),O=()=>{let B="";if(n)B=`let cOffset = ${o.length===1?"0u":s==="NHWC"?`outputIndices[${o.length-1}] / ${l}`:"outputIndices[1]"};`;else if(s==="NCHW")B=`
            ${M.indicesSet("outputIndices","0","0")}
            let cOffset = ${M.indicesToOffset("outputIndices")};`;else{B=`var cIndices = ${E.type.indices}(0);
                       cIndices[0] = outputIndices[${o.length-1}];`;for(let U=1;U<E.rank;U++)B+=`cIndices[${U}] = outputIndices[${U}];`;B+=`let cOffset = ${E.indicesToOffset("cIndices")};`}return B},$=B=>`
  const epsilon = ${i};
  ${B.registerUniform("outputSize","u32").declareVariables(_,E,w,A,C,M)}
  ${B.mainStart()}
  ${B.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${M.offsetToIndices(`global_idx * ${l}`)};
    ${O()}
    let scale = ${E.getByOffset("cOffset")};
    let bias = ${w.getByOffset("cOffset")};
    let inputMean = ${A.getByOffset("cOffset")};
    let inputVar = ${C.getByOffset("cOffset")};
    let x = ${_.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${M.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${e.epsilon}_${e.format}_${n}_${l}`,inputDependencies:f?["rank","type","type","type","type"]:void 0},getShaderSource:$,getRunData:()=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:f?[{type:12,data:h},...Ze(o)]:[{type:12,data:h}]})}},tT=t=>Bt(t),fC=(t,e)=>{let{inputs:i,outputCount:n}=t,s=tT({...e,outputCount:n});if(ui.webgpu.validateInputContent&&J1(i,s),e.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");t.compute(eT(i,s))}}),iT,nT,pC,zO=Ue(()=>{ht(),mt(),iT=t=>{if(t[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(t[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(t[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw new Error("last dimension of input and bias are not the same")},nT=t=>{let e=t[0].dims,i=t[0].dims[2],n=Ae.size(e)/4,s=t[0].dataType,o=Re("input",s,e,4),l=Re("bias",s,[i],4),c=Re("residual",s,e,4),h=Xe("output",s,e,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:e,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(n/64)}}),getShaderSource:f=>`
  const channels = ${i}u / 4;
  ${f.declareVariables(o,l,c,h)}

  ${f.mainStart()}
    ${f.guardAgainstOutOfBoundsWorkgroupSizes(n)}
    let value = ${o.getByOffset("global_idx")}
      + ${l.getByOffset("global_idx % channels")} + ${c.getByOffset("global_idx")};
    ${h.setByOffset("global_idx","value")}
  }`}},pC=t=>{iT(t.inputs),t.compute(nT(t.inputs))}}),rT,Mt,mC,gC,yC,_C,vC,bC,TC,xC,SC,sT,wC,EC,CC,AC,Bd,DC,Df,kC,$C,OC,IC,RC,MC,NC,BC,LC,UC,PC,zC,FC,qC,jC,HC,Ig,VC,X0,K0,GC,WC,XC,aT,oT,KC,Wy=Ue(()=>{at(),ht(),Ci(),mt(),rT=(t,e,i,n,s,o,l)=>{let c=Math.ceil(e/4),h="";typeof s=="string"?h=`${s}(a)`:h=s("a");let f=Re("inputData",i,[c],4),m=Xe("outputData",n,[c],4),_=[{name:"vec_size",type:"u32"}];return l&&_.push(...l),`
      ${t.registerUniforms(_).declareVariables(f,m)}

  ${o??""}

  ${t.mainStart()}
    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${f.getByOffset("global_idx")};
    ${m.setByOffset("global_idx",h)}
  }`},Mt=(t,e,i,n,s,o=t.dataType,l,c)=>{let h=[{type:12,data:Math.ceil(Ae.size(t.dims)/4)}];return l&&h.push(...l),{name:e,shaderCache:{hint:s,inputDependencies:["type"]},getShaderSource:f=>rT(f,Ae.size(t.dims),t.dataType,o,i,n,c),getRunData:f=>({outputs:[{dims:t.dims,dataType:o}],dispatchGroup:{x:Math.ceil(Ae.size(f[0].dims)/64/4)},programUniforms:h})}},mC=t=>{t.compute(Mt(t.inputs[0],"Abs","abs"))},gC=t=>{t.compute(Mt(t.inputs[0],"Acos","acos"))},yC=t=>{t.compute(Mt(t.inputs[0],"Acosh","acosh"))},_C=t=>{t.compute(Mt(t.inputs[0],"Asin","asin"))},vC=t=>{t.compute(Mt(t.inputs[0],"Asinh","asinh"))},bC=t=>{t.compute(Mt(t.inputs[0],"Atan","atan"))},TC=t=>{t.compute(Mt(t.inputs[0],"Atanh","atanh"))},xC=t=>Bt(t),SC=(t,e)=>{let i;switch(e.to){case 10:i="vec4<f16>";break;case 1:i="vec4<f32>";break;case 12:i="vec4<u32>";break;case 6:i="vec4<i32>";break;case 9:i="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${e.to}`)}t.compute(Mt(t.inputs[0],"Cast",i,void 0,e.cacheKey,e.to))},sT=t=>{let e,i,n=t.length>=2&&t[1].data!==0,s=t.length>=3&&t[2].data!==0;switch(t[0].dataType){case 1:e=n?t[1].getFloat32Array()[0]:-34028234663852886e22,i=s?t[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:e=n?t[1].getUint16Array()[0]:64511,i=s?t[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return Bt({min:e,max:i})},wC=(t,e)=>{let i=e||sT(t.inputs),n=On(t.inputs[0].dataType);t.compute(Mt(t.inputs[0],"Clip",s=>`clamp(${s}, vec4<${n}>(uniforms.min), vec4<${n}>(uniforms.max))`,void 0,i.cacheKey,void 0,[{type:t.inputs[0].dataType,data:i.min},{type:t.inputs[0].dataType,data:i.max}],[{name:"min",type:n},{name:"max",type:n}]),{inputs:[0]})},EC=t=>{t.compute(Mt(t.inputs[0],"Ceil","ceil"))},CC=t=>{t.compute(Mt(t.inputs[0],"Cos","cos"))},AC=t=>{t.compute(Mt(t.inputs[0],"Cosh","cosh"))},Bd=t=>Bt(t),DC=(t,e)=>{let i=On(t.inputs[0].dataType);t.compute(Mt(t.inputs[0],"Elu",n=>`elu_vf32(${n})`,`
  const elu_alpha_ = ${i}(${e.alpha});

  fn elu_f32(a: ${i}) -> ${i} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${i}>) -> vec4<${i}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,e.cacheKey))},Df=(t="f32")=>`
const r0: ${t} = 0.3275911;
const r1: ${t} = 0.254829592;
const r2: ${t} = -0.284496736;
const r3: ${t} = 1.421413741;
const r4: ${t} = -1.453152027;
const r5: ${t} = 1.061405429;

fn erf_vf32(v: vec4<${t}>) -> vec4<${t}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,kC=t=>{let e=On(t.inputs[0].dataType);t.compute(Mt(t.inputs[0],"Erf",i=>`erf_vf32(${i})`,Df(e)))},$C=t=>{t.compute(Mt(t.inputs[0],"Exp","exp"))},OC=t=>{t.compute(Mt(t.inputs[0],"Floor","floor"))},IC=t=>{let e=On(t.inputs[0].dataType);t.compute(Mt(t.inputs[0],"Gelu",i=>`0.5 * ${i} * (1.0 + erf_vf32(${i} * 0.7071067811865475))`,Df(e)))},RC=(t,e)=>{let i=On(t.inputs[0].dataType);t.compute(Mt(t.inputs[0],"LeakyRelu",n=>`select(leaky_relu_alpha_ * ${n}, ${n}, ${n} >= vec4<${i}>(0.0))`,`const leaky_relu_alpha_ = ${i}(${e.alpha});`,e.cacheKey))},MC=t=>{t.compute(Mt(t.inputs[0],"Not",e=>`!${e}`))},NC=t=>{t.compute(Mt(t.inputs[0],"Neg",e=>`-${e}`))},BC=t=>{t.compute(Mt(t.inputs[0],"Reciprocal",e=>`1.0/${e}`))},LC=t=>{let e=On(t.inputs[0].dataType);t.compute(Mt(t.inputs[0],"Relu",i=>`select(vec4<${e}>(0.0), ${i}, ${i} > vec4<${e}>(0.0))`))},UC=t=>{t.compute(Mt(t.inputs[0],"Sigmoid",e=>`(1.0 / (1.0 + exp(-${e})))`))},PC=t=>Bt(t),zC=(t,e)=>{let i=On(t.inputs[0].dataType);t.compute(Mt(t.inputs[0],"HardSigmoid",n=>`max(vec4<${i}>(0.0), min(vec4<${i}>(1.0), ${e.alpha} * ${n} + vec4<${i}>(${e.beta})))`,void 0,e.cacheKey))},FC=t=>{t.compute(Mt(t.inputs[0],"Sin","sin"))},qC=t=>{t.compute(Mt(t.inputs[0],"Sinh","sinh"))},jC=t=>{t.compute(Mt(t.inputs[0],"Sqrt","sqrt"))},HC=t=>{t.compute(Mt(t.inputs[0],"Tan","tan"))},Ig=t=>`sign(${t}) * (1 - exp(-2 * abs(${t}))) / (1 + exp(-2 * abs(${t})))`,VC=t=>{t.compute(Mt(t.inputs[0],"Tanh",Ig))},X0=(t="f32")=>`
const fast_gelu_a: ${t} = 0.5;
const fast_gelu_b: ${t} = 0.7978845608028654;
const fast_gelu_c: ${t} = 0.035677408136300125;

fn tanh_v(v: vec4<${t}>) -> vec4<${t}> {
  return ${Ig("v")};
}
`,K0=t=>`(fast_gelu_a + fast_gelu_a * tanh_v(${t} * (fast_gelu_c * ${t} * ${t} + fast_gelu_b))) * ${t}`,GC=t=>{let e=On(t.inputs[0].dataType);t.compute(Mt(t.inputs[0],"FastGelu",K0,X0(e),void 0,t.inputs[0].dataType))},WC=(t,e)=>{let i=On(t.inputs[0].dataType);return t.compute(Mt(t.inputs[0],"ThresholdedRelu",n=>`select(vec4<${i}>(0.0), ${n}, ${n} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${i}>(${e.alpha});`,e.cacheKey)),0},XC=t=>{t.compute(Mt(t.inputs[0],"Log","log"))},aT=(t,e)=>`
const alpha = vec4<${t}>(${e});
const one = ${t}(1.0);
const zero = ${t}(0.0);

fn quick_gelu_impl(x: vec4<${t}>) -> vec4<${t}> {
  let v = x *alpha;
  var x1 : vec4<${t}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,oT=t=>`quick_gelu_impl(${t})`,KC=(t,e)=>{let i=On(t.inputs[0].dataType);t.compute(Mt(t.inputs[0],"QuickGelu",oT,aT(i,e.alpha),e.cacheKey,t.inputs[0].dataType))}}),lT,uT,YC,FO=Ue(()=>{ht(),mt(),Wy(),lT=t=>{if(t[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(t[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(t[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw new Error("last dimension of input and bias are not the same")},uT=t=>{let e=t[0].dims.slice();e[2]=e[2]/2;let i=Re("input",t[0].dataType,t[0].dims,4),n=Re("bias",t[0].dataType,[t[0].dims[2]],4),s=Xe("output",t[0].dataType,e,4),o=Ae.size(e)/4,l=en(t[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:e,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)}}),getShaderSource:c=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${t[0].dims[2]/4/2}u;

  ${c.declareVariables(i,n,s)}

  ${Df(l)}

  ${c.mainStart()}
    ${c.guardAgainstOutOfBoundsWorkgroupSizes(o)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${s.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},YC=t=>{lT(t.inputs),t.compute(uT(t.inputs))}}),cT,dT,As,QC,ZC,JC,eA,tA,iA,nA,rA,sA,aA,qO=Ue(()=>{at(),ht(),mt(),cT=(t,e,i,n,s,o,l,c,h,f,m,_)=>{let E,w;typeof c=="string"?E=w=($,B)=>`${c}((${$}),(${B}))`:typeof c=="function"?E=w=c:(E=c.scalar,w=c.vector);let A=Xe("outputData",m,n.length,4),C=Re("aData",h,e.length,4),M=Re("bData",f,i.length,4),O;if(s)if(o){let $=Ae.size(e)===1,B=Ae.size(i)===1,U=e.length>0&&e[e.length-1]%4===0,j=i.length>0&&i[i.length-1]%4===0;$||B?O=A.setByOffset("global_idx",w($?`${C.type.value}(${C.getByOffset("0")}.x)`:C.getByOffset("global_idx"),B?`${M.type.value}(${M.getByOffset("0")}.x)`:M.getByOffset("global_idx"))):O=`
            let outputIndices = ${A.offsetToIndices("global_idx * 4u")};
            let offsetA = ${C.broadcastedIndicesToOffset("outputIndices",A)};
            let offsetB = ${M.broadcastedIndicesToOffset("outputIndices",A)};
            ${A.setByOffset("global_idx",w(l||U?C.getByOffset("offsetA / 4u"):`${C.type.value}(${C.getByOffset("offsetA / 4u")}[offsetA % 4u])`,l||j?M.getByOffset("offsetB / 4u"):`${M.type.value}(${M.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else O=A.setByOffset("global_idx",w(C.getByOffset("global_idx"),M.getByOffset("global_idx")));else{if(!o)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let $=(B,U,j="")=>{let W=`aData[indexA${U}][componentA${U}]`,z=`bData[indexB${U}][componentB${U}]`;return`
            let outputIndices${U} = ${A.offsetToIndices(`global_idx * 4u + ${U}u`)};
            let offsetA${U} = ${C.broadcastedIndicesToOffset(`outputIndices${U}`,A)};
            let offsetB${U} = ${M.broadcastedIndicesToOffset(`outputIndices${U}`,A)};
            let indexA${U} = offsetA${U} / 4u;
            let indexB${U} = offsetB${U} / 4u;
            let componentA${U} = offsetA${U} % 4u;
            let componentB${U} = offsetB${U} % 4u;
            ${B}[${U}] = ${j}(${E(W,z)});
          `};m===9?O=`
            var data = vec4<u32>(0);
            ${$("data",0,"u32")}
            ${$("data",1,"u32")}
            ${$("data",2,"u32")}
            ${$("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:O=`
            ${$("outputData[global_idx]",0)}
            ${$("outputData[global_idx]",1)}
            ${$("outputData[global_idx]",2)}
            ${$("outputData[global_idx]",3)}
          `}return`
        ${t.registerUniform("vec_size","u32").declareVariables(C,M,A)}

        ${_??""}

        ${t.mainStart()}
        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${O}
      }`},dT=(t,e,i,n,s,o,l=i.dataType)=>{let c=i.dims.map(C=>Number(C)??1),h=n.dims.map(C=>Number(C)??1),f=!Ae.areEqual(c,h),m=c,_=Ae.size(c),E=!1,w=!1,A=[f];if(f){let C=oc.calcShape(c,h,!1);if(!C)throw new Error("Can't perform binary op on the given tensors");m=C.slice(),_=Ae.size(m);let M=Ae.size(c)===1,O=Ae.size(h)===1,$=c.length>0&&c[c.length-1]%4===0,B=h.length>0&&h[h.length-1]%4===0;A.push(M),A.push(O),A.push($),A.push(B);let U=1;for(let j=1;j<m.length;j++){let W=c[c.length-j],z=h[h.length-j];if(W===z)U*=W;else break}U%4===0?(w=!0,E=!0):(M||O||$||B)&&(E=!0)}else E=!0;return A.push(E),{name:t,shaderCache:{hint:e+A.map(C=>C.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:C=>cT(C,c,h,m,E,f,w,s,i.dataType,n.dataType,l,o),getRunData:()=>({outputs:[{dims:m,dataType:l}],dispatchGroup:{x:Math.ceil(_/64/4)},programUniforms:[{type:12,data:Math.ceil(Ae.size(m)/4)},...Ze(c,h,m)]})}},As=(t,e,i,n,s,o)=>{t.compute(dT(e,s??"",t.inputs[0],t.inputs[1],i,n,o))},QC=t=>{As(t,"Add",(e,i)=>`${e}+${i}`)},ZC=t=>{As(t,"Div",(e,i)=>`${e}/${i}`)},JC=t=>{As(t,"Equal",{scalar:(e,i)=>`u32(${e}==${i})`,vector:(e,i)=>`vec4<u32>(${e}==${i})`},void 0,void 0,9)},eA=t=>{As(t,"Mul",(e,i)=>`${e}*${i}`)},tA=t=>{let e=Re("input",t.inputs[0].dataType,t.inputs[0].dims).type.value;As(t,"Pow",{scalar:(i,n)=>`pow_custom(${i},${n})`,vector:(i,n)=>`pow_vector_custom(${i},${n})`},`
    fn pow_custom(a : ${e}, b : ${e}) -> ${e} {
      if (b == ${e}(0.0)) {
        return ${e}(1.0);
      } else if (a < ${e}(0.0) && f32(b) != floor(f32(b))) {
        return ${e}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${e}(1.0), round(f32(abs(b) % ${e}(2.0))) != 1.0) * ${e}(${e==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${e}>, b : vec4<${e}>) -> vec4<${e}> {
      // TODO: implement vectorized pow
      return vec4<${e}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},iA=t=>{As(t,"Sub",(e,i)=>`${e}-${i}`)},nA=t=>{As(t,"Greater",{scalar:(e,i)=>`u32(${e}>${i})`,vector:(e,i)=>`vec4<u32>(${e}>${i})`},void 0,void 0,9)},rA=t=>{As(t,"Less",{scalar:(e,i)=>`u32(${e}<${i})`,vector:(e,i)=>`vec4<u32>(${e}<${i})`},void 0,void 0,9)},sA=t=>{As(t,"GreaterOrEqual",{scalar:(e,i)=>`u32(${e}>=${i})`,vector:(e,i)=>`vec4<u32>(${e}>=${i})`},void 0,void 0,9)},aA=t=>{As(t,"LessOrEqual",{scalar:(e,i)=>`u32(${e}<=${i})`,vector:(e,i)=>`vec4<u32>(${e}<=${i})`},void 0,void 0,9)}}),hT,fT,pT,mT,oA,lA,jO=Ue(()=>{at(),ht(),Ci(),mt(),hT=(t,e)=>{if(!t||t.length<1)throw new Error("too few inputs");let i=0,n=t[i],s=n.dataType,o=n.dims.length;t.forEach((l,c)=>{if(c!==i){if(l.dataType!==s)throw new Error("input tensors should be one type");if(l.dims.length!==o)throw new Error("input tensors should have the same shape");l.dims.forEach((h,f)=>{if(f!==e&&h!==n.dims[f])throw new Error("non concat dimensions must match")})}})},fT=(t,e)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${t}u>(${e});
    for (var i: u32 = 0u; i < ${t}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${t}u;
  }`,pT=(t,e)=>{let i=t.length,n=[];for(let s=0;s<i;++s){let o=e.setByOffset("global_idx",t[s].getByIndices("indices"));i===1?n.push(o):s===0?n.push(`if (inputIndex == ${s}u) { ${o} }`):s===i-1?n.push(`else { ${o} }`):n.push(`else if (inputIndex == ${s}) { ${o} }`)}return n.join(`
`)},mT=(t,e,i,n)=>{let s=Ae.size(i),o=new Array(t.length),l=new Array(t.length),c=0,h=[],f=[],m=[{type:12,data:s}];for(let C=0;C<t.length;++C)c+=t[C].dims[e],o[C]=c,f.push(t[C].dims.length),l[C]=Re(`input${C}`,n,f[C]),h.push("rank"),m.push({type:12,data:o[C]});for(let C=0;C<t.length;++C)m.push(...Ze(t[C].dims));m.push(...Ze(i));let _=Xe("output",n,i.length),E=_.indicesGet("indices",e),w=Array.from(Array(o.length).keys()).map(C=>`uniforms.sizeInConcatAxis${C}`).join(","),A=C=>`

  ${(()=>{C.registerUniform("outputSize","u32");for(let M=0;M<t.length;M++)C.registerUniform(`sizeInConcatAxis${M}`,"u32");return C.declareVariables(...l,_)})()}

  ${fT(o.length,w)}

  ${C.mainStart()}
    ${C.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${_.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${E});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${o.length}u>(${w});
      ${E} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${pT(l,_)}
  }`;return{name:"Concat",shaderCache:{hint:`${e}`,inputDependencies:h},getRunData:()=>({outputs:[{dims:i,dataType:n}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:m}),getShaderSource:A}},oA=(t,e)=>{let i=t.inputs,n=i[0].dims,s=Ae.normalizeAxis(e.axis,n.length);hT(i,s);let o=n.slice();o[s]=i.reduce((c,h)=>c+(h.dims.length>s?h.dims[s]:0),0);let l=i.filter(c=>Ae.size(c.dims)>0);t.compute(mT(l,s,o,i[0].dataType),{inputs:l})},lA=t=>Bt({axis:t.axis})}),eu,tu,iu,Xy,au=Ue(()=>{at(),ht(),eu=(t,e,i="f32")=>{switch(t.activation){case"Relu":return`value = max(value, ${e}(0.0));`;case"Sigmoid":return`value = (${e}(1.0) / (${e}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${e}(${i}(uniforms.clip_min)), ${e}(${i}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${e}(0.0), min(${e}(1.0), ${i}(uniforms.alpha) * value + ${i}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${i}(uniforms.alpha) * value, value, value >= ${e}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${t.activation}`)}},tu=(t,e)=>{t.activation==="Clip"?e.push({type:1,data:t.clipMax},{type:1,data:t.clipMin}):t.activation==="HardSigmoid"?e.push({type:1,data:t.alpha},{type:1,data:t.beta}):t.activation==="LeakyRelu"&&e.push({type:1,data:t.alpha})},iu=(t,e)=>{t.activation==="Clip"?e.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):t.activation==="HardSigmoid"?e.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):t.activation==="LeakyRelu"&&e.push({name:"alpha",type:"f32"})},Xy=t=>{let e=t?.activation||"";if(e==="HardSigmoid"){let[i,n]=t?.activation_params||[.2,.5];return{activation:e,alpha:i,beta:n}}else if(e==="Clip"){let[i,n]=t?.activation_params||[ME,NE];return{activation:e,clipMax:n,clipMin:i}}else if(e==="LeakyRelu"){let[i]=t?.activation_params||[.01];return{activation:e,alpha:i}}return{activation:e}}}),dn,uA,Ky=Ue(()=>{dn=(t,e)=>{switch(t){case 1:return e;case 2:return`vec2<${e}>`;case 3:return`vec3<${e}>`;case 4:return`vec4<${e}>`;default:throw new Error(`${t}-component is not supported.`)}},uA=t=>`
      ${t?"value = value + getBiasByOutputCoords(coords);":""}
      `}),cA,HO=Ue(()=>{cA=t=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${t}.x), i32(${t}.y), i32(${t}.z), 1));
}
`}),Fd,Yy,Qy=Ue(()=>{at(),ht(),mt(),au(),Fd=(t,e,i,n,s)=>{let o=n-i;return`
      ${Array.from({length:i}).map((l,c)=>`
      if (${Ye(e.shape,c,e.rank)} != 1) {
        ${e.indicesSet(t,c,Ye(s,c+o,n))}
      } else {
        ${e.indicesSet(t,c,0)}
      }`).join("")}
`},Yy=(t,e,i,n,s=!1,o)=>{let l=t[0].dims,c=t[1].dims,h=l[l.length-2],f=c[c.length-1],m=l[l.length-1],_=xi(f),E=xi(m),w=xi(h),A=Ae.size(i)/_/w,C=t.length>2,M=n?n.slice(0,-2):i.slice(0,-2),O=[Ae.size(M),h,f],$=[{type:12,data:A},{type:12,data:h},{type:12,data:f},{type:12,data:m}];tu(e,$),$.push(...Ze(M,l,c)),C&&$.push(...Ze(t[2].dims)),$.push(...Ze(O));let B=U=>{let j=Hy("batch_dims",t[0].dataType,M.length),W=Re("a",t[0].dataType,l.length,E),z=Re("b",t[1].dataType,c.length,_),Y=Xe("output",t[0].dataType,O.length,_),L=en(Y.type.tensor),H=eu(e,Y.type.value,L),se=[W,z],ae="";if(C){let be=s?_:1;se.push(Re("bias",t[2].dataType,t[2].dims.length,be)),ae=`${s?`value += bias[col / ${be}];`:`value += ${Y.type.value}(bias[row + i]);`}`}let ce=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];iu(e,ce);let fe=()=>{let be=`var a_data: ${W.type.value};`;for(let J=0;J<E;J++)be+=`
              let b_data${J} = b[(b_offset + (k + ${J}) * uniforms.N + col) / ${_}];`;for(let J=0;J<w;J++){be+=`a_data = a[(a_offset + (row + ${J}) * uniforms.K + k) / ${E}];`;for(let ee=0;ee<E;ee++)be+=`
            values[${J}] = fma(${z.type.value}(a_data${E===1?"":`[${ee}]`}), b_data${ee}, values[${J}]);
`}return be};return`
  ${U.registerUniforms(ce).registerInternalVariables(j).declareVariables(...se,Y)}
  ${U.mainStart()}
    ${U.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${_})) * ${_};
    var index1 = global_idx / (uniforms.N / ${_});
    let stride1 = uniforms.M / ${w};
    let row = (index1 % stride1) * ${w};
    let batch = index1 / stride1;

    ${i.length===2?"":`let batch_indices = ${j.offsetToIndices("batch")};`}

    var a_indices: ${W.type.indices};
    ${Fd("a_indices",W,W.rank-2,j.rank,"batch_indices")}
    ${W.indicesSet("a_indices",W.rank-2,0)}
    ${W.indicesSet("a_indices",W.rank-1,0)}
    let a_offset = ${W.indicesToOffset("a_indices")};

    var b_indices: ${z.type.indices};
    ${Fd("b_indices",z,z.rank-2,j.rank,"batch_indices")}
    ${z.indicesSet("b_indices",z.rank-2,0)}
    ${z.indicesSet("b_indices",z.rank-1,0)}
    let b_offset = ${z.indicesToOffset("b_indices")};
    var values: array<${Y.type.value}, ${w}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${E}) {
      ${fe()}
    }
    for (var i = 0u; i < ${w}u; i++) {
      var value = values[i];
      ${ae}
      ${H}
      let cur_indices = ${Y.type.indices}(batch, row + i, col);
      let offset = ${Y.indicesToOffset("cur_indices")};
      ${Y.setByOffset(`offset / ${_}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${e.activation};${_};${E};${w};${s}`,inputDependencies:C?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:o?o(i):i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(A/64)},programUniforms:$}),getShaderSource:B}}}),gT,yT,Y0,Rg,_T,Q0,vT,Uf,Zy=Ue(()=>{at(),ht(),mt(),au(),Qy(),Ky(),gT=(t,e)=>t?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${e?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${e?", batchIndices":""});
        `,yT=(t,e)=>t?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${e===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${e===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${e===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,Y0=(t,e,i="f32",n,s=!1,o=32,l=!1,c=32)=>{let h=e[1]*t[1],f=e[0]*t[0],m=s?h:o,_=s?o:h,E=m/e[0],w=o/e[1];if(!((s&&E===4&&t[1]===4||!s&&(E===3||E===4))&&m%e[0]===0&&o%e[1]===0&&t[0]===4))throw new Error(`If transposeA ${s} is true, innerElementSize ${E} and workPerThread[1] ${t[1]} must be 4.
      Otherwise, innerElementSize ${E} must be 3 or 4.
  tileAWidth ${m} must be divisible by workgroupSize[0]${e[0]}. tileInner ${o} must be divisible by workgroupSize[1] ${e[1]}. colPerThread ${t[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${E}<${i}>, ${m/E}>, ${_}>;
var<workgroup> mm_Bsub: array<array<vec4<${i}>, ${f/t[0]}>, ${o}>;

const rowPerThread = ${t[1]};
const colPerThread = ${t[0]};
const innerElementSize = ${E};
const tileInner = ${o};

@compute @workgroup_size(${e[0]}, ${e[1]}, ${e[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${l?"0":"i32(globalId.z)"};
  ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${h};

  let num_tiles = ${l?`${Math.ceil(c/o)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${l?`i32(globalId.z) * ${c}`:"0"};

  var acc: array<vec4<${i}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${w};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${gT(s,n)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${w}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${n?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${E===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${yT(s,E)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},Rg=(t,e)=>t?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${e?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${e?", batchIndices":""});
            `,_T=t=>t?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",Q0=(t,e,i="f32",n,s=!1,o=32,l=!1,c=32,h=!1)=>{let f=t[1]*e[1],m=t[0]*e[0],_=s?f:o,E=s?o:f;if(!(E%e[1]===0&&_%e[0]===0&&o%e[1]===0))throw new Error(`tileAHight ${E} must be divisible by workgroupSize[1]${e[1]}, tileAWidth ${_} must be divisible by workgroupSize[0]${e[0]}, tileInner ${o} must be divisible by workgroupSize[1]${e[1]}`);let w=E/e[1],A=_/e[0],C=o/e[1],M=h?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${f};
    let globalColStart = i32(workgroupId.x) * ${m};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${E}; inputRow = inputRow + ${e[1]}) {
        for (var inputCol = localCol; inputCol < ${_}; inputCol = inputCol + ${e[0]}) {
          ${Rg(s,n)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${o}; inputRow = inputRow + ${e[1]}) {
            for (var inputCol = localCol; inputCol < ${m}; inputCol = inputCol + ${e[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${n?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${i}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${e[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${s?`mm_Asub[k][localRow + innerRow * ${e[1]}];`:`mm_Asub[localRow + innerRow * ${e[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${e[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${e[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${f};

let tileRowA = i32(localId.y) * ${w};
let tileColA = i32(localId.x) * ${A};
let tileRowB = i32(localId.y) * ${C};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${w}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${A}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${Rg(s,n)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${C}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${n?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${i}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${_T(s)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${i}, ${_}>, ${E}>;
  var<workgroup> mm_Bsub : array<array<${i}, ${m}>, ${o}>;
  const rowPerThread = ${t[1]};
  const colPerThread = ${t[0]};
  const tileInner = ${o};

@compute @workgroup_size(${e[0]}, ${e[1]}, ${e[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${l?"0":"i32(globalId.z)"};
    ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${l?`${Math.ceil(c/o)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${l?`i32(globalId.z) * ${c}`:"0"};

    var acc : array<array<${i}, colPerThread>, rowPerThread>;
    ${M}
  }
`},vT=(t,e,i,n,s=!1)=>{let[o,l,c,h]=n,f=en(n[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${o.type.indices}) -> ${dn(t,f)} {
      var value = ${dn(t,f)}(0.0);
      let col = colIn * ${t};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${l.type.indices};
        ${Fd("aIndices",l,l.rank-2,o.rank,"batchIndices")}
        ${l.indicesSet("aIndices",l.rank-2,"u32(row)")}
        ${l.indicesSet("aIndices",l.rank-1,"u32(colIn)")}
        value = ${l.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${o.type.indices}) -> ${dn(t,f)} {
      var value = ${dn(t,f)}(0.0);
      let col = colIn * ${t};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${c.type.indices};
        ${Fd("bIndices",c,c.rank-2,o.rank,"batchIndices")}
        ${c.indicesSet("bIndices",c.rank-2,"u32(row)")}
        ${c.indicesSet("bIndices",c.rank-1,"u32(colIn)")}
        value = ${c.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${dn(t,f)}) {
      let col = colIn * ${t};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${e?`value = value + ${s?"bias[colIn]":`${dn(t,f)}(bias[row])`};`:""}
        ${i}
        ${h.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},Uf=(t,e,i,n,s=!1,o)=>{let l=t[0].dims,c=t[1].dims,h=l.slice(0,-2),f=c.slice(0,-2),m=n?n.slice(0,-2):i.slice(0,-2),_=Ae.size(m),E=l[l.length-2],w=l[l.length-1],A=c[c.length-1],C=w%4===0&&A%4===0,M=E<=8?[4,1,1]:[4,4,1],O=[8,8,1],$=[Math.ceil(A/O[0]/M[0]),Math.ceil(E/O[1]/M[1]),Math.ceil(_/O[2]/M[2])],B=C?4:1,U=[...h,E,w/B],j=U.length,W=[...f,w,A/B],z=W.length,Y=[_,E,A/B],L=[{type:6,data:E},{type:6,data:A},{type:6,data:w}];tu(e,L),L.push(...Ze(m,U,W));let H=["rank","rank"],se=t.length>2;se&&(L.push(...Ze(t[2].dims)),H.push("rank")),L.push(...Ze(Y));let ae=ce=>{let fe=m.length,be=Hy("batchDims",t[0].dataType,fe,1),J=en(t[0].dataType),ee=Re("a",t[0].dataType,j,B),de=Re("b",t[1].dataType,z,B),ue=Xe("result",t[0].dataType,Y.length,B),ve=[ee,de];if(se){let le=s?B:1;ve.push(Re("bias",t[2].dataType,t[2].dims.length,le))}let P=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];iu(e,P);let ne=en(ue.type.tensor),ye=eu(e,ue.type.value,ne),ke=vT(B,se,ye,[be,ee,de,ue],s);return`
  ${ce.registerUniforms(P).registerInternalVariables(be).declareVariables(...ve,ue)}
  ${ke}
  ${C?Y0(M,O,J,be):Q0(M,O,J,be)}
                   `};return{name:"MatMul",shaderCache:{hint:`${M};${e.activation};${C};${s}`,inputDependencies:H},getRunData:()=>({outputs:[{dims:o?o(i):i,dataType:t[0].dataType}],dispatchGroup:{x:$[0],y:$[1],z:$[2]},programUniforms:L}),getShaderSource:ae}}}),bT,dA,VO=Ue(()=>{at(),to(),mt(),au(),Ky(),HO(),Zy(),bT=(t,e,i,n,s=!1,o,l=4,c=4,h=4,f="f32")=>{let m=L=>{switch(L){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${f}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${L} is not supported.`)}},_=L=>{switch(L){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${L} is not supported.`)}},E=t?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,w=t?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,A=t?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",C=t?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",M=t?"row":"col",O=t?"col":"row",$=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${M} / outWidth;
    let outCol = ${M} % outWidth;

    let WRow = ${O} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${O} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${O} % inChannels;
    var resData = ${dn(l,f)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${A} && xCol >= 0 && xCol < ${C}) {
      ${E}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${m(l)}
    }
    return resData;`,B=t?e&&n?`
    let col = colIn * ${l};
    ${$}`:`
    let col = colIn * ${l};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${$}
    }
    return ${dn(l,f)}(0.0);`:n&&i?`
    let col = colIn * ${l};
    ${$}`:`
    let col = colIn * ${l};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${$}
    }
    return ${dn(l,f)}(0.0);`,U=t?n&&i?_(c):`
    let col = colIn * ${c};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${_(c)}
    }
    return ${dn(c,f)}(0.0);`:`
    let col = colIn * ${c};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${_(c)}
    }
    return ${dn(c,f)}(0.0);`,j=dn(h,f),W=dn(t?l:c,f),z=dn(t?c:l,f),Y=eu(o,j,f);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${W} {
      ${t?B:U}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${z} {
      ${t?U:B}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${j}) {
      let col = colIn * ${h};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${w}
      ${uA(s)}
      ${Y}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},dA=(t,e,i,n,s,o,l,c,h)=>{let f=e.format==="NHWC",m=f?t[0].dims[3]:t[0].dims[1],_=i[0],E=f?i[2]:i[3],w=f?i[1]:i[2],A=f?i[3]:i[1],C=f&&(m%4===0||m%3===0)&&A%4===0,M=f?A:E*w,O=f?E*w:A,$=[8,8,1],B=n<=8?[4,1,1]:[4,4,1],U=[Math.ceil(M/$[0]/B[0]),Math.ceil(O/$[1]/B[1]),Math.ceil(_/$[2]/B[2])];At("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${U}`);let j=C?f&&m%4!==0?3:4:1,W=$[1]*B[1],z=$[0]*B[0],Y=Math.max($[0]*j,$[1]),L=n%W===0,H=s%z===0,se=o%Y===0,ae=C?[j,4,4]:[1,1,1],ce=[{type:6,data:n},{type:6,data:s},{type:6,data:o},{type:6,data:[e.pads[0],e.pads[1]]},{type:6,data:e.strides},{type:6,data:e.dilations}];tu(e,ce),ce.push(...Ze(t[0].dims,t[1].dims));let fe=["rank","rank"];l&&(ce.push(...Ze(t[2].dims)),fe.push("rank")),ce.push(...Ze(i));let be=J=>{let ee=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];iu(e,ee);let de=C?4:1,ue=en(t[0].dataType),ve=`
      fn setOutputAtIndex(flatIndex : i32, value : ${C?`vec4<${ue}>`:ue}) {
        result[flatIndex] = ${C?`vec4<${ue}>`:ue}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${C?`vec4<${ue}>`:ue}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${C?"/ 4":""}, value);
      }`,P=Re("x",t[0].dataType,t[0].dims.length,j===3?1:j),ne=Re("w",t[1].dataType,t[1].dims.length,de),ye=[P,ne],ke=Xe("result",t[0].dataType,i.length,de);if(l){let le=Re("bias",t[2].dataType,t[2].dims.length,de);ye.push(le),ve+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${C?`vec4<${ue}>`:ue} {
          return bias[coords.${f?"w":"y"}${C?"/ 4":""}];
        }`}return`
        ${cA("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${J.registerUniforms(ee).declareVariables(...ye,ke)}
        ${ve}
        ${bT(f,L,H,se,l,e,ae[0],ae[1],ae[2],ue)}
        ${C?Y0(B,$,ue,void 0,!f,Y):Q0(B,$,ue,void 0,!f,Y,!1,void 0,c)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${e.cacheKey};${j};${C};${L};${H};${se};${W};${z};${Y}`,inputDependencies:fe},getRunData:()=>({outputs:[{dims:h?h(i):i,dataType:t[0].dataType}],dispatchGroup:{x:U[0],y:U[1],z:U[2]},programUniforms:ce}),getShaderSource:be}}}),TT,Mg,Sd,xT,Ng,ST,hA,fA,GO=Ue(()=>{at(),to(),ht(),mt(),au(),Ky(),TT=t=>{let e=1;for(let i=0;i<t.length;i++)e*=t[i];return e},Mg=t=>typeof t=="number"?[t,t,t]:t,Sd=(t,e)=>e<=1?t:t+(t-1)*(e-1),xT=(t,e,i,n=1)=>{let s=Sd(e,n);return Math.floor((t[0]*(i-1)-i+s)/2)},Ng=(t,e,i,n,s)=>{s==null&&(s=xT(t,e[0],n[0]));let o=[0,0,0,i];for(let l=0;l<3;l++)t[l]+2*s>=e[l]&&(o[l]=Math.trunc((t[l]-e[l]+2*s)/n[l]+1));return o},ST=(t,e,i,n,s,o,l,c,h,f)=>{let m,_,E,w;if(t==="VALID"&&(t=0),typeof t=="number"){m={top:t,bottom:t,left:t,right:t,front:t,back:t};let A=Ng([e,i,n,1],[c,h,f],1,[s,o,l],t);_=A[0],E=A[1],w=A[2]}else if(Array.isArray(t)){if(!t.every((C,M,O)=>C===O[0]))throw Error(`Unsupported padding parameter: ${t}`);m={top:t[0],bottom:t[1],left:t[2],right:t[3],front:t[4],back:t[5]};let A=Ng([e,i,n,1],[c,h,f],1,[s,o,l],t[0]);_=A[0],E=A[1],w=A[2]}else if(t==="SAME_UPPER"){_=Math.ceil(e/s),E=Math.ceil(i/o),w=Math.ceil(n/l);let A=(_-1)*s+c-e,C=(E-1)*o+h-i,M=(w-1)*l+f-n,O=Math.floor(A/2),$=A-O,B=Math.floor(C/2),U=C-B,j=Math.floor(M/2),W=M-j;m={top:B,bottom:U,left:j,right:W,front:O,back:$}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:m,outDepth:_,outHeight:E,outWidth:w}},hA=(t,e,i,n,s,o=!1,l="channelsLast")=>{let c,h,f,m,_;if(l==="channelsLast")[c,h,f,m,_]=t;else if(l==="channelsFirst")[c,_,h,f,m]=t;else throw new Error(`Unknown dataFormat ${l}`);let[E,,w,A,C]=e,[M,O,$]=Mg(i),[B,U,j]=Mg(n),W=Sd(w,B),z=Sd(A,U),Y=Sd(C,j),{padInfo:L,outDepth:H,outHeight:se,outWidth:ae}=ST(s,h,f,m,M,O,$,W,z,Y),ce=o?E*_:E,fe=[0,0,0,0,0];return l==="channelsFirst"?fe=[c,ce,H,se,ae]:l==="channelsLast"&&(fe=[c,H,se,ae,ce]),{batchSize:c,dataFormat:l,inDepth:h,inHeight:f,inWidth:m,inChannels:_,outDepth:H,outHeight:se,outWidth:ae,outChannels:ce,padInfo:L,strideDepth:M,strideHeight:O,strideWidth:$,filterDepth:w,filterHeight:A,filterWidth:C,effectiveFilterDepth:W,effectiveFilterHeight:z,effectiveFilterWidth:Y,dilationDepth:B,dilationHeight:U,dilationWidth:j,inShape:t,outShape:fe,filterShape:e}},fA=(t,e,i,n,s,o)=>{let l=o==="channelsLast";l?t[0].dims[3]:t[0].dims[1];let c=[64,1,1],h={x:i.map((M,O)=>O)},f=[Math.ceil(TT(h.x.map(M=>i[M]))/c[0]),1,1];At("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${f}`);let m=1,_=Ae.size(i),E=[{type:12,data:_},{type:12,data:n},{type:12,data:s},{type:12,data:e.strides},{type:12,data:e.dilations}];tu(e,E),E.push(...Ze(t[0].dims,t[1].dims));let w=["rank","rank"],A=t.length===3;A&&(E.push(...Ze(t[2].dims)),w.push("rank")),E.push(...Ze(i));let C=M=>{let O=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:n.length},{name:"pads",type:"u32",length:s.length},{name:"strides",type:"u32",length:e.strides.length},{name:"dilations",type:"u32",length:e.dilations.length}];iu(e,O);let $=1,B=en(t[0].dataType),U=Re("x",t[0].dataType,t[0].dims.length,m),j=Re("W",t[1].dataType,t[1].dims.length,$),W=[U,j],z=Xe("result",t[0].dataType,i.length,$),Y="";if(A){let se=Re("bias",t[2].dataType,t[2].dims.length,$);W.push(se),Y+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${B} {
          return bias[${l?Ye("coords",4,5):Ye("coords",1,5)}];
        }`}let L=dn(m,B),H=eu(e,L,B);return`
            ${Y}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${U.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${j.getByIndices("aIndices")};
            }
          ${M.registerUniforms(O).declareVariables(...W,z)}
          ${M.mainStart()}
          ${M.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${z.offsetToIndices("global_idx")};
              let batch = ${Ye("coords",0,U.rank)};
              let d2 = ${l?Ye("coords",U.rank-1,U.rank):Ye("coords",1,U.rank)};
              let xFRCCorner = vec3<u32>(${l?Ye("coords",1,U.rank):Ye("coords",2,U.rank)},
              ${l?Ye("coords",2,U.rank):Ye("coords",3,U.rank)},
              ${l?Ye("coords",3,U.rank):Ye("coords",4,U.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${l?Ye("uniforms.x_shape",1,U.rank):Ye("uniforms.x_shape",2,U.rank)};
              let xShapeZ = ${l?Ye("uniforms.x_shape",2,U.rank):Ye("uniforms.x_shape",3,U.rank)};
              let xShapeW = ${l?Ye("uniforms.x_shape",3,U.rank):Ye("uniforms.x_shape",4,U.rank)};
              let xShapeU = ${l?Ye("uniforms.x_shape",4,U.rank):Ye("uniforms.x_shape",1,U.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${l?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${l?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${l?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${l?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${A?"value = value + getBiasByOutputCoords(coords)":""};
              ${H}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${e.cacheKey};${l};${m};${A}`,inputDependencies:w},getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:f[0],y:f[1],z:f[2]},programUniforms:E}),getShaderSource:C}}}),pA,mA,WO=Ue(()=>{at(),ht(),mt(),au(),pA=(t,e,i,n)=>{let s=t.length>2,o=s?"value += b[output_channel];":"",l=t[0].dims,c=t[1].dims,h=e.format==="NHWC",f=h?i[3]:i[1],m=f/e.group,_=h&&m>=4?xi(f):1,E=Ae.size(i)/_,w=[{type:12,data:E},{type:12,data:e.dilations},{type:12,data:[e.strides[0],e.strides[1]]},{type:12,data:[e.pads[0],e.pads[1]]},{type:12,data:m}];tu(e,w),w.push(...Ze(l,[c[0],c[1],c[2],c[3]/_]));let A=s?["rank","rank","rank"]:["rank","rank"];w.push(...Ze([i[0],i[1],i[2],i[3]/_]));let C=M=>{let O=Xe("output",t[0].dataType,i.length,_),$=en(O.type.tensor),B=eu(e,O.type.value,$),U=Re("x",t[0].dataType,l.length),j=Re("w",t[1].dataType,c.length,_),W=[U,j];s&&W.push(Re("b",t[2].dataType,t[2].dims,_));let z=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:e.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];iu(e,z);let Y=h?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${U.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${j.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${U.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${j.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${M.registerUniforms(z).declareVariables(...W,O)}

  ${M.mainStart()}
    ${M.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${O.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${h?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${h?1:2}], outputIndices[${h?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${_} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${h?2:1}];

    var value: ${O.type.value} = ${O.type.value}(0);
    ${Y}
    ${o}
    ${B}
    ${O.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${e.cacheKey}_${_}`,inputDependencies:A},getRunData:()=>({outputs:[{dims:n?n(i):i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(E/64)},programUniforms:w}),getShaderSource:C}},mA=(t,e,i,n)=>{let s=t.length>2,o=xi(i[3]),l=xi(i[2]),c=Ae.size(i)/o/l,h=[t[0].dims[0],t[0].dims[1],t[0].dims[2],t[0].dims[3]/o],f=[t[1].dims[0],t[1].dims[1],t[1].dims[2],t[1].dims[3]/o],m=[i[0],i[1],i[2],i[3]/o],_=[{type:12,data:c},{type:6,data:[e.strides[0],e.strides[1]]},{type:6,data:[e.pads[0],e.pads[1]]}];tu(e,_),_.push(...Ze(h,f,m));let E=(l-1)*e.strides[1]+f[1],w=A=>{let C=Xe("output",t[0].dataType,m.length,o),M=en(C.type.tensor),O=eu(e,C.type.value,M),$=Re("x",t[0].dataType,h.length,o),B=Re("w",t[1].dataType,f.length,o),U=[$,B];s&&U.push(Re("b",t[2].dataType,t[2].dims,o));let j=s?"value += b[output_channel];":"",W=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return iu(e,W),`
  ${A.registerUniforms(W).declareVariables(...U,C)}
  ${A.mainStart()}
    ${A.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${l}u;
    let col = (index1 % width1) * ${l}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${$.type.value}, ${E}>;
    var values: array<${C.type.value}, ${l}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${f[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${E}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${$.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${$.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${f[1]}; w_width++) {
          let w_val = ${B.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${l}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${l}u; i++) {
      var value = values[i];
      ${j}
      ${O}
      ${C.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${e.cacheKey};${o};${l};${E};${f[0]};${f[1]}`,inputDependencies:s?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:n?n(i):i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:_}),getShaderSource:w}}}),wT,pf,ET,mf,Z0,Bg,CT,AT,J0,XO=Ue(()=>{ht(),VO(),GO(),Zy(),WO(),au(),Qy(),il(),wT=(t,e,i,n,s,o)=>{let l=t[0],c=t.slice(o?1:2,o?3:4),h=c.length,f=e[0],m=e.slice(2).map((E,w)=>E+(E-1)*(i[w]-1)),_=c.map((E,w)=>E+n[w]+n[w+h]).map((E,w)=>Math.floor((E-m[w]+s[w])/s[w]));return _.splice(0,0,l),_.splice(o?3:1,0,f),_},pf=[2,3,1,0],ET=(t,e)=>{if(!t||t.length!==2&&t.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(t[0].dims.length>5)throw new Error("greater than 5D is not supported");if(t[0].dims.length!==t[1].dims.length)throw new Error("filter does not have same dimension as input");let i=t[0].dims[e.format==="NHWC"?t[0].dims.length-1:1],n=t[1].dims[1]*e.group;if(i!==n)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(t.length===3&&(t[2].dims.length!==1||t[1].dims[0]!==t[2].dims[0]))throw new Error("invalid bias");let s=t[0].dims.length-2;if(e.dilations.length!==s)throw new Error(`dilations should be ${s}D`);if(e.strides.length!==s)throw new Error(`strides should be ${s}D`);if(e.pads.length!==s*2)throw new Error(`pads should be ${s*2}D`);if(e.kernelShape.length!==0&&e.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape")},mf=(t,e)=>{let i=t.kernelShape.slice();i.length<e[1].dims.length-2&&i.push(...Array(e[1].dims.length-2-i.length).fill(0));for(let o=2;o<e[1].dims.length;++o)i[o-2]===0&&(i[o-2]=e[1].dims[o]);let n=t.pads.slice();Bf.adjustPadsBasedOnAutoPad(e[0].dims,t.strides,t.dilations,i,n,t.format==="NHWC",t.autoPad);let s=Object.assign({},t);return Object.assign(s,{kernelShape:i,pads:n}),s},Z0=t=>{let e=Xy(t),i=t.format,n=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],s=t.dilations,o=t.group,l=t.kernel_shape,c=t.pads,h=t.strides,f=t.w_is_const();return{autoPad:n,format:i,dilations:s,group:o,kernelShape:l,pads:c,strides:h,wIsConst:f,...e,cacheKey:`${t.format};${e.activation};`}},Bg=(t,e,i,n)=>{let s=i.format==="NHWC",o=wT(e[0].dims,e[1].dims,i.dilations,i.pads,i.strides,s);if(i.group!==1){let W=[e[0]];if(s){let z=t.kernelCustomData.wT??t.compute($r(e[1],pf),{inputs:[1],outputs:[i.wIsConst?-2:-1]})[0];i.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=z),W.push(z)}else W.push(e[1]);e.length===3&&W.push(e[2]),!t.adapterInfo.isArchitecture("ampere")&&s&&e[1].dims[0]===i.group&&e[1].dims[1]===1&&i.dilations[0]===1&&i.dilations[1]===1?t.compute(mA(W,i,o,n),{inputs:W}):t.compute(pA(W,i,o,n),{inputs:W});return}let l=e.length===3,c=e[0].dims[s?1:2],h=e[0].dims[s?2:3],f=e[0].dims[s?3:1],m=e[1].dims[2],_=e[1].dims[3],E=o[s?1:2],w=o[s?2:3],A=o[s?3:1],C=s&&m===c&&_===h&&i.pads[0]===0&&i.pads[1]===0;if(C||m===1&&_===1&&i.dilations[0]===1&&i.dilations[1]===1&&i.strides[0]===1&&i.strides[1]===1&&i.pads[0]===0&&i.pads[1]===0){let W=o[0],z,Y,L,H=[];if(s){let ce=t.kernelCustomData.wT??t.compute($r(e[1],pf),{inputs:[1],outputs:[i.wIsConst?-2:-1]})[0];if(i.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=ce),C){let fe=c*h*f;z=e[0].reshape([1,W,fe]),Y=ce.reshape([1,fe,A]),L=[1,W,A]}else z=e[0].reshape([W,c*h,f]),Y=ce.reshape([1,f,A]),L=[W,E*w,A];H.push(z),H.push(Y)}else z=e[0].reshape([W,f,c*h]),Y=e[1].reshape([1,A,f]),L=[W,A,E*w],H.push(Y),H.push(z);l&&H.push(e[2]);let se=L[2],ae=H[0].dims[H[0].dims.length-1];se<8&&ae<8?t.compute(Yy(H,i,o,L,s,n),{inputs:H}):t.compute(Uf(H,i,o,L,s,n),{inputs:H});return}let M=!0,O=t.kernelCustomData.wT??t.compute($r(e[1],pf),{inputs:[1],outputs:[i.wIsConst?-2:-1]})[0];i.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=O);let $=[e[0],O];l&&$.push(e[2]);let B=s?E*w:A,U=s?A:E*w,j=m*_*f;t.compute(dA($,i,o,B,U,j,l,M,n),{inputs:$})},CT=(t,e)=>{let i=e.format==="NHWC",n=[t.inputs[0].reshape(i?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];t.inputs.length===3&&n.push(t.inputs[2]);let s=[0,e.pads[0],0,e.pads[1]],o=[1].concat(e.strides),l=[1].concat(e.dilations),c=[1].concat(e.kernelShape),h=mf({...e,pads:s,strides:o,dilations:l,kernelShape:c},n);Bg(t,n,h,f=>i?[f[0],f[2],f[3]]:[f[0],f[1],f[3]])},AT=(t,e,i)=>{let n=i.format==="NHWC"?"channelsLast":"channelsFirst",s=mf(i,e),o=i.autoPad==="NOTSET"?i.pads:i.autoPad,l=hA(e[0].dims,e[1].dims,i.strides,i.dilations,o,!1,n);t.compute(fA(e,s,l.outShape,[l.filterDepth,l.filterHeight,l.filterWidth],[l.padInfo.front,l.padInfo.top,l.padInfo.left],n))},J0=(t,e)=>{if(ET(t.inputs,e),t.inputs[0].dims.length===3)CT(t,e);else if(t.inputs[0].dims.length===5)AT(t,t.inputs,e);else{let i=mf(e,t.inputs);Bg(t,t.inputs,i)}}}),gA,KO=Ue(()=>{at(),to(),ht(),mt(),gA=(t,e,i)=>{let n=t.length>2,s=e.outputShape,o=e.format==="NHWC",l=e.group,c=t[1].dims,h=c[2]/l,f=c[3],m=o?xi(h):1,_=o&&f===1&&h>=4,E=_?Math.floor(h/4)*4:Math.floor(h/m)*m,w=h-E,A=o?xi(f):1,C=o?f===1?m:A:1,M=Ae.size(s)/A,O=[Math.ceil(M/64),1,1];At("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${O}`);let $=["rank","rank"],B=[e.strides[0],e.strides[1]],U=[e.kernelShape[o?1:2],e.kernelShape[o?2:3]],j=[e.dilations[0],e.dilations[1]],W=[U[0]+(e.dilations[0]<=1?0:(e.kernelShape[o?1:2]-1)*(e.dilations[0]-1)),U[1]+(e.dilations[1]<=1?0:(e.kernelShape[o?2:3]-1)*(e.dilations[1]-1))],z=[W[0]-1-Math.floor((e.pads[0]+e.pads[2])/2),W[1]-1-Math.floor((e.pads[1]+e.pads[3])/2)],Y=[{type:12,data:M},{type:12,data:B},{type:12,data:U},{type:12,data:j},{type:12,data:W},{type:6,data:z},{type:12,data:E},{type:12,data:h},{type:12,data:f},...Ze(t[0].dims,t[1].dims)];n&&(Y.push(...Ze(t[2].dims)),$.push("rank")),Y.push(...Ze(s));let L=H=>{let se=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:B.length},{name:"filter_dims",type:"u32",length:U.length},{name:"dilations",type:"u32",length:U.length},{name:"effective_filter_dims",type:"u32",length:W.length},{name:"pads",type:"i32",length:z.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],ae=en(t[0].dataType),ce=o?1:2,fe=o?2:3,be=o?3:1,J=Re("W",t[1].dataType,t[1].dims.length,C),ee=Re("Dy",t[0].dataType,t[0].dims.length,m),de=[ee,J];n&&de.push(Re("bias",t[2].dataType,[s[be]].length,A));let ue=Xe("result",t[0].dataType,s.length,A),ve=()=>{let ye="";if(_)m===4?ye+=`
        let xValue = ${ee.getByOffset("x_offset")};
        let wValue = ${J.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:m===2?ye+=`
          dotProd = dotProd + dot(vec4<${ae}>(${ee.getByOffset("x_offset")}, ${ee.getByOffset("x_offset + 1u")}), vec4<${ae}>(${J.getByOffset("w_offset")}, ${J.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:m===1&&(ye+=`
          dotProd = dotProd + dot(vec4<${ae}>(${ee.getByOffset("x_offset")}, ${ee.getByOffset("x_offset + 1u")}, ${ee.getByOffset("x_offset + 2u")}, ${ee.getByOffset("x_offset + 3u")}), vec4<${ae}>(${J.getByOffset("w_offset")}, ${J.getByOffset("w_offset + 1u")}, ${J.getByOffset("w_offset + 2u")}, ${J.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(ye+=`
                  let xValue = ${o?ee.getByOffset(`${ee.indicesToOffset(`${ee.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${m}`):ee.get("batch","inputChannel","idyR","idyC")};
        `,m===1)ye+=`
          let w_offset = ${J.indicesToOffset(`${J.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${J.getByOffset(`w_offset / ${C}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let ke=0;ke<m;ke++)ye+=`
            let wValue${ke} = ${J.getByOffset(`${J.indicesToOffset(`${J.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${ke}, wOutChannel)`)} / ${C}`)};
            dotProd = dotProd + xValue[${ke}] * wValue${ke};`;return ye},P=()=>{if(w===0)return"";if(!_)throw new Error(`packInputAs4 ${_} is not true.`);let ye="";if(m===1){ye+="dotProd = dotProd";for(let ke=0;ke<w;ke++)ye+=`
            + ${ee.getByOffset(`x_offset + ${ke}`)} * ${J.getByOffset(`w_offset + ${ke}`)}`;ye+=";"}else if(m===2){if(w!==2)throw new Error(`Invalid inputChannelsRemainder ${w}.`);ye+=`
          let xValue = ${ee.getByOffset("x_offset")};
          let wValue = ${J.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return ye},ne=`
            let outputIndices = ${ue.offsetToIndices(`global_idx * ${A}`)};
            let batch = ${ue.indicesGet("outputIndices",0)};
            let d1 = ${ue.indicesGet("outputIndices",be)};
            let r = ${ue.indicesGet("outputIndices",ce)};
            let c = ${ue.indicesGet("outputIndices",fe)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${ue.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${ae}(dyRCorner) + ${ae}(wR)) / ${ae}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${ae}(uniforms.Dy_shape[${ce}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${ae}(dyCCorner) + ${ae}(wC)) / ${ae}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${ae}(uniforms.Dy_shape[${fe}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${_?`
                var x_offset = ${ee.indicesToOffset(`${ee.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${m};
                var w_offset = ${J.indicesToOffset(`${J.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${C};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${_?4:m}) {
                  ${ve()}
                  inputChannel = inputChannel + ${_?4:m};
                }
                ${P()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${n?` + bias[d1 / ${A}]`:""};
            ${ue.setByOffset("global_idx","value")};
          `;return`
    ${H.registerUniforms(se).declareVariables(...de,ue)}
      ${H.mainStart()}
      ${H.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${ne}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${e.cacheKey};${m}${C}${A}${_}${w}`,inputDependencies:$},getRunData:()=>({dispatchGroup:{x:O[0],y:O[1],z:O[2]},outputs:[{dims:i?i(s):s,dataType:t[0].dataType}],programUniforms:Y}),getShaderSource:L}}}),DT,kT,$T,Lg,yA,OT,Ug,IT,_A,YO=Ue(()=>{KO(),au(),il(),DT=(t,e,i,n,s,o)=>(t-1)*e+i+(n-1)*s+1-o,kT=(t,e,i,n,s)=>{let o=Math.floor(t/2);e==="SAME_UPPER"?(i[n]=o,i[s]=t-o):e==="SAME_LOWER"&&(i[n]=t-o,i[s]=o)},$T=(t,e,i,n,s,o,l,c,h,f)=>{let m=t.length-2,_=f.length===0;h.length<m&&h.push(...Array(m-h.length).fill(0));let E=t[0],w=e[c?3:1]*s;for(let A=0,C=t.length-m-(c?1:0);A<m;++A,++C){let M=t[C],O=_?M*l[A]:f[A],$=DT(M,l[A],o[A],e[C],i[A],O);kT($,n,o,A,A+m),_&&f.push(l[A]*(M-1)+h[A]+(e[C]-1)*i[A]+1-o[A]-o[A+m])}f.splice(0,0,E),f.splice(c?3:1,0,w)},Lg=(t,e)=>{let i=t.kernelShape.slice();if(t.kernelShape.length===0||t.kernelShape.reduce((_,E)=>_*E,1)===0){i.length=0;for(let _=2;_<e[1].dims.length;++_)i.push(e[1].dims[_])}let n=t.format==="NHWC";i.splice(0,0,e[1].dims[0]),i.splice(n?3:1,0,e[1].dims[1]);let s=t.pads.slice(),o=t.outputShape.slice(),l=t.outputPadding.slice(),c=e[0].dims,h=t.dilations.slice();if(h.reduce((_,E)=>_+E,0)===0){let _=e[0].dims.length-2;h=new Array(_).fill(1)}let f=t.strides.slice();if(f.reduce((_,E)=>_+E,0)===0){let _=e[0].dims.length-2;f=new Array(_).fill(1)}$T(c,i,h,t.autoPad,t.group,s,f,n,l,o);let m=Object.assign({},t);return Object.assign(m,{kernelShape:i,pads:s,outputPadding:l,outputShape:o,dilations:h,strides:f}),m},yA=t=>{let e=Xy(t),i=t.format,n=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof t.autoPad>"u"?0:t.autoPad],s=t.dilations,o=t.group,l=t.kernelShape,c=t.pads,h=t.strides,f=t.wIsConst(),m=t.outputPadding,_=t.outputShape;return{autoPad:n,format:i,dilations:s,group:o,kernelShape:l,outputPadding:m,outputShape:_,pads:c,strides:h,wIsConst:f,...e,cacheKey:`${t.format};${e.activation};`}},OT=(t,e)=>{if(!t||t.length!==2&&t.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(t[0].dims.length!==4&&t[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(t[0].dims.length!==t[1].dims.length)throw new Error("filter does not have same dimension as input");let i=t[0].dims[e.format==="NHWC"?t[0].dims.length-1:1],n=t[1].dims[0];if(i!==n)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let s=t[1].dims[1]*e.group;if(t.length===3&&(t[2].dims.length!==1||t[2].dims[0]!==s))throw new Error("invalid bias");let o=t[0].dims.length-2;if(e.dilations.reduce((l,c)=>l+c,0)>0&&e.dilations.length!==o)throw new Error(`dilations should be ${o}D`);if(e.strides.reduce((l,c)=>l+c,0)>0&&e.strides.length!==o)throw new Error(`strides should be ${o}D`);if(e.pads.reduce((l,c)=>l+c,0)>0&&e.pads.length!==o*2)throw new Error(`pads should be ${o*2}D`);if(e.outputPadding.length!==o&&e.outputPadding.length!==0)throw new Error(`output_padding should be ${o}D`);if(e.kernelShape.reduce((l,c)=>l+c,0)>0&&e.kernelShape.length!==0&&e.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape");if(e.outputShape.length!==0&&e.outputShape.length!==t[0].dims.length-2)throw new Error("invalid output shape")},Ug=(t,e,i,n)=>{let s=t.kernelCustomData.wT??t.compute($r(e[1],[2,3,0,1]),{inputs:[1],outputs:[i.wIsConst?-2:-1]})[0];i.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=s);let o=[e[0],s];e.length===3&&o.push(e[2]),t.compute(gA(o,i,n),{inputs:o})},IT=(t,e)=>{let i=e.format==="NHWC",n=[t.inputs[0].reshape(i?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];t.inputs.length===3&&n.push(t.inputs[2]);let s=e.kernelShape;(s.length===0||s[0]===0)&&(s=[t.inputs[1].dims[2]]);let o=e.dilations;(o.length===0||o[0]===0)&&(o=[1]);let l=e.strides;(l.length===0||l[0]===0)&&(l=[1]);let c=e.pads;c.length===0&&(c=[0,0]),c=[0,c[0],0,c[1]],l=[1].concat(l),o=[1].concat(o),s=[1].concat(s);let h=e.outputPadding;h=[0].concat(h);let f=Lg({...e,pads:c,strides:l,dilations:o,kernelShape:s,outputPadding:h},n);Ug(t,n,f,m=>i?[m[0],m[2],m[3]]:[m[0],m[1],m[3]])},_A=(t,e)=>{if(OT(t.inputs,e),t.inputs[0].dims.length===3)IT(t,e);else{let i=Lg(e,t.inputs);Ug(t,t.inputs,i)}}}),RT,vA,bA,QO=Ue(()=>{at(),ht(),Ci(),mt(),RT=(t,e,i,n)=>{let s=Ae.size(e),o=e.length,l=Re("input",t,o),c=Xe("output",t,o),h=i.dataType===6?i.getInt32Array()[0]:Number(i.getBigInt64Array()[0]),f=Ae.normalizeAxis(h,o),m=_=>{let E=` i32(${l.indicesGet("inputIndices","uniforms.axis")}) `,w=Ye("uniforms.input_shape","uniforms.axis",o),A=n.reverse?E+(n.exclusive?" + 1":""):"0",C=n.reverse?w:E+(n.exclusive?"":" + 1");return`
                ${_.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(l,c)}
                ${_.mainStart()}
                  ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${c.offsetToIndices("global_idx")};
                  var sum = ${c.type.value}(0);
                  let first : i32 = ${A};
                  let last : i32 = ${C};
                  for (var i : i32 = first; i < last; i++) {
                    ${l.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${l.getByIndices("inputIndices")};
                  }
                  ${c.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:n.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:e,dataType:t}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:[{type:12,data:s},{type:12,data:f},...Ze(e,e)]}),getShaderSource:m}},vA=(t,e)=>{let i=t.inputs[0].dims,n=t.inputs[0].dataType,s=t.inputs[1];t.compute(RT(n,i,s,e),{inputs:[0]})},bA=t=>{let e=t.exclusive===1,i=t.reverse===1;return Bt({exclusive:e,reverse:i})}}),MT,NT,BT,TA,xA,ZO=Ue(()=>{at(),ht(),Ci(),mt(),MT=t=>{if(!t||t.length!==1)throw new Error("DepthToSpace requires 1 input.");if(t[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},NT=(t,e,i,n)=>{let s=[];s.push(`fn perm(i: ${n.type.indices}) -> ${i.type.indices} {
    var a: ${i.type.indices};`);for(let o=0;o<e;++o)s.push(i.indicesSet("a",t[o],`i[${o}]`));return s.push("return a;}"),s.join(`
`)},BT=(t,e)=>{let i,n,s,o,l,c,h=e.format==="NHWC",f=e.blocksize,m=e.mode==="DCR";h?([i,n,s,o]=t.dims,l=m?[i,n,s,f,f,o/f**2]:[i,n,s,o/f**2,f,f],c=m?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([i,n,s,o]=[t.dims[0],t.dims[2],t.dims[3],t.dims[1]],l=m?[i,f,f,o/f**2,n,s]:[i,o/f**2,f,f,n,s],c=m?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let _=t.reshape(l),E=_.dims.length,w=t.dataType,A=Re("a",w,E),C=Xe("output",w,E),M=O=>`
  ${O.registerUniform("output_size","u32").declareVariables(A,C)}

  ${NT(c,E,A,C)}

  ${O.mainStart()}
    ${O.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${C.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${C.setByOffset("global_idx",A.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${t.dims};${e.blocksize};${e.mode}`,inputDependencies:["rank"]},getRunData:O=>{let $=h?[i,n*f,s*f,o/f**2]:[i,o/f**2,n*f,s*f],B=Ae.size($),U=_.dims,j=Ae.sortBasedOnPerm(U,c);return{outputs:[{dims:$,dataType:O[0].dataType}],dispatchGroup:{x:Math.ceil(B/64)},programUniforms:[{type:12,data:B},...Ze(U,j)]}},getShaderSource:M}},TA=(t,e)=>{MT(t.inputs),t.compute(BT(t.inputs[0],e))},xA=t=>Bt({blocksize:t.blocksize,mode:t.mode,format:t.format})}),gf,wd,Pg,LT,UT,PT,zT,zg,FT,SA,wA,JO=Ue(()=>{at(),ht(),Ci(),mt(),gf="[a-zA-Z]|\\.\\.\\.",wd="("+gf+")+",Pg="^"+wd+"$",LT="("+wd+",)*"+wd,UT="^"+LT+"$",PT=class{constructor(t=-1){this.symbolToIndices=new Map,this.inputIndex=t}addSymbol(t,e){let i=this.symbolToIndices.get(t);i===void 0?i=[e]:i.push(e),this.symbolToIndices.set(t,i)}},zT=class{constructor(t,e){this.equation=e,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[i,n]=e.includes("->")?e.split("->",2):[e,""];if(!i.match(RegExp(UT)))throw new Error("Invalid LHS term");if(i.split(",").forEach((s,o)=>{let l=t[o].dims.slice();if(!s.match(RegExp(Pg)))throw new Error("Invalid LHS term");let c=this.processTerm(s,!0,l,o);this.lhs.push(c)}),n==="")n+=[...this.symbolToInfo.entries()].filter(([s,o])=>o.count===1||s==="...").map(([s])=>s).join("");else if(!n.match(RegExp(wd)))throw new Error("Invalid RHS");n.match(RegExp(gf,"g"))?.forEach(s=>{if(s==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let o=this.symbolToInfo.get(s);if(o===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(o.dimValue)}}),this.rhs=this.processTerm(n,!1,this.outputDims)}addSymbol(t,e,i){let n=this.symbolToInfo.get(t);if(n!==void 0){if(n.dimValue!==e&&n.count!==1)throw new Error("Dimension mismatch");n.count++,n.inputIndices.push(i)}else n={count:1,dimValue:e,inputIndices:[i]};this.symbolToInfo.set(t,n)}processTerm(t,e,i,n=-1){let s=i.length,o=!1,l=[],c=0;if(!t.match(RegExp(Pg))&&!e&&t!=="")throw new Error("Invalid LHS term");let h=t.match(RegExp(gf,"g")),f=new PT(n);return h?.forEach((m,_)=>{if(m==="..."){if(o)throw new Error("Only one ellipsis is allowed per input term");o=!0;let E=s-h.length+1;if(E<0)throw new Error("Ellipsis out of bounds");if(l=i.slice(c,c+E),this.hasEllipsis){if(this.ellipsisDims.length!==l.length||this.ellipsisDims.toString()!==l.toString())throw new Error("Ellipsis dimensions mismatch")}else if(e)this.hasEllipsis=!0,this.ellipsisDims=l;else throw new Error("Ellipsis must be specified in the LHS");for(let w=0;w<l.length;w++){let A=String.fromCharCode(48+w);f.addSymbol(A,_+w),this.addSymbol(A,i[c++],n)}}else f.addSymbol(m,_+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(m,i[c++],n)}),f}},zg=t=>t+"_max",FT=(t,e,i,n)=>{let s=t.map(f=>f.length).map((f,m)=>Re(`input${m}`,e,f)),o=Ae.size(n),l=Xe("output",e,n.length),c=[...i.symbolToInfo.keys()].filter(f=>!i.rhs.symbolToIndices.has(f)),h=f=>{let m=[],_="var prod = 1.0;",E="var sum = 0.0;",w="sum += prod;",A=[],C=[],M=[],O=[],$=i.symbolToInfo.size===i.rhs.symbolToIndices.size;i.symbolToInfo.forEach((U,j)=>{if(i.rhs.symbolToIndices.has(j)){let W=i.rhs.symbolToIndices.get(j)?.[0];W!==void 0&&i.lhs.forEach((z,Y)=>{if(U.inputIndices.includes(Y)){let L=z.symbolToIndices.get(j);if(L===void 0)throw new Error("Invalid symbol error");L.forEach(H=>{m.push(`${s[Y].indicesSet(`input${Y}Indices`,H,l.indicesGet("outputIndices",W))}`)})}})}else i.lhs.forEach((W,z)=>{if(U.inputIndices.includes(z)){let Y=W.symbolToIndices.get(j);if(Y===void 0)throw new Error("Invalid symbol error");Y.forEach(L=>{A.push(`${s[z].indicesSet(`input${z}Indices`,L,`${j}`)}`)}),O.push(`prod *= ${s[z].getByIndices(`input${z}Indices`)};`)}}),C.push(`for(var ${j}: u32 = 0; ${j} < uniforms.${zg(j)}; ${j}++) {`),M.push("}")});let B=$?[...m,`let sum = ${s.map((U,j)=>U.getByIndices(`input${j}Indices`)).join(" * ")};`]:[...m,E,...C,...A,_,...O,w,...M];return`
            ${f.registerUniforms(c.map(U=>({name:`${zg(U)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...s,l)}

            ${f.mainStart()}
            ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${l.offsetToIndices("global_idx")};
            ${s.map((U,j)=>`var input${j}Indices: ${s[j].type.indices};`).join(`
`)}
            ${B.join(`
`)};
            ${l.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:i.equation,inputDependencies:t.map(()=>"rank")},getRunData:()=>{let f=c.filter(_=>i.symbolToInfo.has(_)).map(_=>({type:12,data:i.symbolToInfo.get(_)?.dimValue||0}));f.push({type:12,data:o});let m=t.map((_,E)=>[...Ze(_)]).reduce((_,E)=>_.concat(E),f);return m.push(...Ze(n)),{outputs:[{dims:n,dataType:e}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:m}},getShaderSource:h}},SA=(t,e)=>{let i=new zT(t.inputs,e.equation),n=i.outputDims,s=t.inputs.map((o,l)=>o.dims);t.compute(FT(s,t.inputs[0].dataType,i,n))},wA=t=>{let e=t.equation.replace(/\s+/g,"");return Bt({equation:e})}}),qT,Fg,jT,HT,EA,eI=Ue(()=>{at(),ht(),mt(),qT=t=>{if(!t||t.length!==2)throw new Error("Expand requires 2 input.");let e=t[0].dims,i=Array.from(t[1].getBigInt64Array(),Number),n=i.length<e.length?0:i.length-e.length,s=e.length<i.length?0:e.length-i.length;for(;n<i.length&&s<e.length;++n,++s)if(i[n]!==e[s]&&i[n]!==1&&e[s]!==1)throw new Error("Expand requires shape to be broadcastable to input")},Fg=(t,e)=>{let i=t.length-e.length,n=[];for(let s=0;s<i;++s)n.push(t[s]);for(let s=0;s<e.length;++s)n.push(e[s]===1?t[s+i]:e[s]);return n},jT=(t,e)=>t.length>e.length?Fg(t,e):Fg(e,t),HT=t=>{let e=t[0].dims,i=Array.from(t[1].getBigInt64Array(),Number),n=jT(e,i),s=t[0].dataType,o=s===9||Ae.size(e)===1,l=s===9||e.length>0&&e[e.length-1]%4===0?4:1,c=o||n.length>0&&n[n.length-1]%4===0?4:1,h=Math.ceil(Ae.size(n)/c),f=_=>{let E=Re("input",s,e.length,l),w=Xe("output",s,n.length,c),A;if(s===9){let C=(M,O,$="")=>`
          let outputIndices${O} = ${w.offsetToIndices(`outputOffset + ${O}u`)};
          let offset${O} = ${E.broadcastedIndicesToOffset(`outputIndices${O}`,w)};
          let index${O} = offset${O} / 4u;
          let component${O} = offset${O} % 4u;
          ${M}[${O}] = ${$}(${E.getByOffset(`index${O}`)}[component${O}]);
        `;A=`
        let outputOffset = global_idx * ${c};
        var data = vec4<u32>(0);
        ${C("data",0,"u32")}
        ${C("data",1,"u32")}
        ${C("data",2,"u32")}
        ${C("data",3,"u32")}
        ${w.setByOffset("global_idx","data")}
      }`}else A=`
        let outputIndices = ${w.offsetToIndices(`global_idx * ${c}`)};
        let inputOffset = ${E.broadcastedIndicesToOffset("outputIndices",w)};
        let data = ${w.type.value}(${E.getByOffset(`inputOffset / ${l}`)});
        ${w.setByOffset("global_idx","data")}
      }`;return`
    ${_.registerUniform("vec_size","u32").declareVariables(E,w)}
    ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${A}`},m=[{type:12,data:h},...Ze(e,n)];return{name:"Expand",shaderCache:{hint:`${n.length};${l}${c}`,inputDependencies:["rank"]},getShaderSource:f,getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:m})}},EA=t=>{qT(t.inputs),t.compute(HT(t.inputs),{inputs:[0]})}}),VT,CA,tI=Ue(()=>{at(),ht(),mt(),Wy(),VT=t=>{let e=t[0].dataType,i=Ae.size(t[0].dims),n=Ae.size(t[1].dims),s=n%4===0,o=l=>{let c=Re("x",e,[1],4),h=Re("bias",e,[1],4),f=Xe("y",e,[1],4),m=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],_=w=>`
      let bias${w}_offset: u32 = (global_idx * 4 + ${w}) % uniforms.bias_size;
      let bias${w} = ${h.getByOffset(`bias${w}_offset / 4`)}[bias${w}_offset % 4];`,E=s?`
      let bias = ${h.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${_(0)}${_(1)}${_(2)}${_(3)}
      let bias = ${c.type.value}(bias0, bias1, bias2, bias3);`;return`${l.registerUniforms(m).declareVariables(c,h,f)}

    ${X0(On(e))}

    ${l.mainStart(lc)}
      ${l.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${c.getByOffset("global_idx")};
      ${E}
      let x_in = x + bias;
      ${f.setByOffset("global_idx",K0("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${s}`,inputDependencies:["type","type"]},getShaderSource:o,getRunData:l=>({outputs:[{dims:l[0].dims,dataType:l[0].dataType}],programUniforms:[{type:12,data:Math.ceil(i/4)},{type:12,data:n}],dispatchGroup:{x:Math.ceil(i/lc/4)}})}},CA=t=>{t.inputs.length<2||Ae.size(t.inputs[1].dims)===0?GC(t):t.compute(VT(t.inputs))}}),GT,WT,AA,DA,iI=Ue(()=>{at(),ht(),Ci(),mt(),GT=t=>{if(!t||t.length!==2)throw new Error("Gather requires 2 inputs.")},WT=(t,e)=>{let i=t[0].dims,n=t[1].dims,s=i.length,o=Ae.normalizeAxis(e.axis,s),l=i.slice(0);l.splice(o,1,...n);let c=i[o],h=t[0].dataType===9?4:1,f=Math.ceil(Ae.size(l)/h),m=[{type:12,data:f},{type:6,data:c},{type:12,data:o},...Ze(t[0].dims,t[1].dims,l)],_=E=>{let w=Re("data",t[0].dataType,t[0].dims.length,h),A=Re("inputIndices",t[1].dataType,t[1].dims.length),C=Xe("output",t[0].dataType,l.length,h),M=$=>{let B=n.length,U=`var indicesIndices${$}  = ${A.type.indices}(0);`;for(let j=0;j<B;j++)U+=`${B>1?`indicesIndices${$}[${j}]`:`indicesIndices${$}`} = ${l.length>1?`outputIndices${$}[uniforms.axis + ${j}]`:`outputIndices${$}`};`;U+=`
          var idx${$} = ${A.getByIndices(`indicesIndices${$}`)};
          if (idx${$} < 0) {
            idx${$} = idx${$} + uniforms.axisDimLimit;
          }
          var dataIndices${$} : ${w.type.indices};
        `;for(let j=0,W=0;j<s;j++)j===o?(U+=`${s>1?`dataIndices${$}[${j}]`:`dataIndices${$}`} = u32(idx${$});`,W+=B):(U+=`${s>1?`dataIndices${$}[${j}]`:`dataIndices${$}`} = ${l.length>1?`outputIndices${$}[${W}]`:`outputIndices${$}`};`,W++);return U},O;if(t[0].dataType===9){let $=(B,U,j="")=>`
          let outputIndices${U} = ${C.offsetToIndices(`outputOffset + ${U}u`)};
          ${M(U)};
          let offset${U} = ${w.indicesToOffset(`dataIndices${U}`)};
          let index${U} = offset${U} / 4u;
          let component${U} = offset${U} % 4u;
          ${B}[${U}] = ${j}(${w.getByOffset(`index${U}`)}[component${U}]);
        `;O=`
        let outputOffset = global_idx * ${h};
        var value = vec4<u32>(0);
        ${$("value",0,"u32")}
        ${$("value",1,"u32")}
        ${$("value",2,"u32")}
        ${$("value",3,"u32")}
        ${C.setByOffset("global_idx","value")}
      `}else O=`
      let outputIndices = ${C.offsetToIndices("global_idx")};
      ${M("")};
      let value = ${w.getByIndices("dataIndices")};
      ${C.setByOffset("global_idx","value")};
      `;return`
      ${E.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(w,A,C)}
      ${E.mainStart()}
        ${E.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${O}
      }`};return{name:"Gather",shaderCache:{hint:e.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:l,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:m}),getShaderSource:_}},AA=t=>Bt({axis:t.axis}),DA=(t,e)=>{let i=t.inputs;GT(i),t.compute(WT(t.inputs,e))}}),XT,kA,$A,nI=Ue(()=>{at(),ht(),mt(),XT=(t,e,i,n,s,o,l,c,h)=>{let f=[{type:12,data:o},{type:12,data:n},{type:12,data:s},{type:12,data:i},{type:12,data:l},{type:12,data:c},{type:12,data:h}],m=[o];f.push(...Ze(e.dims,m));let _=E=>{let w=Re("indices_data",e.dataType,e.dims.length),A=Xe("input_slice_offsets_data",12,1,1),C=[w,A],M=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:s.length},{name:"sizes_from_slice_dims_data",type:"u32",length:i.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${E.registerUniforms(M).declareVariables(...C)}
  ${E.mainStart()}
    ${E.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${s.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${i.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return t.compute({name:"computeSliceOffsets",shaderCache:{hint:`${s.length}_${i.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:m,dataType:t.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:f}),getShaderSource:_},{inputs:[e],outputs:[-1]})[0]},kA=(t,e)=>{let i=t.inputs,n=i[0].dims,s=i[0].dataType,o=i[1].dims,l=o[o.length-1],c=Ae.sizeToDimension(o,o.length-1),h=Ae.sizeFromDimension(n,e.batchDims+l),f=Ae.sizeToDimension(n,e.batchDims),m=Ae.sizeFromDimension(n,e.batchDims),_=c/f,E=new Array(l),w=h;for(let U=0;U<l;++U)E[l-1-U]=w,w*=n[e.batchDims+l-1-U];let A=XT(t,i[1],E,e.batchDims,n,c,_,m,l),C=e.batchDims+l;if(C>n.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let M=o.slice(0,-1).concat(n.slice(C)),O=Ae.size(M),$=[{type:12,data:O},{type:12,data:h},...Ze(i[0].dims,A.dims,M)],B=U=>{let j=Re("data",i[0].dataType,i[0].dims.length),W=Re("slice_offsets",12,A.dims.length),z=Xe("output",i[0].dataType,M.length);return`
          ${U.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(j,W,z)}
            ${U.mainStart()}
            ${U.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};t.compute({name:"GatherND",shaderCache:{hint:e.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:M,dataType:s}],dispatchGroup:{x:Math.ceil(O/64)},programUniforms:$}),getShaderSource:B},{inputs:[i[0],A]})},$A=t=>({batchDims:t.batch_dims,cacheKey:""})}),KT,YT,OA,IA,rI=Ue(()=>{at(),ht(),Ci(),mt(),KT=(t,e)=>{if(t.length<3||t.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let i=Ae.normalizeAxis(e.quantizeAxis,t[0].dims.length),n=e.blockSize,s=t[0],o=t[2],l=t.length===4?t[3]:void 0;if(o.dims.length!==s.dims.length||!s.dims.map((c,h)=>h===i?Math.ceil(c/n)===o.dims[h]:c===o.dims[h]).reduce((c,h)=>c&&h,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(l){if(l.dataType!==s.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(l.dims.length!==o.dims.length||!l.dims.map((c,h)=>c===o.dims[h]).reduce((c,h)=>c&&h,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},YT=(t,e)=>{let i=t[0].dims,n=t[1].dims,s=i.length,o=Ae.normalizeAxis(e.gatherAxis,s),l=Ae.normalizeAxis(e.quantizeAxis,s),c=i.slice(0);c.splice(o,1,...n);let h=Ae.size(c),f=t[2].dataType,m=t[0].dataType===22,_=[{type:12,data:h},{type:12,data:l},{type:12,data:o},{type:12,data:e.blockSize},...Ze(...t.map((w,A)=>w.dims),c)],E=w=>{let A=Re("data",t[0].dataType,t[0].dims.length),C=Re("inputIndices",t[1].dataType,t[1].dims.length),M=Re("scales",t[2].dataType,t[2].dims.length),O=t.length>3?Re("zeroPoint",t[3].dataType,t[3].dims.length):void 0,$=Xe("output",f,c.length),B=[A,C,M];O&&B.push(O);let U=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${w.registerUniforms(U).declareVariables(...B,$)}
        ${w.mainStart()}
        let output_indices = ${$.offsetToIndices("global_idx")};
        var indices_indices = ${C.type.indices}(0);
        ${n.length>1?`
          for (var i: u32 = 0; i < ${n.length}; i++) {
            let index = ${$.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${C.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${$.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${A.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${$.indicesGet("output_indices","i")};
          ${A.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${C.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${i[o]};
        }
        ${A.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${c.length}; i++) {
          let index = ${$.indicesGet("output_indices",`i + ${n.length} - 1`)};
          ${A.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${A.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${A.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${m?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${M.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${M.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${M.getByIndices("scale_indices")};
        ${O?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${O.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${O.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${m?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${On(f)}(quantized_data - zero_point) * scale;
        ${$.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${e.cacheKey};${t.filter((w,A)=>A!==1).map(w=>w.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:t.length},(w,A)=>"rank")},getRunData:()=>({outputs:[{dims:c,dataType:f}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:_}),getShaderSource:E}},OA=(t,e)=>{let i=t.inputs;KT(i,e),t.compute(YT(t.inputs,e))},IA=t=>Bt({blockSize:t.blockSize,gatherAxis:t.gatherAxis,quantizeAxis:t.quantizeAxis})}),QT,ZT,RA,MA,sI=Ue(()=>{at(),ht(),Ci(),mt(),QT=t=>{if(!t||t.length!==2)throw new Error("GatherElements requires 2 inputs.");if(t[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(t[0].dims.length!==t[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},ZT=(t,e)=>{let i=t[0].dims,n=t[0].dataType,s=i.length,o=t[1].dims,l=t[1].dataType,c=Ae.normalizeAxis(e.axis,s),h=i[c],f=o.slice(0),m=Ae.size(f),_=Re("input",n,s),E=Re("indicesInput",l,o.length),w=Xe("output",n,f.length),A=[{type:12,data:m},{type:6,data:h},{type:12,data:c}];return A.push(...Ze(i,o,f)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:f,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:A}),getShaderSource:C=>`
      ${C.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(_,E,w)}
      ${C.mainStart()}
      ${C.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${w.offsetToIndices("global_idx")};

      var idx = ${E.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${_.type.indices}(outputIndices);
      ${_.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${_.getByIndices("inputIndices")};

      ${w.setByOffset("global_idx","value")};
  }`}},RA=t=>Bt({axis:t.axis}),MA=(t,e)=>{let i=t.inputs;QT(i),t.compute(ZT(t.inputs,e))}}),JT,ex,NA,BA,aI=Ue(()=>{at(),ht(),mt(),JT=t=>{if(!t)throw new Error("Input is missing");if(t.length<2||t.length>3)throw new Error("Invaid input number.");if(t.length===3&&t[2].dims.length>2)throw new Error("Invalid input shape of C");if(t[0].dataType!==t[1].dataType||t.length===3&&t[0].dataType!==t[2].dataType)throw new Error("Input types are mismatched")},ex=(t,e)=>{let i=t[0].dims.slice(),n=t[1].dims.slice(),[s,o,l]=RE.getShapeOfGemmResult(i,e.transA,n,e.transB,t.length===3?t[2].dims:void 0),c=[s,o];if(!c)throw new Error("Can't use gemm on the given tensors");let h=16,f=Math.ceil(o/h),m=Math.ceil(s/h),_=!0,E=Ae.size(c),w=[{type:12,data:_?f:E},{type:12,data:s},{type:12,data:o},{type:12,data:l},{type:1,data:e.alpha},{type:1,data:e.beta}],A=["type","type"];t.length===3&&(w.push(...Ze(t[2].dims)),A.push("rank")),w.push(...Ze(c));let C=O=>{let $="";e.transA&&e.transB?$="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":e.transA&&!e.transB?$="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!e.transA&&e.transB?$="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!e.transA&&!e.transB&&($="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let B=e.alpha===1?"":"value *= uniforms.alpha;",U=Re("a",t[0].dataType,t[0].dims),j=Re("b",t[1].dataType,t[1].dims),W=U.type.value,z=null,Y=[U,j];t.length===3&&(z=Re("c",t[2].dataType,t[2].dims.length),Y.push(z));let L=Xe("output",t[0].dataType,c.length);Y.push(L);let H=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${O.registerUniforms(H).declareVariables(...Y)}

  ${O.mainStart()}
    ${O.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${W}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${$}
    }

    ${B}
    ${z!=null?`let cOffset = ${z.broadcastedIndicesToOffset("vec2(m, n)",L)}; value += ${W}(uniforms.beta) * ${z.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},M=O=>{let $=Re("a",t[0].dataType,t[0].dims),B=Re("b",t[1].dataType,t[1].dims),U=null,j=[$,B];t.length===3&&(U=Re("c",t[2].dataType,t[2].dims.length),j.push(U));let W=Xe("output",t[0].dataType,c.length);j.push(W);let z=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],Y="",L="";e.transA&&e.transB?(L=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${$.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${B.type.value}(0);
      }
      `,Y="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):e.transA&&!e.transB?(L=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${$.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${B.type.value}(0);
      }
      `,Y="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!e.transA&&e.transB?(L=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${$.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${B.type.value}(0);
      }
      `,Y="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!e.transA&&!e.transB&&(L=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${$.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${B.type.value}(0);
      }
      `,Y="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let H=e.alpha===1?"":"value *= uniforms.alpha;";return`
  ${O.registerUniforms(z).declareVariables(...j)}
  var<workgroup> tile_a: array<array<${$.type.storage}, ${h}>, ${h}>;
  var<workgroup> tile_b: array<array<${B.type.storage}, ${h}>, ${h}>;
  ${O.mainStart([h,h,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${h};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${h};
    let num_tiles = (uniforms.K - 1) / ${h} + 1;
    var k_start = 0u;
    var value = ${W.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${L}
      k_start = k_start + ${h};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${h}; k++) {
        ${Y}
      }
      workgroupBarrier();
    }

    ${H}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${U!=null?`let cOffset = ${U.broadcastedIndicesToOffset("vec2(m, n)",W)}; value += ${W.type.value}(uniforms.beta) * ${U.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return _?{name:"GemmShared",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:A},getRunData:()=>({outputs:[{dims:c,dataType:t[0].dataType}],dispatchGroup:{x:f*m},programUniforms:w}),getShaderSource:M}:{name:"Gemm",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:A},getRunData:()=>({outputs:[{dims:c,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(E/64)},programUniforms:w}),getShaderSource:C}},NA=t=>{let e=t.transA,i=t.transB,n=t.alpha,s=t.beta;return{transA:e,transB:i,alpha:n,beta:s,cacheKey:`${t.transA};${t.transB};${t.alpha===1}`}},BA=(t,e)=>{JT(t.inputs),t.compute(ex(t.inputs,e))}}),Js,Ga,Ml,Nl,tx,ix,nx,rx,sx,ax,ox,lx,LA,UA,oI=Ue(()=>{at(),ht(),Ci(),mt(),[Js,Ga,Ml,Nl]=[0,1,2,3],tx=t=>{if(t[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(t[0].dims.length!==t[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(t[0].dims.length-2!==t[1].dims[t[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${t[0].dims.length-2}`);if(t[0].dims[0]!==t[1].dims[0])throw new Error("grid batch size must match input batch size")},ix=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,nx=t=>`
  fn gs_bicubic_interpolate(p: mat4x4<${t}>, x: f32, y: f32) -> ${t} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${t}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,rx=t=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${t.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,sx=t=>`
  ${t.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,ax=(t,e,i)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${e} {
     var pixel = ${e}(0);
     var indices = vec4<u32>(0);
     indices[${Js}] = batch;
     indices[${Ga}] = channel;`+(()=>{switch(i.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${Ml}] = u32(r);
            indices[${Nl}] = u32(c);
          } else {
            return ${e}(0);
          }
        `;case"border":return`
          indices[${Ml}] = u32(clamp(r, 0, H - 1));
          indices[${Nl}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${Ml}] = gs_reflect(r, border[1], border[3]);
          indices[${Nl}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${i.paddingMode} is not supported`)}})()+`
    return ${t.getByIndices("indices")};
  }
`,ox=(t,e,i)=>(()=>{switch(i.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${Js}], indices[${Ga}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${Js}], indices[${Ga}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${Js}], indices[${Ga}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${Js}], indices[${Ga}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${Js}], indices[${Ga}], border);

          let dx2 = ${e}(f32(x2) - x);
          let dx1 = ${e}(x - f32(x1));
          let dy2 = ${e}(f32(y2) - y);
          let dy1 = ${e}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${e}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${Js}], indices[${Ga}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${i.mode} is not supported`)}})()+`${t.setByOffset("global_idx","result")}`,lx=(t,e)=>{let i=Re("x",t[0].dataType,t[0].dims.length),n=[t[1].dims[0],t[1].dims[1],t[1].dims[2]],s=Re("grid",t[1].dataType,n.length,2),o=[t[0].dims[0],t[0].dims[1],t[1].dims[1],t[1].dims[2]];e.format==="NHWC"&&(o=[t[0].dims[0],t[1].dims[1],t[1].dims[2],t[0].dims[3]],[Js,Ga,Ml,Nl]=[0,3,1,2]);let l=Xe("output",t[0].dataType,o.length),c=i.type.value,h=Ae.size(o),f=[{type:12,data:h},...Ze(t[0].dims,n,o)],m=_=>`
  ${_.registerUniform("output_size","u32").declareVariables(i,s,l)}
  ${ix}
  ${nx(c)}
  ${rx(e)}
  ${sx(e)}
  ${ax(i,c,e)}

  ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${Ml}]);
      let W_in = i32(uniforms.x_shape[${Nl}]);

      ${e.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${l.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${Js}], indices[${Ml}], indices[${Nl}]);
      let nxy = ${s.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${ox(l,c,e)}
  }`;return{name:"GridSample",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:["type","type"]},getRunData:_=>{let E=Ae.size(o);return{outputs:[{dims:o,dataType:_[0].dataType}],dispatchGroup:{x:Math.ceil(E/64)},programUniforms:f}},getShaderSource:m}},LA=(t,e)=>{tx(t.inputs),t.compute(lx(t.inputs,e))},UA=t=>Bt({alignCorners:t.align_corners,mode:t.mode,paddingMode:t.padding_mode,format:t.format})}),qn,ux,PA,qg,cx,Ld,zA,FA=Ue(()=>{at(),ht(),Ci(),jy(),Gy(),mt(),il(),qn=(t,e)=>t.length>e&&t[e].dims.length>0?t[e]:void 0,ux=(t,e)=>{let i=t[0],n=qn(t,1),s=qn(t,2),o=qn(t,3),l=qn(t,4),c=qn(t,5),h=qn(t,6),f=qn(t,7);if(i.dims.length!==3&&i.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let m=i.dims[0],_=i.dims[1],E=i.dims.length===3?i.dims[2]:e.numHeads*i.dims[4],w=_,A=0,C=0,M=Math.floor(E/e.numHeads);if(h&&f&&Ae.size(h.dims)&&Ae.size(f.dims)){if(h.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(h.dims[0]!==m||h.dims[1]!==e.numHeads||h.dims[3]!==M)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(f.dims[0]!==m||f.dims[1]!==e.numHeads||f.dims[3]!==M)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(h.dims[2]!==f.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(f.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');A=h.dims[2],C=h.dims[2]}else if(h&&Ae.size(h.dims)||f&&Ae.size(f.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let O;if(n&&Ae.size(n.dims)>0){if(i.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(n.dims.length<3||n.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(i.dims[0]!==n.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(n.dims.length===3){if(n.dims[2]!==i.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');O=2,w=n.dims[1]}else if(n.dims.length===5){if(n.dims[2]!==e.numHeads||n.dims[3]!==2||n.dims[4]!==M)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(s)throw new Error('Expect "value" be none when "key" has packed kv format.');O=5,w=n.dims[1]}else{if(n.dims[1]!==e.numHeads||n.dims[3]!==M)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');O=0,w=n.dims[2]}}else{if(i.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(i.dims[2]!==e.numHeads||i.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');O=3}if(o&&Ae.size(o.dims)>0){if(o.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(n&&n.dims.length===5&&n.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let $=A+w,B=0;if(l&&Ae.size(l.dims)>0){B=8;let z=l.dims;throw z.length===1?z[0]===m?B=1:z[0]===3*m+2&&(B=3):z.length===2&&z[0]===m&&z[1]===$&&(B=5),B===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let U=!1,j=E;if(s&&Ae.size(s.dims)>0){if(s.dims.length!==3&&s.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(i.dims[0]!==s.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(s.dims.length===3){if(w!==s.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');j=s.dims[2]}else{if(w!==s.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');j=s.dims[1]*s.dims[3],U=!0}}let W=!1;if(l&&Ae.size(l.dims)>0)throw new Error("Key padding mask is not supported");if(c&&Ae.size(c.dims)>0){if(c.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(c.dims[0]!==m||c.dims[1]!==e.numHeads||c.dims[2]!==_||c.dims[3]!==$)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:m,sequenceLength:_,pastSequenceLength:A,kvSequenceLength:w,totalSequenceLength:$,maxSequenceLength:C,inputHiddenSize:0,hiddenSize:E,vHiddenSize:j,headSize:M,vHeadSize:Math.floor(j/e.numHeads),numHeads:e.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:e.maskFilterValue,maskType:B,scale:e.scale,broadcastResPosBias:W,passPastInKv:U,qkvFormat:O}},PA=t=>Bt({...t}),qg=Bt({perm:[0,2,1,3]}),cx=(t,e,i,n,s,o,l)=>{let c=[n,s,o],h=Ae.size(c),f=[{type:12,data:h},{type:12,data:l},{type:12,data:o}],m=_=>{let E=Xe("qkv_with_bias",e.dataType,c),w=Re("qkv",e.dataType,c),A=Re("bias",i.dataType,c),C=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${_.registerUniforms(C).declareVariables(w,A,E)}
  ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return t.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:c,dataType:e.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:f}),getShaderSource:m},{inputs:[e,i],outputs:[-1]})[0]},Ld=(t,e,i,n,s,o,l,c)=>{let h=o;if(l&&Ae.size(l.dims)>0){if(n===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return h=cx(t,o,l,e,n,i*s,c),h=h.reshape([e,n,i,s]),i===1||n===1?h:t.compute($r(h,qg.perm),{inputs:[h],outputs:[-1]})[0]}else return o.dims.length===3&&(h=o.reshape([e,n,i,s])),i===1||n===1?h:t.compute($r(h,qg.perm),{inputs:[h],outputs:[-1]})[0]},zA=(t,e)=>{let i=ux(t.inputs,e),n=t.inputs[0],s=qn(t.inputs,1),o=qn(t.inputs,2),l=qn(t.inputs,3),c=qn(t.inputs,4),h=qn(t.inputs,5),f=qn(t.inputs,6),m=qn(t.inputs,7);if(n.dims.length===5)throw new Error("Packed QKV is not implemented");if(s?.dims.length===5)throw new Error("Packed KV is not implemented");let _=s&&o&&s.dims.length===4&&o.dims.length===4,E=Ld(t,i.batchSize,i.numHeads,i.sequenceLength,i.headSize,n,l,0);if(_)return Kd(t,E,s,o,c,void 0,f,m,h,i);if(!s||!o)throw new Error("key and value must be provided");let w=Ld(t,i.batchSize,i.numHeads,i.kvSequenceLength,i.headSize,s,l,i.hiddenSize),A=Ld(t,i.batchSize,i.numHeads,i.kvSequenceLength,i.vHeadSize,o,l,2*i.hiddenSize);Kd(t,E,w,A,c,void 0,f,m,h,i)}}),dx,hx,fx,px,ey,qA,jA,HA=Ue(()=>{at(),ht(),Ci(),mt(),dx=t=>{if(!t||t.length<1)throw new Error("too few inputs")},hx=(t,e)=>{let i=[],n=e.numOutputs;return t[1].dims[0]>0&&(t[1].getBigInt64Array().forEach(s=>i.push(Number(s))),n=i.length),Bt({numOutputs:n,axis:e.axis,splitSizes:i})},fx=t=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${t}u; i += 1u ) {
    if (index < ${Ye("uniforms.size_in_split_axis","i",t)}) {
        return i;
    }
    }
    return ${t}u;
}`,px=t=>{let e=t.length,i=[];for(let n=0;n<e;++n){let s=t[n].setByIndices("indices","input[global_idx]");e===1?i.push(s):n===0?i.push(`if (output_number == ${n}u) { ${s} }`):n===e-1?i.push(`else { ${s} }`):i.push(`else if (output_number == ${n}) { ${s} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${t[0].type.indices}, global_idx: u32) {
        ${i.join(`
`)}
      }`},ey=(t,e)=>{let i=t[0].dims,n=Ae.size(i),s=t[0].dataType,o=Ae.normalizeAxis(e.axis,i.length),l=new Array(e.numOutputs),c=Re("input",s,i.length),h=new Array(e.numOutputs),f=[],m=[],_=0,E=[{type:12,data:n}];for(let A=0;A<e.numOutputs;A++){_+=e.splitSizes[A],h[A]=_;let C=i.slice();C[o]=e.splitSizes[A],m.push(C),l[A]=Xe(`output${A}`,s,C.length),f.push({dims:m[A],dataType:t[0].dataType})}E.push({type:12,data:h},...Ze(i,...m));let w=A=>`
  ${A.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",h.length).declareVariables(c,...l)}
  ${fx(h.length)}
  ${px(l)}

  ${A.mainStart()}
    ${A.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${c.offsetToIndices("global_idx")};
    var index = ${c.indicesGet("indices",o)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${Ye("uniforms.size_in_split_axis","output_number - 1u",h.length)};
      ${c.indicesSet("indices",o,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:e.cacheKey,inputDependencies:["rank"]},getShaderSource:w,getRunData:()=>({outputs:f,dispatchGroup:{x:Math.ceil(n/64)},programUniforms:E})}},qA=(t,e)=>{dx(t.inputs);let i=t.inputs.length===1?e:hx(t.inputs,e);t.compute(ey(t.inputs,i),{inputs:[0]})},jA=t=>{let e=t.axis,i=t.splitSizes,n=t.numOutputs<0?i.length:t.numOutputs;if(n!==i.length)throw new Error("numOutputs and splitSizes length must be equal");return Bt({axis:e,numOutputs:n,splitSizes:i})}}),mx,Pf,VA,GA=Ue(()=>{at(),ht(),Ci(),mt(),mx=(t,e)=>{let[i,n,s,o]=t,{numHeads:l,rotaryEmbeddingDim:c}=e;if(i.dims.length!==3&&i.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${i.dims.length}`);if(!Ae.areEqual(n.dims,[])&&!Ae.areEqual(n.dims,[1])&&n.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${n.dims.length}`);if(s.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${s.dims.length}`);if(o.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${o.dims.length}`);if(!Ae.areEqual(s.dims,o.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(c>0&&l===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let h=i.dims[0],f=i.dims[i.dims.length-2],m=s.dims[0],_=Ae.sizeFromDimension(i.dims,1)/f,E=c===0?s.dims[1]*2:_/l;if(c>E)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(n.dims.length===2){if(h!==n.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${n.dims[0]}`);if(f!==n.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${n.dims[1]}`)}if(E/2!==s.dims[1]&&c/2!==s.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${s.dims[1]}`);if(f>m)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},Pf=(t,e)=>{let{interleaved:i,numHeads:n,rotaryEmbeddingDim:s,scale:o}=e,l=t[0].dims[0],c=Ae.sizeFromDimension(t[0].dims,1),h=t[0].dims[t[0].dims.length-2],f=c/h,m=t[2].dims[1],_=s===0?m*2:f/n,E=new Array(l,h,f/_,_-m),w=Ae.computeStrides(E),A=[{type:1,data:o},{type:12,data:E},{type:12,data:w},...t[0].dims.length===3?new Array({type:12,data:[c,f,_,1]}):[],...t[0].dims.length===4?new Array({type:12,data:[c,_,h*_,1]}):[],...Ze(t[0].dims,t[1].dims,t[2].dims,t[3].dims,t[0].dims)],C=M=>{let O=Re("input",t[0].dataType,t[0].dims.length),$=Re("position_ids",t[1].dataType,t[1].dims.length),B=Re("cos_cache",t[2].dataType,t[2].dims.length),U=Re("sin_cache",t[3].dataType,t[3].dims.length),j=Xe("output",t[0].dataType,t[0].dims.length);return M.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:E.length},{name:"global_strides",type:"u32",length:w.length},{name:"input_output_strides",type:"u32",length:w.length}]),`
        ${M.declareVariables(O,$,B,U,j)}

        ${M.mainStart(lc)}
          let half_rotary_emb_dim = uniforms.${B.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${M.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${$.broadcastedIndicesToOffset("bsnh.xy",Xe("",$.type.tensor,2))};
            let position_id =
                u32(${$.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${i});
            let j = i + select(half_rotary_emb_dim, 1, ${i});
            let re = ${O.getByOffset("i")} * ${B.get("position_id","bsnh[3]")} -
                ${O.getByOffset("j")} * ${U.get("position_id","bsnh[3]")};
            ${j.setByOffset("i","re")}
            let im = ${O.getByOffset("i")} * ${U.get("position_id","bsnh[3]")} +
                ${O.getByOffset("j")} * ${B.get("position_id","bsnh[3]")};
            ${j.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${j.setByOffset("k",O.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:Bt({interleaved:i}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:C,getRunData:()=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(Ae.size(E)/lc)},programUniforms:A})}},VA=(t,e)=>{mx(t.inputs,e),t.compute(Pf(t.inputs,e))}}),gx,yx,jg,_x,WA,lI=Ue(()=>{Ci(),at(),Gy(),FA(),HA(),il(),GA(),mt(),gx=(t,e)=>{if(e.doRotary&&t.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let i=t[0],n=t[1],s=t[2],o=t[3],l=t[4];if(e.doRotary!==0&&t.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(e.localWindowSize!==-1)throw new Error("Local attention is not supported");if(e.softcap!==0)throw new Error("Softcap is not supported");if(e.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(e.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(i.dims.length!==3&&i.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let c=!1,h=i.dims[0],f=i.dims[1],m=i.dims.length===3?c?i.dims[2]/3:i.dims[2]:e.numHeads*i.dims[4],_=f,E=0,w=!n||n.dims.length===0,A=Math.floor(w?m/(e.numHeads+2*e.kvNumHeads):m/e.numHeads);w&&(m=A*e.numHeads);let C=o&&o.dims.length!==0,M=l&&l.dims.length!==0;if(C&&o.dims.length===4&&o.dims[0]===h&&o.dims[1]!==e.kvNumHeads&&o.dims[2]===e.kvNumHeads&&o.dims[3]===A)throw new Error("BSNH pastKey/pastValue is not supported");if(C&&M){if(o.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(l.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');E=o.dims[2]}else if(C||M)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let O=1;if(n&&n.dims.length>0){if(i.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(n.dims.length<3||n.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(i.dims[0]!==n.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(n.dims.length===3){if(i.dims[2]%n.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');_=n.dims[1]}else if(n.dims.length===5){if(n.dims[2]!==e.numHeads||n.dims[3]!==2||n.dims[4]!==A)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(s)throw new Error('Expect "value" be none when "key" has packed kv format.');_=n.dims[1]}else{if(n.dims[1]!==e.numHeads||n.dims[3]!==A)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');_=n.dims[2]}}else{if(i.dims.length!==3&&i.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(i.dims.length===5&&(i.dims[2]!==e.numHeads||i.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');O=3}let $=0,B=!1,U=e.kvNumHeads?A*e.kvNumHeads:m;if(s&&s.dims.length>0){if(s.dims.length!==3&&s.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(i.dims[0]!==s.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(s.dims.length===3){if(_!==s.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');U=s.dims[2]}else{if(_!==s.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');U=s.dims[1]*s.dims[3],B=!0}}let j=t.length>4?t[5]:void 0;if(j&&j.dims.length!==1&&j.dims[0]!==h)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:h,sequenceLength:f,pastSequenceLength:E,kvSequenceLength:_,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:m,vHiddenSize:U,headSize:A,vHeadSize:Math.floor(U/e.kvNumHeads),numHeads:e.numHeads,kvNumHeads:e.kvNumHeads,nReps:e.numHeads/e.kvNumHeads,pastPresentShareBuffer:!1,maskType:$,scale:e.scale,broadcastResPosBias:!1,passPastInKv:B,qkvFormat:O}},yx=Bt({perm:[0,2,1,3]}),jg=(t,e,i)=>{let n=e,s=i.kvNumHeads;return e.dims.length===3&&i.kvSequenceLength!==0&&(n=e.reshape([i.batchSize,i.kvSequenceLength,s,i.headSize]),n=t.compute($r(n,yx.perm),{inputs:[n],outputs:[-1]})[0]),n},_x=(t,e,i,n)=>{let s=7,o=["type","type"],l=[t*e],c=t*e,h=[{type:12,data:c},{type:12,data:e},{type:12,data:t}],f=m=>{let _=Re("seq_lens",i.dataType,i.dims),E=Re("total_seq_lens",n.dataType,n.dims),w=Xe("pos_ids",s,l),A=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${m.registerUniforms(A).declareVariables(_,E,w)}
  ${m.mainStart()}
    ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${E.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${_.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${w.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${w.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${w.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${t};${e}`,inputDependencies:o},getRunData:()=>({outputs:[{dims:l,dataType:s}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:h}),getShaderSource:f}},WA=(t,e)=>{let i=gx(t.inputs,e);if(t.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(t.inputs[1]?.dims.length===5)throw new Error("Packed KV is not implemented");let n=t.inputs[0],s=t.inputs[1]&&t.inputs[1].dims.length>0?t.inputs[1]:void 0,o=t.inputs[2]&&t.inputs[2].dims.length>0?t.inputs[2]:void 0,l=t.inputs[3]&&t.inputs[3].dims.length!==0?t.inputs[3]:void 0,c=t.inputs[4]&&t.inputs[4].dims.length!==0?t.inputs[4]:void 0,h=t.inputs.length>4?t.inputs[5]:void 0,f=t.inputs.length>5?t.inputs[6]:void 0,m=i.kvNumHeads?i.kvNumHeads:i.numHeads,_=Bt({axis:2,numOutputs:3,splitSizes:[i.numHeads*i.headSize,m*i.headSize,m*i.headSize]}),[E,w,A]=!s&&!o?t.compute(ey([n],_),{inputs:[n],outputs:[-1,-1,-1]}):[n,s,o],C,M;if(e.doRotary){let U=t.compute(_x(i.batchSize,i.sequenceLength,h,f),{inputs:[h,f],outputs:[-1]})[0],j=t.inputs[7],W=t.inputs[8],z=Bt({interleaved:e.rotaryInterleaved!==0,numHeads:i.numHeads,rotaryEmbeddingDim:0,scale:e.scale}),Y=[E,U,j,W],L=[-1];C=t.compute(Pf(Y,z),{inputs:Y,outputs:L})[0],Y.splice(0,1,w);let H=Bt({interleaved:e.rotaryInterleaved!==0,numHeads:i.kvNumHeads,rotaryEmbeddingDim:0,scale:e.scale});M=t.compute(Pf(Y,H),{inputs:Y,outputs:L})[0]}let O=Ld(t,i.batchSize,i.numHeads,i.sequenceLength,i.headSize,e.doRotary?C:E,void 0,0),$=jg(t,e.doRotary?M:w,i),B=jg(t,A,i);Kd(t,O,$,B,void 0,void 0,l,c,void 0,i,h,f)}}),Hg,vx,bx,XA,uI=Ue(()=>{at(),ht(),il(),mt(),Hg=(t,e,i,n,s,o,l,c)=>{let h=xi(o),f=h===1?"f32":`vec${h}f`,m=h===1?"vec2f":`mat2x${h}f`,_=s*l,E=64;_===1&&(E=256);let w=[s,l,o/h],A=[s,l,2],C=["rank","type","type"],M=[];M.push(...Ze(w,A));let O=$=>{let B=Re("x",e.dataType,3,h),U=Re("scale",i.dataType,i.dims),j=Re("bias",n.dataType,n.dims),W=Xe("output",1,3,2),z=[B,U,j,W];return`
  var<workgroup> workgroup_shared : array<${m}, ${E}>;
  const workgroup_size = ${E}u;
  ${$.declareVariables(...z)}
  ${$.mainStart(E)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${f}(0);
    var squared_sum = ${f}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${f}(${B.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${m}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${Jo("workgroup_shared[0][0]",h)} / f32(hight * ${h});
      let squared_sum_final = ${Jo("workgroup_shared[0][1]",h)} / f32(hight * ${h});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${c}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return t.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${h};${c};${E}`,inputDependencies:C},getRunData:()=>({outputs:[{dims:A,dataType:1}],dispatchGroup:{x:_},programUniforms:M}),getShaderSource:O},{inputs:[e,i,n],outputs:[-1]})[0]},vx=(t,e,i)=>{let n=e[0].dims,s=n,o=2,l=n[0],c=n[1],h=Ae.sizeFromDimension(n,o),f=xi(h),m=Ae.size(s)/f,_=Hg(t,e[0],e[1],e[2],l,h,c,i.epsilon),E=[l,c,h/f],w=[l,c],A=["type","none"],C=M=>{let O=Re("x",e[0].dataType,E.length,f),$=Re("scale_shift",1,w.length,2),B=Xe("output",e[0].dataType,E.length,f),U=[O,$,B];return`
  ${M.registerUniform("output_size","u32").declareVariables(...U)}
  ${M.mainStart()}
  ${M.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${B.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${$.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${O.getByOffset("global_idx")} * ${B.type.value}(scale_shift.x) + ${B.type.value}(scale_shift.y);
      ${B.setByOffset("global_idx","value")};
  }`};t.compute({name:"InstanceNormalization",shaderCache:{hint:`${f}`,inputDependencies:A},getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:[{type:12,data:m},...Ze(E,w,E)]}),getShaderSource:C},{inputs:[e[0],_]})},bx=(t,e,i)=>{let n=e[0].dims,s=n,o=n[0],l=n[n.length-1],c=Ae.sizeFromDimension(n,1)/l,h=xi(l),f=Ae.size(s)/h,m=[{type:12,data:c},{type:12,data:Math.floor(l/h)}],_=["type","type"],E=!1,w=[0,n.length-1];for(let O=0;O<n.length-2;O++)E=E||n[O+1]!==1,w.push(O+1);E=E&&n[n.length-1]!==1;let A=E?t.compute($r(t.inputs[0],w),{inputs:[t.inputs[0]],outputs:[-1]})[0]:t.inputs[0].reshape(Array.from({length:n.length},(O,$)=>n[w[$]])),C=Hg(t,A,e[1],e[2],o,c,l,i.epsilon),M=O=>{let $=en(e[0].dataType),B=h===1?"vec2f":`mat${h}x2f`,U=z=>{let Y=z===0?"x":"y",L=h===1?"f32":`vec${h}f`;switch(h){case 1:return`${$}(${L}(scale.${Y}))`;case 2:return`vec2<${$}>(${L}(scale[0].${Y}, scale[1].${Y}))`;case 4:return`vec4<${$}>(${L}(scale[0].${Y}, scale[1].${Y}, scale[2].${Y}, scale[3].${Y}))`;default:throw new Error(`Not supported compoents ${h}`)}},j=Re("input",e[0].dataType,e[0].dims,h),W=Xe("output",e[0].dataType,s,h);return`
  @group(0) @binding(0) var<storage, read> input : array<${j.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${B}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${W.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${O.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${U(0)}, ${U(1)});
  }`};t.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${h}`,inputDependencies:_},getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:m}),getShaderSource:M},{inputs:[e[0],C]})},XA=(t,e)=>{e.format==="NHWC"?bx(t,t.inputs,e):vx(t,t.inputs,e)}}),Tx,xx,KA,cI=Ue(()=>{at(),ht(),mt(),Tx=t=>{if(!t||t.length<2)throw new Error("layerNorm requires at least 2 inputs.")},xx=(t,e,i)=>{let n=e.simplified,s=t[0].dims,o=t[1],l=!n&&t[2],c=s,h=Ae.normalizeAxis(e.axis,s.length),f=Ae.sizeToDimension(s,h),m=Ae.sizeFromDimension(s,h),_=Ae.size(o.dims),E=l?Ae.size(l.dims):0;if(_!==m||l&&E!==m)throw new Error(`Size of X.shape()[axis:] == ${m}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${_} and bias size of ${E}`);let w=[];for(let j=0;j<s.length;++j)j<h?w.push(s[j]):w.push(1);let A=xi(m),C=["type","type"],M=[{type:12,data:f},{type:1,data:m},{type:12,data:Math.floor(m/A)},{type:1,data:e.epsilon}];l&&C.push("type");let O=i>1,$=i>2,B=j=>{let W=en(t[0].dataType),z=[Re("x",t[0].dataType,t[0].dims,A),Re("scale",o.dataType,o.dims,A)];l&&z.push(Re("bias",l.dataType,l.dims,A)),z.push(Xe("output",t[0].dataType,c,A)),O&&z.push(Xe("mean_data_output",1,w)),$&&z.push(Xe("inv_std_output",1,w));let Y=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${j.registerUniforms(Y).declareVariables(...z)}
  ${j.mainStart()}
    ${j.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${V0("f32",A)};
    var mean_square_vector = ${V0("f32",A)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${Xu(W,A,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${Jo("mean_vector",A)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${Jo("mean_square_vector",A)} / uniforms.norm_size ${n?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${Xu(W,A,"x[j + offset]")};
      let f32scale = ${Xu(W,A,"scale[j]")};
      output[j + offset] = ${z[0].type.value}((f32input ${n?"":"- mean"}) * inv_std_dev * f32scale
        ${l?`+ ${Xu(W,A,"bias[j]")}`:""}
      );
    }

    ${O?"mean_data_output[global_idx] = mean":""};
    ${$?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},U=[{dims:c,dataType:t[0].dataType}];return O&&U.push({dims:w,dataType:1}),$&&U.push({dims:w,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${A};${i};${n}`,inputDependencies:C},getRunData:()=>({outputs:U,dispatchGroup:{x:Math.ceil(f/64)},programUniforms:M}),getShaderSource:B}},KA=(t,e)=>{Tx(t.inputs),t.compute(xx(t.inputs,e,t.outputCount))}}),Sx,YA,dI=Ue(()=>{ht(),Qy(),Zy(),Sx=t=>{if(!t||t.length!==2)throw new Error("MatMul requires 2 inputs.");if(t[0].dims[t[0].dims.length-1]!==t[1].dims[t[1].dims.length-2])throw new Error("shared dimension does not match.")},YA=t=>{Sx(t.inputs);let e=oc.calcShape(t.inputs[0].dims,t.inputs[1].dims,!0);if(!e)throw new Error("Can't use matmul on the given tensors");let i=e[e.length-1],n=t.inputs[0].dims[t.inputs[0].dims.length-1];if(i<8&&n<8)t.compute(Yy(t.inputs,{activation:""},e));else{let s=e[e.length-2],o=Ae.size(t.inputs[0].dims.slice(0,-2)),l=Ae.size(t.inputs[1].dims.slice(0,-2));if(o!==1&&s===1&&l===1){let c=t.inputs[0].reshape([1,o,n]),h=t.inputs[1].reshape([1,n,i]),f=[1,o,i],m=[c,h];t.compute(Uf(m,{activation:""},e,f),{inputs:m})}else t.compute(Uf(t.inputs,{activation:""},e))}}}),wx,Ex,Cx,QA,ZA,hI=Ue(()=>{at(),ht(),Ci(),mt(),wx=(t,e)=>{if(t.length<3||t.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let i=t[0],n=i.dims.length;if(i.dims[n-1]!==e.k)throw new Error("The last dim of input shape does not match the k value");let s=Math.floor((e.k+e.blockSize-1)/e.blockSize),o=e.blockSize/8*e.bits,l=t[1];if(!Ae.areEqual(l.dims,[e.n,s,o]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let c=t[2].dims;if(Ae.size(c)!==e.n*s)throw new Error("scales input size error.");if(t.length===4){let h=t[3].dims,f=e.n*(e.bits===8?s:Math.floor((s*e.bits+7)/8));if(Ae.size(h)!==f)throw new Error("zeroPoints input size error.")}},Ex=(t,e)=>{let i=t[0].dims,n=i.length,s=i[n-2],o=e.k,l=e.n,c=i.slice(0,n-2),h=Ae.size(c),f=t[1].dims[2]/4,m=t[0].dataType,_=xi(e.k),E=xi(f),w=xi(l),A=c.concat([s,l]),C=s>1&&l/w%2===0?2:1,M=Ae.size(A)/w/C,O=64,$=[],B=[h,s,o/_],U=Ae.convertShape(t[1].dims).slice();U.splice(-1,1,f/E),$.push(...Ze(B)),$.push(...Ze(U)),$.push(...Ze(t[2].dims)),t.length===4&&$.push(...Ze(Ae.convertShape(t[3].dims)));let j=[h,s,l/w];$.push(...Ze(j));let W=z=>{let Y=B.length,L=Re("a",t[0].dataType,Y,_),H=Re("b",12,U.length,E),se=Re("scales",t[2].dataType,t[2].dims.length),ae=[L,H,se],ce=t.length===4?Re("zero_points",12,t[3].dims.length):void 0;ce&&ae.push(ce);let fe=j.length,be=Xe("output",t[0].dataType,fe,w),J=en(t[0].dataType),ee=(()=>{switch(_){case 1:return`array<${J}, 8>`;case 2:return`mat4x2<${J}>`;case 4:return`mat2x4<${J}>`;default:throw new Error(`${_}-component is not supported.`)}})(),de=()=>{let P=`
          // reuse a data
            var input_offset = ${L.indicesToOffset(`${L.type.indices}(batch, row, word_offset)`)};
            var a_data: ${ee};
            for (var j: u32 = 0; j < ${8/_}; j++) {
              a_data[j] = ${L.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let ne=0;ne<w*C;ne++)P+=`
            b_value = ${E===1?`b${ne}_data`:`b${ne}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${ee}(${Array.from({length:4},(ye,ke)=>`${J}(b_value_lower[${ke}]), ${J}(b_value_upper[${ke}])`).join(", ")});
            b_dequantized_values = ${_===1?`${ee}(${Array.from({length:8},(ye,ke)=>`(b_quantized_values[${ke}] - ${ce?`zero_point${ne}`:"zero_point"}) * scale${ne}`).join(", ")});`:`(b_quantized_values - ${ee}(${Array(8).fill(`${ce?`zero_point${ne}`:"zero_point"}`).join(",")})) * scale${ne};`};
            workgroup_shared[local_id.x * ${C} + ${Math.floor(ne/w)}]${w>1?`[${ne%w}]`:""} += ${Array.from({length:8/_},(ye,ke)=>`${_===1?`a_data[${ke}] * b_dequantized_values[${ke}]`:`dot(a_data[${ke}], b_dequantized_values[${ke}])`}`).join(" + ")};
          `;return P},ue=()=>{let P=`
            var col_index = col * ${w};
            ${ce?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${J}(8);`}
            `;for(let ne=0;ne<w*C;ne++)P+=`
            let scale${ne} = ${se.getByOffset("col_index * nBlocksPerCol + block")};
            ${ce?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${ce.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${ne} = ${J}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return P},ve=()=>{let P=`col_index = col * ${w};`;for(let ne=0;ne<w*C;ne++)P+=`
            let b${ne}_data = ${H.getByIndices(`${H.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return P+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${ee};
            var b_dequantized_values: ${ee};`,P};return`
        var<workgroup> workgroup_shared: array<${be.type.value}, ${C*O}>;
        ${z.declareVariables(...ae,be)}
        ${z.mainStart([O,1,1])}
          let output_indices = ${be.offsetToIndices(`(global_idx / ${O}) * ${C}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${O}) {
            //process one block
            var word_offset: u32 = block * ${e.blockSize/_};
            ${ue()}
            for (var word: u32 = 0; word < ${f}; word += ${E}) {
              ${ve()}
              for (var i: u32 = 0; i < ${E}; i++) {
                ${de()}
                word_offset += ${8/_};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${C}) {
            var output_value: ${be.type.value} = ${be.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${O}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${C};
            }
            ${be.setByIndices(`${be.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${e.blockSize};${e.bits};${_};${E};${w};${C};${O}`,inputDependencies:Array(t.length).fill("rank")},getRunData:()=>({outputs:[{dims:A,dataType:m}],dispatchGroup:{x:M},programUniforms:$}),getShaderSource:W}},Cx=(t,e)=>{let i=t[0].dims,n=i.length,s=i[n-2],o=e.k,l=e.n,c=i.slice(0,n-2),h=Ae.size(c),f=t[1].dims[2]/4,m=t[0].dataType,_=xi(e.k),E=xi(f),w=c.concat([s,l]),A=128,C=l%8===0?8:l%4===0?4:1,M=A/C,O=M*E*8,$=O/_,B=O/e.blockSize,U=Ae.size(w)/C,j=[],W=[h,s,o/_],z=Ae.convertShape(t[1].dims).slice();z.splice(-1,1,f/E),j.push(...Ze(W)),j.push(...Ze(z)),j.push(...Ze(t[2].dims)),t.length===4&&j.push(...Ze(Ae.convertShape(t[3].dims)));let Y=[h,s,l];j.push(...Ze(Y));let L=H=>{let se=W.length,ae=Re("a",t[0].dataType,se,_),ce=Re("b",12,z.length,E),fe=Re("scales",t[2].dataType,t[2].dims.length),be=[ae,ce,fe],J=t.length===4?Re("zero_points",12,t[3].dims.length):void 0;J&&be.push(J);let ee=Y.length,de=Xe("output",t[0].dataType,ee),ue=en(t[0].dataType),ve=()=>{switch(_){case 1:return`
          let a_data0 = vec4<${ue}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${ue}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${ue}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${ue}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${_}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${ae.type.value}, ${$}>;
        var<workgroup> inter_results: array<array<${de.type.value}, ${M}>, ${C}>;
        ${H.declareVariables(...be,de)}
        ${H.mainStart([M,C,1])}
          let output_indices = ${de.offsetToIndices(`workgroup_index * ${C}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${B} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${$};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${$}; a_offset += ${A})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${ae.getByIndices(`${ae.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${ae.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${B} + local_id.x;
            ${J?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${J.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${ue}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${ue}(8);`}
            let scale = ${fe.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${ce.getByIndices(`${ce.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${e.blockSize/_};
            for (var i: u32 = 0; i < ${E}; i++) {
              ${ve()}
              let b_value = ${E===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${ue}>(${Array.from({length:4},(P,ne)=>`${ue}(b_value_lower[${ne}]), ${ue}(b_value_upper[${ne}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${ue}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(P,ne)=>`${`dot(a_data${ne}, b_dequantized_values[${ne}])`}`).join(" + ")};
              word_offset += ${8/_};
            }
            workgroupBarrier();
          }

          if (local_idx < ${C}) {
            var output_value: ${de.type.value} = ${de.type.value}(0);
            for (var b = 0u; b < ${M}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${de.setByIndices(`${de.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${e.blockSize};${_};${E};${M};${C}`,inputDependencies:Array(t.length).fill("rank")},getRunData:()=>({outputs:[{dims:w,dataType:m}],dispatchGroup:{x:U},programUniforms:j}),getShaderSource:L}},QA=(t,e)=>{wx(t.inputs,e),e.blockSize===32&&t.adapterInfo.isVendor("intel")&&t.adapterInfo.isArchitecture("gen-12lp")?t.compute(Cx(t.inputs,e)):t.compute(Ex(t.inputs,e))},ZA=t=>Bt(t)}),Ax,Dx,kx,$x,Ox,Ix,Rx,Mx,JA,fI=Ue(()=>{at(),ht(),mt(),Ax=t=>{if(!t||t.length<1)throw new Error("Too few inputs");if(t[0].dataType!==1&&t[0].dataType!==10)throw new Error("Input type must be float or float16.");if(t.length>=2){let e=t[0].dims.length*2===t[1].dims[0];if(t.length===4&&(e=t[3].dims[0]*2===t[1].dims[0]),!e)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},Dx=(t,e,i)=>{let n="";for(let s=e-1;s>=0;--s)n+=`
            k = i32(${t.indicesGet("indices",s)}) - ${Ye("uniforms.pads",s,i)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${Ye("uniforms.x_shape",s,e)})) {
              break;
            }
            offset += k * i32(${Ye("uniforms.x_strides",s,e)});
        `;return`
          value = ${t.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${n}
            value = x[offset];
          }
      `},kx=(t,e,i)=>{let n="";for(let s=e-1;s>=0;--s)n+=`
                k = i32(${t.indicesGet("indices",s)}) - ${Ye("uniforms.pads",s,i)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${Ye("uniforms.x_shape",s,e)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${Ye("uniforms.x_shape",s,e)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${Ye("uniforms.x_strides",s,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},$x=(t,e,i)=>{let n="";for(let s=e-1;s>=0;--s)n+=`
                k = i32(${t.indicesGet("indices",s)}) - ${Ye("uniforms.pads",s,i)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${Ye("uniforms.x_shape",s,e)})) {
                  k = i32(${Ye("uniforms.x_shape",s,e)}) - 1;
                }
                offset += k * i32(${Ye("uniforms.x_strides",s,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},Ox=(t,e,i)=>{let n="";for(let s=e-1;s>=0;--s)n+=`
                k = i32(${t.indicesGet("indices",s)}) - ${Ye("uniforms.pads",s,i)};
                if (k < 0)  {
                  k += i32(${Ye("uniforms.x_shape",s,e)}]);
                }
                if (k >= i32(${Ye("uniforms.x_shape",s,e)})) {
                  k -= i32(${Ye("uniforms.x_shape",s,e)});
                }
                offset += k * i32(${Ye("uniforms.x_strides",s,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},Ix=(t,e,i)=>{switch(i.mode){case 0:return Dx(t,e,i.pads.length);case 1:return kx(t,e,i.pads.length);case 2:return $x(t,e,i.pads.length);case 3:return Ox(t,e,i.pads.length);default:throw new Error("Invalid mode")}},Rx=(t,e)=>{let i=Ae.padShape(t[0].dims.slice(),e.pads),n=t[0].dims,s=Ae.size(i),o=[{type:12,data:s},{type:6,data:e.pads}],l=t.length>=3&&t[2].data;e.mode===0&&o.push({type:l?t[2].dataType:1,data:e.value}),o.push(...Ze(t[0].dims,i));let c=["rank"],h=f=>{let m=Xe("output",t[0].dataType,i.length),_=Re("x",t[0].dataType,n.length),E=_.type.value,w=Ix(m,n.length,e),A=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:e.pads.length}];return e.mode===0&&A.push({name:"constant_value",type:l?E:"f32"}),`
            ${f.registerUniforms(A).declareVariables(_,m)}
            ${f.mainStart()}
            ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${m.offsetToIndices("global_idx")};

            var value = ${E}(0);
            ${w}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${e.mode}${l}`,inputDependencies:c},getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(Ae.size(i)/64)},programUniforms:o}),getShaderSource:h}},Mx=(t,e)=>{if(t.length>1){let i=t[1].getBigInt64Array(),n=t.length>=3&&t[2].data?t[2].dataType===10?t[2].getUint16Array()[0]:t[2].getFloat32Array()[0]:0,s=t[0].dims.length,o=new Int32Array(2*s).fill(0);if(t.length>=4){let c=t[3].getBigInt64Array();for(let h=0;h<c.length;h++)o[Number(c[h])]=Number(i[h]),o[Number(c[h])+s]=Number(i[h+c.length])}else i.forEach((c,h)=>o[Number(h)]=Number(c));let l=[];return o.forEach(c=>l.push(c)),{mode:e.mode,value:n,pads:l}}else return e},JA=(t,e)=>{Ax(t.inputs);let i=Mx(t.inputs,e);t.compute(Rx(t.inputs,i),{inputs:[0]})}}),Ed,Vg,Gg,Wg,Xg,Nx,Bx,Kg,Yg,e3,t3,Qg,i3,n3,Zg,r3,s3,a3,o3,pI=Ue(()=>{is(),at(),ht(),mt(),Ed=t=>{if(ui.webgpu.validateInputContent&&(!t||t.length!==1))throw new Error("Pool ops requires 1 input.")},Vg=(t,e,i)=>{let n=e.format==="NHWC",s=t.dims.slice();n&&s.splice(1,0,s.pop());let o=Object.hasOwnProperty.call(e,"dilations"),l=e.kernelShape.slice(),c=e.strides.slice(),h=o?e.dilations.slice():[],f=e.pads.slice();Bf.adjustPoolAttributes(i,s,l,c,h,f);let m=Bf.computePoolOutputShape(i,s,c,h,l,f,e.autoPad),_=Object.assign({},e);o?Object.assign(_,{kernelShape:l,strides:c,pads:f,dilations:h,cacheKey:e.cacheKey}):Object.assign(_,{kernelShape:l,strides:c,pads:f,cacheKey:e.cacheKey});let E=m.slice();return E.push(E.splice(1,1)[0]),[_,n?E:m]},Gg=(t,e)=>{let i=e.format==="NHWC",n=Ae.size(t),s=Ae.size(e.kernelShape),o=[{type:12,data:n},{type:12,data:s}],l=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(e.kernelShape.length<=2){let c=e.kernelShape[e.kernelShape.length-1],h=e.strides[e.strides.length-1],f=e.pads[e.pads.length/2-1],m=e.pads[e.pads.length-1],_=!!(f+m);o.push({type:12,data:c},{type:12,data:h},{type:12,data:f},{type:12,data:m}),l.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let E=!1;if(e.kernelShape.length===2){let w=e.kernelShape[e.kernelShape.length-2],A=e.strides[e.strides.length-2],C=e.pads[e.pads.length/2-2],M=e.pads[e.pads.length-2];E=!!(C+M),o.push({type:12,data:w},{type:12,data:A},{type:12,data:C},{type:12,data:M}),l.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[o,l,!0,_,E]}else{if(i)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let c=Ae.computeStrides(e.kernelShape);o.push({type:12,data:c},{type:12,data:e.pads},{type:12,data:e.strides}),l.push({name:"kernelStrides",type:"u32",length:c.length},{name:"pads",type:"u32",length:e.pads.length},{name:"strides",type:"u32",length:e.strides.length});let h=e.pads.reduce((f,m)=>f+m);return[o,l,!!h,!1,!1]}},Wg=(t,e,i,n,s,o,l,c,h,f,m,_)=>{let E=s.format==="NHWC",w=e.type.value,A=Xe("output",e.type.tensor,n);if(s.kernelShape.length<=2){let C="",M="",O="",$=i-(E?2:1);if(m?C=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${$}] = indices[${$}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${$}] < 0 || xIndices[${$}]
                      >= uniforms.x_shape[${$}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${e.indicesToOffset("xIndices")}];
                  ${o}
                }`:C=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${$}] = indices[${$}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${e.indicesToOffset("xIndices")}];
                  ${o}
                }`,s.kernelShape.length===2){let B=i-(E?3:2);_?M=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${B}] = indices[${B}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${B}] < 0 || xIndices[${B}] >= uniforms.x_shape[${B}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:M=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${B}] = indices[${B}] * uniforms.sh - uniforms.phStart + j;
                `,O=`
              }
            `}return`
            ${t.registerUniforms(h).declareVariables(e,A)}

            ${t.mainStart()}
              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${A.offsetToIndices("global_idx")};
              var xIndices = ${A.offsetToIndices("global_idx")};

              var value = ${w}(${c});
              var pad = 0;
              ${M}
              ${C}
              ${O}
              ${l}

              output[global_idx] = value;
            }`}else{if(E)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let C=s.kernelShape.length,M=s.pads.length,O="";return f?O=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${e.indicesToOffset("xIndices")}];
                ${o}
              }`:O=`
              }
              let x_val = x[${e.indicesToOffset("xIndices")}];
              ${o}
            `,`
            ${t.registerUniforms(h).declareVariables(e,A)}

            ${t.mainStart()}
              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${A.offsetToIndices("global_idx")};
              var xIndices = ${A.offsetToIndices("global_idx")};

              var offsets: array<u32, ${C}>;

              var value = ${w}(${c});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${C-1}u; j++) {
                  offsets[j] = offset / ${Ye("uniforms.kernelStrides","j",C)};
                  offset -= offsets[j] * ${Ye("uniforms.kernelStrides","j",C)};
                }
                offsets[${C-1}] = offset;

                isPad = false;
                for (var j = ${i-C}u; j < ${i}u; j++) {
                  xIndices[j] = indices[j] * ${Ye("uniforms.strides",`j - ${i-C}u`,C)}
                    + offsets[j - ${i-C}u] - ${Ye("uniforms.pads","j - 2u",M)};
                  ${O}
              }
              ${l}

              output[global_idx] = value;
            }`}},Xg=t=>`${t.format};${t.ceilMode};${t.autoPad};${t.kernelShape.length}`,Nx=t=>`${Xg(t)};${t.countIncludePad}`,Bx=t=>`${Xg(t)};${t.storageOrder};${t.dilations}`,Kg=t=>({format:t.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],ceilMode:t.ceil_mode,kernelShape:t.kernel_shape,strides:t.strides,pads:t.pads}),Yg=(t,e,i,n)=>{let[s,o]=Vg(e,n,i),l=Re("x",e.dataType,e.dims.length),c=l.type.value,h="value += x_val;",f="";s.countIncludePad?f+=`value /= ${c}(uniforms.kernelSize);`:f+=`value /= ${c}(i32(uniforms.kernelSize) - pad);`;let[m,_,E,w,A]=Gg(o,s);m.push(...Ze(e.dims,o));let C=["rank"];return{name:t,shaderCache:{hint:`${n.cacheKey};${E};${w};${A}`,inputDependencies:C},getRunData:()=>({outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(Ae.size(o)/64)},programUniforms:m}),getShaderSource:M=>Wg(M,l,e.dims.length,o.length,s,h,f,0,_,E,w,A)}},e3=t=>{let e=t.count_include_pad!==0,i=Kg(t);if(i.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let n={countIncludePad:e,...i,cacheKey:""};return{...n,cacheKey:Nx(n)}},t3=(t,e)=>{Ed(t.inputs),t.compute(Yg("AveragePool",t.inputs[0],!1,e))},Qg={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},i3=t=>{let e=t.format;return{format:e,...Qg,cacheKey:e}},n3=(t,e)=>{Ed(t.inputs),t.compute(Yg("GlobalAveragePool",t.inputs[0],!0,e))},Zg=(t,e,i,n)=>{let[s,o]=Vg(e,n,i),l=`
      value = max(x_val, value);
    `,c="",h=Re("x",e.dataType,e.dims.length),f=["rank"],[m,_,E,w,A]=Gg(o,s);return m.push(...Ze(e.dims,o)),{name:t,shaderCache:{hint:`${n.cacheKey};${E};${w};${A}`,inputDependencies:f},getRunData:()=>({outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(Ae.size(o)/64)},programUniforms:m}),getShaderSource:C=>Wg(C,h,e.dims.length,o.length,s,l,c,e.dataType===10?-65504:-1e5,_,E,w,A)}},r3=(t,e)=>{Ed(t.inputs),t.compute(Zg("MaxPool",t.inputs[0],!1,e))},s3=t=>{let e=t.storage_order,i=t.dilations,n=Kg(t);if(e!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(n.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let s={storageOrder:e,dilations:i,...n,cacheKey:""};return{...s,cacheKey:Bx(s)}},a3=t=>{let e=t.format;return{format:e,...Qg,cacheKey:e}},o3=(t,e)=>{Ed(t.inputs),t.compute(Zg("GlobalMaxPool",t.inputs[0],!0,e))}}),Lx,Ux,l3,u3,mI=Ue(()=>{at(),ht(),Ci(),mt(),Lx=(t,e)=>{if(t.length<2||t.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(t.length===3&&t[1].dims===t[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(t.length===3&&t[0].dataType!==t[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(t[0].dataType===6&&t.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(t[1].dims.length!==0&&t[1].dims.length!==1&&t[1].dims.length!==t[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(t.length>2){if(t[0].dataType!==t[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(t[1].dims.length!==t[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!t[1].dims.map((i,n)=>i===t[2].dims[n]).reduce((i,n)=>i&&n,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(e.blockSize>0){if(t[1].dims.length===0||t[1].dims.length===1&&t[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!t[1].dims.map((s,o)=>o===e.axis||s===t[0].dims[o]).reduce((s,o)=>s&&o,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(t[1].dims.length!==t[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let i=t[0].dims[e.axis],n=t[1].dims[e.axis];if(e.blockSize<Math.ceil(i/n)||e.blockSize>Math.ceil(i/(n-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},Ux=(t,e)=>{let i=Ae.normalizeAxis(e.axis,t[0].dims.length),n=t[0].dataType,s=n===3,o=t[0].dims,l=t[1].dataType,c=Ae.size(o),h=n===3||n===2,f=h?[Math.ceil(Ae.size(t[0].dims)/4)]:t[0].dims,m=t[1].dims,_=t.length>2?t[2]:void 0,E=_?h?[Math.ceil(Ae.size(_.dims)/4)]:_.dims:void 0,w=m.length===0||m.length===1&&m[0]===1,A=w===!1&&m.length===1,C=xi(c),M=w&&(!h||C===4),O=M?C:1,$=M&&!h?C:1,B=Re("input",h?12:n,f.length,$),U=Re("scale",l,m.length),j=_?Re("zero_point",h?12:n,E.length):void 0,W=Xe("output",l,o.length,O),z=[B,U];j&&z.push(j);let Y=[f,m];_&&Y.push(E);let L=[{type:12,data:c/O},{type:12,data:i},{type:12,data:e.blockSize},...Ze(...Y,o)],H=se=>{let ae=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${se.registerUniforms(ae).declareVariables(...z,W)}
      ${se.mainStart()}
          ${se.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${W.offsetToIndices("global_idx")};

          // Set input x
          ${h?`
            let input = ${B.getByOffset("global_idx / 4")};
            let x_vec = ${s?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${O===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${B.getByOffset("global_idx")};`};

          // Set scale input
          ${w?`let scale_value= ${U.getByOffset("0")}`:A?`
            let scale_index = ${W.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${U.getByOffset("scale_index")};`:`
            var scale_indices: ${U.type.indices} = output_indices;
            let index = ${U.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${U.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${U.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${j?w?h?`
                let zero_point_input = ${j.getByOffset("0")};
                let zero_point_vec =  ${s?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${j.getByOffset("0")}`:A?h?`
                let zero_point_index = ${W.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${j.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${s?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${W.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${j.getByOffset("zero_point_index")};`:h?`
                let zero_point_offset = ${U.indicesToOffset("scale_indices")};
                let zero_point_input = ${j.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${s?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${j.getByIndices("scale_indices")};`:`let zero_point_value = ${h?s?"i32":"u32":B.type.value}(0);`};
      // Compute and write output
      ${W.setByOffset("global_idx",`${W.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:e.cacheKey,inputDependencies:j?["rank","rank","rank"]:["rank","rank"]},getShaderSource:H,getRunData:()=>({outputs:[{dims:o,dataType:l}],dispatchGroup:{x:Math.ceil(c/O/64),y:1,z:1},programUniforms:L})}},l3=(t,e)=>{Lx(t.inputs,e),t.compute(Ux(t.inputs,e))},u3=t=>Bt({axis:t.axis,blockSize:t.blockSize})}),Px,zx,c3,gI=Ue(()=>{is(),at(),mt(),Px=(t,e,i)=>{let n=t===e,s=t<e&&i<0,o=t>e&&i>0;if(n||s||o)throw new Error("Range these inputs' contents are invalid.")},zx=(t,e,i,n)=>{let s=Math.abs(Math.ceil((e-t)/i)),o=[s],l=s,c=[{type:12,data:l},{type:n,data:t},{type:n,data:i},...Ze(o)],h=f=>{let m=Xe("output",n,o.length),_=m.type.value,E=[{name:"outputSize",type:"u32"},{name:"start",type:_},{name:"delta",type:_}];return`
        ${f.registerUniforms(E).declareVariables(m)}
        ${f.mainStart()}
        ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${_}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${n}`},getShaderSource:h,getRunData:()=>({outputs:[{dims:o,dataType:n}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:c})}},c3=t=>{let e=0,i=0,n=0;t.inputs[0].dataType===6?(e=t.inputs[0].getInt32Array()[0],i=t.inputs[1].getInt32Array()[0],n=t.inputs[2].getInt32Array()[0]):t.inputs[0].dataType===1&&(e=t.inputs[0].getFloat32Array()[0],i=t.inputs[1].getFloat32Array()[0],n=t.inputs[2].getFloat32Array()[0]),ui.webgpu.validateInputContent&&Px(e,i,n),t.compute(zx(e,i,n,t.inputs[0].dataType),{inputs:[]})}}),Fx,qx,d3,h3,yI=Ue(()=>{at(),ht(),Ci(),mt(),Fx=(t,e,i,n)=>{if(t!=="none"&&n!=="i32"&&n!=="u32"&&n!=="f32")throw new Error(`Input ${n} is not supported with reduction ${t}.`);let s=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,o=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${e}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(t){case"none":return`${e}=${i};`;case"add":return n==="i32"||n==="u32"?`atomicAdd(&${e}, bitcast<${n}>(${i}));`:`
              ${s}bitcast<${n}>(oldValue) + (${i})${o}`;case"max":return n==="i32"||n==="u32"?`atomicMax(&${e}, bitcast<${n}>(${i}));`:`
                ${s}max(bitcast<f32>(oldValue), (${i}))${o}`;case"min":return n==="i32"||n==="u32"?`atomicMin(&${e}, bitcast<${n}>(${i}));`:`${s}min(bitcast<${n}>(oldValue), (${i}))${o}`;case"mul":return`${s}(bitcast<${n}>(oldValue) * (${i}))${o}`;default:throw new Error(`Reduction ${t} is not supported.`)}},qx=(t,e)=>{let i=t[0].dims,n=t[1].dims,s=i,o=1,l=Math.ceil(Ae.sizeToDimension(n,n.length-1)/o),c=n[n.length-1],h=Ae.sizeFromDimension(i,c),f=[{type:12,data:l},{type:12,data:c},{type:12,data:h},...Ze(t[1].dims,t[2].dims,s)],m=_=>{let E=Re("indices",t[1].dataType,t[1].dims.length),w=Re("updates",t[2].dataType,t[2].dims.length,o),A=e.reduction!=="none"&&e.reduction!==""?zE("output",t[0].dataType,s.length):Xe("output",t[0].dataType,s.length,o);return`
      ${_.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(E,w,A)}
      ${_.mainStart()}
        ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var data_offset = 0u;
  let indices_start = uniforms.last_index_dimension * global_idx;
  let indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${t[0].dims.length===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[i - indices_start];
    let dim_value = uniforms.output_shape[i - indices_start];`}
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));
  }

  for (var i = 0u; i < uniforms.num_updates_elements; i++) {
    let value = updates[uniforms.num_updates_elements * global_idx + i];
    ${Fx(e.reduction,"output[data_offset + i]","value",A.type.value)}
  }

      }`};return{name:"ScatterND",shaderCache:{hint:`${e.cacheKey}_${e.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:s,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:f}),getShaderSource:m}},d3=t=>Bt({reduction:t.reduction}),h3=(t,e)=>{t.compute(qx(t.inputs,e),{inputs:[t.inputs[1],t.inputs[2]],outputs:[]})}}),jx,Hx,Vx,Jg,Gx,Wx,Xx,Kx,Yx,Qx,Zx,Jx,e0,eS,tS,iS,nS,rS,f3,p3,_I=Ue(()=>{at(),ht(),Ci(),mt(),jx=(t,e)=>{if(t.every(i=>i>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),t.length>0){if(e.mode==="linear"){if(!(t.length===2||t.length===3||t.length===4&&t[0]===1&&t[1]===1||t.length===4&&t[0]===1&&t[3]===1||t.length===5&&t[0]===1&&t[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(e.mode==="cubic"&&!(t.length===2||t.length===4&&t[0]===1&&t[1]===1||t.length===4&&t[0]===1&&t[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},Hx=(t,e,i)=>{e.every(s=>s>=0&&s<i||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let n=new Array(i).fill(1);return e.forEach((s,o)=>n[s]=t[o]),n},Vx=(t,e,i,n,s,o)=>{let[l,c,h]=i>10?[1,2,3]:[-1,t.length>1?1:-1,-1],f=t[0].dims.length;if(l>0&&t.length>l&&t[l].dims.length>0)t[l].getFloat32Array().forEach(m=>o.push(m));else if(e.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(c>0&&t.length>c&&t[c].dims.length===1&&t[c].dims[0]>0){if(t[c].getFloat32Array().forEach(m=>n.push(m)),n.length!==0&&n.length!==f&&i>=18&&n.length!==e.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");jx(n,e),e.axes.length>0&&Hx(n,e.axes,f).forEach((m,_)=>n[_]=m)}if(h>0&&t.length>h&&t[h].dims.length===1&&t[h].dims[0]>0&&(t[h].getBigInt64Array().forEach(m=>s.push(Number(m))),s.length!==0&&s.length!==f&&i>=18&&s.length!==e.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(e.axes.length>0){if(n.length!==0&&n.length!==e.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(s.length!==0&&s.length!==e.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof n<"u"&&typeof s<"u"&&n.length>0&&s.length>f)throw new Error("Resize requires only of scales or sizes to be specified")},Jg=(t,e,i,n)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${t}) * (${e});
  let whole = ${n}(big / (${i}));
  let fract = ${n}(big % (${i})) / ${n}(${i});
  return whole + fract;
`,Gx=(t,e)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${e} { `+(()=>{switch(t){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${e}(xResized) / ${e}(xScale);
          } else {
            ${Jg("xResized","lengthOriginal","lengthResized",e)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${e}(xResized) + 0.5) / ${e}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${e}(xResized) + 0.5) / ${e}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${Jg("xResized","lengthOriginal - 1","lengthResized - 1",e)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${e}(roiStart) * ${e}(lengthOriginal - 1) +
                        (${e}(xResized) * ${e}(roiEnd - roiStart) * ${e}(lengthOriginal - 1)) /
                        ${e}(lengthResized - 1);
                  } else {
                    return 0.5 * ${e}(roiStart + roiEnd) * ${e}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${e}xScale * ${e}(lengthResized);
                  const adjustment = ${e}(lengthResized) / outputWidth;
                  const center = ${e}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${e}(xResized) + 0.5) / ${e}(xScale)) - 0.5;`;case"half_pixel":return`return ((${e}(xResized) + 0.5) / ${e}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${t} is not supported`)}})()+"}",Wx=(t,e,i)=>`fn getNearestPixelFromOriginal(xOriginal: ${i}, isDownSample: bool) -> ${i} {`+(()=>{switch(t){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(e<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${t} is not supported`)}})()+"}",Xx=(t,e,i)=>{let n=new Array(i).fill(0).concat(new Array(i).fill(1)),s=t.length===0?n:t.slice();return e.length>0?(e.forEach((o,l)=>{n[o]=s[l],n[l+i]=s[e.length+l]}),n):s},Kx=(t,e,i,n)=>{let s=[];if(i.length>0)if(n.length>0){if(t.forEach(o=>s.push(o)),Math.max(...n)>t.length)throw new Error("axes is out of bound");n.forEach((o,l)=>s[o]=i[l])}else i.forEach(o=>s.push(o));else{if(e.length===0)throw new Error("Resize requires either scales or sizes.");s=t.map((o,l)=>Math.round(o*e[l]))}return s},Yx=(t,e,i)=>{let n=(()=>{switch(i.keepAspectRatioPolicy){case"not_larger":return i.axes.length>0?Math.min(...i.axes.map(o=>e[o]),Number.MAX_VALUE):Math.min(...e,Number.MAX_VALUE);case"not_smaller":return i.axes.length>0?Math.max(...i.axes.map(o=>e[o]),Number.MIN_VALUE):Math.max(...e,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${i.keepAspectRatioPolicy} is not supported`)}})();e.fill(1,0,e.length);let s=t.slice();return i.axes.length>0?(i.axes.forEach(o=>e[o]=n),i.axes.forEach(o=>s[o]=Math.round(t[o]*e[o]))):(e.fill(n,0,e.length),s.forEach((o,l)=>s[l]=Math.round(o*e[l]))),s},Qx=(t,e,i,n,s)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${t.type.indices}) -> array<${t.type.value}, ${i.length}> {
      var original_indices: array<${t.type.value}, ${i.length}>;
      for (var i:u32 = 0; i < ${i.length}; i++) {
        var output_index = ${t.indicesGet("output_indices","i")};
        var scale = ${Ye("uniforms.scales","i",n)};
        var roi_low = ${Ye("uniforms.roi","i",s)};
        var roi_hi = ${Ye("uniforms.roi",`i + ${e.length}`,s)};
        if (scale == 1.0) {
          original_indices[i] = ${t.type.value}(output_index);
        } else {
          var input_shape_i = ${Ye("uniforms.input_shape","i",e.length)};
          var output_shape_i = ${Ye("uniforms.output_shape","i",i.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,Zx=(t,e,i,n,s,o,l)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> ${t.type.indices} {
      var input_indices: ${t.type.indices};
      for (var i:u32 = 0; i < ${n.length}; i++) {
        var output_index = ${e.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${Ye("uniforms.scales","i",s)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${Ye("uniforms.roi","i",o)};
          var roi_hi = ${Ye("uniforms.roi",`i + ${i.length}`,o)};
          var input_shape_i = ${Ye("uniforms.input_shape","i",i.length)};
          var output_shape_i = ${Ye("uniforms.output_shape","i",n.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${l} || (original_idx >= 0 && original_idx < ${e.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${e.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${t.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,Jx=(t,e)=>`
    fn checkInputIndices(input_indices: ${t.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${e.length}; i++) {
        var input_index = ${t.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${Ye("uniforms.input_shape","i",e.length)}) {
          return false;
        }
      }
      return true;
    }`,e0=(t,e,i,n)=>t.rank>n?`
    ${t.indicesSet("input_indices",e,"channel")};
    ${t.indicesSet("input_indices",i,"batch")};
`:"",eS=(t,e,i,n,s)=>{let[o,l,c,h]=i.length===2?[-1,0,1,-1]:[0,2,3,1],f=t.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${f} {
      var input_indices: ${t.type.indices};
      ${t.indicesSet("input_indices",l,`max(0, min(row, ${i[l]} - 1))`)};
      ${t.indicesSet("input_indices",c,`max(0, min(col, ${i[c]} - 1))`)};
      ${e0(t,h,o,2)}
      return ${t.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${e.type.indices}) -> ${f} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${f} = originalIndices[${l}];
      var col:${f} = originalIndices[${c}];
      ${n?`if (row < 0 || row > (${i[l]} - 1) || col < 0 || col > (${i[c]} - 1)) {
        return ${s};
      }`:""};
      row = max(0, min(row, ${i[l]} - 1));
      col = max(0, min(col, ${i[c]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${i.length>2?`u32(originalIndices[${h}])`:"0"};
      var batch: u32 =  ${i.length>2?`u32(originalIndices[${o}])`:"0"};
      var x11: ${f} = getInputValue(batch, channel, row1, col1);
      var x12: ${f} = getInputValue(batch, channel, row1, col2);
      var x21: ${f} = getInputValue(batch, channel, row2, col1);
      var x22: ${f} = getInputValue(batch, channel, row2, col2);
      var dx1: ${f} = abs(row - ${f}(row1));
      var dx2: ${f} = abs(${f}(row2) - row);
      var dy1: ${f} = abs(col - ${f}(col1));
      var dy2: ${f} = abs(${f}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},tS=(t,e,i,n,s,o,l,c,h,f)=>{let m=i.length===2,[_,E]=m?[0,1]:[2,3],w=t.type.value,A=C=>{let M=C===_?"row":"col";return`
      fn ${M}CubicInterpolation(input_indices: ${t.type.indices}, output_indices: ${e.type.indices}) -> ${w} {
        var output_index = ${e.indicesGet("output_indices",C)};
        var originalIdx: ${w} = getOriginalCoordinateFromResizedCoordinate(output_index, ${s[C]},
        ${n[C]}, ${i[C]}, ${o[C]}, ${o[C]} + ${i.length});
        var fractOriginalIdx: ${w} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${c} && (originalIdx < 0 || originalIdx > (${i[C]} - 1))) {
          return ${h};
        }
        var data: array<${w}, 4> = array<${w}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${M}: ${w} = originalIdx + ${w}(i);
          if (${M} < 0 || ${M} >= ${i[C]}) {
            ${f?`coefs[i + 1] = 0.0;
                        continue;`:c?`return ${h};`:`${M} = max(0, min(${M}, ${i[C]} - 1));`};
          }
        var input_indices_copy: ${t.type.indices} = input_indices;
          ${t.indicesSet("input_indices_copy",C,`u32(${M})`)};
          data[i + 1] = ${C===_?t.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${A(_)};
    ${A(E)};
  fn getCubicInterpolationCoefs(s: ${w}) -> array<${w}, 4> {
    var absS = abs(s);
    var coeffs: array<${w}, 4> = array<${w}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${w} = 1.0 - absS;
    var twoMinusAbsS: ${w} = 2.0 - absS;
    var onePlusAbsS: ${w} = 1.0 + absS;
    coeffs[0] = ((${l} * onePlusAbsS - 5 * ${l}) * onePlusAbsS + 8 * ${l}) * onePlusAbsS - 4 * ${l};
    coeffs[1] = ((${l} + 2) * absS - (${l} + 3)) * absS * absS + 1;
    coeffs[2] = ((${l} + 2) * oneMinusAbsS - (${l} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${l} * twoMinusAbsS - 5 * ${l}) * twoMinusAbsS + 8 * ${l}) * twoMinusAbsS - 4 * ${l};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${w}, 4>, coefs: array<${w}, 4>) -> ${w} {
    var coefsSum: ${w} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${e.type.indices}) -> ${w} {
    var input_indices: ${t.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},iS=(t,e,i,n,s)=>{let[o,l,c,h,f]=i.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],m=t.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${m} {
      var input_indices: ${t.type.indices};
      ${t.indicesSet("input_indices",l,`max(0, min(depth, ${i[l]} - 1))`)};
      ${t.indicesSet("input_indices",c,`max(0, min(height, ${i[c]} - 1))`)};
      ${t.indicesSet("input_indices",h,`max(0, min(width, ${i[h]} - 1))`)};
      ${e0(t,f,o,3)}
      return ${t.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${e.type.indices}) -> ${m} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${m} = originalIndices[${l}];
      var height:${m} = originalIndices[${c}];
      var width:${m} = originalIndices[${h}];
      ${n?`if (depth < 0 || depth > (${i[l]} - 1) || height < 0 || height > (${i[c]} - 1) || width < 0 || (width > ${i[h]} - 1)) {
      return ${s};
        }`:""};

    depth = max(0, min(depth, ${i[l]} - 1));
      height = max(0, min(height, ${i[c]} - 1));
      width = max(0, min(width, ${i[h]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${i.length>3?`u32(originalIndices[${f}])`:"0"};
      var batch: u32 =  ${i.length>3?`u32(originalIndices[${o}])`:"0"};

      var x111: ${m} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${m} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${m} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${m} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${m} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${m} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${m} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${m} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${m} = abs(depth - ${m}(depth1));
      var dx2: ${m} = abs(${m}(depth2) - depth);
      var dy1: ${m} = abs(height - ${m}(height1));
      var dy2: ${m} = abs(${m}(height2) - height);
      var dz1: ${m} = abs(width - ${m}(width1));
      var dz2: ${m} = abs(${m}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},nS=(t,e,i,n,s,o)=>{let l=t.dims,c=Xx(o,e.axes,l.length),h=Kx(l,n,s,e.axes),f=n.slice();n.length===0&&(f=l.map(($,B)=>$===0?1:h[B]/$),e.keepAspectRatioPolicy!=="stretch"&&(h=Yx(l,f,e)));let m=Xe("output",t.dataType,h.length),_=Re("input",t.dataType,l.length),E=Ae.size(h),w=l.length===h.length&&l.every(($,B)=>$===h[B]),A=e.coordinateTransformMode==="tf_crop_and_resize",C=e.extrapolationValue,M=_.type.value,O=$=>`
      ${w?"":`
      ${Gx(e.coordinateTransformMode,M)};
      ${(()=>{switch(e.mode){case"nearest":return`
              ${Jx(_,l)};
              ${Wx(e.nearestMode,i,M)};
              ${Zx(_,m,l,h,f.length,c.length,A)};
              `;case"linear":return`
              ${Qx(m,l,h,f.length,c.length)};
              ${(()=>{if(l.length===2||l.length===4)return`${eS(_,m,l,A,C)}`;if(l.length===3||l.length===5)return`${iS(_,m,l,A,C)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(l.length===2||l.length===4)return`${tS(_,m,l,h,f,c,e.cubicCoeffA,A,e.extrapolationValue,e.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${$.registerUniform("output_size","u32").registerUniform("scales","f32",f.length).registerUniform("roi","f32",c.length).declareVariables(_,m)}
      ${$.mainStart()}
        ${$.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${w?"output[global_idx] = input[global_idx];":`
        let output_indices = ${m.offsetToIndices("global_idx")};
        var input_indices: ${_.type.indices};
        ${(()=>{switch(e.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${_.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${e.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${l.length===2||l.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${e.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${e.cacheKey}|${i}|${f.length>0?e.mode==="cubic"?f:f.length:""}|${s.length>0?s:""}|${c.length>0?c:""}|${w}|${e.mode==="nearest"?l.length:l}`,inputDependencies:["rank"]},getShaderSource:O,getRunData:()=>({outputs:[{dims:h,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(E/64)},programUniforms:[{type:12,data:E},{type:1,data:f},{type:1,data:c},...Ze(l,h)]})}},rS=t=>{let e=t.customDataBuffer;return new Uint32Array(e,e.byteOffset,1)[0]},f3=(t,e)=>{let i=[],n=[],s=[],o=rS(t);if(e.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");Vx(t.inputs,e,o,i,n,s),t.compute(nS(t.inputs[0],e,o,i,n,s),{inputs:[0]})},p3=t=>{let e=t.antialias,i=t.axes,n=t.coordinateTransformMode,s=t.cubicCoeffA,o=t.excludeOutside!==0,l=t.extrapolationValue,c=t.keepAspectRatioPolicy,h=t.mode,f=t.nearestMode===""?"simple":t.nearestMode;return Bt({antialias:e,axes:i,coordinateTransformMode:n,cubicCoeffA:s,excludeOutside:o,extrapolationValue:l,keepAspectRatioPolicy:c,mode:h,nearestMode:f})}}),sS,aS,m3,vI=Ue(()=>{at(),ht(),mt(),sS=t=>{if(!t||t.length<3)throw new Error("layerNorm requires at least 3 inputs.");let e=t[0],i=t[1],n=t[2];if(e.dataType!==i.dataType||e.dataType!==n.dataType)throw new Error("All inputs must have the same data type");if(e.dims.length!==3&&e.dims.length!==2)throw new Error("Input must be 2D or 3D");if(i.dims.length!==3&&i.dims.length!==2)throw new Error("Skip must be 2D or 3D");let s=e.dims[e.dims.length-1],o=e.dims[e.dims.length-2];if(i.dims[i.dims.length-1]!==s)throw new Error("Skip must have the same hidden size as input");if(i.dims[i.dims.length-2]!==o)throw new Error("Skip must have the same sequence length as input");if(n.dims.length!==1)throw new Error("Gamma must be 1D");if(n.dims[n.dims.length-1]!==s)throw new Error("Gamma must have the same hidden size as input");if(t.length>3){let l=t[3];if(l.dims.length!==1)throw new Error("Beta must be 1D");if(l.dims[l.dims.length-1]!==s)throw new Error("Beta must have the same hidden size as input")}if(t.length>4){let l=t[4];if(l.dims.length!==1)throw new Error("Bias must be 1D");if(l.dims[l.dims.length-1]!==s)throw new Error("Bias must have the same hidden size as input")}},aS=(t,e,i,n)=>{let s=e.simplified,o=t[0].dims,l=Ae.size(o),c=o,h=l,f=o.slice(-1)[0],m=n?o.slice(0,-1).concat(1):[],_=!s&&t.length>3,E=t.length>4,w=n&&i>1,A=n&&i>2,C=i>3,M=64,O=xi(f),$=[{type:12,data:h},{type:12,data:O},{type:12,data:f},{type:1,data:e.epsilon}],B=j=>{let W=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],z=[Re("x",t[0].dataType,t[0].dims,O),Re("skip",t[1].dataType,t[1].dims,O),Re("gamma",t[2].dataType,t[2].dims,O)];_&&z.push(Re("beta",t[3].dataType,t[3].dims,O)),E&&z.push(Re("bias",t[4].dataType,t[4].dims,O)),z.push(Xe("output",t[0].dataType,c,O)),w&&z.push(Xe("mean_output",1,m)),A&&z.push(Xe("inv_std_output",1,m)),C&&z.push(Xe("input_skip_bias_sum",t[0].dataType,c,O));let Y=en(t[0].dataType),L=en(1,O);return`

      ${j.registerUniforms(W).declareVariables(...z)}
      var<workgroup> sum_shared : array<${L}, ${M}>;
      var<workgroup> sum_squared_shared : array<${L}, ${M}>;

      ${j.mainStart([M,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${M};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${M};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${M-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${E?"bias[offset1d + i]":Y+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${C?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${Xu(Y,O,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${M};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${Jo("sum",O)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${Jo("square_sum",O)} / f32(uniforms.hidden_size) ${s?"":"- mean * mean"} + uniforms.epsilon);
        ${w?"mean_output[global_idx] = mean;":""}
        ${A?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${s?"":`- ${Y}(mean)`}) *
            ${Y}(inv_std_dev) * gamma[offset1d + i]
            ${_?"+ beta[offset1d + i]":""};
        }
      }`},U=[{dims:c,dataType:t[0].dataType}];return i>1&&U.push({dims:m,dataType:1}),i>2&&U.push({dims:m,dataType:1}),i>3&&U.push({dims:o,dataType:t[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${O};${w};${A};${C}`,inputDependencies:t.map((j,W)=>"type")},getShaderSource:B,getRunData:()=>({outputs:U,dispatchGroup:{x:Math.ceil(h/f)},programUniforms:$})}},m3=(t,e)=>{sS(t.inputs);let i=[0];t.outputCount>1&&i.push(-3),t.outputCount>2&&i.push(-3),t.outputCount>3&&i.push(3),t.compute(aS(t.inputs,e,t.outputCount,!1),{outputs:i})}}),oS,Cd,lS,t0,uS,cS,g3,y3,bI=Ue(()=>{at(),ht(),Ci(),mt(),oS=(t,e)=>{if(!t||t.length<1)throw new Error("too few inputs");if(e.axes.length!==0){if(e.axes.length!==e.starts.length||e.axes.length!==e.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(e.starts.length!==e.ends.length)throw new Error("starts and ends must have the same length");t.slice(1).forEach((i,n)=>{if(t[n+1].dataType!==6&&t[n+1].dataType!==7)throw new Error(`Input ${n} must be an array of int32 or int64`)})},Cd=(t,e)=>{let i=[];if(t.length>e)if(t[e].dataType===7)t[e].getBigInt64Array().forEach(n=>i.push(Number(n)));else if(t[e].dataType===6)t[e].getInt32Array().forEach(n=>i.push(Number(n)));else throw new Error(`Input ${e} must be an array of int32 or int64`);return i},lS=(t,e)=>{if(t.length>1){let i=Cd(t,1),n=Cd(t,2),s=Cd(t,3);return s.length===0&&(s=[...Array(t[0].dims.length).keys()]),Bt({starts:i,ends:n,axes:s})}else return e},t0=(t,e,i,n,s)=>{let o=t;return t<0&&(o+=i[n[e]]),s[e]<0?Math.max(0,Math.min(o,i[n[e]]-1)):Math.max(0,Math.min(o,i[n[e]]))},uS=(t,e,i)=>`fn calculateInputIndices(output_indices: ${e.type.indices}) -> ${t.type.indices} {
          var input_indices: ${t.type.indices};
          var carry = 0u;
          for (var i = ${i.length-1}; i >= 0; i--) {
            let input_shape_i = ${Ye("uniforms.input_shape","i",i.length)};
            let steps_i = ${Ye("uniforms.steps","i",i.length)};
            let signs_i = ${Ye("uniforms.signs","i",i.length)};
            let starts_i = ${Ye("uniforms.starts","i",i.length)};
            var output_index = ${e.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${t.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,cS=(t,e)=>{let i=t[0].dims,n=Ae.size(i),s=e.axes.length>0?Ae.normalizeAxes(e.axes,i.length):[...Array(i.length).keys()],o=Cd(t,4);o.forEach(O=>O!==0||(()=>{throw new Error("step cannot be 0")})),o.length===0&&(o=Array(s.length).fill(1));let l=e.starts.map((O,$)=>t0(O,$,i,s,o)),c=e.ends.map((O,$)=>t0(O,$,i,s,o));if(s.length!==l.length||s.length!==c.length)throw new Error("start, ends and axes should have the same number of elements");if(s.length!==i.length)for(let O=0;O<i.length;++O)s.includes(O)||(l.splice(O,0,0),c.splice(O,0,i[O]),o.splice(O,0,1));let h=o.map(O=>Math.sign(O));o.forEach((O,$,B)=>{if(O<0){let U=(c[$]-l[$])/O,j=l[$],W=j+U*o[$];l[$]=W,c[$]=j,B[$]=-O}});let f=i.slice(0);s.forEach((O,$)=>{f[O]=Math.ceil((c[O]-l[O])/o[O])});let m={dims:f,dataType:t[0].dataType},_=Xe("output",t[0].dataType,f.length),E=Re("input",t[0].dataType,t[0].dims.length),w=Ae.size(f),A=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:l.length},{name:"signs",type:"i32",length:h.length},{name:"steps",type:"u32",length:o.length}],C=[{type:12,data:w},{type:12,data:l},{type:6,data:h},{type:12,data:o},...Ze(t[0].dims,f)],M=O=>`
      ${O.registerUniforms(A).declareVariables(E,_)}
        ${uS(E,_,i)}
        ${O.mainStart()}
          ${O.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${_.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${_.setByOffset("global_idx",E.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${h.length}_${l.length}_${o.length}`,inputDependencies:["rank"]},getShaderSource:M,getRunData:()=>({outputs:[m],dispatchGroup:{x:Math.ceil(n/64)},programUniforms:C})}},g3=(t,e)=>{oS(t.inputs,e);let i=lS(t.inputs,e);t.compute(cS(t.inputs,i),{inputs:[0]})},y3=t=>{let e=t.starts,i=t.ends,n=t.axes;return Bt({starts:e,ends:i,axes:n})}}),dS,hS,_3,v3,TI=Ue(()=>{at(),ht(),Ci(),il(),mt(),dS=t=>{if(!t||t.length!==1)throw new Error("Softmax op requires 1 input.")},hS=(t,e)=>{let i=t.inputs[0],n=i.dims,s=Ae.size(n),o=n.length,l=Ae.normalizeAxis(e.axis,o),c=l<n.length-1,h,f=[];c?(f=Array.from({length:o},(z,Y)=>Y),f[l]=o-1,f[o-1]=l,h=t.compute($r(i,f),{inputs:[i],outputs:[-1]})[0]):h=i;let m=h.dims,_=m[o-1],E=s/_,w=xi(_),A=_/w,C=64;E===1&&(C=256);let M=(z,Y)=>Y===4?`max(max(${z}.x, ${z}.y), max(${z}.z, ${z}.w))`:Y===2?`max(${z}.x, ${z}.y)`:Y===3?`max(max(${z}.x, ${z}.y), ${z}.z)`:z,O=Re("x",h.dataType,h.dims,w),$=Xe("result",h.dataType,h.dims,w),B=O.type.value,U=en(h.dataType)==="f32"?`var threadMax = ${B}(-3.402823e+38f);`:`var threadMax = ${B}(-65504.0h);`,j=z=>`
      var<workgroup> rowMaxShared : ${B};
      var<workgroup> rowSumShared : ${B};
      var<workgroup> threadShared : array<${B}, ${C}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${B} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${B}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${z.registerUniform("packedCols","i32").declareVariables(O,$)}
      ${z.mainStart(C)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${C};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${U}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${B}(${M("threadShared[0]",w)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${B}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${B}(${Jo("threadShared[0]",w)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          var value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          // max operation protects against NaN since all values should be >=0
          value = max(value, ${B}(0.0));
          setValue(row, col, row_stride, value);
        }
      }`,W=t.compute({name:"Softmax",shaderCache:{hint:`${w};${C}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:m,dataType:h.dataType}],dispatchGroup:{x:E},programUniforms:[{type:6,data:A}]}),getShaderSource:j},{inputs:[h],outputs:[c?-1:0]})[0];c&&t.compute($r(W,f),{inputs:[W]})},_3=(t,e)=>{dS(t.inputs),hS(t,e)},v3=t=>Bt({axis:t.axis})}),i0,fS,pS,mS,b3,xI=Ue(()=>{at(),ht(),mt(),i0=t=>Array.from(t.getBigInt64Array(),Number),fS=t=>{if(!t||t.length!==2)throw new Error("Tile requires 2 inputs.");if(t[0].dataType!==1&&t[0].dataType!==10&&t[0].dataType!==6&&t[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(t[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(t[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(i0(t[1]).length!==t[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},pS=(t,e)=>{let i=[];for(let n=0;n<t.length;++n)i.push(t[n]*e[n]);return i},mS=(t,e)=>{let i=t[0].dims,n=e??i0(t[1]),s=pS(i,n),o=Ae.size(s),l=t[0].dataType,c=Re("input",l,i.length),h=Xe("output",l,s.length),f=m=>`
      const inputShape = ${c.indices(...i)};
      ${m.registerUniform("output_size","u32").declareVariables(c,h)}
      ${m.mainStart()}
      ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${h.offsetToIndices("global_idx")};
      var input_indices: ${c.type.indices};
      for (var i = 0; i < ${i.length}; i++) {
        let input_dim_i = ${c.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${h.indicesGet("output_indices","i")}  % input_dim_i;

        ${c.indicesSet("input_indices","i","input_dim_value")}
      }
      ${h.setByOffset("global_idx",c.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${n}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:s,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:[{type:12,data:o},...Ze(t[0].dims,s)]}),getShaderSource:f}},b3=t=>{fS(t.inputs),t.compute(mS(t.inputs),{inputs:[0]})}}),gS,yS,T3,SI=Ue(()=>{at(),ht(),mt(),gS=(t,e,i,n,s)=>{let o=Xe("output_data",s,i.length,4),l=Re("a_data",e[1].dataType,e[1].dims.length,4),c=Re("b_data",e[2].dataType,e[2].dims.length,4),h=Re("c_data",e[0].dataType,e[0].dims.length,4),f,m=(_,E,w)=>`select(${E}, ${_}, ${w})`;if(!n)f=o.setByOffset("global_idx",m(l.getByOffset("global_idx"),c.getByOffset("global_idx"),h.getByOffset("global_idx")));else{let _=(E,w,A="")=>{let C=`a_data[index_a${w}][component_a${w}]`,M=`b_data[index_b${w}][component_b${w}]`,O=`bool(c_data[index_c${w}] & (0xffu << (component_c${w} * 8)))`;return`
            let output_indices${w} = ${o.offsetToIndices(`global_idx * 4u + ${w}u`)};
            let offset_a${w} = ${l.broadcastedIndicesToOffset(`output_indices${w}`,o)};
            let offset_b${w} = ${c.broadcastedIndicesToOffset(`output_indices${w}`,o)};
            let offset_c${w} = ${h.broadcastedIndicesToOffset(`output_indices${w}`,o)};
            let index_a${w} = offset_a${w} / 4u;
            let index_b${w} = offset_b${w} / 4u;
            let index_c${w} = offset_c${w} / 4u;
            let component_a${w} = offset_a${w} % 4u;
            let component_b${w} = offset_b${w} % 4u;
            let component_c${w} = offset_c${w} % 4u;
            ${E}[${w}] = ${A}(${m(C,M,O)});
          `};s===9?f=`
            var data = vec4<u32>(0);
            ${_("data",0,"u32")}
            ${_("data",1,"u32")}
            ${_("data",2,"u32")}
            ${_("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:f=`
            ${_("output_data[global_idx]",0)}
            ${_("output_data[global_idx]",1)}
            ${_("output_data[global_idx]",2)}
            ${_("output_data[global_idx]",3)}
          `}return`
        ${t.registerUniform("vec_size","u32").declareVariables(h,l,c,o)}
        ${t.mainStart()}
        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${f}
      }`},yS=t=>{let e=t[1].dims,i=t[2].dims,n=t[0].dims,s=t[1].dataType,o=!(Ae.areEqual(e,i)&&Ae.areEqual(i,n)),l=e,c=Ae.size(e);if(o){let f=oc.calcShape(oc.calcShape(e,i,!1),n,!1);if(!f)throw new Error("Can't perform where op on the given tensors");l=f,c=Ae.size(l)}let h=Math.ceil(c/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:f=>gS(f,t,l,o,s),getRunData:()=>({outputs:[{dims:l,dataType:s}],dispatchGroup:{x:Math.ceil(c/64/4)},programUniforms:[{type:12,data:h},...Ze(n,e,i,l)]})}},T3=t=>{t.compute(yS(t.inputs))}}),x3,wI=Ue(()=>{UO(),Gy(),PO(),zO(),FO(),qO(),jO(),XO(),YO(),QO(),ZO(),JO(),eI(),tI(),iI(),nI(),rI(),sI(),aI(),oI(),lI(),uI(),cI(),dI(),hI(),FA(),fI(),pI(),mI(),gI(),yI(),Vy(),_I(),GA(),vI(),bI(),TI(),HA(),xI(),il(),Wy(),SI(),x3=new Map([["Abs",[mC]],["Acos",[gC]],["Acosh",[yC]],["Add",[QC]],["ArgMax",[dC,W0]],["ArgMin",[cC,W0]],["Asin",[_C]],["Asinh",[vC]],["Atan",[bC]],["Atanh",[TC]],["Attention",[hC]],["AveragePool",[t3,e3]],["BatchNormalization",[fC]],["BiasAdd",[pC]],["BiasSplitGelu",[YC]],["Cast",[SC,xC]],["Ceil",[EC]],["Clip",[wC]],["Concat",[oA,lA]],["Conv",[J0,Z0]],["ConvTranspose",[_A,yA]],["Cos",[CC]],["Cosh",[AC]],["CumSum",[vA,bA]],["DepthToSpace",[TA,xA]],["DequantizeLinear",[l3,u3]],["Div",[ZC]],["Einsum",[SA,wA]],["Elu",[DC,Bd]],["Equal",[JC]],["Erf",[kC]],["Exp",[$C]],["Expand",[EA]],["FastGelu",[CA]],["Floor",[OC]],["FusedConv",[J0,Z0]],["Gather",[DA,AA]],["GatherElements",[MA,RA]],["GatherBlockQuantized",[OA,IA]],["GatherND",[kA,$A]],["Gelu",[IC]],["Gemm",[BA,NA]],["GlobalAveragePool",[n3,i3]],["GlobalMaxPool",[o3,a3]],["Greater",[nA]],["GreaterOrEqual",[sA]],["GridSample",[LA,UA]],["GroupQueryAttention",[WA]],["HardSigmoid",[zC,PC]],["InstanceNormalization",[XA]],["LayerNormalization",[KA]],["LeakyRelu",[RC,Bd]],["Less",[rA]],["LessOrEqual",[aA]],["Log",[XC]],["MatMul",[YA]],["MatMulNBits",[QA,ZA]],["MaxPool",[r3,s3]],["Mul",[eA]],["MultiHeadAttention",[zA,PA]],["Neg",[NC]],["Not",[MC]],["Pad",[JA]],["Pow",[tA]],["QuickGelu",[KC,Bd]],["Range",[c3]],["Reciprocal",[BC]],["ReduceMin",[sC]],["ReduceMean",[eC]],["ReduceMax",[rC]],["ReduceSum",[oC]],["ReduceProd",[aC]],["ReduceL1",[tC]],["ReduceL2",[iC]],["ReduceLogSum",[uC]],["ReduceLogSumExp",[nC]],["ReduceSumSquare",[lC]],["Relu",[LC]],["Resize",[f3,p3]],["RotaryEmbedding",[VA]],["ScatterND",[h3,d3]],["Sigmoid",[UC]],["Sin",[FC]],["Sinh",[qC]],["Slice",[g3,y3]],["SkipLayerNormalization",[m3]],["Split",[qA,jA]],["Sqrt",[jC]],["Softmax",[_3,v3]],["Sub",[iA]],["Tan",[HC]],["Tanh",[VC]],["ThresholdedRelu",[WC,Bd]],["Tile",[b3]],["Transpose",[qE,jE]],["Where",[T3]]])}),S3,EI=Ue(()=>{is(),to(),mt(),S3=class{constructor(t){this.backend=t,this.repo=new Map,this.attributesBound=!1}getArtifact(t){return this.repo.get(t)}setArtifact(t,e){this.repo.set(t,e)}run(t,e,i,n,s){oa(t.programInfo.name);let o=this.backend.device,l=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let c=[];for(let f of e)c.push({binding:c.length,resource:{buffer:f.buffer}});for(let f of i)c.push({binding:c.length,resource:{buffer:f.buffer}});s&&c.push({binding:c.length,resource:s});let h=o.createBindGroup({layout:t.computePipeline.getBindGroupLayout(0),entries:c,label:t.programInfo.name});if(this.backend.sessionStatus==="capturing"){let f={kernelId:this.backend.currentKernelId,computePipeline:t.computePipeline,bindGroup:h,dispatchGroup:n};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(f)}l.setPipeline(t.computePipeline),l.setBindGroup(0,h),l.dispatchWorkgroups(...n),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),ks(t.programInfo.name)}dispose(){}build(t,e){oa(t.name);let i=this.backend.device,n=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(f=>{i.features.has(f.feature)&&n.push(`enable ${f.extension};`)});let s=FE(e,this.backend.device.limits),o=t.getShaderSource(s),l=`${n.join(`
`)}
${s.additionalImplementations}
${o}`,c=i.createShaderModule({code:l,label:t.name});At("verbose",()=>`[WebGPU] ${t.name} shader code: ${l}`);let h=i.createComputePipeline({compute:{module:c,entryPoint:"main"},layout:"auto",label:t.name});return ks(t.name),{programInfo:t,computePipeline:h,uniformVariablesInfo:s.variablesInfo}}normalizeDispatchGroupSize(t){let e=typeof t=="number"?t:t.x,i=typeof t=="number"?1:t.y||1,n=typeof t=="number"?1:t.z||1,s=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(e<=s&&i<=s&&n<=s)return[e,i,n];let o=e*i*n,l=Math.ceil(Math.sqrt(o));if(l>s){if(l=Math.ceil(Math.cbrt(o)),l>s)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[l,l,l]}else return[l,l,1]}}}),w3={};_c(w3,{WebGpuBackend:()=>E3});var _S,vS,bS,E3,CI=Ue(()=>{is(),at(),to(),BE(),BO(),wI(),EI(),_S=(t,e)=>{if(e.length!==t.length)throw new Error(`inputDependencies length ${e.length} is not equal to inputTensors length ${t.length}.`);let i=[];for(let n=0;n<t.length;++n){let s=t[n].dataType;switch(e[n]){case"none":{i.push("");break}case"type":{i.push(`${s}`);break}case"rank":{let o=t[n].dims.length;i.push(`${s};${o}`);break}case"dims":{let o=t[n].dims.join(",");i.push(`${s};${o}`);break}default:throw new Error(`unsupported input dependency: ${e[n]}`)}}return i.join("|")},vS=(t,e,i)=>{let n=t.name;return t.shaderCache?.hint&&(n+="["+t.shaderCache.hint+"]"),n+=":"+i+`:${_S(e,t.shaderCache?.inputDependencies??new Array(e.length).fill("dims"))}`,n},bS=class{constructor(t){t&&(this.architecture=t.architecture,this.vendor=t.vendor)}isArchitecture(t){return this.architecture===t}isVendor(t){return this.vendor===t}},E3=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let t=this.kernelCustomData.get(this.currentKernelId);return t||(t={},this.kernelCustomData.set(this.currentKernelId,t)),t}async initialize(t,e){this.env=t;let i=[],n={requiredLimits:{maxComputeWorkgroupStorageSize:e.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:e.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:e.limits.maxStorageBufferBindingSize,maxBufferSize:e.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:e.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:e.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:e.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:e.limits.maxComputeWorkgroupSizeZ},requiredFeatures:i},s=o=>e.features.has(o)&&i.push(o)&&!0;s("chromium-experimental-timestamp-query-inside-passes")||s("timestamp-query"),s("shader-f16"),s("subgroups"),this.device=await e.requestDevice(n),this.adapterInfo=new bS(e.info||await e.requestAdapterInfo()),this.gpuDataManager=PE(this),this.programManager=new S3(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,Fy(t.logLevel,!!t.debug),this.device.onuncapturederror=o=>{o.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${o.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:e,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let t=this.getCommandEncoder(),e={};this.queryType==="at-passes"&&(e.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=t.beginComputePass(e)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;oa(),this.endComputePass();let t;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),t=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(t,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,t,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&t.mapAsync(GPUMapMode.READ).then(()=>{let e=new BigUint64Array(t.getMappedRange()),i=this.pendingQueries.get(t);for(let n=0;n<e.length/2;n++){let s=i[n],o=s.kernelId,l=this.kernels.get(o),c=l.kernelType,h=l.kernelName,f=s.programName,m=s.inputTensorViews,_=s.outputTensorViews,E=e[n*2],w=e[n*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=E);let A=Number(E-this.queryTimeBase),C=Number(w-this.queryTimeBase);if(!Number.isSafeInteger(A)||!Number.isSafeInteger(C))throw new RangeError("incorrect timestamp range");if(this.env.webgpu.profiling?.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:m.map(M=>({dims:M.dims,dataType:Xa(M.dataType)})),outputsMetadata:_.map(M=>({dims:M.dims,dataType:Xa(M.dataType)})),kernelId:o,kernelType:c,kernelName:h,programName:f,startTime:A,endTime:C});else{let M="";m.forEach(($,B)=>{M+=`input[${B}]: [${$.dims}] | ${Xa($.dataType)}, `});let O="";_.forEach(($,B)=>{O+=`output[${B}]: [${$.dims}] | ${Xa($.dataType)}, `}),console.log(`[profiling] kernel "${o}|${c}|${h}|${f}" ${M}${O}start time: ${A} ns, execution time: ${C-A} ns`)}Rf("GPU",`${f}::${E}::${w}`)}t.unmap(),this.pendingQueries.delete(t)}),ks()}run(t,e,i,n,s,o){oa(t.name);let l=[];for(let $=0;$<e.length;++$){let B=e[$].data;if(B===0)continue;let U=this.gpuDataManager.get(B);if(!U)throw new Error(`no GPU data for input: ${B}`);l.push(U)}let{outputs:c,dispatchGroup:h,programUniforms:f}=t.getRunData(e),m=i.length===0?c.map(($,B)=>B):i;if(m.length!==c.length)throw new Error(`Output size ${m.length} must be equal to ${c.length}.`);let _=[],E=[];for(let $=0;$<c.length;++$){if(!Number.isInteger(m[$])||m[$]<-3||m[$]>=o)throw new Error(`Invalid output index: ${m[$]}`);if(m[$]===-3)continue;let B=m[$]===-1,U=m[$]===-2,j=B||U?s(c[$].dataType,c[$].dims):n(m[$],c[$].dataType,c[$].dims);if(_.push(j),j.data===0)continue;let W=this.gpuDataManager.get(j.data);if(!W)throw new Error(`no GPU data for output: ${j.data}`);if(B&&this.temporaryData.push(W),U){let z=this.kernelPersistentData.get(this.currentKernelId);z||(z=[],this.kernelPersistentData.set(this.currentKernelId,z)),z.push(W)}E.push(W)}if(l.length!==e.length||E.length!==_.length){if(E.length===0)return ks(t.name),_;throw new Error(`Program ${t.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let w;if(f){let $=0,B=[];f.forEach(z=>{let Y=typeof z.data=="number"?[z.data]:z.data;if(Y.length===0)return;let L=z.type===10?2:4,H,se;z.type===10?(se=Y.length>4?16:Y.length>2?8:Y.length*L,H=Y.length>4?16:L*Y.length):(se=Y.length<=2?Y.length*L:16,H=16),$=Math.ceil($/se)*se,B.push($);let ae=z.type===10?8:4;$+=Y.length>4?Math.ceil(Y.length/ae)*H:Y.length*L});let U=16;$=Math.ceil($/U)*U;let j=new ArrayBuffer($);f.forEach((z,Y)=>{let L=B[Y],H=typeof z.data=="number"?[z.data]:z.data;if(z.type===6)new Int32Array(j,L,H.length).set(H);else if(z.type===12)new Uint32Array(j,L,H.length).set(H);else if(z.type===10)new Uint16Array(j,L,H.length).set(H);else if(z.type===1)new Float32Array(j,L,H.length).set(H);else throw new Error(`Unsupported uniform type: ${Xa(z.type)}`)});let W=this.gpuDataManager.create($,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(W.buffer,0,j,0,$),this.gpuDataManager.release(W.id),w={offset:0,size:$,buffer:W.buffer}}let A=this.programManager.normalizeDispatchGroupSize(h),C=A[1]===1&&A[2]===1,M=vS(t,e,C),O=this.programManager.getArtifact(M);if(O||(O=this.programManager.build(t,A),this.programManager.setArtifact(M,O),At("info",()=>`[artifact] key: ${M}, programName: ${t.name}`)),f&&O.uniformVariablesInfo){if(f.length!==O.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${O.uniformVariablesInfo.length}, got ${f.length} in program "${O.programInfo.name}".`);for(let $=0;$<f.length;$++){let B=f[$],U=B.type,j=typeof B.data=="number"?1:B.data.length,[W,z]=O.uniformVariablesInfo[$];if(U!==W||j!==z)throw new Error(`Uniform variable ${$} mismatch: expect type ${W} with size ${z}, got type ${U} with size ${j} in program "${O.programInfo.name}".`)}}if(At("info",()=>`[ProgramManager] run "${t.name}" (key=${M}) with ${A[0]}x${A[1]}x${A[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let $={kernelId:this.currentKernelId,programName:O.programInfo.name,inputTensorViews:e,outputTensorViews:_};this.pendingKernels.push($),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push($)}return this.programManager.run(O,l,E,A,w),ks(t.name),_}upload(t,e){this.gpuDataManager.upload(t,e)}memcpy(t,e){this.gpuDataManager.memcpy(t,e)}async download(t,e){await this.gpuDataManager.download(t,e)}alloc(t){return this.gpuDataManager.create(t).id}free(t){return this.gpuDataManager.release(t)}createKernel(t,e,i,n){let s=x3.get(t);if(!s)throw new Error(`kernel not implemented: ${t}`);let o={kernelType:t,kernelName:n,kernelEntry:s[0],attributes:[s[1],i]};this.kernels.set(e,o)}releaseKernel(t){let e=this.kernelPersistentData.get(t);if(e){for(let i of e)this.gpuDataManager.release(i.id);this.kernelPersistentData.delete(t)}this.kernelCustomData.delete(t),this.kernels.delete(t)}computeKernel(t,e,i){let n=this.kernels.get(t);if(!n)throw new Error(`kernel not created: ${t}`);let s=n.kernelType,o=n.kernelName,l=n.kernelEntry,c=n.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${s}] ${o}" is not allowed to be called recursively`);this.currentKernelId=t,c[0]&&(c[1]=c[0](c[1]),c[0]=void 0),At("info",()=>`[WebGPU] Start to run kernel "[${s}] ${o}"...`);let h=this.env.debug;this.temporaryData=[];try{return h&&this.device.pushErrorScope("validation"),l(e,c[1]),0}catch(f){return i.push(Promise.resolve(`[WebGPU] Kernel "[${s}] ${o}" failed. ${f}`)),1}finally{h&&i.push(this.device.popErrorScope().then(f=>f?`GPU validation error for kernel "[${s}] ${o}": ${f.message}`:null));for(let f of this.temporaryData)this.gpuDataManager.release(f.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(t,e,i,n){let s=this.sessionExternalDataMapping.get(t);s||(s=new Map,this.sessionExternalDataMapping.set(t,s));let o=s.get(e),l=this.gpuDataManager.registerExternalBuffer(i,n,o);return s.set(e,[l,i]),l}unregisterBuffers(t){let e=this.sessionExternalDataMapping.get(t);e&&(e.forEach(i=>this.gpuDataManager.unregisterExternalBuffer(i[0])),this.sessionExternalDataMapping.delete(t))}getBuffer(t){let e=this.gpuDataManager.get(t);if(!e)throw new Error(`no GPU data for buffer: ${t}`);return e.buffer}createDownloader(t,e,i){return async()=>{let n=await H0(this,t,e);return qy(n.buffer,i)}}writeTimestamp(t){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,t)}setQueryType(){this.queryType="none",(this.env.webgpu.profiling?.mode==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){At("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){At("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){At("info","replay"),this.sessionStatus="replaying";let t=this.capturedCommandList.get(this.currentSessionId),e=this.capturedPendingKernels.get(this.currentSessionId),i=t.length;this.pendingKernels=[];for(let n=0;n<i;n++){let s=this.getComputePassEncoder(),o=t[n];this.writeTimestamp(this.pendingDispatchNumber*2),s.setPipeline(o.computePipeline),s.setBindGroup(0,o.bindGroup),s.dispatchWorkgroups(...o.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(e[n]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(t){this.unregisterBuffers(t),this.capturedCommandList.has(t)&&this.capturedCommandList.delete(t),this.capturedPendingKernels.has(t)&&this.capturedPendingKernels.delete(t),this.gpuDataManager.onReleaseSession(t)}onRunStart(t){this.currentSessionId=t,this.setQueryType()}}}),C3={};_c(C3,{init:()=>A3});var yf,TS,A3,AI=Ue(()=>{at(),to(),ht(),NO(),yf=class D3{constructor(e,i,n,s){this.module=e,this.dataType=i,this.data=n,this.dims=s}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let e=Ae.size(this.dims);return e===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,e)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let e=Ae.size(this.dims);return e===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,e)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let e=Ae.size(this.dims);return e===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,e)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let e=Ae.size(this.dims);return e===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,e)}reshape(e){if(Ae.size(e)!==Ae.size(this.dims))throw new Error("Invalid new shape");return new D3(this.module,this.dataType,this.data,e)}},TS=class{constructor(t,e,i){this.module=t,this.backend=e,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=e.adapterInfo;let n=t.PTR_SIZE,s=i/t.PTR_SIZE,o=n===4?"i32":"i64";this.opKernelContext=Number(t.getValue(n*s++,o));let l=Number(t.getValue(n*s++,o));this.outputCount=Number(t.getValue(n*s++,o)),this.customDataOffset=Number(t.getValue(n*s++,"*")),this.customDataSize=Number(t.getValue(n*s++,o));let c=[];for(let h=0;h<l;h++){let f=Number(t.getValue(n*s++,o)),m=Number(t.getValue(n*s++,"*")),_=Number(t.getValue(n*s++,o)),E=[];for(let w=0;w<_;w++)E.push(Number(t.getValue(n*s++,o)));c.push(new yf(t,f,m,E))}this.inputs=c}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(t,e){let i=e?.inputs?.map(l=>typeof l=="number"?this.inputs[l]:l)??this.inputs,n=e?.outputs??[],s=(l,c,h)=>new yf(this.module,c,this.output(l,h),h),o=(l,c)=>{let h=jl(l,c);if(!h)throw new Error(`Unsupported data type: ${l}`);let f=h>0?this.backend.gpuDataManager.create(h).id:0;return new yf(this.module,l,f,c)};return this.backend.run(t,i,n,s,o,this.outputCount)}output(t,e){let i=this.module.stackSave();try{let n=this.module.PTR_SIZE,s=n===4?"i32":"i64",o=this.module.stackAlloc((1+e.length)*n);this.module.setValue(o,e.length,s);for(let l=0;l<e.length;l++)this.module.setValue(o+n*(l+1),e[l],s);return this.module._JsepOutput(this.opKernelContext,t,o)}catch(n){throw new Error(`Failed to generate kernel's output[${t}] with dims [${e}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${n}`)}finally{this.module.stackRestore(i)}}},A3=async(t,e,i,n)=>{let s=e.jsepInit;if(!s)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(t==="webgpu"){let o=(CI(),Xd(w3)).WebGpuBackend,l=new o;await l.initialize(i,n),s("webgpu",[l,c=>l.alloc(Number(c)),c=>l.free(c),(c,h,f,m=!1)=>{if(m)At("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(c)}, dst=${Number(h)}, size=${Number(f)}`),l.memcpy(Number(c),Number(h));else{At("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(c)}, gpuDataId=${Number(h)}, size=${Number(f)}`);let _=e.HEAPU8.subarray(Number(c>>>0),Number(c>>>0)+Number(f));l.upload(Number(h),_)}},async(c,h,f)=>{At("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${c}, dataOffset=${h}, size=${f}`),await l.download(Number(c),()=>e.HEAPU8.subarray(Number(h)>>>0,Number(h+f)>>>0))},(c,h,f)=>l.createKernel(c,Number(h),f,e.UTF8ToString(e._JsepGetNodeName(Number(h)))),c=>l.releaseKernel(c),(c,h,f,m)=>{At("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${f}, kernel=${c}, contextDataOffset=${h}`);let _=new TS(e,l,Number(h));return l.computeKernel(Number(c),_,m)},()=>l.captureBegin(),()=>l.captureEnd(),()=>l.replay()])}else{let o=new UE(i);s("webnn",[o,()=>o.reserveTensorId(),l=>o.releaseTensorId(l),async(l,c,h,f,m)=>o.ensureTensor(l,c,h,f,m),(l,c)=>{o.uploadTensor(l,c)},async(l,c)=>o.downloadTensor(l,c),(l,c)=>o.registerMLContext(l,c),!!i.trace])}}}),xS,Jy,e_,Vo,SS,n0,zf,t_,i_,r0,n_,r_,s_,k3=Ue(()=>{is(),IO(),RO(),at(),su(),Ly(),IE(),xS=(t,e)=>{ii()._OrtInit(t,e)!==0&&jt("Can't initialize onnxruntime.")},Jy=async t=>{xS(t.wasm.numThreads,Nf(t.logLevel))},e_=async(t,e)=>{ii().asyncInit?.();let i=t.webgpu.adapter;if(e==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(i){if(typeof i.limits!="object"||typeof i.features!="object"||typeof i.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let n=t.webgpu.powerPreference;if(n!==void 0&&n!=="low-power"&&n!=="high-performance")throw new Error(`Invalid powerPreference setting: "${n}"`);let s=t.webgpu.forceFallbackAdapter;if(s!==void 0&&typeof s!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${s}"`);if(i=await navigator.gpu.requestAdapter({powerPreference:n,forceFallbackAdapter:s}),!i)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(e==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");{let n=(AI(),Xd(C3)).init;e==="webgpu"&&await n("webgpu",ii(),t,i),e==="webnn"&&await n("webnn",ii(),t)}},Vo=new Map,SS=t=>{let e=ii(),i=e.stackSave();try{let n=e.PTR_SIZE,s=e.stackAlloc(2*n);e._OrtGetInputOutputCount(t,s,s+n)!==0&&jt("Can't get session input/output count.");let o=n===4?"i32":"i64";return[Number(e.getValue(s,o)),Number(e.getValue(s+n,o))]}finally{e.stackRestore(i)}},n0=(t,e)=>{let i=ii(),n=i.stackSave(),s=0;try{let o=i.PTR_SIZE,l=i.stackAlloc(2*o);i._OrtGetInputOutputMetadata(t,e,l,l+o)!==0&&jt("Can't get session input/output metadata.");let c=Number(i.getValue(l,"*"));s=Number(i.getValue(l+o,"*"));let h=i.HEAP32[s/4];if(h===0)return[c,0];let f=i.HEAPU32[s/4+1],m=[];for(let _=0;_<f;_++){let E=Number(i.getValue(s+8+_*o,"*"));m.push(E!==0?i.UTF8ToString(E):Number(i.getValue(s+8+(_+f)*o,"*")))}return[c,h,m]}finally{i.stackRestore(n),s!==0&&i._OrtFree(s)}},zf=t=>{let e=ii(),i=e._malloc(t.byteLength);if(i===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${t.byteLength}.`);return e.HEAPU8.set(t,i),[i,t.byteLength]},t_=async(t,e)=>{let i,n,s=ii();Array.isArray(t)?[i,n]=t:t.buffer===s.HEAPU8.buffer?[i,n]=[t.byteOffset,t.byteLength]:[i,n]=zf(t);let o=0,l=0,c=0,h=[],f=[],m=[];try{if([l,h]=await OE(e),e?.externalData&&s.mountExternalData){let U=[];for(let j of e.externalData){let W=typeof j=="string"?j:j.path;U.push(zy(typeof j=="string"?j:j.data).then(z=>{s.mountExternalData(W,z)}))}await Promise.all(U)}for(let U of e?.executionProviders??[])if((typeof U=="string"?U:U.name)==="webnn"){if(s.shouldTransferToMLTensor=!1,typeof U!="string"){let j=U,W=j?.context,z=j?.gpuDevice,Y=j?.deviceType,L=j?.powerPreference;W?s.currentContext=W:z?s.currentContext=await s.webnnCreateMLContext(z):s.currentContext=await s.webnnCreateMLContext({deviceType:Y,powerPreference:L})}else s.currentContext=await s.webnnCreateMLContext();break}o=await s._OrtCreateSession(i,n,l),s.webgpuOnCreateSession?.(o),o===0&&jt("Can't create a session."),s.jsepOnCreateSession?.(),s.currentContext&&(s.webnnRegisterMLContext(o,s.currentContext),s.currentContext=void 0,s.shouldTransferToMLTensor=!0);let[_,E]=SS(o),w=!!e?.enableGraphCapture,A=[],C=[],M=[],O=[],$=[];for(let U=0;U<_;U++){let[j,W,z]=n0(o,U);j===0&&jt("Can't get an input name."),f.push(j);let Y=s.UTF8ToString(j);A.push(Y),M.push(W===0?{name:Y,isTensor:!1}:{name:Y,isTensor:!0,type:Xa(W),shape:z})}for(let U=0;U<E;U++){let[j,W,z]=n0(o,U+_);j===0&&jt("Can't get an output name."),m.push(j);let Y=s.UTF8ToString(j);C.push(Y),O.push(W===0?{name:Y,isTensor:!1}:{name:Y,isTensor:!0,type:Xa(W),shape:z});{if(w&&e?.preferredOutputLocation===void 0){$.push("gpu-buffer");continue}let L=typeof e?.preferredOutputLocation=="string"?e.preferredOutputLocation:e?.preferredOutputLocation?.[Y]??"cpu",H=s.webnnIsGraphOutput;if(L==="cpu"&&H&&H(o,Y)){$.push("ml-tensor-cpu-output");continue}if(L!=="cpu"&&L!=="cpu-pinned"&&L!=="gpu-buffer"&&L!=="ml-tensor")throw new Error(`Not supported preferred output location: ${L}.`);if(w&&L!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${L}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);$.push(L)}}let B=null;return $.some(U=>U==="gpu-buffer"||U==="ml-tensor"||U==="ml-tensor-cpu-output")&&(c=s._OrtCreateBinding(o),c===0&&jt("Can't create IO binding."),B={handle:c,outputPreferredLocations:$,outputPreferredLocationsEncoded:$.map(U=>U==="ml-tensor-cpu-output"?"ml-tensor":U).map(U=>q0(U))}),Vo.set(o,[o,f,m,B,w,!1]),[o,A,C,M,O]}catch(_){throw f.forEach(E=>s._OrtFree(E)),m.forEach(E=>s._OrtFree(E)),c!==0&&s._OrtReleaseBinding(c)!==0&&jt("Can't release IO binding."),o!==0&&s._OrtReleaseSession(o)!==0&&jt("Can't release session."),_}finally{s._free(i),l!==0&&s._OrtReleaseSessionOptions(l)!==0&&jt("Can't release session options."),h.forEach(_=>s._free(_)),s.unmountExternalData?.()}},i_=t=>{let e=ii(),i=Vo.get(t);if(!i)throw new Error(`cannot release session. invalid session id: ${t}`);let[n,s,o,l,c]=i;l&&(c&&e._OrtClearBoundOutputs(l.handle)!==0&&jt("Can't clear bound outputs."),e._OrtReleaseBinding(l.handle)!==0&&jt("Can't release IO binding.")),e.jsepOnReleaseSession?.(t),e.webnnOnReleaseSession?.(t),e.webgpuOnReleaseSession?.(t),s.forEach(h=>e._OrtFree(h)),o.forEach(h=>e._OrtFree(h)),e._OrtReleaseSession(n)!==0&&jt("Can't release session."),Vo.delete(t)},r0=async(t,e,i,n,s,o,l=!1)=>{if(!t){e.push(0);return}let c=ii(),h=c.PTR_SIZE,f=t[0],m=t[1],_=t[3],E=_,w,A;if(f==="string"&&(_==="gpu-buffer"||_==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(l&&_!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${o} when enableGraphCapture is true.`);if(_==="gpu-buffer"){let O=t[2].gpuBuffer;A=jl(ql(f),m);{let $=c.jsepRegisterBuffer;if(!$)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');w=$(n,o,O,A)}}else if(_==="ml-tensor"){let O=t[2].mlTensor;A=jl(ql(f),m);let $=c.webnnRegisterMLTensor;if(!$)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');w=$(n,O,ql(f),m)}else{let O=t[2];if(Array.isArray(O)){A=h*O.length,w=c._malloc(A),i.push(w);for(let $=0;$<O.length;$++){if(typeof O[$]!="string")throw new TypeError(`tensor data at index ${$} is not a string`);c.setValue(w+$*h,Ds(O[$],i),"*")}}else{let $=c.webnnIsGraphInput,B=c.webnnIsGraphOutput;if(f!=="string"&&$&&B){let U=c.UTF8ToString(s);if($(n,U)||B(n,U)){let j=ql(f);A=jl(j,m),E="ml-tensor";let W=c.webnnCreateTemporaryTensor,z=c.webnnUploadTensor;if(!W||!z)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let Y=await W(n,j,m);z(Y,new Uint8Array(O.buffer,O.byteOffset,O.byteLength)),w=Y}else A=O.byteLength,w=c._malloc(A),i.push(w),c.HEAPU8.set(new Uint8Array(O.buffer,O.byteOffset,A),w)}else A=O.byteLength,w=c._malloc(A),i.push(w),c.HEAPU8.set(new Uint8Array(O.buffer,O.byteOffset,A),w)}}let C=c.stackSave(),M=c.stackAlloc(4*m.length);try{m.forEach(($,B)=>c.setValue(M+B*h,$,h===4?"i32":"i64"));let O=c._OrtCreateTensor(ql(f),w,A,M,m.length,q0(E));O===0&&jt(`Can't create tensor for input/output. session=${n}, index=${o}.`),e.push(O)}finally{c.stackRestore(C)}},n_=async(t,e,i,n,s,o)=>{let l=ii(),c=l.PTR_SIZE,h=Vo.get(t);if(!h)throw new Error(`cannot run inference. invalid session id: ${t}`);let f=h[0],m=h[1],_=h[2],E=h[3],w=h[4],A=h[5],C=e.length,M=n.length,O=0,$=[],B=[],U=[],j=[],W=l.stackSave(),z=l.stackAlloc(C*c),Y=l.stackAlloc(C*c),L=l.stackAlloc(M*c),H=l.stackAlloc(M*c);try{[O,$]=$E(o),Wl("wasm prepareInputOutputTensor");for(let fe=0;fe<C;fe++)await r0(i[fe],B,j,t,m[e[fe]],e[fe],w);for(let fe=0;fe<M;fe++)await r0(s[fe],U,j,t,_[n[fe]],C+n[fe],w);Xl("wasm prepareInputOutputTensor");for(let fe=0;fe<C;fe++)l.setValue(z+fe*c,B[fe],"*"),l.setValue(Y+fe*c,m[e[fe]],"*");for(let fe=0;fe<M;fe++)l.setValue(L+fe*c,U[fe],"*"),l.setValue(H+fe*c,_[n[fe]],"*");if(E&&!A){let{handle:fe,outputPreferredLocations:be,outputPreferredLocationsEncoded:J}=E;if(m.length!==C)throw new Error(`input count from feeds (${C}) is expected to be always equal to model's input count (${m.length}).`);Wl("wasm bindInputsOutputs");for(let ee=0;ee<C;ee++){let de=e[ee];await l._OrtBindInput(fe,m[de],B[ee])!==0&&jt(`Can't bind input[${ee}] for session=${t}.`)}for(let ee=0;ee<M;ee++){let de=n[ee];s[ee]?.[3]?l._OrtBindOutput(fe,_[de],U[ee],0)!==0&&jt(`Can't bind pre-allocated output[${ee}] for session=${t}.`):l._OrtBindOutput(fe,_[de],0,J[de])!==0&&jt(`Can't bind output[${ee}] to ${be[ee]} for session=${t}.`)}Xl("wasm bindInputsOutputs"),Vo.set(t,[f,m,_,E,w,!0])}l.jsepOnRunStart?.(f),l.webnnOnRunStart?.(f);let se;E?se=await l._OrtRunWithBinding(f,E.handle,M,L,O):se=await l._OrtRun(f,Y,z,C,H,M,L,O),se!==0&&jt("failed to call OrtRun().");let ae=[],ce=[];Wl("wasm ProcessOutputTensor");for(let fe=0;fe<M;fe++){let be=Number(l.getValue(L+fe*c,"*"));if(be===U[fe]){ae.push(s[fe]);continue}let J=l.stackSave(),ee=l.stackAlloc(4*c),de=!1,ue,ve=0;try{l._OrtGetTensorData(be,ee,ee+c,ee+2*c,ee+3*c)!==0&&jt(`Can't access output tensor data on index ${fe}.`);let P=c===4?"i32":"i64",ne=Number(l.getValue(ee,P));ve=l.getValue(ee+c,"*");let ye=l.getValue(ee+c*2,"*"),ke=Number(l.getValue(ee+c*3,P)),le=[];for(let Je=0;Je<ke;Je++)le.push(Number(l.getValue(ye+Je*c,P)));l._OrtFree(ye)!==0&&jt("Can't free memory for tensor dims.");let ze=le.reduce((Je,Qe)=>Je*Qe,1);ue=Xa(ne);let it=E?.outputPreferredLocations[n[fe]];if(ue==="string"){if(it==="gpu-buffer"||it==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let Je=[];for(let Qe=0;Qe<ze;Qe++){let bt=l.getValue(ve+Qe*c,"*"),ri=l.getValue(ve+(Qe+1)*c,"*"),fi=Qe===ze-1?void 0:ri-bt;Je.push(l.UTF8ToString(bt,fi))}ae.push([ue,le,Je,"cpu"])}else if(it==="gpu-buffer"&&ze>0){let Je=l.jsepGetBuffer;if(!Je)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let Qe=Je(ve),bt=jl(ne,ze);if(bt===void 0||!Uy(ue))throw new Error(`Unsupported data type: ${ue}`);de=!0,ae.push([ue,le,{gpuBuffer:Qe,download:l.jsepCreateDownloader(Qe,bt,ue),dispose:()=>{l._OrtReleaseTensor(be)!==0&&jt("Can't release tensor.")}},"gpu-buffer"])}else if(it==="ml-tensor"&&ze>0){let Je=l.webnnEnsureTensor,Qe=l.webnnIsGraphInputOutputTypeSupported;if(!Je||!Qe)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(jl(ne,ze)===void 0||!Py(ue))throw new Error(`Unsupported data type: ${ue}`);if(!Qe(t,ue,!1))throw new Error(`preferredLocation "ml-tensor" for ${ue} output is not supported by current WebNN Context.`);let bt=await Je(t,ve,ne,le,!1);de=!0,ae.push([ue,le,{mlTensor:bt,download:l.webnnCreateMLTensorDownloader(ve,ue),dispose:()=>{l.webnnReleaseTensorId(ve),l._OrtReleaseTensor(be)}},"ml-tensor"])}else if(it==="ml-tensor-cpu-output"&&ze>0){let Je=l.webnnCreateMLTensorDownloader(ve,ue)(),Qe=ae.length;de=!0,ce.push((async()=>{let bt=[Qe,await Je];return l.webnnReleaseTensorId(ve),l._OrtReleaseTensor(be),bt})()),ae.push([ue,le,[],"cpu"])}else{let Je=lp(ue),Qe=new Je(ze);new Uint8Array(Qe.buffer,Qe.byteOffset,Qe.byteLength).set(l.HEAPU8.subarray(ve,ve+Qe.byteLength)),ae.push([ue,le,Qe,"cpu"])}}finally{l.stackRestore(J),ue==="string"&&ve&&l._free(ve),de||l._OrtReleaseTensor(be)}}E&&!w&&(l._OrtClearBoundOutputs(E.handle)!==0&&jt("Can't clear bound outputs."),Vo.set(t,[f,m,_,E,w,!1]));for(let[fe,be]of await Promise.all(ce))ae[fe][2]=be;return Xl("wasm ProcessOutputTensor"),ae}finally{l.webnnOnRunEnd?.(f),l.stackRestore(W),B.forEach(se=>l._OrtReleaseTensor(se)),U.forEach(se=>l._OrtReleaseTensor(se)),j.forEach(se=>l._free(se)),O!==0&&l._OrtReleaseRunOptions(O),$.forEach(se=>l._free(se))}},r_=t=>{let e=ii(),i=Vo.get(t);if(!i)throw new Error("invalid session id");let n=i[0],s=e._OrtEndProfiling(n);s===0&&jt("Can't get an profile file name."),e._OrtFree(s)},s_=t=>{let e=[];for(let i of t){let n=i[2];!Array.isArray(n)&&"buffer"in n&&e.push(n.buffer)}return e}}),Go,Yr,ju,Ad,Dd,_f,s0,vf,Bl,Ll,wS,$3,O3,I3,R3,M3,N3,B3,L3=Ue(()=>{is(),k3(),su(),Ny(),Go=()=>!!ui.wasm.proxy&&typeof document<"u",ju=!1,Ad=!1,Dd=!1,vf=new Map,Bl=(t,e)=>{let i=vf.get(t);i?i.push(e):vf.set(t,[e])},Ll=()=>{if(ju||!Ad||Dd||!Yr)throw new Error("worker not ready")},wS=t=>{switch(t.data.type){case"init-wasm":ju=!1,t.data.err?(Dd=!0,s0[1](t.data.err)):(Ad=!0,s0[0]()),_f&&(URL.revokeObjectURL(_f),_f=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let e=vf.get(t.data.type);t.data.err?e.shift()[1](t.data.err):e.shift()[0](t.data.out);break}}},$3=async()=>{if(!Ad){if(ju)throw new Error("multiple calls to 'initWasm()' detected.");if(Dd)throw new Error("previous call to 'initWasm()' failed.");if(ju=!0,Go())return new Promise((t,e)=>{Yr?.terminate(),DE().then(([i,n])=>{try{Yr=n,Yr.onerror=o=>e(o),Yr.onmessage=wS,s0=[t,e];let s={type:"init-wasm",in:ui};!s.in.wasm.wasmPaths&&(i||F0)&&(s.in.wasm.wasmPaths={wasm:new URL("https://github.com/vntion/chicken-part-detection/assets/ort-wasm-simd-threaded.jsep-BGTZ4Y7F.wasm",import.meta.url).href}),Yr.postMessage(s),_f=i}catch(s){e(s)}},e)});try{await By(ui.wasm),await Jy(ui),Ad=!0}catch(t){throw Dd=!0,t}finally{ju=!1}}},O3=async t=>{if(Go())return Ll(),new Promise((e,i)=>{Bl("init-ep",[e,i]);let n={type:"init-ep",in:{epName:t,env:ui}};Yr.postMessage(n)});await e_(ui,t)},I3=async t=>Go()?(Ll(),new Promise((e,i)=>{Bl("copy-from",[e,i]);let n={type:"copy-from",in:{buffer:t}};Yr.postMessage(n,[t.buffer])})):zf(t),R3=async(t,e)=>{if(Go()){if(e?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return Ll(),new Promise((i,n)=>{Bl("create",[i,n]);let s={type:"create",in:{model:t,options:{...e}}},o=[];t instanceof Uint8Array&&o.push(t.buffer),Yr.postMessage(s,o)})}else return t_(t,e)},M3=async t=>{if(Go())return Ll(),new Promise((e,i)=>{Bl("release",[e,i]);let n={type:"release",in:t};Yr.postMessage(n)});i_(t)},N3=async(t,e,i,n,s,o)=>{if(Go()){if(i.some(l=>l[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(s.some(l=>l))throw new Error("pre-allocated output tensor is not supported for proxy.");return Ll(),new Promise((l,c)=>{Bl("run",[l,c]);let h=i,f={type:"run",in:{sessionId:t,inputIndices:e,inputs:h,outputIndices:n,options:o}};Yr.postMessage(f,s_(h))})}else return n_(t,e,i,n,s,o)},B3=async t=>{if(Go())return Ll(),new Promise((e,i)=>{Bl("end-profiling",[e,i]);let n={type:"end-profiling",in:t};Yr.postMessage(n)});r_(t)}}),a0,ES,U3,DI=Ue(()=>{is(),L3(),at(),My(),IE(),a0=(t,e)=>{switch(t.location){case"cpu":return[t.type,t.dims,t.data,"cpu"];case"gpu-buffer":return[t.type,t.dims,{gpuBuffer:t.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[t.type,t.dims,{mlTensor:t.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${t.location} for ${e()}`)}},ES=t=>{switch(t[3]){case"cpu":return new Zr(t[0],t[2],t[1]);case"gpu-buffer":{let e=t[0];if(!Uy(e))throw new Error(`not supported data type: ${e} for deserializing GPU tensor`);let{gpuBuffer:i,download:n,dispose:s}=t[2];return Zr.fromGpuBuffer(i,{dataType:e,dims:t[1],download:n,dispose:s})}case"ml-tensor":{let e=t[0];if(!Py(e))throw new Error(`not supported data type: ${e} for deserializing MLTensor tensor`);let{mlTensor:i,download:n,dispose:s}=t[2];return Zr.fromMLTensor(i,{dataType:e,dims:t[1],download:n,dispose:s})}default:throw new Error(`invalid data location: ${t[3]}`)}},U3=class{async fetchModelAndCopyToWasmMemory(t){return I3(await zy(t))}async loadModel(t,e){oa();let i;typeof t=="string"?i=await this.fetchModelAndCopyToWasmMemory(t):i=t,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await R3(i,e),ks()}async dispose(){return M3(this.sessionId)}async run(t,e,i){oa();let n=[],s=[];Object.entries(t).forEach(_=>{let E=_[0],w=_[1],A=this.inputNames.indexOf(E);if(A===-1)throw new Error(`invalid input '${E}'`);n.push(w),s.push(A)});let o=[],l=[];Object.entries(e).forEach(_=>{let E=_[0],w=_[1],A=this.outputNames.indexOf(E);if(A===-1)throw new Error(`invalid output '${E}'`);o.push(w),l.push(A)});let c=n.map((_,E)=>a0(_,()=>`input "${this.inputNames[s[E]]}"`)),h=o.map((_,E)=>_?a0(_,()=>`output "${this.outputNames[l[E]]}"`):null),f=await N3(this.sessionId,s,c,l,h,i),m={};for(let _=0;_<f.length;_++)m[this.outputNames[l[_]]]=o[_]??ES(f[_]);return ks(),m}startProfiling(){}endProfiling(){B3(this.sessionId)}}}),P3={};_c(P3,{OnnxruntimeWebAssemblyBackend:()=>iy,initializeFlags:()=>ty,wasmBackend:()=>z3});var ty,iy,z3,kI=Ue(()=>{is(),L3(),DI(),ty=()=>{(typeof ui.wasm.initTimeout!="number"||ui.wasm.initTimeout<0)&&(ui.wasm.initTimeout=0);let t=ui.wasm.simd;if(typeof t!="boolean"&&t!==void 0&&t!=="fixed"&&t!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${t}". Reset it to \`false\` and ignore SIMD feature checking.`),ui.wasm.simd=!1),typeof ui.wasm.proxy!="boolean"&&(ui.wasm.proxy=!1),typeof ui.wasm.trace!="boolean"&&(ui.wasm.trace=!1),typeof ui.wasm.numThreads!="number"||!Number.isInteger(ui.wasm.numThreads)||ui.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)ui.wasm.numThreads=1;else{let e=typeof navigator>"u"?pO("node:os").cpus().length:navigator.hardwareConcurrency;ui.wasm.numThreads=Math.min(4,Math.ceil((e||1)/2))}},iy=class{async init(t){ty(),await $3(),await O3(t)}async createInferenceSessionHandler(t,e){let i=new U3;return await i.loadModel(t,e),i}},z3=new iy});is();is();is();var $I="1.23.2";{let t=(kI(),Xd(P3)).wasmBackend;Wu("webgpu",t,5),Wu("webnn",t,5),Wu("cpu",t,10),Wu("wasm",t,10)}Object.defineProperty(ui.versions,"web",{value:$I,enumerable:!0});const Qa=640,Za=640,OI=1,II=3,F3=[OI,II,Za,Qa],RI=["person","bicycle","car","motorcycle","airplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis racket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","couch","potted plant","bed","dining table","toilet","tv","laptop","mouse","remote","keyboard","cell phone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"],MI=t=>{const e=document.createElement("canvas");e.width=Qa,e.height=Za;const i=e.getContext("2d");if(!i)throw new Error("Gagal mendapatkan konteks 2D kanvas");i.drawImage(t,0,0,Qa,Za);const n=i.getImageData(0,0,Qa,Za).data,s=[],o=[],l=[];for(let c=0;c<n.length;c+=4)s.push(n[c]/255),o.push(n[c+1]/255),l.push(n[c+2]/255);return[...s,...o,...l]},NI=(t,e,i)=>{const n=t.getContext("2d");n&&(t.width=e.naturalWidth,t.height=e.naturalHeight,n.drawImage(e,0,0,t.width,t.height),n.strokeStyle="#4ade80",n.lineWidth=3,n.font="18px Arial",i.forEach(s=>{const[o,l,c,h]=s.bounding,f=s.label,m=s.probability;n.strokeRect(o,l,c,h),n.fillStyle="#4ade80";const _=`${f} (${(m*100).toFixed(1)}%)`,E=n.measureText(_).width;n.fillRect(o,l,E+10,25),n.fillStyle="#000000",n.fillText(_,o+5,l+18)}))},BI=async(t,e,i)=>{const n=e.current;if(!n){console.error("Elemen kanvas tidak ditemukan.");return}const s=MI(t),o=new Zr("float32",new Float32Array(s),F3),l=i.inputNames[0],c=i.outputNames[0],h={};h[l]=o;const m=(await i.run(h))[c],_=[],E=m.data,w=m.dims[1],A=m.dims[2],C=t.naturalWidth/Qa,M=t.naturalHeight/Za;for(let O=0;O<w;O++){const $=E.slice(O*A,(O+1)*A),B=$[0],U=$[1],j=$[2],W=$[3],z=$[4],Y=$[5];if(Number(z)<.25)continue;const L=B*C,H=U*M,se=(j-B)*C,ae=(W-U)*M;_.push({bounding:[L,H,se,ae],label:RI[Math.round(Y)],probability:z})}NI(n,t,_)};function LI({session:t}){const[e,i]=gi.useState(!1),[n,s]=gi.useState(null),[o,l]=gi.useState(!1),c=gi.useRef(null),h=_=>{_.target.files&&_.target.files[0]&&(s(_.target.files[0]),l(!1))},f=n?URL.createObjectURL(n):"",m=async()=>{if(!n){alert("Silakan unggah gambar terlebih dahulu.");return}if(!t){alert("Model belum dimuat");return}i(!0),l(!1);const _=new Image;_.src=f,_.onload=async()=>{try{await BI(_,c,t),l(!0),console.log("Deteksi selesai, kanvas digambar.")}catch(E){alert(`Terjadi kesalahan saat deteksi: ${E}`)}finally{i(!1)}}};return He.jsxs("div",{className:"mx-auto max-w-5xl space-y-6",children:[He.jsx("h2",{className:"text-4xl font-bold text-gray-800",children:"Deteksi Gambar"}),He.jsx("p",{className:"text-gray-600",children:"Unggah gambar untuk ditingkatkan (enhance) atau deteksi wilayah objek (region)."}),He.jsxs("form",{children:[n?He.jsxs("div",{className:"",children:[!o&&He.jsx("img",{src:f,alt:n.name,className:"h-auto max-h-210 w-full object-contain"}),He.jsx("canvas",{ref:c,className:o?"block h-auto max-h-200 w-full object-contain":"hidden"}),He.jsxs("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:["File terpilih: ",n.name]}),He.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Ukuran: ",(n.size/1024/1024).toFixed(2)," MB"]}),He.jsxs("label",{htmlFor:"input_file",className:"mt-4 inline-block w-full cursor-pointer rounded-md border border-gray-300 bg-white px-4 py-2 text-center text-sm font-medium text-gray-700 shadow-sm transition-colors hover:bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none",children:[He.jsx("input",{type:"file",onChange:h,className:"hidden",id:"input_file",accept:"image/png, image/jpeg, image/webp"}),"Ganti gambar"]})]}):He.jsxs("label",{className:"relative block cursor-pointer rounded-lg border-2 border-dashed border-gray-300 bg-white p-12 text-center transition-colors hover:border-blue-500",htmlFor:"input_file",children:[He.jsx("input",{type:"file",onChange:h,className:"absolute inset-0 cursor-pointer opacity-0",id:"input_file",accept:"image/png, image/jpeg, image/webp"}),He.jsxs(He.Fragment,{children:[He.jsx(nE,{className:"mx-auto h-12 w-12 text-gray-400"}),He.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Seret & Lepas atau Klik untuk mengunggah"}),He.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"PNG, JPG, WEBP hingga 10MB"})]})]}),He.jsx("button",{type:"button",onClick:m,disabled:e||!n,className:"mt-4 flex w-full cursor-pointer items-center justify-center rounded-lg bg-blue-600 px-4 py-3 text-lg font-bold text-white transition-colors hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-50",children:e?He.jsxs(He.Fragment,{children:[He.jsx(rE,{className:"mr-2 h-6 w-6 animate-spin"}),He.jsx("span",{children:"Mendeteksi..."})]}):He.jsx("span",{children:"Mulai Deteksi Gambar"})})]})]})}function UI({children:t}){return He.jsx("main",{className:"flex-1 overflow-auto p-10",children:t})}const q3=gi.createContext(void 0);function PI({children:t}){const[e,i]=gi.useState("image"),n=gi.useCallback(s=>{i(s)},[]);return He.jsx(q3.Provider,{value:{mode:e,onChangeMode:n},children:t})}const j3=()=>{const t=gi.useContext(q3);if(t===void 0)throw new Error("useMode must be used inside ModeProvider");return t};function zI(){const{onChangeMode:t,mode:e}=j3();return He.jsxs("aside",{className:"flex w-64 flex-col bg-gray-900 p-6 text-white shadow-xl",children:[He.jsx("h1",{className:"mb-1 text-center text-3xl font-bold",children:"Chicken part detection"}),He.jsx("h3",{className:"mb-8 text-center text-gray-400",children:"powered by yolov11"}),He.jsxs("nav",{className:"mb-auto flex flex-col space-y-2",children:[He.jsxs("button",{onClick:()=>t("image"),className:`flex w-full items-center gap-3 rounded-lg px-4 py-3 font-medium transition-all hover:cursor-pointer ${e==="image"?"bg-blue-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:[He.jsx(oO,{}),He.jsx("span",{children:"Deteksi Gambar"})]}),He.jsxs("button",{onClick:()=>t("video"),className:`flex w-full items-center gap-3 rounded-lg px-4 py-3 font-medium transition-all hover:cursor-pointer ${e==="video"?"bg-blue-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:[He.jsx(cO,{}),He.jsx("span",{children:"Deteksi Video"})]})]})]})}var o0,CS;function up(){if(CS)return o0;CS=1;var t;return typeof window<"u"?t=window:typeof If<"u"?t=If:typeof self<"u"?t=self:t={},o0=t,o0}var FI=up();const te=th(FI),qI={},jI=Object.freeze(Object.defineProperty({__proto__:null,default:qI},Symbol.toStringTag,{value:"Module"})),HI=q$(jI);var l0,AS;function H3(){if(AS)return l0;AS=1;var t=typeof If<"u"?If:typeof window<"u"?window:{},e=HI,i;return typeof document<"u"?i=document:(i=t["__GLOBAL_DOCUMENT_CACHE@4"],i||(i=t["__GLOBAL_DOCUMENT_CACHE@4"]=e)),l0=i,l0}var VI=H3();const Fe=th(VI);var bf={exports:{}},u0={exports:{}},DS;function GI(){return DS||(DS=1,(function(t){function e(){return t.exports=e=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var o in s)({}).hasOwnProperty.call(s,o)&&(i[o]=s[o])}return i},t.exports.__esModule=!0,t.exports.default=t.exports,e.apply(null,arguments)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports})(u0)),u0.exports}var c0,kS;function WI(){if(kS)return c0;kS=1,c0=e;var t=Object.prototype.toString;function e(i){if(!i)return!1;var n=t.call(i);return n==="[object Function]"||typeof i=="function"&&n!=="[object RegExp]"||typeof window<"u"&&(i===window.setTimeout||i===window.alert||i===window.confirm||i===window.prompt)}return c0}var d0,$S;function XI(){if($S)return d0;$S=1;function t(s,o){var l=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(l)return(l=l.call(s)).next.bind(l);if(Array.isArray(s)||(l=e(s))||o){l&&(s=l);var c=0;return function(){return c>=s.length?{done:!0}:{done:!1,value:s[c++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e(s,o){if(s){if(typeof s=="string")return i(s,o);var l=Object.prototype.toString.call(s).slice(8,-1);if(l==="Object"&&s.constructor&&(l=s.constructor.name),l==="Map"||l==="Set")return Array.from(s);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return i(s,o)}}function i(s,o){(o==null||o>s.length)&&(o=s.length);for(var l=0,c=new Array(o);l<o;l++)c[l]=s[l];return c}var n=(function(){function s(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1}var o=s.prototype;return o.getIsEnabled=function(){return this.enabled_},o.enable=function(){this.enabled_=!0},o.disable=function(){this.enabled_=!1},o.reset=function(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1},o.addInterceptor=function(c,h){this.typeToInterceptorsMap_.has(c)||this.typeToInterceptorsMap_.set(c,new Set);var f=this.typeToInterceptorsMap_.get(c);return f.has(h)?!1:(f.add(h),!0)},o.removeInterceptor=function(c,h){var f=this.typeToInterceptorsMap_.get(c);return f&&f.has(h)?(f.delete(h),!0):!1},o.clearInterceptorsByType=function(c){var h=this.typeToInterceptorsMap_.get(c);return h?(this.typeToInterceptorsMap_.delete(c),this.typeToInterceptorsMap_.set(c,new Set),!0):!1},o.clear=function(){return this.typeToInterceptorsMap_.size?(this.typeToInterceptorsMap_=new Map,!0):!1},o.getForType=function(c){return this.typeToInterceptorsMap_.get(c)||new Set},o.execute=function(c,h){for(var f=this.getForType(c),m=t(f),_;!(_=m()).done;){var E=_.value;try{h=E(h)}catch{}}return h},s})();return d0=n,d0}var h0,OS;function KI(){if(OS)return h0;OS=1;var t=(function(){function i(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1}var n=i.prototype;return n.getIsEnabled=function(){return this.enabled_},n.enable=function(){this.enabled_=!0},n.disable=function(){this.enabled_=!1},n.reset=function(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1},n.getMaxAttempts=function(){return this.maxAttempts_},n.setMaxAttempts=function(o){this.maxAttempts_=o},n.getDelayFactor=function(){return this.delayFactor_},n.setDelayFactor=function(o){this.delayFactor_=o},n.getFuzzFactor=function(){return this.fuzzFactor_},n.setFuzzFactor=function(o){this.fuzzFactor_=o},n.getInitialDelay=function(){return this.initialDelay_},n.setInitialDelay=function(o){this.initialDelay_=o},n.createRetry=function(o){var l=o===void 0?{}:o,c=l.maxAttempts,h=l.delayFactor,f=l.fuzzFactor,m=l.initialDelay;return new e({maxAttempts:c||this.maxAttempts_,delayFactor:h||this.delayFactor_,fuzzFactor:f||this.fuzzFactor_,initialDelay:m||this.initialDelay_})},i})(),e=(function(){function i(s){this.maxAttempts_=s.maxAttempts,this.delayFactor_=s.delayFactor,this.fuzzFactor_=s.fuzzFactor,this.currentDelay_=s.initialDelay,this.currentAttempt_=1}var n=i.prototype;return n.moveToNextAttempt=function(){this.currentAttempt_++;var o=this.currentDelay_*this.delayFactor_;this.currentDelay_=this.currentDelay_+o},n.shouldRetry=function(){return this.currentAttempt_<this.maxAttempts_},n.getCurrentDelay=function(){return this.currentDelay_},n.getCurrentMinPossibleDelay=function(){return(1-this.fuzzFactor_)*this.currentDelay_},n.getCurrentMaxPossibleDelay=function(){return(1+this.fuzzFactor_)*this.currentDelay_},n.getCurrentFuzzedDelay=function(){var o=this.getCurrentMinPossibleDelay(),l=this.getCurrentMaxPossibleDelay();return o+Math.random()*(l-o)},i})();return h0=t,h0}var f0,IS;function YI(){if(IS)return f0;IS=1;var t=up(),e=function(s,o){return o===void 0&&(o=!1),function(l,c,h){if(l){s(l);return}if(c.statusCode>=400&&c.statusCode<=599){var f=h;if(o)if(t.TextDecoder){var m=i(c.headers&&c.headers["content-type"]);try{f=new TextDecoder(m).decode(h)}catch{}}else f=String.fromCharCode.apply(null,new Uint8Array(h));s({cause:f});return}s(null,h)}};function i(n){return n===void 0&&(n=""),n.toLowerCase().split(";").reduce(function(s,o){var l=o.split("="),c=l[0],h=l[1];return c.trim()==="charset"?h.trim():s},"utf-8")}return f0=e,f0}var RS;function QI(){if(RS)return bf.exports;RS=1;var t=up(),e=GI(),i=WI(),n=XI(),s=KI();f.httpHandler=YI(),f.requestInterceptorsStorage=new n,f.responseInterceptorsStorage=new n,f.retryManager=new s;var o=function(A){var C={};return A&&A.trim().split(`
`).forEach(function(M){var O=M.indexOf(":"),$=M.slice(0,O).trim().toLowerCase(),B=M.slice(O+1).trim();typeof C[$]>"u"?C[$]=B:Array.isArray(C[$])?C[$].push(B):C[$]=[C[$],B]}),C};bf.exports=f,bf.exports.default=f,f.XMLHttpRequest=t.XMLHttpRequest||E,f.XDomainRequest="withCredentials"in new f.XMLHttpRequest?f.XMLHttpRequest:t.XDomainRequest,l(["get","put","post","patch","head","delete"],function(w){f[w==="delete"?"del":w]=function(A,C,M){return C=h(A,C,M),C.method=w.toUpperCase(),m(C)}});function l(w,A){for(var C=0;C<w.length;C++)A(w[C])}function c(w){for(var A in w)if(w.hasOwnProperty(A))return!1;return!0}function h(w,A,C){var M=w;return i(A)?(C=A,typeof w=="string"&&(M={uri:w})):M=e({},A,{uri:w}),M.callback=C,M}function f(w,A,C){return A=h(w,A,C),m(A)}function m(w){if(typeof w.callback>"u")throw new Error("callback argument missing");if(w.requestType&&f.requestInterceptorsStorage.getIsEnabled()){var A={uri:w.uri||w.url,headers:w.headers||{},body:w.body,metadata:w.metadata||{},retry:w.retry,timeout:w.timeout},C=f.requestInterceptorsStorage.execute(w.requestType,A);w.uri=C.uri,w.headers=C.headers,w.body=C.body,w.metadata=C.metadata,w.retry=C.retry,w.timeout=C.timeout}var M=!1,O=function(de,ue,ve){M||(M=!0,w.callback(de,ue,ve))};function $(){W.readyState===4&&!f.responseInterceptorsStorage.getIsEnabled()&&setTimeout(j,0)}function B(){var ee=void 0;if(W.response?ee=W.response:ee=W.responseText||_(W),fe)try{ee=JSON.parse(ee)}catch{}return ee}function U(ee){if(clearTimeout(be),clearTimeout(w.retryTimeout),ee instanceof Error||(ee=new Error(""+(ee||"Unknown XMLHttpRequest Error"))),ee.statusCode=0,!Y&&f.retryManager.getIsEnabled()&&w.retry&&w.retry.shouldRetry()){w.retryTimeout=setTimeout(function(){w.retry.moveToNextAttempt(),w.xhr=W,m(w)},w.retry.getCurrentFuzzedDelay());return}if(w.requestType&&f.responseInterceptorsStorage.getIsEnabled()){var de={headers:J.headers||{},body:J.body,responseUrl:W.responseURL,responseType:W.responseType},ue=f.responseInterceptorsStorage.execute(w.requestType,de);J.body=ue.body,J.headers=ue.headers}return O(ee,J)}function j(){if(!Y){var ee;clearTimeout(be),clearTimeout(w.retryTimeout),w.useXDR&&W.status===void 0?ee=200:ee=W.status===1223?204:W.status;var de=J,ue=null;if(ee!==0?(de={body:B(),statusCode:ee,method:H,headers:{},url:L,rawRequest:W},W.getAllResponseHeaders&&(de.headers=o(W.getAllResponseHeaders()))):ue=new Error("Internal XMLHttpRequest Error"),w.requestType&&f.responseInterceptorsStorage.getIsEnabled()){var ve={headers:de.headers||{},body:de.body,responseUrl:W.responseURL,responseType:W.responseType},P=f.responseInterceptorsStorage.execute(w.requestType,ve);de.body=P.body,de.headers=P.headers}return O(ue,de,de.body)}}var W=w.xhr||null;W||(w.cors||w.useXDR?W=new f.XDomainRequest:W=new f.XMLHttpRequest);var z,Y,L=W.url=w.uri||w.url,H=W.method=w.method||"GET",se=w.body||w.data,ae=W.headers=w.headers||{},ce=!!w.sync,fe=!1,be,J={body:void 0,headers:{},statusCode:0,method:H,url:L,rawRequest:W};if("json"in w&&w.json!==!1&&(fe=!0,ae.accept||ae.Accept||(ae.Accept="application/json"),H!=="GET"&&H!=="HEAD"&&(ae["content-type"]||ae["Content-Type"]||(ae["Content-Type"]="application/json"),se=JSON.stringify(w.json===!0?se:w.json))),W.onreadystatechange=$,W.onload=j,W.onerror=U,W.onprogress=function(){},W.onabort=function(){Y=!0,clearTimeout(w.retryTimeout)},W.ontimeout=U,W.open(H,L,!ce,w.username,w.password),ce||(W.withCredentials=!!w.withCredentials),!ce&&w.timeout>0&&(be=setTimeout(function(){if(!Y){Y=!0,W.abort("timeout");var ee=new Error("XMLHttpRequest timeout");ee.code="ETIMEDOUT",U(ee)}},w.timeout)),W.setRequestHeader)for(z in ae)ae.hasOwnProperty(z)&&W.setRequestHeader(z,ae[z]);else if(w.headers&&!c(w.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in w&&(W.responseType=w.responseType),"beforeSend"in w&&typeof w.beforeSend=="function"&&w.beforeSend(W),W.send(se||null),W}function _(w){try{if(w.responseType==="document")return w.responseXML;var A=w.responseXML&&w.responseXML.documentElement.nodeName==="parsererror";if(w.responseType===""&&!A)return w.responseXML}catch{}return null}function E(){}return bf.exports}var ZI=QI();const V3=th(ZI);var p0={exports:{}},m0,MS;function JI(){if(MS)return m0;MS=1;var t=H3(),e=Object.create||(function(){function L(){}return function(H){if(arguments.length!==1)throw new Error("Object.create shim only accepts one parameter.");return L.prototype=H,new L}})();function i(L,H){this.name="ParsingError",this.code=L.code,this.message=H||L.message}i.prototype=e(Error.prototype),i.prototype.constructor=i,i.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}};function n(L){function H(ae,ce,fe,be){return(ae|0)*3600+(ce|0)*60+(fe|0)+(be|0)/1e3}var se=L.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return se?se[3]?H(se[1],se[2],se[3].replace(":",""),se[4]):se[1]>59?H(se[1],se[2],0,se[4]):H(0,se[1],se[2],se[4]):null}function s(){this.values=e(null)}s.prototype={set:function(L,H){!this.get(L)&&H!==""&&(this.values[L]=H)},get:function(L,H,se){return se?this.has(L)?this.values[L]:H[se]:this.has(L)?this.values[L]:H},has:function(L){return L in this.values},alt:function(L,H,se){for(var ae=0;ae<se.length;++ae)if(H===se[ae]){this.set(L,H);break}},integer:function(L,H){/^-?\d+$/.test(H)&&this.set(L,parseInt(H,10))},percent:function(L,H){return H.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(H=parseFloat(H),H>=0&&H<=100)?(this.set(L,H),!0):!1}};function o(L,H,se,ae){var ce=ae?L.split(ae):[L];for(var fe in ce)if(typeof ce[fe]=="string"){var be=ce[fe].split(se);if(be.length===2){var J=be[0].trim(),ee=be[1].trim();H(J,ee)}}}function l(L,H,se){var ae=L;function ce(){var J=n(L);if(J===null)throw new i(i.Errors.BadTimeStamp,"Malformed timestamp: "+ae);return L=L.replace(/^[^\sa-zA-Z-]+/,""),J}function fe(J,ee){var de=new s;o(J,function(ue,ve){switch(ue){case"region":for(var P=se.length-1;P>=0;P--)if(se[P].id===ve){de.set(ue,se[P].region);break}break;case"vertical":de.alt(ue,ve,["rl","lr"]);break;case"line":var ne=ve.split(","),ye=ne[0];de.integer(ue,ye),de.percent(ue,ye)&&de.set("snapToLines",!1),de.alt(ue,ye,["auto"]),ne.length===2&&de.alt("lineAlign",ne[1],["start","center","end"]);break;case"position":ne=ve.split(","),de.percent(ue,ne[0]),ne.length===2&&de.alt("positionAlign",ne[1],["start","center","end"]);break;case"size":de.percent(ue,ve);break;case"align":de.alt(ue,ve,["start","center","end","left","right"]);break}},/:/,/\s/),ee.region=de.get("region",null),ee.vertical=de.get("vertical","");try{ee.line=de.get("line","auto")}catch{}ee.lineAlign=de.get("lineAlign","start"),ee.snapToLines=de.get("snapToLines",!0),ee.size=de.get("size",100);try{ee.align=de.get("align","center")}catch{ee.align=de.get("align","middle")}try{ee.position=de.get("position","auto")}catch{ee.position=de.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},ee.align)}ee.positionAlign=de.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},ee.align)}function be(){L=L.replace(/^\s+/,"")}if(be(),H.startTime=ce(),be(),L.substr(0,3)!=="-->")throw new i(i.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '-->'): "+ae);L=L.substr(3),be(),H.endTime=ce(),be(),fe(L,H)}var c=t.createElement&&t.createElement("textarea"),h={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},f={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},m={v:"title",lang:"lang"},_={rt:"ruby"};function E(L,H){function se(){if(!H)return null;function ye(le){return H=H.substr(le.length),le}var ke=H.match(/^([^<]*)(<[^>]*>?)?/);return ye(ke[1]?ke[1]:ke[2])}function ae(ye){return c.innerHTML=ye,ye=c.textContent,c.textContent="",ye}function ce(ye,ke){return!_[ke.localName]||_[ke.localName]===ye.localName}function fe(ye,ke){var le=h[ye];if(!le)return null;var ze=L.document.createElement(le),it=m[ye];return it&&ke&&(ze[it]=ke.trim()),ze}for(var be=L.document.createElement("div"),J=be,ee,de=[];(ee=se())!==null;){if(ee[0]==="<"){if(ee[1]==="/"){de.length&&de[de.length-1]===ee.substr(2).replace(">","")&&(de.pop(),J=J.parentNode);continue}var ue=n(ee.substr(1,ee.length-2)),ve;if(ue){ve=L.document.createProcessingInstruction("timestamp",ue),J.appendChild(ve);continue}var P=ee.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!P||(ve=fe(P[1],P[3]),!ve)||!ce(J,ve))continue;if(P[2]){var ne=P[2].split(".");ne.forEach(function(ye){var ke=/^bg_/.test(ye),le=ke?ye.slice(3):ye;if(f.hasOwnProperty(le)){var ze=ke?"background-color":"color",it=f[le];ve.style[ze]=it}}),ve.className=ne.join(" ")}de.push(P[1]),J.appendChild(ve),J=ve;continue}J.appendChild(L.document.createTextNode(ae(ee)))}return be}var w=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function A(L){for(var H=0;H<w.length;H++){var se=w[H];if(L>=se[0]&&L<=se[1])return!0}return!1}function C(L){var H=[],se="",ae;if(!L||!L.childNodes)return"ltr";function ce(J,ee){for(var de=ee.childNodes.length-1;de>=0;de--)J.push(ee.childNodes[de])}function fe(J){if(!J||!J.length)return null;var ee=J.pop(),de=ee.textContent||ee.innerText;if(de){var ue=de.match(/^.*(\n|\r)/);return ue?(J.length=0,ue[0]):de}if(ee.tagName==="ruby")return fe(J);if(ee.childNodes)return ce(J,ee),fe(J)}for(ce(H,L);se=fe(H);)for(var be=0;be<se.length;be++)if(ae=se.charCodeAt(be),A(ae))return"rtl";return"ltr"}function M(L){if(typeof L.line=="number"&&(L.snapToLines||L.line>=0&&L.line<=100))return L.line;if(!L.track||!L.track.textTrackList||!L.track.textTrackList.mediaElement)return-1;for(var H=L.track,se=H.textTrackList,ae=0,ce=0;ce<se.length&&se[ce]!==H;ce++)se[ce].mode==="showing"&&ae++;return++ae*-1}function O(){}O.prototype.applyStyles=function(L,H){H=H||this.div;for(var se in L)L.hasOwnProperty(se)&&(H.style[se]=L[se])},O.prototype.formatStyle=function(L,H){return L===0?0:L+H};function $(L,H,se){O.call(this),this.cue=H,this.cueDiv=E(L,H.text);var ae={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:H.vertical===""?"horizontal-tb":H.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(ae,this.cueDiv),this.div=L.document.createElement("div"),ae={direction:C(this.cueDiv),writingMode:H.vertical===""?"horizontal-tb":H.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:H.align==="middle"?"center":H.align,font:se.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(ae),this.div.appendChild(this.cueDiv);var ce=0;switch(H.positionAlign){case"start":case"line-left":ce=H.position;break;case"center":ce=H.position-H.size/2;break;case"end":case"line-right":ce=H.position-H.size;break}H.vertical===""?this.applyStyles({left:this.formatStyle(ce,"%"),width:this.formatStyle(H.size,"%")}):this.applyStyles({top:this.formatStyle(ce,"%"),height:this.formatStyle(H.size,"%")}),this.move=function(fe){this.applyStyles({top:this.formatStyle(fe.top,"px"),bottom:this.formatStyle(fe.bottom,"px"),left:this.formatStyle(fe.left,"px"),right:this.formatStyle(fe.right,"px"),height:this.formatStyle(fe.height,"px"),width:this.formatStyle(fe.width,"px")})}}$.prototype=e(O.prototype),$.prototype.constructor=$;function B(L){var H,se,ae,ce;if(L.div){se=L.div.offsetHeight,ae=L.div.offsetWidth,ce=L.div.offsetTop;var fe=(fe=L.div.childNodes)&&(fe=fe[0])&&fe.getClientRects&&fe.getClientRects();L=L.div.getBoundingClientRect(),H=fe?Math.max(fe[0]&&fe[0].height||0,L.height/fe.length):0}this.left=L.left,this.right=L.right,this.top=L.top||ce,this.height=L.height||se,this.bottom=L.bottom||ce+(L.height||se),this.width=L.width||ae,this.lineHeight=H!==void 0?H:L.lineHeight}B.prototype.move=function(L,H){switch(H=H!==void 0?H:this.lineHeight,L){case"+x":this.left+=H,this.right+=H;break;case"-x":this.left-=H,this.right-=H;break;case"+y":this.top+=H,this.bottom+=H;break;case"-y":this.top-=H,this.bottom-=H;break}},B.prototype.overlaps=function(L){return this.left<L.right&&this.right>L.left&&this.top<L.bottom&&this.bottom>L.top},B.prototype.overlapsAny=function(L){for(var H=0;H<L.length;H++)if(this.overlaps(L[H]))return!0;return!1},B.prototype.within=function(L){return this.top>=L.top&&this.bottom<=L.bottom&&this.left>=L.left&&this.right<=L.right},B.prototype.overlapsOppositeAxis=function(L,H){switch(H){case"+x":return this.left<L.left;case"-x":return this.right>L.right;case"+y":return this.top<L.top;case"-y":return this.bottom>L.bottom}},B.prototype.intersectPercentage=function(L){var H=Math.max(0,Math.min(this.right,L.right)-Math.max(this.left,L.left)),se=Math.max(0,Math.min(this.bottom,L.bottom)-Math.max(this.top,L.top)),ae=H*se;return ae/(this.height*this.width)},B.prototype.toCSSCompatValues=function(L){return{top:this.top-L.top,bottom:L.bottom-this.bottom,left:this.left-L.left,right:L.right-this.right,height:this.height,width:this.width}},B.getSimpleBoxPosition=function(L){var H=L.div?L.div.offsetHeight:L.tagName?L.offsetHeight:0,se=L.div?L.div.offsetWidth:L.tagName?L.offsetWidth:0,ae=L.div?L.div.offsetTop:L.tagName?L.offsetTop:0;L=L.div?L.div.getBoundingClientRect():L.tagName?L.getBoundingClientRect():L;var ce={left:L.left,right:L.right,top:L.top||ae,height:L.height||H,bottom:L.bottom||ae+(L.height||H),width:L.width||se};return ce};function U(L,H,se,ae){function ce(le,ze){for(var it,Je=new B(le),Qe=1,bt=0;bt<ze.length;bt++){for(;le.overlapsOppositeAxis(se,ze[bt])||le.within(se)&&le.overlapsAny(ae);)le.move(ze[bt]);if(le.within(se))return le;var ri=le.intersectPercentage(se);Qe>ri&&(it=new B(le),Qe=ri),le=new B(Je)}return it||Je}var fe=new B(H),be=H.cue,J=M(be),ee=[];if(be.snapToLines){var de;switch(be.vertical){case"":ee=["+y","-y"],de="height";break;case"rl":ee=["+x","-x"],de="width";break;case"lr":ee=["-x","+x"],de="width";break}var ue=fe.lineHeight,ve=ue*Math.round(J),P=se[de]+ue,ne=ee[0];Math.abs(ve)>P&&(ve=ve<0?-1:1,ve*=Math.ceil(P/ue)*ue),J<0&&(ve+=be.vertical===""?se.height:se.width,ee=ee.reverse()),fe.move(ne,ve)}else{var ye=fe.lineHeight/se.height*100;switch(be.lineAlign){case"center":J-=ye/2;break;case"end":J-=ye;break}switch(be.vertical){case"":H.applyStyles({top:H.formatStyle(J,"%")});break;case"rl":H.applyStyles({left:H.formatStyle(J,"%")});break;case"lr":H.applyStyles({right:H.formatStyle(J,"%")});break}ee=["+y","-x","+x","-y"],fe=new B(H)}var ke=ce(fe,ee);H.move(ke.toCSSCompatValues(se))}function j(){}j.StringDecoder=function(){return{decode:function(L){if(!L)return"";if(typeof L!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(L))}}},j.convertCueToDOMTree=function(L,H){return!L||!H?null:E(L,H)};var W=.05,z="sans-serif",Y="1.5%";return j.processCues=function(L,H,se){if(!L||!H||!se)return null;for(;se.firstChild;)se.removeChild(se.firstChild);var ae=L.document.createElement("div");ae.style.position="absolute",ae.style.left="0",ae.style.right="0",ae.style.top="0",ae.style.bottom="0",ae.style.margin=Y,se.appendChild(ae);function ce(ue){for(var ve=0;ve<ue.length;ve++)if(ue[ve].hasBeenReset||!ue[ve].displayState)return!0;return!1}if(!ce(H)){for(var fe=0;fe<H.length;fe++)ae.appendChild(H[fe].displayState);return}var be=[],J=B.getSimpleBoxPosition(ae),ee=Math.round(J.height*W*100)/100,de={font:ee+"px "+z};(function(){for(var ue,ve,P=0;P<H.length;P++)ve=H[P],ue=new $(L,ve,de),ae.appendChild(ue.div),U(L,ue,J,be),ve.displayState=ue.div,be.push(B.getSimpleBoxPosition(ue))})()},j.Parser=function(L,H,se){se||(se=H,H={}),H||(H={}),this.window=L,this.vttjs=H,this.state="INITIAL",this.buffer="",this.decoder=se||new TextDecoder("utf8"),this.regionList=[]},j.Parser.prototype={reportOrThrowError:function(L){if(L instanceof i)this.onparsingerror&&this.onparsingerror(L);else throw L},parse:function(L){var H=this;L&&(H.buffer+=H.decoder.decode(L,{stream:!0}));function se(){for(var ue=H.buffer,ve=0;ve<ue.length&&ue[ve]!=="\r"&&ue[ve]!==`
`;)++ve;var P=ue.substr(0,ve);return ue[ve]==="\r"&&++ve,ue[ve]===`
`&&++ve,H.buffer=ue.substr(ve),P}function ae(ue){var ve=new s;if(o(ue,function(ne,ye){switch(ne){case"id":ve.set(ne,ye);break;case"width":ve.percent(ne,ye);break;case"lines":ve.integer(ne,ye);break;case"regionanchor":case"viewportanchor":var ke=ye.split(",");if(ke.length!==2)break;var le=new s;if(le.percent("x",ke[0]),le.percent("y",ke[1]),!le.has("x")||!le.has("y"))break;ve.set(ne+"X",le.get("x")),ve.set(ne+"Y",le.get("y"));break;case"scroll":ve.alt(ne,ye,["up"]);break}},/=/,/\s/),ve.has("id")){var P=new(H.vttjs.VTTRegion||H.window.VTTRegion);P.width=ve.get("width",100),P.lines=ve.get("lines",3),P.regionAnchorX=ve.get("regionanchorX",0),P.regionAnchorY=ve.get("regionanchorY",100),P.viewportAnchorX=ve.get("viewportanchorX",0),P.viewportAnchorY=ve.get("viewportanchorY",100),P.scroll=ve.get("scroll",""),H.onregion&&H.onregion(P),H.regionList.push({id:ve.get("id"),region:P})}}function ce(ue){var ve=new s;o(ue,function(P,ne){switch(P){case"MPEGT":ve.integer(P+"S",ne);break;case"LOCA":ve.set(P+"L",n(ne));break}},/[^\d]:/,/,/),H.ontimestampmap&&H.ontimestampmap({MPEGTS:ve.get("MPEGTS"),LOCAL:ve.get("LOCAL")})}function fe(ue){ue.match(/X-TIMESTAMP-MAP/)?o(ue,function(ve,P){switch(ve){case"X-TIMESTAMP-MAP":ce(P);break}},/=/):o(ue,function(ve,P){switch(ve){case"Region":ae(P);break}},/:/)}try{var be;if(H.state==="INITIAL"){if(!/\r\n|\n/.test(H.buffer))return this;be=se();var J=be.match(/^WEBVTT([ \t].*)?$/);if(!J||!J[0])throw new i(i.Errors.BadSignature);H.state="HEADER"}for(var ee=!1;H.buffer;){if(!/\r\n|\n/.test(H.buffer))return this;switch(ee?ee=!1:be=se(),H.state){case"HEADER":/:/.test(be)?fe(be):be||(H.state="ID");continue;case"NOTE":be||(H.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(be)){H.state="NOTE";break}if(!be)continue;H.cue=new(H.vttjs.VTTCue||H.window.VTTCue)(0,0,"");try{H.cue.align="center"}catch{H.cue.align="middle"}if(H.state="CUE",be.indexOf("-->")===-1){H.cue.id=be;continue}case"CUE":try{l(be,H.cue,H.regionList)}catch(ue){H.reportOrThrowError(ue),H.cue=null,H.state="BADCUE";continue}H.state="CUETEXT";continue;case"CUETEXT":var de=be.indexOf("-->")!==-1;if(!be||de&&(ee=!0)){H.oncue&&H.oncue(H.cue),H.cue=null,H.state="ID";continue}H.cue.text&&(H.cue.text+=`
`),H.cue.text+=be.replace(/\u2028/g,`
`).replace(/u2029/g,`
`);continue;case"BADCUE":be||(H.state="ID");continue}}}catch(ue){H.reportOrThrowError(ue),H.state==="CUETEXT"&&H.cue&&H.oncue&&H.oncue(H.cue),H.cue=null,H.state=H.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var L=this;try{if(L.buffer+=L.decoder.decode(),(L.cue||L.state==="HEADER")&&(L.buffer+=`

`,L.parse()),L.state==="INITIAL")throw new i(i.Errors.BadSignature)}catch(H){L.reportOrThrowError(H)}return L.onflush&&L.onflush(),this}},m0=j,m0}var g0,NS;function eR(){if(NS)return g0;NS=1;var t="auto",e={"":1,lr:1,rl:1},i={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function n(l){if(typeof l!="string")return!1;var c=e[l.toLowerCase()];return c?l.toLowerCase():!1}function s(l){if(typeof l!="string")return!1;var c=i[l.toLowerCase()];return c?l.toLowerCase():!1}function o(l,c,h){this.hasBeenReset=!1;var f="",m=!1,_=l,E=c,w=h,A=null,C="",M=!0,O="auto",$="start",B="auto",U="auto",j=100,W="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return f},set:function(z){f=""+z}},pauseOnExit:{enumerable:!0,get:function(){return m},set:function(z){m=!!z}},startTime:{enumerable:!0,get:function(){return _},set:function(z){if(typeof z!="number")throw new TypeError("Start time must be set to a number.");_=z,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return E},set:function(z){if(typeof z!="number")throw new TypeError("End time must be set to a number.");E=z,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return w},set:function(z){w=""+z,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return A},set:function(z){A=z,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return C},set:function(z){var Y=n(z);if(Y===!1)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");C=Y,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return M},set:function(z){M=!!z,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return O},set:function(z){if(typeof z!="number"&&z!==t)throw new SyntaxError("Line: an invalid number or illegal string was specified.");O=z,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return $},set:function(z){var Y=s(z);Y?($=Y,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return B},set:function(z){if(z<0||z>100)throw new Error("Position must be between 0 and 100.");B=z,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return U},set:function(z){var Y=s(z);Y?(U=Y,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return j},set:function(z){if(z<0||z>100)throw new Error("Size must be between 0 and 100.");j=z,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return W},set:function(z){var Y=s(z);if(!Y)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");W=Y,this.hasBeenReset=!0}}}),this.displayState=void 0}return o.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},g0=o,g0}var y0,BS;function tR(){if(BS)return y0;BS=1;var t={"":!0,up:!0};function e(s){if(typeof s!="string")return!1;var o=t[s.toLowerCase()];return o?s.toLowerCase():!1}function i(s){return typeof s=="number"&&s>=0&&s<=100}function n(){var s=100,o=3,l=0,c=100,h=0,f=100,m="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return s},set:function(_){if(!i(_))throw new Error("Width must be between 0 and 100.");s=_}},lines:{enumerable:!0,get:function(){return o},set:function(_){if(typeof _!="number")throw new TypeError("Lines must be set to a number.");o=_}},regionAnchorY:{enumerable:!0,get:function(){return c},set:function(_){if(!i(_))throw new Error("RegionAnchorX must be between 0 and 100.");c=_}},regionAnchorX:{enumerable:!0,get:function(){return l},set:function(_){if(!i(_))throw new Error("RegionAnchorY must be between 0 and 100.");l=_}},viewportAnchorY:{enumerable:!0,get:function(){return f},set:function(_){if(!i(_))throw new Error("ViewportAnchorY must be between 0 and 100.");f=_}},viewportAnchorX:{enumerable:!0,get:function(){return h},set:function(_){if(!i(_))throw new Error("ViewportAnchorX must be between 0 and 100.");h=_}},scroll:{enumerable:!0,get:function(){return m},set:function(_){var E=e(_);E===!1?console.warn("Scroll: an invalid or illegal string was specified."):m=E}}})}return y0=n,y0}var LS;function iR(){if(LS)return p0.exports;LS=1;var t=up(),e=p0.exports={WebVTT:JI(),VTTCue:eR(),VTTRegion:tR()};t.vttjs=e,t.WebVTT=e.WebVTT;var i=e.VTTCue,n=e.VTTRegion,s=t.VTTCue,o=t.VTTRegion;return e.shim=function(){t.VTTCue=i,t.VTTRegion=n},e.restore=function(){t.VTTCue=s,t.VTTRegion=o},t.VTTCue||e.shim(),p0.exports}var nR=iR();const US=th(nR);function Li(){return Li=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)({}).hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},Li.apply(null,arguments)}var PS="https://example.com",cp=function(e,i){if(/^[a-z]+:/i.test(i))return i;/^data:/.test(e)&&(e=te.location&&te.location.href||"");var n=/^\/\//.test(e),s=!te.location&&!/\/\//i.test(e);e=new te.URL(e,te.location||PS);var o=new URL(i,e);return s?o.href.slice(PS.length):n?o.href.slice(o.protocol.length):o.href},a_=(function(){function t(){this.listeners={}}var e=t.prototype;return e.on=function(n,s){this.listeners[n]||(this.listeners[n]=[]),this.listeners[n].push(s)},e.off=function(n,s){if(!this.listeners[n])return!1;var o=this.listeners[n].indexOf(s);return this.listeners[n]=this.listeners[n].slice(0),this.listeners[n].splice(o,1),o>-1},e.trigger=function(n){var s=this.listeners[n];if(s)if(arguments.length===2)for(var o=s.length,l=0;l<o;++l)s[l].call(this,arguments[1]);else for(var c=Array.prototype.slice.call(arguments,1),h=s.length,f=0;f<h;++f)s[f].apply(this,c)},e.dispose=function(){this.listeners={}},e.pipe=function(n){this.on("data",function(s){n.push(s)})},t})(),rR=function(e){return te.atob?te.atob(e):Buffer.from(e,"base64").toString("binary")};function G3(t){for(var e=rR(t),i=new Uint8Array(e.length),n=0;n<e.length;n++)i[n]=e.charCodeAt(n);return i}class sR extends a_{constructor(){super(),this.buffer=""}push(e){let i;for(this.buffer+=e,i=this.buffer.indexOf(`
`);i>-1;i=this.buffer.indexOf(`
`))this.trigger("data",this.buffer.substring(0,i)),this.buffer=this.buffer.substring(i+1)}}const aR="	",_0=function(t){const e=/([0-9.]*)?@?([0-9.]*)?/.exec(t||""),i={};return e[1]&&(i.length=parseInt(e[1],10)),e[2]&&(i.offset=parseInt(e[2],10)),i},oR=function(){const i="(?:"+"[^=]*"+")=(?:"+'"[^"]*"|[^,]*'+")";return new RegExp("(?:^|,)("+i+")")},jn=function(t){const e={};if(!t)return e;const i=t.split(oR());let n=i.length,s;for(;n--;)i[n]!==""&&(s=/([^=]*)=(.*)/.exec(i[n]).slice(1),s[0]=s[0].replace(/^\s+|\s+$/g,""),s[1]=s[1].replace(/^\s+|\s+$/g,""),s[1]=s[1].replace(/^['"](.*)['"]$/g,"$1"),e[s[0]]=s[1]);return e},zS=t=>{const e=t.split("x"),i={};return e[0]&&(i.width=parseInt(e[0],10)),e[1]&&(i.height=parseInt(e[1],10)),i};class lR extends a_{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(e){let i,n;if(e=e.trim(),e.length===0)return;if(e[0]!=="#"){this.trigger("data",{type:"uri",uri:e});return}this.tagMappers.reduce((o,l)=>{const c=l(e);return c===e?o:o.concat([c])},[e]).forEach(o=>{for(let l=0;l<this.customParsers.length;l++)if(this.customParsers[l].call(this,o))return;if(o.indexOf("#EXT")!==0){this.trigger("data",{type:"comment",text:o.slice(1)});return}if(o=o.replace("\r",""),i=/^#EXTM3U/.exec(o),i){this.trigger("data",{type:"tag",tagType:"m3u"});return}if(i=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(o),i){n={type:"tag",tagType:"inf"},i[1]&&(n.duration=parseFloat(i[1])),i[2]&&(n.title=i[2]),this.trigger("data",n);return}if(i=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(o),i){n={type:"tag",tagType:"targetduration"},i[1]&&(n.duration=parseInt(i[1],10)),this.trigger("data",n);return}if(i=/^#EXT-X-VERSION:([0-9.]*)?/.exec(o),i){n={type:"tag",tagType:"version"},i[1]&&(n.version=parseInt(i[1],10)),this.trigger("data",n);return}if(i=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(o),i){n={type:"tag",tagType:"media-sequence"},i[1]&&(n.number=parseInt(i[1],10)),this.trigger("data",n);return}if(i=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(o),i){n={type:"tag",tagType:"discontinuity-sequence"},i[1]&&(n.number=parseInt(i[1],10)),this.trigger("data",n);return}if(i=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(o),i){n={type:"tag",tagType:"playlist-type"},i[1]&&(n.playlistType=i[1]),this.trigger("data",n);return}if(i=/^#EXT-X-BYTERANGE:(.*)?$/.exec(o),i){n=Li(_0(i[1]),{type:"tag",tagType:"byterange"}),this.trigger("data",n);return}if(i=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(o),i){n={type:"tag",tagType:"allow-cache"},i[1]&&(n.allowed=!/NO/.test(i[1])),this.trigger("data",n);return}if(i=/^#EXT-X-MAP:(.*)$/.exec(o),i){if(n={type:"tag",tagType:"map"},i[1]){const l=jn(i[1]);l.URI&&(n.uri=l.URI),l.BYTERANGE&&(n.byterange=_0(l.BYTERANGE))}this.trigger("data",n);return}if(i=/^#EXT-X-STREAM-INF:(.*)$/.exec(o),i){n={type:"tag",tagType:"stream-inf"},i[1]&&(n.attributes=jn(i[1]),n.attributes.RESOLUTION&&(n.attributes.RESOLUTION=zS(n.attributes.RESOLUTION)),n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["FRAME-RATE"]&&(n.attributes["FRAME-RATE"]=parseFloat(n.attributes["FRAME-RATE"])),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))),this.trigger("data",n);return}if(i=/^#EXT-X-MEDIA:(.*)$/.exec(o),i){n={type:"tag",tagType:"media"},i[1]&&(n.attributes=jn(i[1])),this.trigger("data",n);return}if(i=/^#EXT-X-ENDLIST/.exec(o),i){this.trigger("data",{type:"tag",tagType:"endlist"});return}if(i=/^#EXT-X-DISCONTINUITY/.exec(o),i){this.trigger("data",{type:"tag",tagType:"discontinuity"});return}if(i=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(o),i){n={type:"tag",tagType:"program-date-time"},i[1]&&(n.dateTimeString=i[1],n.dateTimeObject=new Date(i[1])),this.trigger("data",n);return}if(i=/^#EXT-X-KEY:(.*)$/.exec(o),i){n={type:"tag",tagType:"key"},i[1]&&(n.attributes=jn(i[1]),n.attributes.IV&&(n.attributes.IV.substring(0,2).toLowerCase()==="0x"&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),this.trigger("data",n);return}if(i=/^#EXT-X-START:(.*)$/.exec(o),i){n={type:"tag",tagType:"start"},i[1]&&(n.attributes=jn(i[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),this.trigger("data",n);return}if(i=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(o),i){n={type:"tag",tagType:"cue-out-cont"},i[1]?n.data=i[1]:n.data="",this.trigger("data",n);return}if(i=/^#EXT-X-CUE-OUT:(.*)?$/.exec(o),i){n={type:"tag",tagType:"cue-out"},i[1]?n.data=i[1]:n.data="",this.trigger("data",n);return}if(i=/^#EXT-X-CUE-IN:?(.*)?$/.exec(o),i){n={type:"tag",tagType:"cue-in"},i[1]?n.data=i[1]:n.data="",this.trigger("data",n);return}if(i=/^#EXT-X-SKIP:(.*)$/.exec(o),i&&i[1]){n={type:"tag",tagType:"skip"},n.attributes=jn(i[1]),n.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(n.attributes["SKIPPED-SEGMENTS"]=parseInt(n.attributes["SKIPPED-SEGMENTS"],10)),n.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(n.attributes["RECENTLY-REMOVED-DATERANGES"]=n.attributes["RECENTLY-REMOVED-DATERANGES"].split(aR)),this.trigger("data",n);return}if(i=/^#EXT-X-PART:(.*)$/.exec(o),i&&i[1]){n={type:"tag",tagType:"part"},n.attributes=jn(i[1]),["DURATION"].forEach(function(l){n.attributes.hasOwnProperty(l)&&(n.attributes[l]=parseFloat(n.attributes[l]))}),["INDEPENDENT","GAP"].forEach(function(l){n.attributes.hasOwnProperty(l)&&(n.attributes[l]=/YES/.test(n.attributes[l]))}),n.attributes.hasOwnProperty("BYTERANGE")&&(n.attributes.byterange=_0(n.attributes.BYTERANGE)),this.trigger("data",n);return}if(i=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(o),i&&i[1]){n={type:"tag",tagType:"server-control"},n.attributes=jn(i[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(l){n.attributes.hasOwnProperty(l)&&(n.attributes[l]=parseFloat(n.attributes[l]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(l){n.attributes.hasOwnProperty(l)&&(n.attributes[l]=/YES/.test(n.attributes[l]))}),this.trigger("data",n);return}if(i=/^#EXT-X-PART-INF:(.*)$/.exec(o),i&&i[1]){n={type:"tag",tagType:"part-inf"},n.attributes=jn(i[1]),["PART-TARGET"].forEach(function(l){n.attributes.hasOwnProperty(l)&&(n.attributes[l]=parseFloat(n.attributes[l]))}),this.trigger("data",n);return}if(i=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(o),i&&i[1]){n={type:"tag",tagType:"preload-hint"},n.attributes=jn(i[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(l){if(n.attributes.hasOwnProperty(l)){n.attributes[l]=parseInt(n.attributes[l],10);const c=l==="BYTERANGE-LENGTH"?"length":"offset";n.attributes.byterange=n.attributes.byterange||{},n.attributes.byterange[c]=n.attributes[l],delete n.attributes[l]}}),this.trigger("data",n);return}if(i=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(o),i&&i[1]){n={type:"tag",tagType:"rendition-report"},n.attributes=jn(i[1]),["LAST-MSN","LAST-PART"].forEach(function(l){n.attributes.hasOwnProperty(l)&&(n.attributes[l]=parseInt(n.attributes[l],10))}),this.trigger("data",n);return}if(i=/^#EXT-X-DATERANGE:(.*)$/.exec(o),i&&i[1]){n={type:"tag",tagType:"daterange"},n.attributes=jn(i[1]),["ID","CLASS"].forEach(function(c){n.attributes.hasOwnProperty(c)&&(n.attributes[c]=String(n.attributes[c]))}),["START-DATE","END-DATE"].forEach(function(c){n.attributes.hasOwnProperty(c)&&(n.attributes[c]=new Date(n.attributes[c]))}),["DURATION","PLANNED-DURATION"].forEach(function(c){n.attributes.hasOwnProperty(c)&&(n.attributes[c]=parseFloat(n.attributes[c]))}),["END-ON-NEXT"].forEach(function(c){n.attributes.hasOwnProperty(c)&&(n.attributes[c]=/YES/i.test(n.attributes[c]))}),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach(function(c){n.attributes.hasOwnProperty(c)&&(n.attributes[c]=n.attributes[c].toString(16))});const l=/^X-([A-Z]+-)+[A-Z]+$/;for(const c in n.attributes){if(!l.test(c))continue;const h=/[0-9A-Fa-f]{6}/g.test(n.attributes[c]),f=/^\d+(\.\d+)?$/.test(n.attributes[c]);n.attributes[c]=h?n.attributes[c].toString(16):f?parseFloat(n.attributes[c]):String(n.attributes[c])}this.trigger("data",n);return}if(i=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(o),i){this.trigger("data",{type:"tag",tagType:"independent-segments"});return}if(i=/^#EXT-X-I-FRAMES-ONLY/.exec(o),i){this.trigger("data",{type:"tag",tagType:"i-frames-only"});return}if(i=/^#EXT-X-CONTENT-STEERING:(.*)$/.exec(o),i){n={type:"tag",tagType:"content-steering"},n.attributes=jn(i[1]),this.trigger("data",n);return}if(i=/^#EXT-X-I-FRAME-STREAM-INF:(.*)$/.exec(o),i){n={type:"tag",tagType:"i-frame-playlist"},n.attributes=jn(i[1]),n.attributes.URI&&(n.uri=n.attributes.URI),n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes.RESOLUTION&&(n.attributes.RESOLUTION=zS(n.attributes.RESOLUTION)),n.attributes["AVERAGE-BANDWIDTH"]&&(n.attributes["AVERAGE-BANDWIDTH"]=parseInt(n.attributes["AVERAGE-BANDWIDTH"],10)),n.attributes["FRAME-RATE"]&&(n.attributes["FRAME-RATE"]=parseFloat(n.attributes["FRAME-RATE"])),this.trigger("data",n);return}if(i=/^#EXT-X-DEFINE:(.*)$/.exec(o),i){n={type:"tag",tagType:"define"},n.attributes=jn(i[1]),this.trigger("data",n);return}this.trigger("data",{type:"tag",data:o.slice(4)})})}addParser({expression:e,customType:i,dataParser:n,segment:s}){typeof n!="function"&&(n=o=>o),this.customParsers.push(o=>{if(e.exec(o))return this.trigger("data",{type:"custom",data:n(o),customType:i,segment:s}),!0})}addTagMapper({expression:e,map:i}){const n=s=>e.test(s)?i(s):s;this.tagMappers.push(n)}}const uR=t=>t.toLowerCase().replace(/-(\w)/g,e=>e[1].toUpperCase()),Wo=function(t){const e={};return Object.keys(t).forEach(function(i){e[uR(i)]=t[i]}),e},v0=function(t){const{serverControl:e,targetDuration:i,partTargetDuration:n}=t;if(!e)return;const s="#EXT-X-SERVER-CONTROL",o="holdBack",l="partHoldBack",c=i&&i*3,h=n&&n*2;i&&!e.hasOwnProperty(o)&&(e[o]=c,this.trigger("info",{message:`${s} defaulting HOLD-BACK to targetDuration * 3 (${c}).`})),c&&e[o]<c&&(this.trigger("warn",{message:`${s} clamping HOLD-BACK (${e[o]}) to targetDuration * 3 (${c})`}),e[o]=c),n&&!e.hasOwnProperty(l)&&(e[l]=n*3,this.trigger("info",{message:`${s} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${e[l]}).`})),n&&e[l]<h&&(this.trigger("warn",{message:`${s} clamping PART-HOLD-BACK (${e[l]}) to partTargetDuration * 2 (${h}).`}),e[l]=h)};class cR extends a_{constructor(e={}){super(),this.lineStream=new sR,this.parseStream=new lR,this.lineStream.pipe(this.parseStream),this.mainDefinitions=e.mainDefinitions||{},this.params=new URL(e.uri,"https://a.com").searchParams,this.lastProgramDateTime=null;const i=this,n=[];let s={},o,l,c=!1;const h=function(){},f={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},m="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";let _=0;this.manifest={allowCache:!0,discontinuityStarts:[],dateRanges:[],iFramePlaylists:[],segments:[]};let E=0,w=0;const A={};this.on("end",()=>{s.uri||!s.parts&&!s.preloadHints||(!s.map&&o&&(s.map=o),!s.key&&l&&(s.key=l),!s.timeline&&typeof _=="number"&&(s.timeline=_),this.manifest.preloadSegment=s)}),this.parseStream.on("data",function(C){let M,O;if(i.manifest.definitions){for(const $ in i.manifest.definitions)if(C.uri&&(C.uri=C.uri.replace(`{$${$}}`,i.manifest.definitions[$])),C.attributes)for(const B in C.attributes)typeof C.attributes[B]=="string"&&(C.attributes[B]=C.attributes[B].replace(`{$${$}}`,i.manifest.definitions[$]))}({tag(){({version(){C.version&&(this.manifest.version=C.version)},"allow-cache"(){this.manifest.allowCache=C.allowed,"allowed"in C||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const $={};"length"in C&&(s.byterange=$,$.length=C.length,"offset"in C||(C.offset=E)),"offset"in C&&(s.byterange=$,$.offset=C.offset),E=$.offset+$.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),C.title&&(s.title=C.title),C.duration>0&&(s.duration=C.duration),C.duration===0&&(s.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=n},key(){if(!C.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if(C.attributes.METHOD==="NONE"){l=null;return}if(!C.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if(C.attributes.KEYFORMAT==="com.apple.streamingkeydelivery"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:C.attributes};return}if(C.attributes.KEYFORMAT==="com.microsoft.playready"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.microsoft.playready"]={uri:C.attributes.URI};return}if(C.attributes.KEYFORMAT===m){if(["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(C.attributes.METHOD)===-1){this.trigger("warn",{message:"invalid key method provided for Widevine"});return}if(C.attributes.METHOD==="SAMPLE-AES-CENC"&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),C.attributes.URI.substring(0,23)!=="data:text/plain;base64,"){this.trigger("warn",{message:"invalid key URI provided for Widevine"});return}if(!(C.attributes.KEYID&&C.attributes.KEYID.substring(0,2)==="0x")){this.trigger("warn",{message:"invalid key ID provided for Widevine"});return}this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:C.attributes.KEYFORMAT,keyId:C.attributes.KEYID.substring(2)},pssh:G3(C.attributes.URI.split(",")[1])};return}C.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),l={method:C.attributes.METHOD||"AES-128",uri:C.attributes.URI},typeof C.attributes.IV<"u"&&(l.iv=C.attributes.IV)},"media-sequence"(){if(!isFinite(C.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+C.number});return}this.manifest.mediaSequence=C.number},"discontinuity-sequence"(){if(!isFinite(C.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+C.number});return}this.manifest.discontinuitySequence=C.number,_=C.number},"playlist-type"(){if(!/VOD|EVENT/.test(C.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+C.playlist});return}this.manifest.playlistType=C.playlistType},map(){o={},C.uri&&(o.uri=C.uri),C.byterange&&(o.byterange=C.byterange),l&&(o.key=l)},"stream-inf"(){if(this.manifest.playlists=n,this.manifest.mediaGroups=this.manifest.mediaGroups||f,!C.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}s.attributes||(s.attributes={}),Li(s.attributes,C.attributes)},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||f,!(C.attributes&&C.attributes.TYPE&&C.attributes["GROUP-ID"]&&C.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}const $=this.manifest.mediaGroups[C.attributes.TYPE];$[C.attributes["GROUP-ID"]]=$[C.attributes["GROUP-ID"]]||{},M=$[C.attributes["GROUP-ID"]],O={default:/yes/i.test(C.attributes.DEFAULT)},O.default?O.autoselect=!0:O.autoselect=/yes/i.test(C.attributes.AUTOSELECT),C.attributes.LANGUAGE&&(O.language=C.attributes.LANGUAGE),C.attributes.URI&&(O.uri=C.attributes.URI),C.attributes["INSTREAM-ID"]&&(O.instreamId=C.attributes["INSTREAM-ID"]),C.attributes.CHARACTERISTICS&&(O.characteristics=C.attributes.CHARACTERISTICS),C.attributes.FORCED&&(O.forced=/yes/i.test(C.attributes.FORCED)),M[C.attributes.NAME]=O},discontinuity(){_+=1,s.discontinuity=!0,this.manifest.discontinuityStarts.push(n.length)},"program-date-time"(){typeof this.manifest.dateTimeString>"u"&&(this.manifest.dateTimeString=C.dateTimeString,this.manifest.dateTimeObject=C.dateTimeObject),s.dateTimeString=C.dateTimeString,s.dateTimeObject=C.dateTimeObject;const{lastProgramDateTime:$}=this;this.lastProgramDateTime=new Date(C.dateTimeString).getTime(),$===null&&this.manifest.segments.reduceRight((B,U)=>(U.programDateTime=B-U.duration*1e3,U.programDateTime),this.lastProgramDateTime)},targetduration(){if(!isFinite(C.duration)||C.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+C.duration});return}this.manifest.targetDuration=C.duration,v0.call(this,this.manifest)},start(){if(!C.attributes||isNaN(C.attributes["TIME-OFFSET"])){this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});return}this.manifest.start={timeOffset:C.attributes["TIME-OFFSET"],precise:C.attributes.PRECISE}},"cue-out"(){s.cueOut=C.data},"cue-out-cont"(){s.cueOutCont=C.data},"cue-in"(){s.cueIn=C.data},skip(){this.manifest.skip=Wo(C.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",C.attributes,["SKIPPED-SEGMENTS"])},part(){c=!0;const $=this.manifest.segments.length,B=Wo(C.attributes);s.parts=s.parts||[],s.parts.push(B),B.byterange&&(B.byterange.hasOwnProperty("offset")||(B.byterange.offset=w),w=B.byterange.offset+B.byterange.length);const U=s.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${U} for segment #${$}`,C.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((j,W)=>{j.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${W} lacks required attribute(s): LAST-PART`})})},"server-control"(){const $=this.manifest.serverControl=Wo(C.attributes);$.hasOwnProperty("canBlockReload")||($.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),v0.call(this,this.manifest),$.canSkipDateranges&&!$.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const $=this.manifest.segments.length,B=Wo(C.attributes),U=B.type&&B.type==="PART";s.preloadHints=s.preloadHints||[],s.preloadHints.push(B),B.byterange&&(B.byterange.hasOwnProperty("offset")||(B.byterange.offset=U?w:0,U&&(w=B.byterange.offset+B.byterange.length)));const j=s.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${j} for segment #${$}`,C.attributes,["TYPE","URI"]),!!B.type)for(let W=0;W<s.preloadHints.length-1;W++){const z=s.preloadHints[W];z.type&&z.type===B.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${j} for segment #${$} has the same TYPE ${B.type} as preload hint #${W}`})}},"rendition-report"(){const $=Wo(C.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push($);const B=this.manifest.renditionReports.length-1,U=["LAST-MSN","URI"];c&&U.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${B}`,C.attributes,U)},"part-inf"(){this.manifest.partInf=Wo(C.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",C.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),v0.call(this,this.manifest)},daterange(){this.manifest.dateRanges.push(Wo(C.attributes));const $=this.manifest.dateRanges.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${$}`,C.attributes,["ID","START-DATE"]);const B=this.manifest.dateRanges[$];B.endDate&&B.startDate&&new Date(B.endDate)<new Date(B.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),B.duration&&B.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),B.plannedDuration&&B.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});const U=!!B.endOnNext;if(U&&!B.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),U&&(B.duration||B.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),B.duration&&B.endDate){const W=B.startDate.getTime()+B.duration*1e3;this.manifest.dateRanges[$].endDate=new Date(W)}if(!A[B.id])A[B.id]=B;else{for(const W in A[B.id])if(B[W]&&JSON.stringify(A[B.id][W])!==JSON.stringify(B[W])){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes values"});break}const j=this.manifest.dateRanges.findIndex(W=>W.id===B.id);this.manifest.dateRanges[j]=Li(this.manifest.dateRanges[j],B),A[B.id]=Li(A[B.id],B),this.manifest.dateRanges.pop()}},"independent-segments"(){this.manifest.independentSegments=!0},"i-frames-only"(){this.manifest.iFramesOnly=!0,this.requiredCompatibilityversion(this.manifest.version,4)},"content-steering"(){this.manifest.contentSteering=Wo(C.attributes),this.warnOnMissingAttributes_("#EXT-X-CONTENT-STEERING",C.attributes,["SERVER-URI"])},define(){this.manifest.definitions=this.manifest.definitions||{};const $=(B,U)=>{if(B in this.manifest.definitions){this.trigger("error",{message:`EXT-X-DEFINE: Duplicate name ${B}`});return}this.manifest.definitions[B]=U};if("QUERYPARAM"in C.attributes){if("NAME"in C.attributes||"IMPORT"in C.attributes){this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"});return}const B=this.params.get(C.attributes.QUERYPARAM);if(!B){this.trigger("error",{message:`EXT-X-DEFINE: No query param ${C.attributes.QUERYPARAM}`});return}$(C.attributes.QUERYPARAM,decodeURIComponent(B));return}if("NAME"in C.attributes){if("IMPORT"in C.attributes){this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"});return}if(!("VALUE"in C.attributes)||typeof C.attributes.VALUE!="string"){this.trigger("error",{message:`EXT-X-DEFINE: No value for ${C.attributes.NAME}`});return}$(C.attributes.NAME,C.attributes.VALUE);return}if("IMPORT"in C.attributes){if(!this.mainDefinitions[C.attributes.IMPORT]){this.trigger("error",{message:`EXT-X-DEFINE: No value ${C.attributes.IMPORT} to import, or IMPORT used on main playlist`});return}$(C.attributes.IMPORT,this.mainDefinitions[C.attributes.IMPORT]);return}this.trigger("error",{message:"EXT-X-DEFINE: No attribute"})},"i-frame-playlist"(){this.manifest.iFramePlaylists.push({attributes:C.attributes,uri:C.uri,timeline:_}),this.warnOnMissingAttributes_("#EXT-X-I-FRAME-STREAM-INF",C.attributes,["BANDWIDTH","URI"])}}[C.tagType]||h).call(i)},uri(){s.uri=C.uri,n.push(s),this.manifest.targetDuration&&!("duration"in s)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),s.duration=this.manifest.targetDuration),l&&(s.key=l),s.timeline=_,o&&(s.map=o),w=0,this.lastProgramDateTime!==null&&(s.programDateTime=this.lastProgramDateTime,this.lastProgramDateTime+=s.duration*1e3),s={}},comment(){},custom(){C.segment?(s.custom=s.custom||{},s.custom[C.customType]=C.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[C.customType]=C.data)}})[C.type].call(i)})}requiredCompatibilityversion(e,i){(e<i||!e)&&this.trigger("warn",{message:`manifest must be at least version ${i}`})}warnOnMissingAttributes_(e,i,n){const s=[];n.forEach(function(o){i.hasOwnProperty(o)||s.push(o)}),s.length&&this.trigger("warn",{message:`${e} lacks required attribute(s): ${s.join(", ")}`})}push(e){this.lineStream.push(e)}end(){this.lineStream.push(`
`),this.manifest.dateRanges.length&&this.lastProgramDateTime===null&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),this.lastProgramDateTime=null,this.trigger("end")}addParser(e){this.parseStream.addParser(e)}addTagMapper(e){this.parseStream.addTagMapper(e)}}var Kl={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},dR=["video","audio","text"],FS=["Video","Audio","Text"],W3=function(e){return e&&e.replace(/avc1\.(\d+)\.(\d+)/i,function(i,n,s){var o=("00"+Number(n).toString(16)).slice(-2),l=("00"+Number(s).toString(16)).slice(-2);return"avc1."+o+"00"+l})},ta=function(e){e===void 0&&(e="");var i=e.split(","),n=[];return i.forEach(function(s){s=s.trim();var o;dR.forEach(function(l){var c=Kl[l].exec(s.toLowerCase());if(!(!c||c.length<=1)){o=l;var h=s.substring(0,c[1].length),f=s.replace(h,"");n.push({type:h,details:f,mediaType:l})}}),o||n.push({type:s,details:"",mediaType:"unknown"})}),n},hR=function(e,i){if(!e.mediaGroups.AUDIO||!i)return null;var n=e.mediaGroups.AUDIO[i];if(!n)return null;for(var s in n){var o=n[s];if(o.default&&o.playlists)return ta(o.playlists[0].attributes.CODECS)}return null},X3=function(e){return e===void 0&&(e=""),Kl.audio.test(e.trim().toLowerCase())},fR=function(e){return e===void 0&&(e=""),Kl.text.test(e.trim().toLowerCase())},uc=function(e){if(!(!e||typeof e!="string")){var i=e.toLowerCase().split(",").map(function(o){return W3(o.trim())}),n="video";i.length===1&&X3(i[0])?n="audio":i.length===1&&fR(i[0])&&(n="application");var s="mp4";return i.every(function(o){return Kl.mp4.test(o)})?s="mp4":i.every(function(o){return Kl.webm.test(o)})?s="webm":i.every(function(o){return Kl.ogg.test(o)})&&(s="ogg"),n+"/"+s+';codecs="'+e+'"'}},qd=function(e,i){return e===void 0&&(e=""),i===void 0&&(i=!1),te.MediaSource&&te.MediaSource.isTypeSupported&&te.MediaSource.isTypeSupported(uc(e))||i&&te.ManagedMediaSource&&te.ManagedMediaSource.isTypeSupported&&te.ManagedMediaSource.isTypeSupported(uc(e))||!1},b0=function(e){return e===void 0&&(e=""),e.toLowerCase().split(",").every(function(i){i=i.trim();for(var n=0;n<FS.length;n++){var s=FS[n];if(Kl["muxer"+s].test(i))return!0}return!1})},qS="mp4a.40.2",pR="avc1.4d400d",mR=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,gR=/^application\/dash\+xml/i,K3=function(e){return mR.test(e)?"hls":gR.test(e)?"dash":e==="application/vnd.videojs.vhs+json"?"vhs-json":null},yR=function(e){return e.toString(2).length},_R=function(e){return Math.ceil(yR(e)/8)},Y3=function(e){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},vR=function(e){return Y3(e)},ot=function(e){return e instanceof Uint8Array?e:(!Array.isArray(e)&&!vR(e)&&!(e instanceof ArrayBuffer)&&(typeof e!="number"||typeof e=="number"&&e!==e?e=0:e=[e]),new Uint8Array(e&&e.buffer||e,e&&e.byteOffset||0,e&&e.byteLength||0))},xn=te.BigInt||Number,ny=[xn("0x1"),xn("0x100"),xn("0x10000"),xn("0x1000000"),xn("0x100000000"),xn("0x10000000000"),xn("0x1000000000000"),xn("0x100000000000000"),xn("0x10000000000000000")];(function(){var t=new Uint16Array([65484]),e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);return e[0]===255?"big":e[0]===204?"little":"unknown"})();var bR=function(e,i){var n=i===void 0?{}:i,s=n.signed,o=s===void 0?!1:s,l=n.le,c=l===void 0?!1:l;e=ot(e);var h=c?"reduce":"reduceRight",f=e[h]?e[h]:Array.prototype[h],m=f.call(e,function(E,w,A){var C=c?A:Math.abs(A+1-e.length);return E+xn(w)*ny[C]},xn(0));if(o){var _=ny[e.length]/xn(2)-xn(1);m=xn(m),m>_&&(m-=_,m-=_,m-=xn(2))}return Number(m)},TR=function(e,i){var n={},s=n.le,o=s===void 0?!1:s;(typeof e!="bigint"&&typeof e!="number"||typeof e=="number"&&e!==e)&&(e=0),e=xn(e);for(var l=_R(e),c=new Uint8Array(new ArrayBuffer(l)),h=0;h<l;h++){var f=o?h:Math.abs(h+1-c.length);c[f]=Number(e/ny[h]&xn(255)),e<0&&(c[f]=Math.abs(~c[f]),c[f]-=h===0?1:2)}return c},Q3=function(e,i){if(typeof e!="string"&&e&&typeof e.toString=="function"&&(e=e.toString()),typeof e!="string")return new Uint8Array;i||(e=unescape(encodeURIComponent(e)));for(var n=new Uint8Array(e.length),s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n},xR=function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];if(i=i.filter(function(c){return c&&(c.byteLength||c.length)&&typeof c!="string"}),i.length<=1)return ot(i[0]);var s=i.reduce(function(c,h,f){return c+(h.byteLength||h.length)},0),o=new Uint8Array(s),l=0;return i.forEach(function(c){c=ot(c),o.set(c,l),l+=c.byteLength}),o},bi=function(e,i,n){var s=n===void 0?{}:n,o=s.offset,l=o===void 0?0:o,c=s.mask,h=c===void 0?[]:c;e=ot(e),i=ot(i);var f=i.every?i.every:Array.prototype.every;return i.length&&e.length-l>=i.length&&f.call(i,function(m,_){var E=h[_]?h[_]&e[l+_]:e[l+_];return m===E})},SR=function(e,i,n){i.forEach(function(s){for(var o in e.mediaGroups[s])for(var l in e.mediaGroups[s][o]){var c=e.mediaGroups[s][o][l];n(c,s,o,l)}})},kd={},Wa={},Ul={},jS;function dp(){if(jS)return Ul;jS=1;function t(o,l,c){if(c===void 0&&(c=Array.prototype),o&&typeof c.find=="function")return c.find.call(o,l);for(var h=0;h<o.length;h++)if(Object.prototype.hasOwnProperty.call(o,h)){var f=o[h];if(l.call(void 0,f,h,o))return f}}function e(o,l){return l===void 0&&(l=Object),l&&typeof l.freeze=="function"?l.freeze(o):o}function i(o,l){if(o===null||typeof o!="object")throw new TypeError("target is not an object");for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(o[c]=l[c]);return o}var n=e({HTML:"text/html",isHTML:function(o){return o===n.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),s=e({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(o){return o===s.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});return Ul.assign=i,Ul.find=t,Ul.freeze=e,Ul.MIME_TYPE=n,Ul.NAMESPACE=s,Ul}var HS;function Z3(){if(HS)return Wa;HS=1;var t=dp(),e=t.find,i=t.NAMESPACE;function n(q){return q!==""}function s(q){return q?q.split(/[\t\n\f\r ]+/).filter(n):[]}function o(q,V){return q.hasOwnProperty(V)||(q[V]=!0),q}function l(q){if(!q)return[];var V=s(q);return Object.keys(V.reduce(o,{}))}function c(q){return function(V){return q&&q.indexOf(V)!==-1}}function h(q,V){for(var re in q)Object.prototype.hasOwnProperty.call(q,re)&&(V[re]=q[re])}function f(q,V){var re=q.prototype;if(!(re instanceof V)){let xe=function(){};xe.prototype=V.prototype,xe=new xe,h(re,xe),q.prototype=re=xe}re.constructor!=q&&(typeof q!="function"&&console.error("unknown Class:"+q),re.constructor=q)}var m={},_=m.ELEMENT_NODE=1,E=m.ATTRIBUTE_NODE=2,w=m.TEXT_NODE=3,A=m.CDATA_SECTION_NODE=4,C=m.ENTITY_REFERENCE_NODE=5,M=m.ENTITY_NODE=6,O=m.PROCESSING_INSTRUCTION_NODE=7,$=m.COMMENT_NODE=8,B=m.DOCUMENT_NODE=9,U=m.DOCUMENT_TYPE_NODE=10,j=m.DOCUMENT_FRAGMENT_NODE=11,W=m.NOTATION_NODE=12,z={},Y={};z.INDEX_SIZE_ERR=(Y[1]="Index size error",1),z.DOMSTRING_SIZE_ERR=(Y[2]="DOMString size error",2);var L=z.HIERARCHY_REQUEST_ERR=(Y[3]="Hierarchy request error",3);z.WRONG_DOCUMENT_ERR=(Y[4]="Wrong document",4),z.INVALID_CHARACTER_ERR=(Y[5]="Invalid character",5),z.NO_DATA_ALLOWED_ERR=(Y[6]="No data allowed",6),z.NO_MODIFICATION_ALLOWED_ERR=(Y[7]="No modification allowed",7);var H=z.NOT_FOUND_ERR=(Y[8]="Not found",8);z.NOT_SUPPORTED_ERR=(Y[9]="Not supported",9);var se=z.INUSE_ATTRIBUTE_ERR=(Y[10]="Attribute in use",10);z.INVALID_STATE_ERR=(Y[11]="Invalid state",11),z.SYNTAX_ERR=(Y[12]="Syntax error",12),z.INVALID_MODIFICATION_ERR=(Y[13]="Invalid modification",13),z.NAMESPACE_ERR=(Y[14]="Invalid namespace",14),z.INVALID_ACCESS_ERR=(Y[15]="Invalid access",15);function ae(q,V){if(V instanceof Error)var re=V;else re=this,Error.call(this,Y[q]),this.message=Y[q],Error.captureStackTrace&&Error.captureStackTrace(this,ae);return re.code=q,V&&(this.message=this.message+": "+V),re}ae.prototype=Error.prototype,h(z,ae);function ce(){}ce.prototype={length:0,item:function(q){return q>=0&&q<this.length?this[q]:null},toString:function(q,V){for(var re=[],xe=0;xe<this.length;xe++)Mr(this[xe],re,q,V);return re.join("")},filter:function(q){return Array.prototype.filter.call(this,q)},indexOf:function(q){return Array.prototype.indexOf.call(this,q)}};function fe(q,V){this._node=q,this._refresh=V,be(this)}function be(q){var V=q._node._inc||q._node.ownerDocument._inc;if(q._inc!==V){var re=q._refresh(q._node);if(Nr(q,"length",re.length),!q.$$length||re.length<q.$$length)for(var xe=re.length;xe in q;xe++)Object.prototype.hasOwnProperty.call(q,xe)&&delete q[xe];h(re,q),q._inc=V}}fe.prototype.item=function(q){return be(this),this[q]||null},f(fe,ce);function J(){}function ee(q,V){for(var re=q.length;re--;)if(q[re]===V)return re}function de(q,V,re,xe){if(xe?V[ee(V,xe)]=re:V[V.length++]=re,q){re.ownerElement=q;var qe=q.ownerDocument;qe&&(xe&&ze(qe,q,xe),le(qe,q,re))}}function ue(q,V,re){var xe=ee(V,re);if(xe>=0){for(var qe=V.length-1;xe<qe;)V[xe]=V[++xe];if(V.length=qe,q){var nt=q.ownerDocument;nt&&(ze(nt,q,re),re.ownerElement=null)}}else throw new ae(H,new Error(q.tagName+"@"+re))}J.prototype={length:0,item:ce.prototype.item,getNamedItem:function(q){for(var V=this.length;V--;){var re=this[V];if(re.nodeName==q)return re}},setNamedItem:function(q){var V=q.ownerElement;if(V&&V!=this._ownerElement)throw new ae(se);var re=this.getNamedItem(q.nodeName);return de(this._ownerElement,this,q,re),re},setNamedItemNS:function(q){var V=q.ownerElement,re;if(V&&V!=this._ownerElement)throw new ae(se);return re=this.getNamedItemNS(q.namespaceURI,q.localName),de(this._ownerElement,this,q,re),re},removeNamedItem:function(q){var V=this.getNamedItem(q);return ue(this._ownerElement,this,V),V},removeNamedItemNS:function(q,V){var re=this.getNamedItemNS(q,V);return ue(this._ownerElement,this,re),re},getNamedItemNS:function(q,V){for(var re=this.length;re--;){var xe=this[re];if(xe.localName==V&&xe.namespaceURI==q)return xe}return null}};function ve(){}ve.prototype={hasFeature:function(q,V){return!0},createDocument:function(q,V,re){var xe=new ke;if(xe.implementation=this,xe.childNodes=new ce,xe.doctype=re||null,re&&xe.appendChild(re),V){var qe=xe.createElementNS(q,V);xe.appendChild(qe)}return xe},createDocumentType:function(q,V,re){var xe=new Xi;return xe.name=q,xe.nodeName=q,xe.publicId=V||"",xe.systemId=re||"",xe}};function P(){}P.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(q,V){return Wi(this,q,V)},replaceChild:function(q,V){Wi(this,q,V,Ui),V&&this.removeChild(V)},removeChild:function(q){return Je(this,q)},appendChild:function(q){return this.insertBefore(q,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(q){return hr(this.ownerDocument||this,this,q)},normalize:function(){for(var q=this.firstChild;q;){var V=q.nextSibling;V&&V.nodeType==w&&q.nodeType==w?(this.removeChild(V),q.appendData(V.data)):(q.normalize(),q=V)}},isSupported:function(q,V){return this.ownerDocument.implementation.hasFeature(q,V)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(q){for(var V=this;V;){var re=V._nsMap;if(re){for(var xe in re)if(Object.prototype.hasOwnProperty.call(re,xe)&&re[xe]===q)return xe}V=V.nodeType==E?V.ownerDocument:V.parentNode}return null},lookupNamespaceURI:function(q){for(var V=this;V;){var re=V._nsMap;if(re&&Object.prototype.hasOwnProperty.call(re,q))return re[q];V=V.nodeType==E?V.ownerDocument:V.parentNode}return null},isDefaultNamespace:function(q){var V=this.lookupPrefix(q);return V==null}};function ne(q){return q=="<"&&"&lt;"||q==">"&&"&gt;"||q=="&"&&"&amp;"||q=='"'&&"&quot;"||"&#"+q.charCodeAt()+";"}h(m,P),h(m,P.prototype);function ye(q,V){if(V(q))return!0;if(q=q.firstChild)do if(ye(q,V))return!0;while(q=q.nextSibling)}function ke(){this.ownerDocument=this}function le(q,V,re){q&&q._inc++;var xe=re.namespaceURI;xe===i.XMLNS&&(V._nsMap[re.prefix?re.localName:""]=re.value)}function ze(q,V,re,xe){q&&q._inc++;var qe=re.namespaceURI;qe===i.XMLNS&&delete V._nsMap[re.prefix?re.localName:""]}function it(q,V,re){if(q&&q._inc){q._inc++;var xe=V.childNodes;if(re)xe[xe.length++]=re;else{for(var qe=V.firstChild,nt=0;qe;)xe[nt++]=qe,qe=qe.nextSibling;xe.length=nt,delete xe[xe.length]}}}function Je(q,V){var re=V.previousSibling,xe=V.nextSibling;return re?re.nextSibling=xe:q.firstChild=xe,xe?xe.previousSibling=re:q.lastChild=re,V.parentNode=null,V.previousSibling=null,V.nextSibling=null,it(q.ownerDocument,q),V}function Qe(q){return q&&(q.nodeType===P.DOCUMENT_NODE||q.nodeType===P.DOCUMENT_FRAGMENT_NODE||q.nodeType===P.ELEMENT_NODE)}function bt(q){return q&&(fi(q)||mn(q)||ri(q)||q.nodeType===P.DOCUMENT_FRAGMENT_NODE||q.nodeType===P.COMMENT_NODE||q.nodeType===P.PROCESSING_INSTRUCTION_NODE)}function ri(q){return q&&q.nodeType===P.DOCUMENT_TYPE_NODE}function fi(q){return q&&q.nodeType===P.ELEMENT_NODE}function mn(q){return q&&q.nodeType===P.TEXT_NODE}function Lt(q,V){var re=q.childNodes||[];if(e(re,fi)||ri(V))return!1;var xe=e(re,ri);return!(V&&xe&&re.indexOf(xe)>re.indexOf(V))}function Nn(q,V){var re=q.childNodes||[];function xe(nt){return fi(nt)&&nt!==V}if(e(re,xe))return!1;var qe=e(re,ri);return!(V&&qe&&re.indexOf(qe)>re.indexOf(V))}function Ut(q,V,re){if(!Qe(q))throw new ae(L,"Unexpected parent node type "+q.nodeType);if(re&&re.parentNode!==q)throw new ae(H,"child not in parent");if(!bt(V)||ri(V)&&q.nodeType!==P.DOCUMENT_NODE)throw new ae(L,"Unexpected node type "+V.nodeType+" for parent node type "+q.nodeType)}function rs(q,V,re){var xe=q.childNodes||[],qe=V.childNodes||[];if(V.nodeType===P.DOCUMENT_FRAGMENT_NODE){var nt=qe.filter(fi);if(nt.length>1||e(qe,mn))throw new ae(L,"More than one element or text in fragment");if(nt.length===1&&!Lt(q,re))throw new ae(L,"Element in fragment can not be inserted before doctype")}if(fi(V)&&!Lt(q,re))throw new ae(L,"Only one element can be added and only after doctype");if(ri(V)){if(e(xe,ri))throw new ae(L,"Only one doctype is allowed");var Rt=e(xe,fi);if(re&&xe.indexOf(Rt)<xe.indexOf(re))throw new ae(L,"Doctype can only be inserted before an element");if(!re&&Rt)throw new ae(L,"Doctype can not be appended since element is present")}}function Ui(q,V,re){var xe=q.childNodes||[],qe=V.childNodes||[];if(V.nodeType===P.DOCUMENT_FRAGMENT_NODE){var nt=qe.filter(fi);if(nt.length>1||e(qe,mn))throw new ae(L,"More than one element or text in fragment");if(nt.length===1&&!Nn(q,re))throw new ae(L,"Element in fragment can not be inserted before doctype")}if(fi(V)&&!Nn(q,re))throw new ae(L,"Only one element can be added and only after doctype");if(ri(V)){if(e(xe,function(tn){return ri(tn)&&tn!==re}))throw new ae(L,"Only one doctype is allowed");var Rt=e(xe,fi);if(re&&xe.indexOf(Rt)<xe.indexOf(re))throw new ae(L,"Doctype can only be inserted before an element")}}function Wi(q,V,re,xe){Ut(q,V,re),q.nodeType===P.DOCUMENT_NODE&&(xe||rs)(q,V,re);var qe=V.parentNode;if(qe&&qe.removeChild(V),V.nodeType===j){var nt=V.firstChild;if(nt==null)return V;var Rt=V.lastChild}else nt=Rt=V;var pi=re?re.previousSibling:q.lastChild;nt.previousSibling=pi,Rt.nextSibling=re,pi?pi.nextSibling=nt:q.firstChild=nt,re==null?q.lastChild=Rt:re.previousSibling=Rt;do{nt.parentNode=q;var tn=q.ownerDocument||q;ft(nt,tn)}while(nt!==Rt&&(nt=nt.nextSibling));return it(q.ownerDocument||q,q),V.nodeType==j&&(V.firstChild=V.lastChild=null),V}function ft(q,V){if(q.ownerDocument!==V){if(q.ownerDocument=V,q.nodeType===_&&q.attributes)for(var re=0;re<q.attributes.length;re++){var xe=q.attributes.item(re);xe&&(xe.ownerDocument=V)}for(var qe=q.firstChild;qe;)ft(qe,V),qe=qe.nextSibling}}function Pt(q,V){V.parentNode&&V.parentNode.removeChild(V),V.parentNode=q,V.previousSibling=q.lastChild,V.nextSibling=null,V.previousSibling?V.previousSibling.nextSibling=V:q.firstChild=V,q.lastChild=V,it(q.ownerDocument,q,V);var re=q.ownerDocument||q;return ft(V,re),V}ke.prototype={nodeName:"#document",nodeType:B,doctype:null,documentElement:null,_inc:1,insertBefore:function(q,V){if(q.nodeType==j){for(var re=q.firstChild;re;){var xe=re.nextSibling;this.insertBefore(re,V),re=xe}return q}return Wi(this,q,V),ft(q,this),this.documentElement===null&&q.nodeType===_&&(this.documentElement=q),q},removeChild:function(q){return this.documentElement==q&&(this.documentElement=null),Je(this,q)},replaceChild:function(q,V){Wi(this,q,V,Ui),ft(q,this),V&&this.removeChild(V),fi(q)&&(this.documentElement=q)},importNode:function(q,V){return ha(this,q,V)},getElementById:function(q){var V=null;return ye(this.documentElement,function(re){if(re.nodeType==_&&re.getAttribute("id")==q)return V=re,!0}),V},getElementsByClassName:function(q){var V=l(q);return new fe(this,function(re){var xe=[];return V.length>0&&ye(re.documentElement,function(qe){if(qe!==re&&qe.nodeType===_){var nt=qe.getAttribute("class");if(nt){var Rt=q===nt;if(!Rt){var pi=l(nt);Rt=V.every(c(pi))}Rt&&xe.push(qe)}}}),xe})},createElement:function(q){var V=new Ot;V.ownerDocument=this,V.nodeName=q,V.tagName=q,V.localName=q,V.childNodes=new ce;var re=V.attributes=new J;return re._ownerElement=V,V},createDocumentFragment:function(){var q=new It;return q.ownerDocument=this,q.childNodes=new ce,q},createTextNode:function(q){var V=new Rr;return V.ownerDocument=this,V.appendData(q),V},createComment:function(q){var V=new Wn;return V.ownerDocument=this,V.appendData(q),V},createCDATASection:function(q){var V=new Pi;return V.ownerDocument=this,V.appendData(q),V},createProcessingInstruction:function(q,V){var re=new Xn;return re.ownerDocument=this,re.tagName=re.nodeName=re.target=q,re.nodeValue=re.data=V,re},createAttribute:function(q){var V=new Dt;return V.ownerDocument=this,V.name=q,V.nodeName=q,V.localName=q,V.specified=!0,V},createEntityReference:function(q){var V=new ss;return V.ownerDocument=this,V.nodeName=q,V},createElementNS:function(q,V){var re=new Ot,xe=V.split(":"),qe=re.attributes=new J;return re.childNodes=new ce,re.ownerDocument=this,re.nodeName=V,re.tagName=V,re.namespaceURI=q,xe.length==2?(re.prefix=xe[0],re.localName=xe[1]):re.localName=V,qe._ownerElement=re,re},createAttributeNS:function(q,V){var re=new Dt,xe=V.split(":");return re.ownerDocument=this,re.nodeName=V,re.name=V,re.namespaceURI=q,re.specified=!0,xe.length==2?(re.prefix=xe[0],re.localName=xe[1]):re.localName=V,re}},f(ke,P);function Ot(){this._nsMap={}}Ot.prototype={nodeType:_,hasAttribute:function(q){return this.getAttributeNode(q)!=null},getAttribute:function(q){var V=this.getAttributeNode(q);return V&&V.value||""},getAttributeNode:function(q){return this.attributes.getNamedItem(q)},setAttribute:function(q,V){var re=this.ownerDocument.createAttribute(q);re.value=re.nodeValue=""+V,this.setAttributeNode(re)},removeAttribute:function(q){var V=this.getAttributeNode(q);V&&this.removeAttributeNode(V)},appendChild:function(q){return q.nodeType===j?this.insertBefore(q,null):Pt(this,q)},setAttributeNode:function(q){return this.attributes.setNamedItem(q)},setAttributeNodeNS:function(q){return this.attributes.setNamedItemNS(q)},removeAttributeNode:function(q){return this.attributes.removeNamedItem(q.nodeName)},removeAttributeNS:function(q,V){var re=this.getAttributeNodeNS(q,V);re&&this.removeAttributeNode(re)},hasAttributeNS:function(q,V){return this.getAttributeNodeNS(q,V)!=null},getAttributeNS:function(q,V){var re=this.getAttributeNodeNS(q,V);return re&&re.value||""},setAttributeNS:function(q,V,re){var xe=this.ownerDocument.createAttributeNS(q,V);xe.value=xe.nodeValue=""+re,this.setAttributeNode(xe)},getAttributeNodeNS:function(q,V){return this.attributes.getNamedItemNS(q,V)},getElementsByTagName:function(q){return new fe(this,function(V){var re=[];return ye(V,function(xe){xe!==V&&xe.nodeType==_&&(q==="*"||xe.tagName==q)&&re.push(xe)}),re})},getElementsByTagNameNS:function(q,V){return new fe(this,function(re){var xe=[];return ye(re,function(qe){qe!==re&&qe.nodeType===_&&(q==="*"||qe.namespaceURI===q)&&(V==="*"||qe.localName==V)&&xe.push(qe)}),xe})}},ke.prototype.getElementsByTagName=Ot.prototype.getElementsByTagName,ke.prototype.getElementsByTagNameNS=Ot.prototype.getElementsByTagNameNS,f(Ot,P);function Dt(){}Dt.prototype.nodeType=E,f(Dt,P);function si(){}si.prototype={data:"",substringData:function(q,V){return this.data.substring(q,q+V)},appendData:function(q){q=this.data+q,this.nodeValue=this.data=q,this.length=q.length},insertData:function(q,V){this.replaceData(q,0,V)},appendChild:function(q){throw new Error(Y[L])},deleteData:function(q,V){this.replaceData(q,V,"")},replaceData:function(q,V,re){var xe=this.data.substring(0,q),qe=this.data.substring(q+V);re=xe+re+qe,this.nodeValue=this.data=re,this.length=re.length}},f(si,P);function Rr(){}Rr.prototype={nodeName:"#text",nodeType:w,splitText:function(q){var V=this.data,re=V.substring(q);V=V.substring(0,q),this.data=this.nodeValue=V,this.length=V.length;var xe=this.ownerDocument.createTextNode(re);return this.parentNode&&this.parentNode.insertBefore(xe,this.nextSibling),xe}},f(Rr,si);function Wn(){}Wn.prototype={nodeName:"#comment",nodeType:$},f(Wn,si);function Pi(){}Pi.prototype={nodeName:"#cdata-section",nodeType:A},f(Pi,si);function Xi(){}Xi.prototype.nodeType=U,f(Xi,P);function Rs(){}Rs.prototype.nodeType=W,f(Rs,P);function Sn(){}Sn.prototype.nodeType=M,f(Sn,P);function ss(){}ss.prototype.nodeType=C,f(ss,P);function It(){}It.prototype.nodeName="#document-fragment",It.prototype.nodeType=j,f(It,P);function Xn(){}Xn.prototype.nodeType=O,f(Xn,P);function yi(){}yi.prototype.serializeToString=function(q,V,re){return Bn.call(q,V,re)},P.prototype.toString=Bn;function Bn(q,V){var re=[],xe=this.nodeType==9&&this.documentElement||this,qe=xe.prefix,nt=xe.namespaceURI;if(nt&&qe==null){var qe=xe.lookupPrefix(nt);if(qe==null)var Rt=[{namespace:nt,prefix:null}]}return Mr(this,re,q,V,Rt),re.join("")}function zi(q,V,re){var xe=q.prefix||"",qe=q.namespaceURI;if(!qe||xe==="xml"&&qe===i.XML||qe===i.XMLNS)return!1;for(var nt=re.length;nt--;){var Rt=re[nt];if(Rt.prefix===xe)return Rt.namespace!==qe}return!0}function da(q,V,re){q.push(" ",V,'="',re.replace(/[<>&"\t\n\r]/g,ne),'"')}function Mr(q,V,re,xe,qe){if(qe||(qe=[]),xe)if(q=xe(q),q){if(typeof q=="string"){V.push(q);return}}else return;switch(q.nodeType){case _:var nt=q.attributes,Rt=nt.length,rt=q.firstChild,pi=q.tagName;re=i.isHTML(q.namespaceURI)||re;var tn=pi;if(!re&&!q.prefix&&q.namespaceURI){for(var wn,nn=0;nn<nt.length;nn++)if(nt.item(nn).name==="xmlns"){wn=nt.item(nn).value;break}if(!wn)for(var gn=qe.length-1;gn>=0;gn--){var Ki=qe[gn];if(Ki.prefix===""&&Ki.namespace===q.namespaceURI){wn=Ki.namespace;break}}if(wn!==q.namespaceURI)for(var gn=qe.length-1;gn>=0;gn--){var Ki=qe[gn];if(Ki.namespace===q.namespaceURI){Ki.prefix&&(tn=Ki.prefix+":"+pi);break}}}V.push("<",tn);for(var Wt=0;Wt<Rt;Wt++){var rn=nt.item(Wt);rn.prefix=="xmlns"?qe.push({prefix:rn.localName,namespace:rn.value}):rn.nodeName=="xmlns"&&qe.push({prefix:"",namespace:rn.value})}for(var Wt=0;Wt<Rt;Wt++){var rn=nt.item(Wt);if(zi(rn,re,qe)){var Ln=rn.prefix||"",Ii=rn.namespaceURI;da(V,Ln?"xmlns:"+Ln:"xmlns",Ii),qe.push({prefix:Ln,namespace:Ii})}Mr(rn,V,re,xe,qe)}if(pi===tn&&zi(q,re,qe)){var Ln=q.prefix||"",Ii=q.namespaceURI;da(V,Ln?"xmlns:"+Ln:"xmlns",Ii),qe.push({prefix:Ln,namespace:Ii})}if(rt||re&&!/^(?:meta|link|img|br|hr|input)$/i.test(pi)){if(V.push(">"),re&&/^script$/i.test(pi))for(;rt;)rt.data?V.push(rt.data):Mr(rt,V,re,xe,qe.slice()),rt=rt.nextSibling;else for(;rt;)Mr(rt,V,re,xe,qe.slice()),rt=rt.nextSibling;V.push("</",tn,">")}else V.push("/>");return;case B:case j:for(var rt=q.firstChild;rt;)Mr(rt,V,re,xe,qe.slice()),rt=rt.nextSibling;return;case E:return da(V,q.name,q.value);case w:return V.push(q.data.replace(/[<&>]/g,ne));case A:return V.push("<![CDATA[",q.data,"]]>");case $:return V.push("<!--",q.data,"-->");case U:var ci=q.publicId,gt=q.systemId;if(V.push("<!DOCTYPE ",q.name),ci)V.push(" PUBLIC ",ci),gt&&gt!="."&&V.push(" ",gt),V.push(">");else if(gt&&gt!=".")V.push(" SYSTEM ",gt,">");else{var Un=q.internalSubset;Un&&V.push(" [",Un,"]"),V.push(">")}return;case O:return V.push("<?",q.target," ",q.data,"?>");case C:return V.push("&",q.nodeName,";");default:V.push("??",q.nodeName)}}function ha(q,V,re){var xe;switch(V.nodeType){case _:xe=V.cloneNode(!1),xe.ownerDocument=q;case j:break;case E:re=!0;break}if(xe||(xe=V.cloneNode(!1)),xe.ownerDocument=q,xe.parentNode=null,re)for(var qe=V.firstChild;qe;)xe.appendChild(ha(q,qe,re)),qe=qe.nextSibling;return xe}function hr(q,V,re){var xe=new V.constructor;for(var qe in V)if(Object.prototype.hasOwnProperty.call(V,qe)){var nt=V[qe];typeof nt!="object"&&nt!=xe[qe]&&(xe[qe]=nt)}switch(V.childNodes&&(xe.childNodes=new ce),xe.ownerDocument=q,xe.nodeType){case _:var Rt=V.attributes,pi=xe.attributes=new J,tn=Rt.length;pi._ownerElement=xe;for(var wn=0;wn<tn;wn++)xe.setAttributeNode(hr(q,Rt.item(wn),!0));break;case E:re=!0}if(re)for(var nn=V.firstChild;nn;)xe.appendChild(hr(q,nn,re)),nn=nn.nextSibling;return xe}function Nr(q,V,re){q[V]=re}try{if(Object.defineProperty){let q=function(V){switch(V.nodeType){case _:case j:var re=[];for(V=V.firstChild;V;)V.nodeType!==7&&V.nodeType!==8&&re.push(q(V)),V=V.nextSibling;return re.join("");default:return V.nodeValue}};Object.defineProperty(fe.prototype,"length",{get:function(){return be(this),this.$$length}}),Object.defineProperty(P.prototype,"textContent",{get:function(){return q(this)},set:function(V){switch(this.nodeType){case _:case j:for(;this.firstChild;)this.removeChild(this.firstChild);(V||String(V))&&this.appendChild(this.ownerDocument.createTextNode(V));break;default:this.data=V,this.value=V,this.nodeValue=V}}}),Nr=function(V,re,xe){V["$$"+re]=xe}}}catch{}return Wa.DocumentType=Xi,Wa.DOMException=ae,Wa.DOMImplementation=ve,Wa.Element=Ot,Wa.Node=P,Wa.NodeList=ce,Wa.XMLSerializer=yi,Wa}var $d={},T0={},VS;function wR(){return VS||(VS=1,(function(t){var e=dp().freeze;t.XML_ENTITIES=e({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),t.HTML_ENTITIES=e({Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",AMP:"&",amp:"&",And:"",and:"",andand:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsd:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",ap:"",apacir:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",Barwed:"",barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",Because:"",because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxDL:"",boxDl:"",boxdL:"",boxdl:"",boxDR:"",boxDr:"",boxdR:"",boxdr:"",boxH:"",boxh:"",boxHD:"",boxHd:"",boxhD:"",boxhd:"",boxHU:"",boxHu:"",boxhU:"",boxhu:"",boxminus:"",boxplus:"",boxtimes:"",boxUL:"",boxUl:"",boxuL:"",boxul:"",boxUR:"",boxUr:"",boxuR:"",boxur:"",boxV:"",boxv:"",boxVH:"",boxVh:"",boxvH:"",boxvh:"",boxVL:"",boxVl:"",boxvL:"",boxvl:"",boxVR:"",boxVr:"",boxvR:"",boxvr:"",bprime:"",Breve:"",breve:"",brvbar:"",Bscr:"",bscr:"",bsemi:"",bsim:"",bsime:"",bsol:"\\",bsolb:"",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",Cap:"",cap:"",capand:"",capbrcup:"",capcap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",CenterDot:"",centerdot:"",Cfr:"",cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",cir:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",Colon:"",colon:":",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",Conint:"",conint:"",ContourIntegral:"",Copf:"",copf:"",coprod:"",Coproduct:"",COPY:"",copy:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",Cross:"",cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",Cup:"",cup:"",cupbrcap:"",CupCap:"",cupcap:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",Dagger:"",dagger:"",daleth:"",Darr:"",dArr:"",darr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",DD:"",dd:"",ddagger:"",ddarr:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",Diamond:"",diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrow:"",Downarrow:"",downarrow:"",DownArrowBar:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVector:"",DownLeftVectorBar:"",DownRightTeeVector:"",DownRightVector:"",DownRightVectorBar:"",DownTee:"",DownTeeArrow:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",ecir:"",Ecirc:"",ecirc:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",eDot:"",edot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp:"",emsp13:"",emsp14:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",Escr:"",escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",ExponentialE:"",exponentiale:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",ForAll:"",forall:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",Fscr:"",fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",gE:"",ge:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",ges:"",gescc:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",Gg:"",gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gl:"",gla:"",glE:"",glj:"",gnap:"",gnapprox:"",gnE:"",gne:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",Gt:"",GT:">",gt:">",gtcc:"",gtcir:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",hArr:"",harr:"",harrcir:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",Hfr:"",hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",Hopf:"",hopf:"",horbar:"",HorizontalLine:"",Hscr:"",hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",Ifr:"",ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Im:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",imof:"",imped:"",Implies:"",in:"",incare:"",infin:"",infintie:"",inodot:"",Int:"",int:"",intcal:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",Iscr:"",iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",Lang:"",lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",Larr:"",lArr:"",larr:"",larrb:"",larrbfs:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",lat:"",lAtail:"",latail:"",late:"",lates:"",lBarr:"",lbarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",lE:"",le:"",LeftAngleBracket:"",LeftArrow:"",Leftarrow:"",leftarrow:"",LeftArrowBar:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVector:"",LeftDownVectorBar:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTee:"",LeftTeeArrow:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangle:"",LeftTriangleBar:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVector:"",LeftUpVectorBar:"",LeftVector:"",LeftVectorBar:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",les:"",lescc:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",Ll:"",ll:"",llarr:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoust:"",lmoustache:"",lnap:"",lnapprox:"",lnE:"",lne:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",LongLeftArrow:"",Longleftarrow:"",longleftarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longleftrightarrow:"",longmapsto:"",LongRightArrow:"",Longrightarrow:"",longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",Lscr:"",lscr:"",Lsh:"",lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",Lt:"",LT:"<",lt:"<",ltcc:"",ltcir:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",mid:"",midast:"*",midcir:"",middot:"",minus:"",minusb:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",Mscr:"",mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natur:"",natural:"",naturals:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",ne:"",nearhk:"",neArr:"",nearr:"",nearrow:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:`
`,nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nhArr:"",nharr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlArr:"",nlarr:"",nldr:"",nlE:"",nle:"",nLeftarrow:"",nleftarrow:"",nLeftrightarrow:"",nleftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",Nopf:"",nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangle:"",NotLeftTriangleBar:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangle:"",NotRightTriangleBar:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",npar:"",nparallel:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",npre:"",nprec:"",npreceq:"",nrArr:"",nrarr:"",nrarrc:"",nrarrw:"",nRightarrow:"",nrightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nVDash:"",nVdash:"",nvDash:"",nvdash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwArr:"",nwarr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",ocir:"",Ocirc:"",ocirc:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",Or:"",or:"",orarr:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",Otimes:"",otimes:"",otimesas:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",par:"",para:"",parallel:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plus:"+",plusacir:"",plusb:"",pluscir:"",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",Popf:"",popf:"",pound:"",Pr:"",pr:"",prap:"",prcue:"",prE:"",pre:"",prec:"",precapprox:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",precsim:"",Prime:"",prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportion:"",Proportional:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",Qopf:"",qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",QUOT:'"',quot:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",Rang:"",rang:"",rangd:"",range:"",rangle:"",raquo:"",Rarr:"",rArr:"",rarr:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",rAtail:"",ratail:"",ratio:"",rationals:"",RBarr:"",rBarr:"",rbarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",Re:"",real:"",realine:"",realpart:"",reals:"",rect:"",REG:"",reg:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",Rfr:"",rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrow:"",Rightarrow:"",rightarrow:"",RightArrowBar:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVector:"",RightDownVectorBar:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTee:"",RightTeeArrow:"",RightTeeVector:"",rightthreetimes:"",RightTriangle:"",RightTriangleBar:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVector:"",RightUpVectorBar:"",RightVector:"",RightVectorBar:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoust:"",rmoustache:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",Ropf:"",ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",Rscr:"",rscr:"",Rsh:"",rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",Sc:"",sc:"",scap:"",Scaron:"",scaron:"",sccue:"",scE:"",sce:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdot:"",sdotb:"",sdote:"",searhk:"",seArr:"",searr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",sol:"/",solb:"",solbar:"",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",squ:"",Square:"",square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",Sub:"",sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",Subset:"",subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succ:"",succapprox:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",Sum:"",sum:"",sung:"",Sup:"",sup:"",sup1:"",sup2:"",sup3:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",Supset:"",supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swArr:"",swarr:"",swarrow:"",swnwar:"",szlig:"",Tab:"	",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",Therefore:"",therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",thinsp:"",ThinSpace:"",thkap:"",thksim:"",THORN:"",thorn:"",Tilde:"",tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",times:"",timesb:"",timesbar:"",timesd:"",tint:"",toea:"",top:"",topbot:"",topcir:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",TRADE:"",trade:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",Uarr:"",uArr:"",uarr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrow:"",Uparrow:"",uparrow:"",UpArrowBar:"",UpArrowDownArrow:"",UpDownArrow:"",Updownarrow:"",updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",Upsi:"",upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTee:"",UpTeeArrow:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",vArr:"",varr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",Vbar:"",vBar:"",vBarv:"",Vcy:"",vcy:"",VDash:"",Vdash:"",vDash:"",vdash:"",Vdashl:"",Vee:"",vee:"",veebar:"",veeeq:"",vellip:"",Verbar:"",verbar:"|",Vert:"",vert:"|",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",Wedge:"",wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xhArr:"",xharr:"",Xi:"",xi:"",xlArr:"",xlarr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrArr:"",xrarr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",Yuml:"",yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",Zfr:"",zfr:"",ZHcy:"",zhcy:"",zigrarr:"",Zopf:"",zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""}),t.entityMap=t.HTML_ENTITIES})(T0)),T0}var Tf={},GS;function ER(){if(GS)return Tf;GS=1;var t=dp().NAMESPACE,e=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,i=new RegExp("[\\-\\.0-9"+e.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),n=new RegExp("^"+e.source+i.source+"*(?::"+e.source+i.source+"*)?$"),s=0,o=1,l=2,c=3,h=4,f=5,m=6,_=7;function E(L,H){this.message=L,this.locator=H,Error.captureStackTrace&&Error.captureStackTrace(this,E)}E.prototype=new Error,E.prototype.name=E.name;function w(){}w.prototype={parse:function(L,H,se){var ae=this.domBuilder;ae.startDocument(),U(H,H={}),A(L,H,se,ae,this.errorHandler),ae.endDocument()}};function A(L,H,se,ae,ce){function fe(Pt){if(Pt>65535){Pt-=65536;var Ot=55296+(Pt>>10),Dt=56320+(Pt&1023);return String.fromCharCode(Ot,Dt)}else return String.fromCharCode(Pt)}function be(Pt){var Ot=Pt.slice(1,-1);return Object.hasOwnProperty.call(se,Ot)?se[Ot]:Ot.charAt(0)==="#"?fe(parseInt(Ot.substr(1).replace("x","0x"))):(ce.error("entity not found:"+Pt),Pt)}function J(Pt){if(Pt>ke){var Ot=L.substring(ke,Pt).replace(/&#?\w+;/g,be);P&&ee(ke),ae.characters(Ot,0,Pt-ke),ke=Pt}}function ee(Pt,Ot){for(;Pt>=ue&&(Ot=ve.exec(L));)de=Ot.index,ue=de+Ot[0].length,P.lineNumber++;P.columnNumber=Pt-de+1}for(var de=0,ue=0,ve=/.*(?:\r\n?|\n)|.*$/g,P=ae.locator,ne=[{currentNSMap:H}],ye={},ke=0;;){try{var le=L.indexOf("<",ke);if(le<0){if(!L.substr(ke).match(/^\s*$/)){var ze=ae.doc,it=ze.createTextNode(L.substr(ke));ze.appendChild(it),ae.currentElement=it}return}switch(le>ke&&J(le),L.charAt(le+1)){case"/":var Ut=L.indexOf(">",le+3),Je=L.substring(le+2,Ut).replace(/[ \t\n\r]+$/g,""),Qe=ne.pop();Ut<0?(Je=L.substring(le+2).replace(/[\s<].*/,""),ce.error("end tag name: "+Je+" is not complete:"+Qe.tagName),Ut=le+1+Je.length):Je.match(/\s</)&&(Je=Je.replace(/[\s<].*/,""),ce.error("end tag name: "+Je+" maybe not complete"),Ut=le+1+Je.length);var bt=Qe.localNSMap,ri=Qe.tagName==Je,fi=ri||Qe.tagName&&Qe.tagName.toLowerCase()==Je.toLowerCase();if(fi){if(ae.endElement(Qe.uri,Qe.localName,Je),bt)for(var mn in bt)Object.prototype.hasOwnProperty.call(bt,mn)&&ae.endPrefixMapping(mn);ri||ce.fatalError("end tag name: "+Je+" is not match the current start tagName:"+Qe.tagName)}else ne.push(Qe);Ut++;break;case"?":P&&ee(le),Ut=W(L,le,ae);break;case"!":P&&ee(le),Ut=j(L,le,ae,ce);break;default:P&&ee(le);var Lt=new z,Nn=ne[ne.length-1].currentNSMap,Ut=M(L,le,Lt,Nn,be,ce),rs=Lt.length;if(!Lt.closed&&B(L,Ut,Lt.tagName,ye)&&(Lt.closed=!0,se.nbsp||ce.warning("unclosed xml attribute")),P&&rs){for(var Ui=C(P,{}),Wi=0;Wi<rs;Wi++){var ft=Lt[Wi];ee(ft.offset),ft.locator=C(P,{})}ae.locator=Ui,O(Lt,ae,Nn)&&ne.push(Lt),ae.locator=P}else O(Lt,ae,Nn)&&ne.push(Lt);t.isHTML(Lt.uri)&&!Lt.closed?Ut=$(L,Ut,Lt.tagName,be,ae):Ut++}}catch(Pt){if(Pt instanceof E)throw Pt;ce.error("element parse error: "+Pt),Ut=-1}Ut>ke?ke=Ut:J(Math.max(le,ke)+1)}}function C(L,H){return H.lineNumber=L.lineNumber,H.columnNumber=L.columnNumber,H}function M(L,H,se,ae,ce,fe){function be(P,ne,ye){se.attributeNames.hasOwnProperty(P)&&fe.fatalError("Attribute "+P+" redefined"),se.addValue(P,ne.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,ce),ye)}for(var J,ee,de=++H,ue=s;;){var ve=L.charAt(de);switch(ve){case"=":if(ue===o)J=L.slice(H,de),ue=c;else if(ue===l)ue=c;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(ue===c||ue===o)if(ue===o&&(fe.warning('attribute value must after "="'),J=L.slice(H,de)),H=de+1,de=L.indexOf(ve,H),de>0)ee=L.slice(H,de),be(J,ee,H-1),ue=f;else throw new Error("attribute value no end '"+ve+"' match");else if(ue==h)ee=L.slice(H,de),be(J,ee,H),fe.warning('attribute "'+J+'" missed start quot('+ve+")!!"),H=de+1,ue=f;else throw new Error('attribute value must after "="');break;case"/":switch(ue){case s:se.setTagName(L.slice(H,de));case f:case m:case _:ue=_,se.closed=!0;case h:case o:break;case l:se.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return fe.error("unexpected end of input"),ue==s&&se.setTagName(L.slice(H,de)),de;case">":switch(ue){case s:se.setTagName(L.slice(H,de));case f:case m:case _:break;case h:case o:ee=L.slice(H,de),ee.slice(-1)==="/"&&(se.closed=!0,ee=ee.slice(0,-1));case l:ue===l&&(ee=J),ue==h?(fe.warning('attribute "'+ee+'" missed quot(")!'),be(J,ee,H)):((!t.isHTML(ae[""])||!ee.match(/^(?:disabled|checked|selected)$/i))&&fe.warning('attribute "'+ee+'" missed value!! "'+ee+'" instead!!'),be(ee,ee,H));break;case c:throw new Error("attribute value missed!!")}return de;case"":ve=" ";default:if(ve<=" ")switch(ue){case s:se.setTagName(L.slice(H,de)),ue=m;break;case o:J=L.slice(H,de),ue=l;break;case h:var ee=L.slice(H,de);fe.warning('attribute "'+ee+'" missed quot(")!!'),be(J,ee,H);case f:ue=m;break}else switch(ue){case l:se.tagName,(!t.isHTML(ae[""])||!J.match(/^(?:disabled|checked|selected)$/i))&&fe.warning('attribute "'+J+'" missed value!! "'+J+'" instead2!!'),be(J,J,H),H=de,ue=o;break;case f:fe.warning('attribute space is required"'+J+'"!!');case m:ue=o,H=de;break;case c:ue=h,H=de;break;case _:throw new Error("elements closed character '/' and '>' must be connected to")}}de++}}function O(L,H,se){for(var ae=L.tagName,ce=null,ve=L.length;ve--;){var fe=L[ve],be=fe.qName,J=fe.value,P=be.indexOf(":");if(P>0)var ee=fe.prefix=be.slice(0,P),de=be.slice(P+1),ue=ee==="xmlns"&&de;else de=be,ee=null,ue=be==="xmlns"&&"";fe.localName=de,ue!==!1&&(ce==null&&(ce={},U(se,se={})),se[ue]=ce[ue]=J,fe.uri=t.XMLNS,H.startPrefixMapping(ue,J))}for(var ve=L.length;ve--;){fe=L[ve];var ee=fe.prefix;ee&&(ee==="xml"&&(fe.uri=t.XML),ee!=="xmlns"&&(fe.uri=se[ee||""]))}var P=ae.indexOf(":");P>0?(ee=L.prefix=ae.slice(0,P),de=L.localName=ae.slice(P+1)):(ee=null,de=L.localName=ae);var ne=L.uri=se[ee||""];if(H.startElement(ne,de,ae,L),L.closed){if(H.endElement(ne,de,ae),ce)for(ee in ce)Object.prototype.hasOwnProperty.call(ce,ee)&&H.endPrefixMapping(ee)}else return L.currentNSMap=se,L.localNSMap=ce,!0}function $(L,H,se,ae,ce){if(/^(?:script|textarea)$/i.test(se)){var fe=L.indexOf("</"+se+">",H),be=L.substring(H+1,fe);if(/[&<]/.test(be))return/^script$/i.test(se)?(ce.characters(be,0,be.length),fe):(be=be.replace(/&#?\w+;/g,ae),ce.characters(be,0,be.length),fe)}return H+1}function B(L,H,se,ae){var ce=ae[se];return ce==null&&(ce=L.lastIndexOf("</"+se+">"),ce<H&&(ce=L.lastIndexOf("</"+se)),ae[se]=ce),ce<H}function U(L,H){for(var se in L)Object.prototype.hasOwnProperty.call(L,se)&&(H[se]=L[se])}function j(L,H,se,ae){var ce=L.charAt(H+2);switch(ce){case"-":if(L.charAt(H+3)==="-"){var fe=L.indexOf("-->",H+4);return fe>H?(se.comment(L,H+4,fe-H-4),fe+3):(ae.error("Unclosed comment"),-1)}else return-1;default:if(L.substr(H+3,6)=="CDATA["){var fe=L.indexOf("]]>",H+9);return se.startCDATA(),se.characters(L,H+9,fe-H-9),se.endCDATA(),fe+3}var be=Y(L,H),J=be.length;if(J>1&&/!doctype/i.test(be[0][0])){var ee=be[1][0],de=!1,ue=!1;J>3&&(/^public$/i.test(be[2][0])?(de=be[3][0],ue=J>4&&be[4][0]):/^system$/i.test(be[2][0])&&(ue=be[3][0]));var ve=be[J-1];return se.startDTD(ee,de,ue),se.endDTD(),ve.index+ve[0].length}}return-1}function W(L,H,se){var ae=L.indexOf("?>",H);if(ae){var ce=L.substring(H,ae).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return ce?(ce[0].length,se.processingInstruction(ce[1],ce[2]),ae+2):-1}return-1}function z(){this.attributeNames={}}z.prototype={setTagName:function(L){if(!n.test(L))throw new Error("invalid tagName:"+L);this.tagName=L},addValue:function(L,H,se){if(!n.test(L))throw new Error("invalid attribute:"+L);this.attributeNames[L]=this.length,this[this.length++]={qName:L,value:H,offset:se}},length:0,getLocalName:function(L){return this[L].localName},getLocator:function(L){return this[L].locator},getQName:function(L){return this[L].qName},getURI:function(L){return this[L].uri},getValue:function(L){return this[L].value}};function Y(L,H){var se,ae=[],ce=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(ce.lastIndex=H,ce.exec(L);se=ce.exec(L);)if(ae.push(se),se[1])return ae}return Tf.XMLReader=w,Tf.ParseError=E,Tf}var WS;function CR(){if(WS)return $d;WS=1;var t=dp(),e=Z3(),i=wR(),n=ER(),s=e.DOMImplementation,o=t.NAMESPACE,l=n.ParseError,c=n.XMLReader;function h(M){return M.replace(/\r[\n\u0085]/g,`
`).replace(/[\r\u0085\u2028]/g,`
`)}function f(M){this.options=M||{locator:{}}}f.prototype.parseFromString=function(M,O){var $=this.options,B=new c,U=$.domBuilder||new _,j=$.errorHandler,W=$.locator,z=$.xmlns||{},Y=/\/x?html?$/.test(O),L=Y?i.HTML_ENTITIES:i.XML_ENTITIES;W&&U.setDocumentLocator(W),B.errorHandler=m(j,U,W),B.domBuilder=$.domBuilder||U,Y&&(z[""]=o.HTML),z.xml=z.xml||o.XML;var H=$.normalizeLineEndings||h;return M&&typeof M=="string"?B.parse(H(M),z,L):B.errorHandler.error("invalid doc source"),U.doc};function m(M,O,$){if(!M){if(O instanceof _)return O;M=O}var B={},U=M instanceof Function;$=$||{};function j(W){var z=M[W];!z&&U&&(z=M.length==2?function(Y){M(W,Y)}:M),B[W]=z&&function(Y){z("[xmldom "+W+"]	"+Y+w($))}||function(){}}return j("warning"),j("error"),j("fatalError"),B}function _(){this.cdata=!1}function E(M,O){O.lineNumber=M.lineNumber,O.columnNumber=M.columnNumber}_.prototype={startDocument:function(){this.doc=new s().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(M,O,$,B){var U=this.doc,j=U.createElementNS(M,$||O),W=B.length;C(this,j),this.currentElement=j,this.locator&&E(this.locator,j);for(var z=0;z<W;z++){var M=B.getURI(z),Y=B.getValue(z),$=B.getQName(z),L=U.createAttributeNS(M,$);this.locator&&E(B.getLocator(z),L),L.value=L.nodeValue=Y,j.setAttributeNode(L)}},endElement:function(M,O,$){var B=this.currentElement;B.tagName,this.currentElement=B.parentNode},startPrefixMapping:function(M,O){},endPrefixMapping:function(M){},processingInstruction:function(M,O){var $=this.doc.createProcessingInstruction(M,O);this.locator&&E(this.locator,$),C(this,$)},ignorableWhitespace:function(M,O,$){},characters:function(M,O,$){if(M=A.apply(this,arguments),M){if(this.cdata)var B=this.doc.createCDATASection(M);else var B=this.doc.createTextNode(M);this.currentElement?this.currentElement.appendChild(B):/^\s*$/.test(M)&&this.doc.appendChild(B),this.locator&&E(this.locator,B)}},skippedEntity:function(M){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(M){(this.locator=M)&&(M.lineNumber=0)},comment:function(M,O,$){M=A.apply(this,arguments);var B=this.doc.createComment(M);this.locator&&E(this.locator,B),C(this,B)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(M,O,$){var B=this.doc.implementation;if(B&&B.createDocumentType){var U=B.createDocumentType(M,O,$);this.locator&&E(this.locator,U),C(this,U),this.doc.doctype=U}},warning:function(M){console.warn("[xmldom warning]	"+M,w(this.locator))},error:function(M){console.error("[xmldom error]	"+M,w(this.locator))},fatalError:function(M){throw new l(M,this.locator)}};function w(M){if(M)return`
@`+(M.systemId||"")+"#[line:"+M.lineNumber+",col:"+M.columnNumber+"]"}function A(M,O,$){return typeof M=="string"?M.substr(O,$):M.length>=O+$||O?new java.lang.String(M,O,$)+"":M}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(M){_.prototype[M]=function(){return null}});function C(M,O){M.currentElement?M.currentElement.appendChild(O):M.doc.appendChild(O)}return $d.__DOMHandler=_,$d.normalizeLineEndings=h,$d.DOMParser=f,$d}var XS;function AR(){if(XS)return kd;XS=1;var t=Z3();return kd.DOMImplementation=t.DOMImplementation,kd.XMLSerializer=t.XMLSerializer,kd.DOMParser=CR().DOMParser,kd}var DR=AR();const KS=t=>!!t&&typeof t=="object",fn=(...t)=>t.reduce((e,i)=>(typeof i!="object"||Object.keys(i).forEach(n=>{Array.isArray(e[n])&&Array.isArray(i[n])?e[n]=e[n].concat(i[n]):KS(e[n])&&KS(i[n])?e[n]=fn(e[n],i[n]):e[n]=i[n]}),e),{}),J3=t=>Object.keys(t).map(e=>t[e]),kR=(t,e)=>{const i=[];for(let n=t;n<e;n++)i.push(n);return i},cc=t=>t.reduce((e,i)=>e.concat(i),[]),eD=t=>{if(!t.length)return[];const e=[];for(let i=0;i<t.length;i++)e.push(t[i]);return e},$R=(t,e)=>t.reduce((i,n,s)=>(n[e]&&i.push(s),i),[]),OR=(t,e)=>J3(t.reduce((i,n)=>(n.forEach(s=>{i[e(s)]=s}),i),{}));var dc={INVALID_NUMBER_OF_PERIOD:"INVALID_NUMBER_OF_PERIOD",DASH_EMPTY_MANIFEST:"DASH_EMPTY_MANIFEST",DASH_INVALID_XML:"DASH_INVALID_XML",NO_BASE_URL:"NO_BASE_URL",SEGMENT_TIME_UNSPECIFIED:"SEGMENT_TIME_UNSPECIFIED",UNSUPPORTED_UTC_TIMING_SCHEME:"UNSUPPORTED_UTC_TIMING_SCHEME"};const Yd=({baseUrl:t="",source:e="",range:i="",indexRange:n=""})=>{const s={uri:e,resolvedUri:cp(t||"",e)};if(i||n){const l=(i||n).split("-");let c=te.BigInt?te.BigInt(l[0]):parseInt(l[0],10),h=te.BigInt?te.BigInt(l[1]):parseInt(l[1],10);c<Number.MAX_SAFE_INTEGER&&typeof c=="bigint"&&(c=Number(c)),h<Number.MAX_SAFE_INTEGER&&typeof h=="bigint"&&(h=Number(h));let f;typeof h=="bigint"||typeof c=="bigint"?f=te.BigInt(h)-te.BigInt(c)+te.BigInt(1):f=h-c+1,typeof f=="bigint"&&f<Number.MAX_SAFE_INTEGER&&(f=Number(f)),s.byterange={length:f,offset:c}}return s},IR=t=>{let e;return typeof t.offset=="bigint"||typeof t.length=="bigint"?e=te.BigInt(t.offset)+te.BigInt(t.length)-te.BigInt(1):e=t.offset+t.length-1,`${t.offset}-${e}`},YS=t=>(t&&typeof t!="number"&&(t=parseInt(t,10)),isNaN(t)?null:t),RR={static(t){const{duration:e,timescale:i=1,sourceDuration:n,periodDuration:s}=t,o=YS(t.endNumber),l=e/i;return typeof o=="number"?{start:0,end:o}:typeof s=="number"?{start:0,end:s/l}:{start:0,end:n/l}},dynamic(t){const{NOW:e,clientOffset:i,availabilityStartTime:n,timescale:s=1,duration:o,periodStart:l=0,minimumUpdatePeriod:c=0,timeShiftBufferDepth:h=1/0}=t,f=YS(t.endNumber),m=(e+i)/1e3,_=n+l,w=m+c-_,A=Math.ceil(w*s/o),C=Math.floor((m-_-h)*s/o),M=Math.floor((m-_)*s/o);return{start:Math.max(0,C),end:typeof f=="number"?f:Math.min(A,M)}}},MR=t=>e=>{const{duration:i,timescale:n=1,periodStart:s,startNumber:o=1}=t;return{number:o+e,duration:i/n,timeline:s,time:e*i}},o_=t=>{const{type:e,duration:i,timescale:n=1,periodDuration:s,sourceDuration:o}=t,{start:l,end:c}=RR[e](t),h=kR(l,c).map(MR(t));if(e==="static"){const f=h.length-1,m=typeof s=="number"?s:o;h[f].duration=m-i/n*f}return h},tD=t=>{const{baseUrl:e,initialization:i={},sourceDuration:n,indexRange:s="",periodStart:o,presentationTime:l,number:c=0,duration:h}=t;if(!e)throw new Error(dc.NO_BASE_URL);const f=Yd({baseUrl:e,source:i.sourceURL,range:i.range}),m=Yd({baseUrl:e,source:e,indexRange:s});if(m.map=f,h){const _=o_(t);_.length&&(m.duration=_[0].duration,m.timeline=_[0].timeline)}else n&&(m.duration=n,m.timeline=o);return m.presentationTime=l||o,m.number=c,[m]},l_=(t,e,i)=>{const n=t.sidx.map?t.sidx.map:null,s=t.sidx.duration,o=t.timeline||0,l=t.sidx.byterange,c=l.offset+l.length,h=e.timescale,f=e.references.filter(M=>M.referenceType!==1),m=[],_=t.endList?"static":"dynamic",E=t.sidx.timeline;let w=E,A=t.mediaSequence||0,C;typeof e.firstOffset=="bigint"?C=te.BigInt(c)+e.firstOffset:C=c+e.firstOffset;for(let M=0;M<f.length;M++){const O=e.references[M],$=O.referencedSize,B=O.subsegmentDuration;let U;typeof C=="bigint"?U=C+te.BigInt($)-te.BigInt(1):U=C+$-1;const j=`${C}-${U}`,z=tD({baseUrl:i,timescale:h,timeline:o,periodStart:E,presentationTime:w,number:A,duration:B,sourceDuration:s,indexRange:j,type:_})[0];n&&(z.map=n),m.push(z),typeof C=="bigint"?C+=te.BigInt($):C+=$,w+=B/h,A++}return t.segments=m,t},NR=["AUDIO","SUBTITLES"],BR=1/60,iD=t=>OR(t,({timeline:e})=>e).sort((e,i)=>e.timeline>i.timeline?1:-1),LR=(t,e)=>{for(let i=0;i<t.length;i++)if(t[i].attributes.NAME===e)return t[i];return null},QS=t=>{let e=[];return SR(t,NR,(i,n,s,o)=>{e=e.concat(i.playlists||[])}),e},ZS=({playlist:t,mediaSequence:e})=>{t.mediaSequence=e,t.segments.forEach((i,n)=>{i.number=t.mediaSequence+n})},UR=({oldPlaylists:t,newPlaylists:e,timelineStarts:i})=>{e.forEach(n=>{n.discontinuitySequence=i.findIndex(function({timeline:h}){return h===n.timeline});const s=LR(t,n.attributes.NAME);if(!s||n.sidx)return;const o=n.segments[0],l=s.segments.findIndex(function(h){return Math.abs(h.presentationTime-o.presentationTime)<BR});if(l===-1){ZS({playlist:n,mediaSequence:s.mediaSequence+s.segments.length}),n.segments[0].discontinuity=!0,n.discontinuityStarts.unshift(0),(!s.segments.length&&n.timeline>s.timeline||s.segments.length&&n.timeline>s.segments[s.segments.length-1].timeline)&&n.discontinuitySequence--;return}s.segments[l].discontinuity&&!o.discontinuity&&(o.discontinuity=!0,n.discontinuityStarts.unshift(0),n.discontinuitySequence--),ZS({playlist:n,mediaSequence:s.segments[l].number})})},PR=({oldManifest:t,newManifest:e})=>{const i=t.playlists.concat(QS(t)),n=e.playlists.concat(QS(e));return e.timelineStarts=iD([t.timelineStarts,e.timelineStarts]),UR({oldPlaylists:i,newPlaylists:n,timelineStarts:e.timelineStarts}),e},hp=t=>t&&t.uri+"-"+IR(t.byterange),x0=t=>{const e=t.reduce(function(n,s){return n[s.attributes.baseUrl]||(n[s.attributes.baseUrl]=[]),n[s.attributes.baseUrl].push(s),n},{});let i=[];return Object.values(e).forEach(n=>{const s=J3(n.reduce((o,l)=>{const c=l.attributes.id+(l.attributes.lang||"");return o[c]?(l.segments&&(l.segments[0]&&(l.segments[0].discontinuity=!0),o[c].segments.push(...l.segments)),l.attributes.contentProtection&&(o[c].attributes.contentProtection=l.attributes.contentProtection)):(o[c]=l,o[c].attributes.timelineStarts=[]),o[c].attributes.timelineStarts.push({start:l.attributes.periodStart,timeline:l.attributes.periodStart}),o},{}));i=i.concat(s)}),i.map(n=>(n.discontinuityStarts=$R(n.segments||[],"discontinuity"),n))},u_=(t,e)=>{const i=hp(t.sidx),n=i&&e[i]&&e[i].sidx;return n&&l_(t,n,t.sidx.resolvedUri),t},zR=(t,e={})=>{if(!Object.keys(e).length)return t;for(const i in t)t[i]=u_(t[i],e);return t},FR=({attributes:t,segments:e,sidx:i,mediaSequence:n,discontinuitySequence:s,discontinuityStarts:o},l)=>{const c={attributes:{NAME:t.id,BANDWIDTH:t.bandwidth,CODECS:t.codecs,"PROGRAM-ID":1},uri:"",endList:t.type==="static",timeline:t.periodStart,resolvedUri:t.baseUrl||"",targetDuration:t.duration,discontinuitySequence:s,discontinuityStarts:o,timelineStarts:t.timelineStarts,mediaSequence:n,segments:e};return t.contentProtection&&(c.contentProtection=t.contentProtection),t.serviceLocation&&(c.attributes.serviceLocation=t.serviceLocation),i&&(c.sidx=i),l&&(c.attributes.AUDIO="audio",c.attributes.SUBTITLES="subs"),c},qR=({attributes:t,segments:e,mediaSequence:i,discontinuityStarts:n,discontinuitySequence:s})=>{typeof e>"u"&&(e=[{uri:t.baseUrl,timeline:t.periodStart,resolvedUri:t.baseUrl||"",duration:t.sourceDuration,number:0}],t.duration=t.sourceDuration);const o={NAME:t.id,BANDWIDTH:t.bandwidth,"PROGRAM-ID":1};t.codecs&&(o.CODECS=t.codecs);const l={attributes:o,uri:"",endList:t.type==="static",timeline:t.periodStart,resolvedUri:t.baseUrl||"",targetDuration:t.duration,timelineStarts:t.timelineStarts,discontinuityStarts:n,discontinuitySequence:s,mediaSequence:i,segments:e};return t.serviceLocation&&(l.attributes.serviceLocation=t.serviceLocation),l},jR=(t,e={},i=!1)=>{let n;const s=t.reduce((o,l)=>{const c=l.attributes.role&&l.attributes.role.value||"",h=l.attributes.lang||"";let f=l.attributes.label||"main";if(h&&!l.attributes.label){const _=c?` (${c})`:"";f=`${l.attributes.lang}${_}`}o[f]||(o[f]={language:h,autoselect:!0,default:c==="main",playlists:[],uri:""});const m=u_(FR(l,i),e);return o[f].playlists.push(m),typeof n>"u"&&c==="main"&&(n=l,n.default=!0),o},{});if(!n){const o=Object.keys(s)[0];s[o].default=!0}return s},HR=(t,e={})=>t.reduce((i,n)=>{const s=n.attributes.label||n.attributes.lang||"text",o=n.attributes.lang||"und";return i[s]||(i[s]={language:o,default:!1,autoselect:!1,playlists:[],uri:""}),i[s].playlists.push(u_(qR(n),e)),i},{}),VR=t=>t.reduce((e,i)=>(i&&i.forEach(n=>{const{channel:s,language:o}=n;e[o]={autoselect:!1,default:!1,instreamId:s,language:o},n.hasOwnProperty("aspectRatio")&&(e[o].aspectRatio=n.aspectRatio),n.hasOwnProperty("easyReader")&&(e[o].easyReader=n.easyReader),n.hasOwnProperty("3D")&&(e[o]["3D"]=n["3D"])}),e),{}),GR=({attributes:t,segments:e,sidx:i,discontinuityStarts:n})=>{const s={attributes:{NAME:t.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:t.width,height:t.height},CODECS:t.codecs,BANDWIDTH:t.bandwidth,"PROGRAM-ID":1},uri:"",endList:t.type==="static",timeline:t.periodStart,resolvedUri:t.baseUrl||"",targetDuration:t.duration,discontinuityStarts:n,timelineStarts:t.timelineStarts,segments:e};return t.frameRate&&(s.attributes["FRAME-RATE"]=t.frameRate),t.contentProtection&&(s.contentProtection=t.contentProtection),t.serviceLocation&&(s.attributes.serviceLocation=t.serviceLocation),i&&(s.sidx=i),s},WR=({attributes:t})=>t.mimeType==="video/mp4"||t.mimeType==="video/webm"||t.contentType==="video",XR=({attributes:t})=>t.mimeType==="audio/mp4"||t.mimeType==="audio/webm"||t.contentType==="audio",KR=({attributes:t})=>t.mimeType==="text/vtt"||t.contentType==="text",YR=(t,e)=>{t.forEach(i=>{i.mediaSequence=0,i.discontinuitySequence=e.findIndex(function({timeline:n}){return n===i.timeline}),i.segments&&i.segments.forEach((n,s)=>{n.number=s})})},JS=t=>t?Object.keys(t).reduce((e,i)=>{const n=t[i];return e.concat(n.playlists)},[]):[],QR=({dashPlaylists:t,locations:e,contentSteering:i,sidxMapping:n={},previousManifest:s,eventStream:o})=>{if(!t.length)return{};const{sourceDuration:l,type:c,suggestedPresentationDelay:h,minimumUpdatePeriod:f}=t[0].attributes,m=x0(t.filter(WR)).map(GR),_=x0(t.filter(XR)),E=x0(t.filter(KR)),w=t.map(U=>U.attributes.captionServices).filter(Boolean),A={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:"",duration:l,playlists:zR(m,n)};f>=0&&(A.minimumUpdatePeriod=f*1e3),e&&(A.locations=e),i&&(A.contentSteering=i),c==="dynamic"&&(A.suggestedPresentationDelay=h),o&&o.length>0&&(A.eventStream=o);const C=A.playlists.length===0,M=_.length?jR(_,n,C):null,O=E.length?HR(E,n):null,$=m.concat(JS(M),JS(O)),B=$.map(({timelineStarts:U})=>U);return A.timelineStarts=iD(B),YR($,A.timelineStarts),M&&(A.mediaGroups.AUDIO.audio=M),O&&(A.mediaGroups.SUBTITLES.subs=O),w.length&&(A.mediaGroups["CLOSED-CAPTIONS"].cc=VR(w)),s?PR({oldManifest:s,newManifest:A}):A},ZR=(t,e,i)=>{const{NOW:n,clientOffset:s,availabilityStartTime:o,timescale:l=1,periodStart:c=0,minimumUpdatePeriod:h=0}=t,f=(n+s)/1e3,m=o+c,E=f+h-m;return Math.ceil((E*l-e)/i)},nD=(t,e)=>{const{type:i,minimumUpdatePeriod:n=0,media:s="",sourceDuration:o,timescale:l=1,startNumber:c=1,periodStart:h}=t,f=[];let m=-1;for(let _=0;_<e.length;_++){const E=e[_],w=E.d,A=E.r||0,C=E.t||0;m<0&&(m=C),C&&C>m&&(m=C);let M;if(A<0){const B=_+1;B===e.length?i==="dynamic"&&n>0&&s.indexOf("$Number$")>0?M=ZR(t,m,w):M=(o*l-m)/w:M=(e[B].t-m)/w}else M=A+1;const O=c+f.length+M;let $=c+f.length;for(;$<O;)f.push({number:$,duration:w/l,time:m,timeline:h}),m+=w,$++}return f},JR=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,e8=t=>(e,i,n,s)=>{if(e==="$$")return"$";if(typeof t[i]>"u")return e;const o=""+t[i];return i==="RepresentationID"||(n?s=parseInt(s,10):s=1,o.length>=s)?o:`${new Array(s-o.length+1).join("0")}${o}`},ew=(t,e)=>t.replace(JR,e8(e)),t8=(t,e)=>!t.duration&&!e?[{number:t.startNumber||1,duration:t.sourceDuration,time:0,timeline:t.periodStart}]:t.duration?o_(t):nD(t,e),i8=(t,e)=>{const i={RepresentationID:t.id,Bandwidth:t.bandwidth||0},{initialization:n={sourceURL:"",range:""}}=t,s=Yd({baseUrl:t.baseUrl,source:ew(n.sourceURL,i),range:n.range});return t8(t,e).map(l=>{i.Number=l.number,i.Time=l.time;const c=ew(t.media||"",i),h=t.timescale||1,f=t.presentationTimeOffset||0,m=t.periodStart+(l.time-f)/h;return{uri:c,timeline:l.timeline,duration:l.duration,resolvedUri:cp(t.baseUrl||"",c),map:s,number:l.number,presentationTime:m}})},n8=(t,e)=>{const{baseUrl:i,initialization:n={}}=t,s=Yd({baseUrl:i,source:n.sourceURL,range:n.range}),o=Yd({baseUrl:i,source:e.media,range:e.mediaRange});return o.map=s,o},r8=(t,e)=>{const{duration:i,segmentUrls:n=[],periodStart:s}=t;if(!i&&!e||i&&e)throw new Error(dc.SEGMENT_TIME_UNSPECIFIED);const o=n.map(h=>n8(t,h));let l;return i&&(l=o_(t)),e&&(l=nD(t,e)),l.map((h,f)=>{if(o[f]){const m=o[f],_=t.timescale||1,E=t.presentationTimeOffset||0;return m.timeline=h.timeline,m.duration=h.duration,m.number=h.number,m.presentationTime=s+(h.time-E)/_,m}}).filter(h=>h)},s8=({attributes:t,segmentInfo:e})=>{let i,n;e.template?(n=i8,i=fn(t,e.template)):e.base?(n=tD,i=fn(t,e.base)):e.list&&(n=r8,i=fn(t,e.list));const s={attributes:t};if(!n)return s;const o=n(i,e.segmentTimeline);if(i.duration){const{duration:l,timescale:c=1}=i;i.duration=l/c}else o.length?i.duration=o.reduce((l,c)=>Math.max(l,Math.ceil(c.duration)),0):i.duration=0;return s.attributes=i,s.segments=o,e.base&&i.indexRange&&(s.sidx=o[0],s.segments=[]),s},a8=t=>t.map(s8),Ti=(t,e)=>eD(t.childNodes).filter(({tagName:i})=>i===e),ih=t=>t.textContent.trim(),o8=t=>parseFloat(t.split("/").reduce((e,i)=>e/i)),Hu=t=>{const c=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(t);if(!c)return 0;const[h,f,m,_,E,w]=c.slice(1);return parseFloat(h||0)*31536e3+parseFloat(f||0)*2592e3+parseFloat(m||0)*86400+parseFloat(_||0)*3600+parseFloat(E||0)*60+parseFloat(w||0)},l8=t=>(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(t)&&(t+="Z"),Date.parse(t)),tw={mediaPresentationDuration(t){return Hu(t)},availabilityStartTime(t){return l8(t)/1e3},minimumUpdatePeriod(t){return Hu(t)},suggestedPresentationDelay(t){return Hu(t)},type(t){return t},timeShiftBufferDepth(t){return Hu(t)},start(t){return Hu(t)},width(t){return parseInt(t,10)},height(t){return parseInt(t,10)},bandwidth(t){return parseInt(t,10)},frameRate(t){return o8(t)},startNumber(t){return parseInt(t,10)},timescale(t){return parseInt(t,10)},presentationTimeOffset(t){return parseInt(t,10)},duration(t){const e=parseInt(t,10);return isNaN(e)?Hu(t):e},d(t){return parseInt(t,10)},t(t){return parseInt(t,10)},r(t){return parseInt(t,10)},presentationTime(t){return parseInt(t,10)},DEFAULT(t){return t}},Gi=t=>t&&t.attributes?eD(t.attributes).reduce((e,i)=>{const n=tw[i.name]||tw.DEFAULT;return e[i.name]=n(i.value),e},{}):{},u8={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime","urn:mpeg:dash:mp4protection:2011":"mp4protection"},fp=(t,e)=>e.length?cc(t.map(function(i){return e.map(function(n){const s=ih(n),o=cp(i.baseUrl,s),l=fn(Gi(n),{baseUrl:o});return o!==s&&!l.serviceLocation&&i.serviceLocation&&(l.serviceLocation=i.serviceLocation),l})})):t,c_=t=>{const e=Ti(t,"SegmentTemplate")[0],i=Ti(t,"SegmentList")[0],n=i&&Ti(i,"SegmentURL").map(_=>fn({tag:"SegmentURL"},Gi(_))),s=Ti(t,"SegmentBase")[0],o=i||e,l=o&&Ti(o,"SegmentTimeline")[0],c=i||s||e,h=c&&Ti(c,"Initialization")[0],f=e&&Gi(e);f&&h?f.initialization=h&&Gi(h):f&&f.initialization&&(f.initialization={sourceURL:f.initialization});const m={template:f,segmentTimeline:l&&Ti(l,"S").map(_=>Gi(_)),list:i&&fn(Gi(i),{segmentUrls:n,initialization:Gi(h)}),base:s&&fn(Gi(s),{initialization:Gi(h)})};return Object.keys(m).forEach(_=>{m[_]||delete m[_]}),m},c8=(t,e,i)=>n=>{const s=Ti(n,"BaseURL"),o=fp(e,s),l=fn(t,Gi(n)),c=c_(n);return o.map(h=>({segmentInfo:fn(i,c),attributes:fn(l,h)}))},d8=t=>t.reduce((e,i)=>{const n=Gi(i);n.schemeIdUri&&(n.schemeIdUri=n.schemeIdUri.toLowerCase());const s=u8[n.schemeIdUri];if(s){e[s]={attributes:n};const o=Ti(i,"cenc:pssh")[0];if(o){const l=ih(o);e[s].pssh=l&&G3(l)}}return e},{}),h8=t=>{if(t.schemeIdUri==="urn:scte:dash:cc:cea-608:2015")return(typeof t.value!="string"?[]:t.value.split(";")).map(i=>{let n,s;return s=i,/^CC\d=/.test(i)?[n,s]=i.split("="):/^CC\d$/.test(i)&&(n=i),{channel:n,language:s}});if(t.schemeIdUri==="urn:scte:dash:cc:cea-708:2015")return(typeof t.value!="string"?[]:t.value.split(";")).map(i=>{const n={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(i)){const[s,o=""]=i.split("=");n.channel=s,n.language=i,o.split(",").forEach(l=>{const[c,h]=l.split(":");c==="lang"?n.language=h:c==="er"?n.easyReader=Number(h):c==="war"?n.aspectRatio=Number(h):c==="3D"&&(n["3D"]=Number(h))})}else n.language=i;return n.channel&&(n.channel="SERVICE"+n.channel),n})},f8=t=>cc(Ti(t.node,"EventStream").map(e=>{const i=Gi(e),n=i.schemeIdUri;return Ti(e,"Event").map(s=>{const o=Gi(s),l=o.presentationTime||0,c=i.timescale||1,h=o.duration||0,f=l/c+t.attributes.start;return{schemeIdUri:n,value:i.value,id:o.id,start:f,end:f+h/c,messageData:ih(s)||o.messageData,contentEncoding:i.contentEncoding,presentationTimeOffset:i.presentationTimeOffset||0}})})),p8=(t,e,i)=>n=>{const s=Gi(n),o=fp(e,Ti(n,"BaseURL")),l=Ti(n,"Role")[0],c={role:Gi(l)};let h=fn(t,s,c);const f=Ti(n,"Accessibility")[0],m=h8(Gi(f));m&&(h=fn(h,{captionServices:m}));const _=Ti(n,"Label")[0];if(_&&_.childNodes.length){const M=_.childNodes[0].nodeValue.trim();h=fn(h,{label:M})}const E=d8(Ti(n,"ContentProtection"));Object.keys(E).length&&(h=fn(h,{contentProtection:E}));const w=c_(n),A=Ti(n,"Representation"),C=fn(i,w);return cc(A.map(c8(h,o,C)))},m8=(t,e)=>(i,n)=>{const s=fp(e,Ti(i.node,"BaseURL")),o=fn(t,{periodStart:i.attributes.start});typeof i.attributes.duration=="number"&&(o.periodDuration=i.attributes.duration);const l=Ti(i.node,"AdaptationSet"),c=c_(i.node);return cc(l.map(p8(o,s,c)))},g8=(t,e)=>{if(t.length>1&&e({type:"warn",message:"The MPD manifest should contain no more than one ContentSteering tag"}),!t.length)return null;const i=fn({serverURL:ih(t[0])},Gi(t[0]));return i.queryBeforeStart=i.queryBeforeStart==="true",i},y8=({attributes:t,priorPeriodAttributes:e,mpdType:i})=>typeof t.start=="number"?t.start:e&&typeof e.start=="number"&&typeof e.duration=="number"?e.start+e.duration:!e&&i==="static"?0:null,_8=(t,e={})=>{const{manifestUri:i="",NOW:n=Date.now(),clientOffset:s=0,eventHandler:o=function(){}}=e,l=Ti(t,"Period");if(!l.length)throw new Error(dc.INVALID_NUMBER_OF_PERIOD);const c=Ti(t,"Location"),h=Gi(t),f=fp([{baseUrl:i}],Ti(t,"BaseURL")),m=Ti(t,"ContentSteering");h.type=h.type||"static",h.sourceDuration=h.mediaPresentationDuration||0,h.NOW=n,h.clientOffset=s,c.length&&(h.locations=c.map(ih));const _=[];return l.forEach((E,w)=>{const A=Gi(E),C=_[w-1];A.start=y8({attributes:A,priorPeriodAttributes:C?C.attributes:null,mpdType:h.type}),_.push({node:E,attributes:A})}),{locations:h.locations,contentSteeringInfo:g8(m,o),representationInfo:cc(_.map(m8(h,f))),eventStream:cc(_.map(f8))}},rD=t=>{if(t==="")throw new Error(dc.DASH_EMPTY_MANIFEST);const e=new DR.DOMParser;let i,n;try{i=e.parseFromString(t,"application/xml"),n=i&&i.documentElement.tagName==="MPD"?i.documentElement:null}catch{}if(!n||n&&n.getElementsByTagName("parsererror").length>0)throw new Error(dc.DASH_INVALID_XML);return n},v8=t=>{const e=Ti(t,"UTCTiming")[0];if(!e)return null;const i=Gi(e);switch(i.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":i.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":i.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":i.method="DIRECT",i.value=Date.parse(i.value);break;case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":default:throw new Error(dc.UNSUPPORTED_UTC_TIMING_SCHEME)}return i},b8=(t,e={})=>{const i=_8(rD(t),e),n=a8(i.representationInfo);return QR({dashPlaylists:n,locations:i.locations,contentSteering:i.contentSteeringInfo,sidxMapping:e.sidxMapping,previousManifest:e.previousManifest,eventStream:i.eventStream})},T8=t=>v8(rD(t));var S0,iw;function x8(){if(iw)return S0;iw=1;var t=Math.pow(2,32),e=function(i){var n=new DataView(i.buffer,i.byteOffset,i.byteLength),s;return n.getBigUint64?(s=n.getBigUint64(0),s<Number.MAX_SAFE_INTEGER?Number(s):s):n.getUint32(0)*t+n.getUint32(4)};return S0={getUint64:e,MAX_UINT32:t},S0}var w0,nw;function S8(){if(nw)return w0;nw=1;var t=x8().getUint64,e=function(i){var n=new DataView(i.buffer,i.byteOffset,i.byteLength),s={version:i[0],flags:new Uint8Array(i.subarray(1,4)),references:[],referenceId:n.getUint32(4),timescale:n.getUint32(8)},o=12;s.version===0?(s.earliestPresentationTime=n.getUint32(o),s.firstOffset=n.getUint32(o+4),o+=8):(s.earliestPresentationTime=t(i.subarray(o)),s.firstOffset=t(i.subarray(o+8)),o+=16),o+=2;var l=n.getUint16(o);for(o+=2;l>0;o+=12,l--)s.references.push({referenceType:(i[o]&128)>>>7,referencedSize:n.getUint32(o)&2147483647,subsegmentDuration:n.getUint32(o+4),startsWithSap:!!(i[o+8]&128),sapType:(i[o+8]&112)>>>4,sapDeltaTime:n.getUint32(o+8)&268435455});return s};return w0=e,w0}var w8=S8();const E8=th(w8);var C8=ot([73,68,51]),A8=function(e,i){i===void 0&&(i=0),e=ot(e);var n=e[i+5],s=e[i+6]<<21|e[i+7]<<14|e[i+8]<<7|e[i+9],o=(n&16)>>4;return o?s+20:s+10},Ud=function t(e,i){return i===void 0&&(i=0),e=ot(e),e.length-i<10||!bi(e,C8,{offset:i})?i:(i+=A8(e,i),t(e,i))},rw=function(e){return typeof e=="string"?Q3(e):e},D8=function(e){return Array.isArray(e)?e.map(function(i){return rw(i)}):[rw(e)]},k8=function t(e,i,n){n===void 0&&(n=!1),i=D8(i),e=ot(e);var s=[];if(!i.length)return s;for(var o=0;o<e.length;){var l=(e[o]<<24|e[o+1]<<16|e[o+2]<<8|e[o+3])>>>0,c=e.subarray(o+4,o+8);if(l===0)break;var h=o+l;if(h>e.length){if(n)break;h=e.length}var f=e.subarray(o+8,h);bi(c,i[0])&&(i.length===1?s.push(f):s.push.apply(s,t(f,i.slice(1),n))),o=h}return s},xf={EBML:ot([26,69,223,163]),DocType:ot([66,130]),Segment:ot([24,83,128,103]),SegmentInfo:ot([21,73,169,102]),Tracks:ot([22,84,174,107]),Track:ot([174]),TrackNumber:ot([215]),DefaultDuration:ot([35,227,131]),TrackEntry:ot([174]),TrackType:ot([131]),FlagDefault:ot([136]),CodecID:ot([134]),CodecPrivate:ot([99,162]),VideoTrack:ot([224]),AudioTrack:ot([225]),Cluster:ot([31,67,182,117]),Timestamp:ot([231]),TimestampScale:ot([42,215,177]),BlockGroup:ot([160]),BlockDuration:ot([155]),Block:ot([161]),SimpleBlock:ot([163])},ry=[128,64,32,16,8,4,2,1],$8=function(e){for(var i=1,n=0;n<ry.length&&!(e&ry[n]);n++)i++;return i},Ff=function(e,i,n,s){n===void 0&&(n=!0),s===void 0&&(s=!1);var o=$8(e[i]),l=e.subarray(i,i+o);return n&&(l=Array.prototype.slice.call(e,i,i+o),l[0]^=ry[o-1]),{length:o,value:bR(l,{signed:s}),bytes:l}},sw=function t(e){return typeof e=="string"?e.match(/.{1,2}/g).map(function(i){return t(i)}):typeof e=="number"?TR(e):e},O8=function(e){return Array.isArray(e)?e.map(function(i){return sw(i)}):[sw(e)]},I8=function t(e,i,n){if(n>=i.length)return i.length;var s=Ff(i,n,!1);if(bi(e.bytes,s.bytes))return n;var o=Ff(i,n+s.length);return t(e,i,n+o.length+o.value+s.length)},aw=function t(e,i){i=O8(i),e=ot(e);var n=[];if(!i.length)return n;for(var s=0;s<e.length;){var o=Ff(e,s,!1),l=Ff(e,s+o.length),c=s+o.length+l.length;l.value===127&&(l.value=I8(o,e,c),l.value!==e.length&&(l.value-=c));var h=c+l.value>e.length?e.length:c+l.value,f=e.subarray(c,h);bi(i[0],o.bytes)&&(i.length===1?n.push(f):n=n.concat(t(f,i.slice(1))));var m=o.length+l.length+f.length;s+=m}return n},R8=ot([0,0,0,1]),M8=ot([0,0,1]),N8=ot([0,0,3]),B8=function(e){for(var i=[],n=1;n<e.length-2;)bi(e.subarray(n,n+3),N8)&&(i.push(n+2),n++),n++;if(i.length===0)return e;var s=e.length-i.length,o=new Uint8Array(s),l=0;for(n=0;n<s;l++,n++)l===i[0]&&(l++,i.shift()),o[n]=e[l];return o},sD=function(e,i,n,s){e=ot(e),n=[].concat(n);for(var o=0,l,c=0;o<e.length&&(c<s||l);){var h=void 0;if(bi(e.subarray(o),R8)?h=4:bi(e.subarray(o),M8)&&(h=3),!h){o++;continue}if(c++,l)return B8(e.subarray(l,o));var f=void 0;i==="h264"?f=e[o+h]&31:i==="h265"&&(f=e[o+h]>>1&63),n.indexOf(f)!==-1&&(l=o+h),o+=h+(i==="h264"?1:2)}return e.subarray(0,0)},L8=function(e,i,n){return sD(e,"h264",i,n)},U8=function(e,i,n){return sD(e,"h265",i,n)},Hn={webm:ot([119,101,98,109]),matroska:ot([109,97,116,114,111,115,107,97]),flac:ot([102,76,97,67]),ogg:ot([79,103,103,83]),ac3:ot([11,119]),riff:ot([82,73,70,70]),avi:ot([65,86,73]),wav:ot([87,65,86,69]),"3gp":ot([102,116,121,112,51,103]),mp4:ot([102,116,121,112]),fmp4:ot([115,116,121,112]),mov:ot([102,116,121,112,113,116]),moov:ot([109,111,111,118]),moof:ot([109,111,111,102])},hc={aac:function(e){var i=Ud(e);return bi(e,[255,16],{offset:i,mask:[255,22]})},mp3:function(e){var i=Ud(e);return bi(e,[255,2],{offset:i,mask:[255,6]})},webm:function(e){var i=aw(e,[xf.EBML,xf.DocType])[0];return bi(i,Hn.webm)},mkv:function(e){var i=aw(e,[xf.EBML,xf.DocType])[0];return bi(i,Hn.matroska)},mp4:function(e){if(hc["3gp"](e)||hc.mov(e))return!1;if(bi(e,Hn.mp4,{offset:4})||bi(e,Hn.fmp4,{offset:4})||bi(e,Hn.moof,{offset:4})||bi(e,Hn.moov,{offset:4}))return!0},mov:function(e){return bi(e,Hn.mov,{offset:4})},"3gp":function(e){return bi(e,Hn["3gp"],{offset:4})},ac3:function(e){var i=Ud(e);return bi(e,Hn.ac3,{offset:i})},ts:function(e){if(e.length<189&&e.length>=1)return e[0]===71;for(var i=0;i+188<e.length&&i<188;){if(e[i]===71&&e[i+188]===71)return!0;i+=1}return!1},flac:function(e){var i=Ud(e);return bi(e,Hn.flac,{offset:i})},ogg:function(e){return bi(e,Hn.ogg)},avi:function(e){return bi(e,Hn.riff)&&bi(e,Hn.avi,{offset:8})},wav:function(e){return bi(e,Hn.riff)&&bi(e,Hn.wav,{offset:8})},h264:function(e){return L8(e,7,3).length},h265:function(e){return U8(e,[32,33],3).length}},sy=Object.keys(hc).filter(function(t){return t!=="ts"&&t!=="h264"&&t!=="h265"}).concat(["ts","h264","h265"]);sy.forEach(function(t){var e=hc[t];hc[t]=function(i){return e(ot(i))}});var P8=hc,d_=function(e){e=ot(e);for(var i=0;i<sy.length;i++){var n=sy[i];if(P8[n](e))return n}return""},z8=function(e){return k8(e,["moof"]).length>0},E0,ow;function F8(){if(ow)return E0;ow=1;var t=9e4,e,i,n,s,o,l,c;return e=function(h){return h*t},i=function(h,f){return h*f},n=function(h){return h/t},s=function(h,f){return h/f},o=function(h,f){return e(s(h,f))},l=function(h,f){return i(n(h),f)},c=function(h,f,m){return n(m?h:h-f)},E0={ONE_SECOND_IN_TS:t,secondsToVideoTs:e,secondsToAudioTs:i,videoTsToSeconds:n,audioTsToSeconds:s,audioTsToVideoTs:o,videoTsToAudioTs:l,metadataTsToSeconds:c},E0}var Vl=F8();var ay="8.23.4";const Ka={},el=function(t,e){return Ka[t]=Ka[t]||[],e&&(Ka[t]=Ka[t].concat(e)),Ka[t]},q8=function(t,e){el(t,e)},aD=function(t,e){const i=el(t).indexOf(e);return i<=-1?!1:(Ka[t]=Ka[t].slice(),Ka[t].splice(i,1),!0)},j8=function(t,e){el(t,[].concat(e).map(i=>{const n=(...s)=>(aD(t,n),i(...s));return n}))},qf={prefixed:!0},kf=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"]],lw=kf[0];let Pd;for(let t=0;t<kf.length;t++)if(kf[t][1]in Fe){Pd=kf[t];break}if(Pd){for(let t=0;t<Pd.length;t++)qf[lw[t]]=Pd[t];qf.prefixed=Pd[0]!==lw[0]}let lr=[];const H8=(t,e,i)=>(n,s,o)=>{const l=e.levels[s],c=new RegExp(`^(${l})$`);let h=t;if(n!=="log"&&o.unshift(n.toUpperCase()+":"),i&&(h=`%c${t}`,o.unshift(i)),o.unshift(h+":"),lr){lr.push([].concat(o));const m=lr.length-1e3;lr.splice(0,m>0?m:0)}if(!te.console)return;let f=te.console[n];!f&&n==="debug"&&(f=te.console.info||te.console.log),!(!f||!l||!c.test(n))&&f[Array.isArray(o)?"apply":"call"](te.console,o)};function oy(t,e=":",i=""){let n="info",s;function o(...l){s("log",n,l)}return s=H8(t,o,i),o.createLogger=(l,c,h)=>{const f=c!==void 0?c:e,m=h!==void 0?h:i,_=`${t} ${f} ${l}`;return oy(_,f,m)},o.createNewLogger=(l,c,h)=>oy(l,c,h),o.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:n},o.level=l=>{if(typeof l=="string"){if(!o.levels.hasOwnProperty(l))throw new Error(`"${l}" in not a valid log level`);n=l}return n},o.history=()=>lr?[].concat(lr):[],o.history.filter=l=>(lr||[]).filter(c=>new RegExp(`.*${l}.*`).test(c[0])),o.history.clear=()=>{lr&&(lr.length=0)},o.history.disable=()=>{lr!==null&&(lr.length=0,lr=null)},o.history.enable=()=>{lr===null&&(lr=[])},o.error=(...l)=>s("error",n,l),o.warn=(...l)=>s("warn",n,l),o.debug=(...l)=>s("debug",n,l),o}const St=oy("VIDEOJS"),oD=St.createLogger,V8=Object.prototype.toString,lD=function(t){return la(t)?Object.keys(t):[]};function Zu(t,e){lD(t).forEach(i=>e(t[i],i))}function uD(t,e,i=0){return lD(t).reduce((n,s)=>e(n,t[s],s),i)}function la(t){return!!t&&typeof t=="object"}function fc(t){return la(t)&&V8.call(t)==="[object Object]"&&t.constructor===Object}function ni(...t){const e={};return t.forEach(i=>{i&&Zu(i,(n,s)=>{if(!fc(n)){e[s]=n;return}fc(e[s])||(e[s]={}),e[s]=ni(e[s],n)})}),e}function cD(t={}){const e=[];for(const i in t)if(t.hasOwnProperty(i)){const n=t[i];e.push(n)}return e}function pp(t,e,i,n=!0){const s=l=>Object.defineProperty(t,e,{value:l,enumerable:!0,writable:!0}),o={configurable:!0,enumerable:!0,get(){const l=i();return s(l),l}};return n&&(o.set=s),Object.defineProperty(t,e,o)}var G8=Object.freeze({__proto__:null,each:Zu,reduce:uD,isObject:la,isPlain:fc,merge:ni,values:cD,defineLazyProperty:pp});let h_=!1,dD=null,Os=!1,hD,fD=!1,Ju=!1,ec=!1,ua=!1,f_=null,mp=null;const W8=!!(te.cast&&te.cast.framework&&te.cast.framework.CastReceiverContext);let pD=null,jf=!1,gp=!1,Hf=!1,yp=!1,Vf=!1,Gf=!1,Wf=!1;const Qd=!!(vc()&&("ontouchstart"in te||te.navigator.maxTouchPoints||te.DocumentTouch&&te.document instanceof te.DocumentTouch)),Xo=te.navigator&&te.navigator.userAgentData;Xo&&Xo.platform&&Xo.brands&&(Os=Xo.platform==="Android",Ju=!!Xo.brands.find(t=>t.brand==="Microsoft Edge"),ec=!!Xo.brands.find(t=>t.brand==="Chromium"),ua=!Ju&&ec,f_=mp=(Xo.brands.find(t=>t.brand==="Chromium")||{}).version||null,gp=Xo.platform==="Windows");if(!ec){const t=te.navigator&&te.navigator.userAgent||"";h_=/iPod/i.test(t),dD=(function(){const e=t.match(/OS (\d+)_/i);return e&&e[1]?e[1]:null})(),Os=/Android/i.test(t),hD=(function(){const e=t.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;const i=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return i&&n?parseFloat(e[1]+"."+e[2]):i||null})(),fD=/Firefox/i.test(t),Ju=/Edg/i.test(t),ec=/Chrome/i.test(t)||/CriOS/i.test(t),ua=!Ju&&ec,f_=mp=(function(){const e=t.match(/(Chrome|CriOS)\/(\d+)/);return e&&e[2]?parseFloat(e[2]):null})(),pD=(function(){const e=/MSIE\s(\d+)\.\d/.exec(t);let i=e&&parseFloat(e[1]);return!i&&/Trident\/7.0/i.test(t)&&/rv:11.0/.test(t)&&(i=11),i})(),Vf=/Tizen/i.test(t),Gf=/Web0S/i.test(t),Wf=Vf||Gf,jf=/Safari/i.test(t)&&!ua&&!Os&&!Ju&&!Wf,gp=/Windows/i.test(t),Hf=/iPad/i.test(t)||jf&&Qd&&!/iPhone/i.test(t),yp=/iPhone/i.test(t)&&!Hf}const In=yp||Hf||h_,_p=(jf||In)&&!ua;var mD=Object.freeze({__proto__:null,get IS_IPOD(){return h_},get IOS_VERSION(){return dD},get IS_ANDROID(){return Os},get ANDROID_VERSION(){return hD},get IS_FIREFOX(){return fD},get IS_EDGE(){return Ju},get IS_CHROMIUM(){return ec},get IS_CHROME(){return ua},get CHROMIUM_VERSION(){return f_},get CHROME_VERSION(){return mp},IS_CHROMECAST_RECEIVER:W8,get IE_VERSION(){return pD},get IS_SAFARI(){return jf},get IS_WINDOWS(){return gp},get IS_IPAD(){return Hf},get IS_IPHONE(){return yp},get IS_TIZEN(){return Vf},get IS_WEBOS(){return Gf},get IS_SMART_TV(){return Wf},TOUCH_ENABLED:Qd,IS_IOS:In,IS_ANY_SAFARI:_p});function uw(t){return typeof t=="string"&&!!t.trim()}function X8(t){if(t.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function vc(){return Fe===te.document}function bc(t){return la(t)&&t.nodeType===1}function gD(){try{return te.parent!==te.self}catch{return!0}}function yD(t){return function(e,i){if(!uw(e))return Fe[t](null);uw(i)&&(i=Fe.querySelector(i));const n=bc(i)?i:Fe;return n[t]&&n[t](e)}}function ut(t="div",e={},i={},n){const s=Fe.createElement(t);return Object.getOwnPropertyNames(e).forEach(function(o){const l=e[o];o==="textContent"?nl(s,l):(s[o]!==l||o==="tabIndex")&&(s[o]=l)}),Object.getOwnPropertyNames(i).forEach(function(o){s.setAttribute(o,i[o])}),n&&p_(s,n),s}function nl(t,e){return typeof t.textContent>"u"?t.innerText=e:t.textContent=e,t}function ly(t,e){e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)}function jd(t,e){return X8(e),t.classList.contains(e)}function Yl(t,...e){return t.classList.add(...e.reduce((i,n)=>i.concat(n.split(/\s+/)),[])),t}function vp(t,...e){return t?(t.classList.remove(...e.reduce((i,n)=>i.concat(n.split(/\s+/)),[])),t):(St.warn("removeClass was called with an element that doesn't exist"),null)}function _D(t,e,i){return typeof i=="function"&&(i=i(t,e)),typeof i!="boolean"&&(i=void 0),e.split(/\s+/).forEach(n=>t.classList.toggle(n,i)),t}function vD(t,e){Object.getOwnPropertyNames(e).forEach(function(i){const n=e[i];n===null||typeof n>"u"||n===!1?t.removeAttribute(i):t.setAttribute(i,n===!0?"":n)})}function Qo(t){const e={},i=["autoplay","controls","playsinline","loop","muted","default","defaultMuted"];if(t&&t.attributes&&t.attributes.length>0){const n=t.attributes;for(let s=n.length-1;s>=0;s--){const o=n[s].name;let l=n[s].value;i.includes(o)&&(l=l!==null),e[o]=l}}return e}function bD(t,e){return t.getAttribute(e)}function pc(t,e,i){t.setAttribute(e,i)}function bp(t,e){t.removeAttribute(e)}function TD(){Fe.body.focus(),Fe.onselectstart=function(){return!1}}function xD(){Fe.onselectstart=function(){return!0}}function mc(t){if(t&&t.getBoundingClientRect&&t.parentNode){const e=t.getBoundingClientRect(),i={};return["bottom","height","left","right","top","width"].forEach(n=>{e[n]!==void 0&&(i[n]=e[n])}),i.height||(i.height=parseFloat(gc(t,"height"))),i.width||(i.width=parseFloat(gc(t,"width"))),i}}function Zd(t){if(!t||t&&!t.offsetParent)return{left:0,top:0,width:0,height:0};const e=t.offsetWidth,i=t.offsetHeight;let n=0,s=0;for(;t.offsetParent&&t!==Fe[qf.fullscreenElement];)n+=t.offsetLeft,s+=t.offsetTop,t=t.offsetParent;return{left:n,top:s,width:e,height:i}}function Tp(t,e){const i={x:0,y:0};if(In){let m=t;for(;m&&m.nodeName.toLowerCase()!=="html";){const _=gc(m,"transform");if(/^matrix/.test(_)){const E=_.slice(7,-1).split(/,\s/).map(Number);i.x+=E[4],i.y+=E[5]}else if(/^matrix3d/.test(_)){const E=_.slice(9,-1).split(/,\s/).map(Number);i.x+=E[12],i.y+=E[13]}if(m.assignedSlot&&m.assignedSlot.parentElement&&te.WebKitCSSMatrix){const E=te.getComputedStyle(m.assignedSlot.parentElement).transform,w=new te.WebKitCSSMatrix(E);i.x+=w.m41,i.y+=w.m42}m=m.parentNode||m.host}}const n={},s=Zd(e.target),o=Zd(t),l=o.width,c=o.height;let h=e.offsetY-(o.top-s.top),f=e.offsetX-(o.left-s.left);return e.changedTouches&&(f=e.changedTouches[0].pageX-o.left,h=e.changedTouches[0].pageY+o.top,In&&(f-=i.x,h-=i.y)),n.y=1-Math.max(0,Math.min(1,h/c)),n.x=Math.max(0,Math.min(1,f/l)),n}function SD(t){return la(t)&&t.nodeType===3}function xp(t){for(;t.firstChild;)t.removeChild(t.firstChild);return t}function wD(t){return typeof t=="function"&&(t=t()),(Array.isArray(t)?t:[t]).map(e=>{if(typeof e=="function"&&(e=e()),bc(e)||SD(e))return e;if(typeof e=="string"&&/\S/.test(e))return Fe.createTextNode(e)}).filter(e=>e)}function p_(t,e){return wD(e).forEach(i=>t.appendChild(i)),t}function ED(t,e){return p_(xp(t),e)}function Jd(t){return t.button===void 0&&t.buttons===void 0||t.button===0&&t.buttons===void 0||t.type==="mouseup"&&t.button===0&&t.buttons===0||t.type==="mousedown"&&t.button===0&&t.buttons===0?!0:!(t.button!==0||t.buttons!==1)}const tl=yD("querySelector"),CD=yD("querySelectorAll");function gc(t,e){if(!t||!e)return"";if(typeof te.getComputedStyle=="function"){let i;try{i=te.getComputedStyle(t)}catch{return""}return i?i.getPropertyValue(e)||i[e]:""}return""}function AD(t){[...Fe.styleSheets].forEach(e=>{try{const i=[...e.cssRules].map(s=>s.cssText).join(""),n=Fe.createElement("style");n.textContent=i,t.document.head.appendChild(n)}catch{const n=Fe.createElement("link");n.rel="stylesheet",n.type=e.type,n.media=e.media.mediaText,n.href=e.href,t.document.head.appendChild(n)}})}var DD=Object.freeze({__proto__:null,isReal:vc,isEl:bc,isInFrame:gD,createEl:ut,textContent:nl,prependTo:ly,hasClass:jd,addClass:Yl,removeClass:vp,toggleClass:_D,setAttributes:vD,getAttributes:Qo,getAttribute:bD,setAttribute:pc,removeAttribute:bp,blockTextSelection:TD,unblockTextSelection:xD,getBoundingClientRect:mc,findPosition:Zd,getPointerPosition:Tp,isTextNode:SD,emptyEl:xp,normalizeContent:wD,appendContent:p_,insertContent:ED,isSingleLeftClick:Jd,$:tl,$$:CD,computedStyle:gc,copyStyleSheetsToWindow:AD});let kD=!1,uy;const K8=function(){if(uy.options.autoSetup===!1)return;const t=Array.prototype.slice.call(Fe.getElementsByTagName("video")),e=Array.prototype.slice.call(Fe.getElementsByTagName("audio")),i=Array.prototype.slice.call(Fe.getElementsByTagName("video-js")),n=t.concat(e,i);if(n&&n.length>0)for(let s=0,o=n.length;s<o;s++){const l=n[s];if(l&&l.getAttribute)l.player===void 0&&l.getAttribute("data-setup")!==null&&uy(l);else{cy(1);break}}else kD||cy(1)};function cy(t,e){vc()&&(e&&(uy=e),te.setTimeout(K8,t))}function dy(){kD=!0,te.removeEventListener("load",dy)}vc()&&(Fe.readyState==="complete"?dy():te.addEventListener("load",dy));const $D=function(t){const e=Fe.createElement("style");return e.className=t,e},OD=function(t,e){t.styleSheet?t.styleSheet.cssText=e:t.textContent=e};var Gn=new WeakMap;const Y8=3;let Q8=Y8;function es(){return Q8++}function cw(t,e){if(!Gn.has(t))return;const i=Gn.get(t);i.handlers[e].length===0&&(delete i.handlers[e],t.removeEventListener?t.removeEventListener(e,i.dispatcher,!1):t.detachEvent&&t.detachEvent("on"+e,i.dispatcher)),Object.getOwnPropertyNames(i.handlers).length<=0&&(delete i.handlers,delete i.dispatcher,delete i.disabled),Object.getOwnPropertyNames(i).length===0&&Gn.delete(t)}function m_(t,e,i,n){i.forEach(function(s){t(e,s,n)})}function Sp(t){if(t.fixed_)return t;function e(){return!0}function i(){return!1}if(!t||!t.isPropagationStopped||!t.isImmediatePropagationStopped){const n=t||te.event;t={};const s=["layerX","layerY","keyLocation","path","webkitMovementX","webkitMovementY","mozPressure","mozInputSource"];for(const o in n)s.includes(o)||o==="returnValue"&&n.preventDefault||(t[o]=n[o]);if(t.target||(t.target=t.srcElement||Fe),t.relatedTarget||(t.relatedTarget=t.fromElement===t.target?t.toElement:t.fromElement),t.preventDefault=function(){n.preventDefault&&n.preventDefault(),t.returnValue=!1,n.returnValue=!1,t.defaultPrevented=!0},t.defaultPrevented=!1,t.stopPropagation=function(){n.stopPropagation&&n.stopPropagation(),t.cancelBubble=!0,n.cancelBubble=!0,t.isPropagationStopped=e},t.isPropagationStopped=i,t.stopImmediatePropagation=function(){n.stopImmediatePropagation&&n.stopImmediatePropagation(),t.isImmediatePropagationStopped=e,t.stopPropagation()},t.isImmediatePropagationStopped=i,t.clientX!==null&&t.clientX!==void 0){const o=Fe.documentElement,l=Fe.body;t.pageX=t.clientX+(o&&o.scrollLeft||l&&l.scrollLeft||0)-(o&&o.clientLeft||l&&l.clientLeft||0),t.pageY=t.clientY+(o&&o.scrollTop||l&&l.scrollTop||0)-(o&&o.clientTop||l&&l.clientTop||0)}t.which=t.charCode||t.keyCode,t.button!==null&&t.button!==void 0&&(t.button=t.button&1?0:t.button&4?1:t.button&2?2:0)}return t.fixed_=!0,t}let Sf;const Z8=function(){if(typeof Sf!="boolean"){Sf=!1;try{const t=Object.defineProperty({},"passive",{get(){Sf=!0}});te.addEventListener("test",null,t),te.removeEventListener("test",null,t)}catch{}}return Sf},J8=["touchstart","touchmove"];function Or(t,e,i){if(Array.isArray(e))return m_(Or,t,e,i);Gn.has(t)||Gn.set(t,{});const n=Gn.get(t);if(n.handlers||(n.handlers={}),n.handlers[e]||(n.handlers[e]=[]),i.guid||(i.guid=es()),n.handlers[e].push(i),n.dispatcher||(n.disabled=!1,n.dispatcher=function(s,o){if(n.disabled)return;s=Sp(s);const l=n.handlers[s.type];if(l){const c=l.slice(0);for(let h=0,f=c.length;h<f&&!s.isImmediatePropagationStopped();h++)try{c[h].call(t,s,o)}catch(m){St.error(m)}}}),n.handlers[e].length===1)if(t.addEventListener){let s=!1;Z8()&&J8.indexOf(e)>-1&&(s={passive:!0}),t.addEventListener(e,n.dispatcher,s)}else t.attachEvent&&t.attachEvent("on"+e,n.dispatcher)}function Rn(t,e,i){if(!Gn.has(t))return;const n=Gn.get(t);if(!n.handlers)return;if(Array.isArray(e))return m_(Rn,t,e,i);const s=function(l,c){n.handlers[c]=[],cw(l,c)};if(e===void 0){for(const l in n.handlers)Object.prototype.hasOwnProperty.call(n.handlers||{},l)&&s(t,l);return}const o=n.handlers[e];if(o){if(!i){s(t,e);return}if(i.guid)for(let l=0;l<o.length;l++)o[l].guid===i.guid&&o.splice(l--,1);cw(t,e)}}function Tc(t,e,i){const n=Gn.has(t)?Gn.get(t):{},s=t.parentNode||t.ownerDocument;if(typeof e=="string"?e={type:e,target:t}:e.target||(e.target=t),e=Sp(e),n.dispatcher&&n.dispatcher.call(t,e,i),s&&!e.isPropagationStopped()&&e.bubbles===!0)Tc.call(null,s,e,i);else if(!s&&!e.defaultPrevented&&e.target&&e.target[e.type]){Gn.has(e.target)||Gn.set(e.target,{});const o=Gn.get(e.target);e.target[e.type]&&(o.disabled=!0,typeof e.target[e.type]=="function"&&e.target[e.type](),o.disabled=!1)}return!e.defaultPrevented}function wp(t,e,i){if(Array.isArray(e))return m_(wp,t,e,i);const n=function(){Rn(t,e,n),i.apply(this,arguments)};n.guid=i.guid=i.guid||es(),Or(t,e,n)}function g_(t,e,i){const n=function(){Rn(t,e,n),i.apply(this,arguments)};n.guid=i.guid=i.guid||es(),Or(t,e,n)}var eM=Object.freeze({__proto__:null,fixEvent:Sp,on:Or,off:Rn,trigger:Tc,one:wp,any:g_});const ts=30,hi=function(t,e,i){e.guid||(e.guid=es());const n=e.bind(t);return n.guid=i?i+"_"+e.guid:e.guid,n},ca=function(t,e){let i=te.performance.now();return function(...s){const o=te.performance.now();o-i>=e&&(t(...s),i=o)}},ID=function(t,e,i,n=te){let s;const o=()=>{n.clearTimeout(s),s=null},l=function(){const c=this,h=arguments;let f=function(){s=null,f=null,i||t.apply(c,h)};!s&&i&&t.apply(c,h),n.clearTimeout(s),s=n.setTimeout(f,e)};return l.cancel=o,l};var tM=Object.freeze({__proto__:null,UPDATE_REFRESH_INTERVAL:ts,bind_:hi,throttle:ca,debounce:ID});let Od;class Ir{on(e,i){const n=this.addEventListener;this.addEventListener=()=>{},Or(this,e,i),this.addEventListener=n}off(e,i){Rn(this,e,i)}one(e,i){const n=this.addEventListener;this.addEventListener=()=>{},wp(this,e,i),this.addEventListener=n}any(e,i){const n=this.addEventListener;this.addEventListener=()=>{},g_(this,e,i),this.addEventListener=n}trigger(e){const i=e.type||e;typeof e=="string"&&(e={type:i}),e=Sp(e),this.allowedEvents_[i]&&this["on"+i]&&this["on"+i](e),Tc(this,e)}queueTrigger(e){Od||(Od=new Map);const i=e.type||e;let n=Od.get(this);n||(n=new Map,Od.set(this,n));const s=n.get(i);n.delete(i),te.clearTimeout(s);const o=te.setTimeout(()=>{n.delete(i),n.size===0&&(n=null,Od.delete(this)),this.trigger(e)},0);n.set(i,o)}}Ir.prototype.allowedEvents_={};Ir.prototype.addEventListener=Ir.prototype.on;Ir.prototype.removeEventListener=Ir.prototype.off;Ir.prototype.dispatchEvent=Ir.prototype.trigger;const Ep=t=>typeof t.name=="function"?t.name():typeof t.name=="string"?t.name:t.name_?t.name_:t.constructor&&t.constructor.name?t.constructor.name:typeof t,Ja=t=>t instanceof Ir||!!t.eventBusEl_&&["on","one","off","trigger"].every(e=>typeof t[e]=="function"),iM=(t,e)=>{Ja(t)?e():(t.eventedCallbacks||(t.eventedCallbacks=[]),t.eventedCallbacks.push(e))},hy=t=>typeof t=="string"&&/\S/.test(t)||Array.isArray(t)&&!!t.length,Xf=(t,e,i)=>{if(!t||!t.nodeName&&!Ja(t))throw new Error(`Invalid target for ${Ep(e)}#${i}; must be a DOM node or evented object.`)},RD=(t,e,i)=>{if(!hy(t))throw new Error(`Invalid event type for ${Ep(e)}#${i}; must be a non-empty string or array.`)},MD=(t,e,i)=>{if(typeof t!="function")throw new Error(`Invalid listener for ${Ep(e)}#${i}; must be a function.`)},C0=(t,e,i)=>{const n=e.length<3||e[0]===t||e[0]===t.eventBusEl_;let s,o,l;return n?(s=t.eventBusEl_,e.length>=3&&e.shift(),[o,l]=e):(s=e[0],o=e[1],l=e[2]),Xf(s,t,i),RD(o,t,i),MD(l,t,i),l=hi(t,l),{isTargetingSelf:n,target:s,type:o,listener:l}},Pl=(t,e,i,n)=>{Xf(t,t,e),t.nodeName?eM[e](t,i,n):t[e](i,n)},nM={on(...t){const{isTargetingSelf:e,target:i,type:n,listener:s}=C0(this,t,"on");if(Pl(i,"on",n,s),!e){const o=()=>this.off(i,n,s);o.guid=s.guid;const l=()=>this.off("dispose",o);l.guid=s.guid,Pl(this,"on","dispose",o),Pl(i,"on","dispose",l)}},one(...t){const{isTargetingSelf:e,target:i,type:n,listener:s}=C0(this,t,"one");if(e)Pl(i,"one",n,s);else{const o=(...l)=>{this.off(i,n,o),s.apply(null,l)};o.guid=s.guid,Pl(i,"one",n,o)}},any(...t){const{isTargetingSelf:e,target:i,type:n,listener:s}=C0(this,t,"any");if(e)Pl(i,"any",n,s);else{const o=(...l)=>{this.off(i,n,o),s.apply(null,l)};o.guid=s.guid,Pl(i,"any",n,o)}},off(t,e,i){if(!t||hy(t))Rn(this.eventBusEl_,t,e);else{const n=t,s=e;Xf(n,this,"off"),RD(s,this,"off"),MD(i,this,"off"),i=hi(this,i),this.off("dispose",i),n.nodeName?(Rn(n,s,i),Rn(n,"dispose",i)):Ja(n)&&(n.off(s,i),n.off("dispose",i))}},trigger(t,e){Xf(this.eventBusEl_,this,"trigger");const i=t&&typeof t!="string"?t.type:t;if(!hy(i))throw new Error(`Invalid event type for ${Ep(this)}#trigger; must be a non-empty string or object with a type key that has a non-empty value.`);return Tc(this.eventBusEl_,t,e)}};function y_(t,e={}){const{eventBusKey:i}=e;if(i){if(!t[i].nodeName)throw new Error(`The eventBusKey "${i}" does not refer to an element.`);t.eventBusEl_=t[i]}else t.eventBusEl_=ut("span",{className:"vjs-event-bus"});return Object.assign(t,nM),t.eventedCallbacks&&t.eventedCallbacks.forEach(n=>{n()}),t.on("dispose",()=>{t.off(),[t,t.el_,t.eventBusEl_].forEach(function(n){n&&Gn.has(n)&&Gn.delete(n)}),te.setTimeout(()=>{t.eventBusEl_=null},0)}),t}const rM={state:{},setState(t){typeof t=="function"&&(t=t());let e;return Zu(t,(i,n)=>{this.state[n]!==i&&(e=e||{},e[n]={from:this.state[n],to:i}),this.state[n]=i}),e&&Ja(this)&&this.trigger({changes:e,type:"statechanged"}),e}};function ND(t,e){return Object.assign(t,rM),t.state=Object.assign({},t.state,e),typeof t.handleStateChanged=="function"&&Ja(t)&&t.on("statechanged",t.handleStateChanged),t}const Hd=function(t){return typeof t!="string"?t:t.replace(/./,e=>e.toLowerCase())},Oi=function(t){return typeof t!="string"?t:t.replace(/./,e=>e.toUpperCase())},BD=function(t,e){return Oi(t)===Oi(e)};var sM=Object.freeze({__proto__:null,toLowerCase:Hd,toTitleCase:Oi,titleCaseEquals:BD});class Oe{constructor(e,i,n){if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=ni({},this.options_),i=this.options_=ni(this.options_,i),this.id_=i.id||i.el&&i.el.id,!this.id_){const s=e&&e.id&&e.id()||"no_player";this.id_=`${s}_component_${es()}`}this.name_=i.name||null,i.el?this.el_=i.el:i.createEl!==!1&&(this.el_=this.createEl()),i.className&&this.el_&&i.className.split(" ").forEach(s=>this.addClass(s)),["on","off","one","any","trigger"].forEach(s=>{this[s]=void 0}),i.evented!==!1&&(y_(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),ND(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Set,this.setIntervalIds_=new Set,this.rafIds_=new Set,this.namedRafs_=new Map,this.clearingTimersOnDispose_=!1,i.initChildren!==!1&&this.initChildren(),this.ready(n),i.reportTouchActivity!==!1&&this.enableTouchActivity()}dispose(e={}){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(let i=this.children_.length-1;i>=0;i--)this.children_[i].dispose&&this.children_[i].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(e.restoreEl?this.el_.parentNode.replaceChild(e.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}}isDisposed(){return!!this.isDisposed_}player(){return this.player_}options(e){return e?(this.options_=ni(this.options_,e),this.options_):this.options_}el(){return this.el_}createEl(e,i,n){return ut(e,i,n)}localize(e,i,n=e){const s=this.player_.language&&this.player_.language(),o=this.player_.languages&&this.player_.languages(),l=o&&o[s],c=s&&s.split("-")[0],h=o&&o[c];let f=n;return l&&l[e]?f=l[e]:h&&h[e]&&(f=h[e]),i&&(f=f.replace(/\{(\d+)\}/g,function(m,_){const E=i[_-1];let w=E;return typeof E>"u"&&(w=m),w})),f}handleLanguagechange(){}contentEl(){return this.contentEl_||this.el_}id(){return this.id_}name(){return this.name_}children(){return this.children_}getChildById(e){return this.childIndex_[e]}getChild(e){if(e)return this.childNameIndex_[e]}getDescendant(...e){e=e.reduce((n,s)=>n.concat(s),[]);let i=this;for(let n=0;n<e.length;n++)if(i=i.getChild(e[n]),!i||!i.getChild)return;return i}setIcon(e,i=this.el()){if(!this.player_.options_.experimentalSvgIcons)return;const n="http://www.w3.org/2000/svg",s=ut("span",{className:"vjs-icon-placeholder vjs-svg-icon"},{"aria-hidden":"true"}),o=Fe.createElementNS(n,"svg");o.setAttributeNS(null,"viewBox","0 0 512 512");const l=Fe.createElementNS(n,"use");return o.appendChild(l),l.setAttributeNS(null,"href",`#vjs-icon-${e}`),s.appendChild(o),this.iconIsSet_?i.replaceChild(s,i.querySelector(".vjs-icon-placeholder")):i.appendChild(s),this.iconIsSet_=!0,s}addChild(e,i={},n=this.children_.length){let s,o;if(typeof e=="string"){o=Oi(e);const l=i.componentClass||o;i.name=o;const c=Oe.getComponent(l);if(!c)throw new Error(`Component ${l} does not exist`);if(typeof c!="function")return null;s=new c(this.player_||this,i)}else s=e;if(s.parentComponent_&&s.parentComponent_.removeChild(s),this.children_.splice(n,0,s),s.parentComponent_=this,typeof s.id=="function"&&(this.childIndex_[s.id()]=s),o=o||s.name&&Oi(s.name()),o&&(this.childNameIndex_[o]=s,this.childNameIndex_[Hd(o)]=s),typeof s.el=="function"&&s.el()){let l=null;this.children_[n+1]&&(this.children_[n+1].el_?l=this.children_[n+1].el_:bc(this.children_[n+1])&&(l=this.children_[n+1])),this.contentEl().insertBefore(s.el(),l)}return s}removeChild(e){if(typeof e=="string"&&(e=this.getChild(e)),!e||!this.children_)return;let i=!1;for(let s=this.children_.length-1;s>=0;s--)if(this.children_[s]===e){i=!0,this.children_.splice(s,1);break}if(!i)return;e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[Oi(e.name())]=null,this.childNameIndex_[Hd(e.name())]=null;const n=e.el();n&&n.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}initChildren(){const e=this.options_.children;if(e){const i=this.options_,n=l=>{const c=l.name;let h=l.opts;if(i[c]!==void 0&&(h=i[c]),h===!1)return;h===!0&&(h={}),h.playerOptions=this.options_.playerOptions;const f=this.addChild(c,h);f&&(this[c]=f)};let s;const o=Oe.getComponent("Tech");Array.isArray(e)?s=e:s=Object.keys(e),s.concat(Object.keys(this.options_).filter(function(l){return!s.some(function(c){return typeof c=="string"?l===c:l===c.name})})).map(l=>{let c,h;return typeof l=="string"?(c=l,h=e[c]||this.options_[c]||{}):(c=l.name,h=l),{name:c,opts:h}}).filter(l=>{const c=Oe.getComponent(l.opts.componentClass||Oi(l.name));return c&&!o.isTech(c)}).forEach(n)}}buildCSSClass(){return""}ready(e,i=!1){if(e){if(!this.isReady_){this.readyQueue_=this.readyQueue_||[],this.readyQueue_.push(e);return}i?e.call(this):this.setTimeout(e,1)}}triggerReady(){this.isReady_=!0,this.setTimeout(function(){const e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach(function(i){i.call(this)},this),this.trigger("ready")},1)}$(e,i){return tl(e,i||this.contentEl())}$$(e,i){return CD(e,i||this.contentEl())}hasClass(e){return jd(this.el_,e)}addClass(...e){Yl(this.el_,...e)}removeClass(...e){vp(this.el_,...e)}toggleClass(e,i){_D(this.el_,e,i)}show(){this.removeClass("vjs-hidden")}hide(){this.addClass("vjs-hidden")}lockShowing(){this.addClass("vjs-lock-showing")}unlockShowing(){this.removeClass("vjs-lock-showing")}getAttribute(e){return bD(this.el_,e)}setAttribute(e,i){pc(this.el_,e,i)}removeAttribute(e){bp(this.el_,e)}width(e,i){return this.dimension("width",e,i)}height(e,i){return this.dimension("height",e,i)}dimensions(e,i){this.width(e,!0),this.height(i)}dimension(e,i,n){if(i!==void 0){(i===null||i!==i)&&(i=0),(""+i).indexOf("%")!==-1||(""+i).indexOf("px")!==-1?this.el_.style[e]=i:i==="auto"?this.el_.style[e]="":this.el_.style[e]=i+"px",n||this.trigger("componentresize");return}if(!this.el_)return 0;const s=this.el_.style[e],o=s.indexOf("px");return parseInt(o!==-1?s.slice(0,o):this.el_["offset"+Oi(e)],10)}currentDimension(e){let i=0;if(e!=="width"&&e!=="height")throw new Error("currentDimension only accepts width or height value");if(i=gc(this.el_,e),i=parseFloat(i),i===0||isNaN(i)){const n=`offset${Oi(e)}`;i=this.el_[n]}return i}currentDimensions(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}}currentWidth(){return this.currentDimension("width")}currentHeight(){return this.currentDimension("height")}getPositions(){const e=this.el_.getBoundingClientRect(),i={x:e.x,y:e.y,width:e.width,height:e.height,top:e.top,right:e.right,bottom:e.bottom,left:e.left},n={x:e.left+e.width/2,y:e.top+e.height/2,width:0,height:0,top:e.top+e.height/2,right:e.left+e.width/2,bottom:e.top+e.height/2,left:e.left+e.width/2};return{boundingClientRect:i,center:n}}focus(){this.el_.focus()}blur(){this.el_.blur()}handleKeyDown(e){this.player_&&(e.key!=="Tab"&&!(this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled)&&e.stopPropagation(),this.player_.handleKeyDown(e))}handleKeyPress(e){this.handleKeyDown(e)}emitTapEvents(){let e=0,i=null;const n=10,s=200;let o;this.on("touchstart",function(c){c.touches.length===1&&(i={pageX:c.touches[0].pageX,pageY:c.touches[0].pageY},e=te.performance.now(),o=!0)}),this.on("touchmove",function(c){if(c.touches.length>1)o=!1;else if(i){const h=c.touches[0].pageX-i.pageX,f=c.touches[0].pageY-i.pageY;Math.sqrt(h*h+f*f)>n&&(o=!1)}});const l=function(){o=!1};this.on("touchleave",l),this.on("touchcancel",l),this.on("touchend",function(c){i=null,o===!0&&te.performance.now()-e<s&&(c.preventDefault(),this.trigger("tap"))})}enableTouchActivity(){if(!this.player()||!this.player().reportUserActivity)return;const e=hi(this.player(),this.player().reportUserActivity);let i;this.on("touchstart",function(){e(),this.clearInterval(i),i=this.setInterval(e,250)});const n=function(s){e(),this.clearInterval(i)};this.on("touchmove",e),this.on("touchend",n),this.on("touchcancel",n)}setTimeout(e,i){var n;return e=hi(this,e),this.clearTimersOnDispose_(),n=te.setTimeout(()=>{this.setTimeoutIds_.has(n)&&this.setTimeoutIds_.delete(n),e()},i),this.setTimeoutIds_.add(n),n}clearTimeout(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),te.clearTimeout(e)),e}setInterval(e,i){e=hi(this,e),this.clearTimersOnDispose_();const n=te.setInterval(e,i);return this.setIntervalIds_.add(n),n}clearInterval(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),te.clearInterval(e)),e}requestAnimationFrame(e){this.clearTimersOnDispose_();var i;return e=hi(this,e),i=te.requestAnimationFrame(()=>{this.rafIds_.has(i)&&this.rafIds_.delete(i),e()}),this.rafIds_.add(i),i}requestNamedAnimationFrame(e,i){this.namedRafs_.has(e)&&this.cancelNamedAnimationFrame(e),this.clearTimersOnDispose_(),i=hi(this,i);const n=this.requestAnimationFrame(()=>{i(),this.namedRafs_.has(e)&&this.namedRafs_.delete(e)});return this.namedRafs_.set(e,n),e}cancelNamedAnimationFrame(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))}cancelAnimationFrame(e){return this.rafIds_.has(e)&&(this.rafIds_.delete(e),te.cancelAnimationFrame(e)),e}clearTimersOnDispose_(){this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",()=>{[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(([e,i])=>{this[e].forEach((n,s)=>this[i](s))}),this.clearingTimersOnDispose_=!1}))}getIsDisabled(){return!!this.el_.disabled}getIsExpresslyInert(){return this.el_.inert&&!this.el_.ownerDocument.documentElement.inert}getIsFocusable(e){return(e||this.el_).tabIndex>=0&&!(this.getIsDisabled()||this.getIsExpresslyInert())}getIsAvailableToBeFocused(e){function i(o){const l=te.getComputedStyle(o,null),c=l.getPropertyValue("visibility");return l.getPropertyValue("display")!=="none"&&!["hidden","collapse"].includes(c)}function n(o){return!(!i(o.parentElement)||!i(o)||o.style.opacity==="0"||te.getComputedStyle(o).height==="0px"||te.getComputedStyle(o).width==="0px")}function s(o){if(o.offsetWidth+o.offsetHeight+o.getBoundingClientRect().height+o.getBoundingClientRect().width===0)return!1;const l={x:o.getBoundingClientRect().left+o.offsetWidth/2,y:o.getBoundingClientRect().top+o.offsetHeight/2};if(l.x<0||l.x>(Fe.documentElement.clientWidth||te.innerWidth)||l.y<0||l.y>(Fe.documentElement.clientHeight||te.innerHeight))return!1;let c=Fe.elementFromPoint(l.x,l.y);for(;c;){if(c===o)return!0;if(c.parentNode)c=c.parentNode;else return!1}}return e||(e=this.el()),!!(s(e)&&n(e)&&(!e.parentElement||e.tabIndex>=0))}static registerComponent(e,i){if(typeof e!="string"||!e)throw new Error(`Illegal component name, "${e}"; must be a non-empty string.`);const n=Oe.getComponent("Tech"),s=n&&n.isTech(i),o=Oe===i||Oe.prototype.isPrototypeOf(i.prototype);if(s||!o){let c;throw s?c="techs must be registered using Tech.registerTech()":c="must be a Component subclass",new Error(`Illegal component, "${e}"; ${c}.`)}e=Oi(e),Oe.components_||(Oe.components_={});const l=Oe.getComponent("Player");if(e==="Player"&&l&&l.players){const c=l.players,h=Object.keys(c);if(c&&h.length>0){for(let f=0;f<h.length;f++)if(c[h[f]]!==null)throw new Error("Can not register Player component after player has been created.")}}return Oe.components_[e]=i,Oe.components_[Hd(e)]=i,i}static getComponent(e){if(!(!e||!Oe.components_))return Oe.components_[e]}}Oe.registerComponent("Component",Oe);function aM(t,e,i){if(typeof e!="number"||e<0||e>i)throw new Error(`Failed to execute '${t}' on 'TimeRanges': The index provided (${e}) is non-numeric or out of bounds (0-${i}).`)}function dw(t,e,i,n){return aM(t,n,i.length-1),i[n][e]}function A0(t){let e;return t===void 0||t.length===0?e={length:0,start(){throw new Error("This TimeRanges object is empty")},end(){throw new Error("This TimeRanges object is empty")}}:e={length:t.length,start:dw.bind(null,"start",0,t),end:dw.bind(null,"end",1,t)},te.Symbol&&te.Symbol.iterator&&(e[te.Symbol.iterator]=()=>(t||[]).values()),e}function $s(t,e){return Array.isArray(t)?A0(t):t===void 0||e===void 0?A0():A0([[t,e]])}const LD=function(t,e){t=t<0?0:t;let i=Math.floor(t%60),n=Math.floor(t/60%60),s=Math.floor(t/3600);const o=Math.floor(e/60%60),l=Math.floor(e/3600);return(isNaN(t)||t===1/0)&&(s=n=i="-"),s=s>0||l>0?s+":":"",n=((s||o>=10)&&n<10?"0"+n:n)+":",i=i<10?"0"+i:i,s+n+i};let __=LD;function UD(t){__=t}function PD(){__=LD}function nu(t,e=t){return __(t,e)}var oM=Object.freeze({__proto__:null,createTimeRanges:$s,createTimeRange:$s,setFormatTime:UD,resetFormatTime:PD,formatTime:nu});function zD(t,e){let i=0,n,s;if(!e)return 0;(!t||!t.length)&&(t=$s(0,0));for(let o=0;o<t.length;o++)n=t.start(o),s=t.end(o),s>e&&(s=e),i+=s-n;return i/e}function Ei(t){if(t instanceof Ei)return t;typeof t=="number"?this.code=t:typeof t=="string"?this.message=t:la(t)&&(typeof t.code=="number"&&(this.code=t.code),Object.assign(this,t)),this.message||(this.message=Ei.defaultMessages[this.code]||"")}Ei.prototype.code=0;Ei.prototype.message="";Ei.prototype.status=null;Ei.prototype.metadata=null;Ei.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"];Ei.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};Ei.MEDIA_ERR_CUSTOM=0;Ei.prototype.MEDIA_ERR_CUSTOM=0;Ei.MEDIA_ERR_ABORTED=1;Ei.prototype.MEDIA_ERR_ABORTED=1;Ei.MEDIA_ERR_NETWORK=2;Ei.prototype.MEDIA_ERR_NETWORK=2;Ei.MEDIA_ERR_DECODE=3;Ei.prototype.MEDIA_ERR_DECODE=3;Ei.MEDIA_ERR_SRC_NOT_SUPPORTED=4;Ei.prototype.MEDIA_ERR_SRC_NOT_SUPPORTED=4;Ei.MEDIA_ERR_ENCRYPTED=5;Ei.prototype.MEDIA_ERR_ENCRYPTED=5;function Vd(t){return t!=null&&typeof t.then=="function"}function na(t){Vd(t)&&t.then(null,e=>{})}const fy=function(t){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce((i,n,s)=>(t[n]&&(i[n]=t[n]),i),{cues:t.cues&&Array.prototype.map.call(t.cues,function(i){return{startTime:i.startTime,endTime:i.endTime,text:i.text,id:i.id}})})},lM=function(t){const e=t.$$("track"),i=Array.prototype.map.call(e,s=>s.track);return Array.prototype.map.call(e,function(s){const o=fy(s.track);return s.src&&(o.src=s.src),o}).concat(Array.prototype.filter.call(t.textTracks(),function(s){return i.indexOf(s)===-1}).map(fy))},uM=function(t,e){return t.forEach(function(i){const n=e.addRemoteTextTrack(i).track;!i.src&&i.cues&&i.cues.forEach(s=>n.addCue(s))}),e.textTracks()};var py={textTracksToJson:lM,jsonToTextTracks:uM,trackToJson:fy};const D0="vjs-modal-dialog";class xc extends Oe{constructor(e,i){super(e,i),this.handleKeyDown_=n=>this.handleKeyDown(n),this.close_=n=>this.close(n),this.opened_=this.hasBeenOpened_=this.hasBeenFilled_=!1,this.closeable(!this.options_.uncloseable),this.content(this.options_.content),this.contentEl_=ut("div",{className:`${D0}-content`},{role:"document"}),this.descEl_=ut("p",{className:`${D0}-description vjs-control-text`,id:this.el().getAttribute("aria-describedby")}),nl(this.descEl_,this.description()),this.el_.appendChild(this.descEl_),this.el_.appendChild(this.contentEl_)}createEl(){return super.createEl("div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":`${this.id()}_description`,"aria-hidden":"true","aria-label":this.label(),role:"dialog","aria-live":"polite"})}dispose(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,super.dispose()}buildCSSClass(){return`${D0} vjs-hidden ${super.buildCSSClass()}`}label(){return this.localize(this.options_.label||"Modal Window")}description(){let e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e}open(){if(this.opened_){this.options_.fillAlways&&this.fill();return}const e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}opened(e){return typeof e=="boolean"&&this[e?"open":"close"](),this.opened_}close(){if(!this.opened_)return;const e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger({type:"modalclose",bubbles:!0}),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}closeable(e){if(typeof e=="boolean"){const i=this.closeable_=!!e;let n=this.getChild("closeButton");if(i&&!n){const s=this.contentEl_;this.contentEl_=this.el_,n=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=s,this.on(n,"close",this.close_)}!i&&n&&(this.off(n,"close",this.close_),this.removeChild(n),n.dispose())}return this.closeable_}fill(){this.fillWith(this.content())}fillWith(e){const i=this.contentEl(),n=i.parentNode,s=i.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,n.removeChild(i),this.empty(),ED(i,e),this.trigger("modalfill"),s?n.insertBefore(i,s):n.appendChild(i);const o=this.getChild("closeButton");o&&n.appendChild(o.el_),this.trigger("aftermodalfill")}empty(){this.trigger("beforemodalempty"),xp(this.contentEl()),this.trigger("modalempty")}content(e){return typeof e<"u"&&(this.content_=e),this.content_}conditionalFocus_(){const e=Fe.activeElement,i=this.player_.el_;this.previouslyActiveEl_=null,(i.contains(e)||i===e)&&(this.previouslyActiveEl_=e,this.focus())}conditionalBlur_(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)}handleKeyDown(e){if(this.trigger({type:"modalKeydown",originalEvent:e,target:this,bubbles:!0}),e.stopPropagation(),e.key==="Escape"&&this.closeable()){e.preventDefault(),this.close();return}if(e.key!=="Tab")return;const i=this.focusableEls_(),n=this.el_.querySelector(":focus");let s;for(let o=0;o<i.length;o++)if(n===i[o]){s=o;break}Fe.activeElement===this.el_&&(s=0),e.shiftKey&&s===0?(i[i.length-1].focus(),e.preventDefault()):!e.shiftKey&&s===i.length-1&&(i[0].focus(),e.preventDefault())}focusableEls_(){const e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,i=>(i instanceof te.HTMLAnchorElement||i instanceof te.HTMLAreaElement)&&i.hasAttribute("href")||(i instanceof te.HTMLInputElement||i instanceof te.HTMLSelectElement||i instanceof te.HTMLTextAreaElement||i instanceof te.HTMLButtonElement)&&!i.hasAttribute("disabled")||i instanceof te.HTMLIFrameElement||i instanceof te.HTMLObjectElement||i instanceof te.HTMLEmbedElement||i.hasAttribute("tabindex")&&i.getAttribute("tabindex")!==-1||i.hasAttribute("contenteditable"))}}xc.prototype.options_={pauseOnOpen:!0,temporary:!0};Oe.registerComponent("ModalDialog",xc);class ru extends Ir{constructor(e=[]){super(),this.tracks_=[],Object.defineProperty(this,"length",{get(){return this.tracks_.length}});for(let i=0;i<e.length;i++)this.addTrack(e[i])}addTrack(e){const i=this.tracks_.length;""+i in this||Object.defineProperty(this,i,{get(){return this.tracks_[i]}}),this.tracks_.indexOf(e)===-1&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=()=>{this.trigger({track:e,type:"labelchange",target:this})},Ja(e)&&e.addEventListener("labelchange",e.labelchange_)}removeTrack(e){let i;for(let n=0,s=this.length;n<s;n++)if(this[n]===e){i=this[n],i.off&&i.off(),this.tracks_.splice(n,1);break}i&&this.trigger({track:i,type:"removetrack",target:this})}getTrackById(e){let i=null;for(let n=0,s=this.length;n<s;n++){const o=this[n];if(o.id===e){i=o;break}}return i}}ru.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(const t in ru.prototype.allowedEvents_)ru.prototype["on"+t]=null;const k0=function(t,e){for(let i=0;i<t.length;i++)!Object.keys(t[i]).length||e.id===t[i].id||(t[i].enabled=!1)};class FD extends ru{constructor(e=[]){for(let i=e.length-1;i>=0;i--)if(e[i].enabled){k0(e,e[i]);break}super(e),this.changing_=!1}addTrack(e){e.enabled&&k0(this,e),super.addTrack(e),e.addEventListener&&(e.enabledChange_=()=>{this.changing_||(this.changing_=!0,k0(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("enabledchange",e.enabledChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener("enabledchange",e.enabledChange_),e.enabledChange_=null)}}const $0=function(t,e){for(let i=0;i<t.length;i++)!Object.keys(t[i]).length||e.id===t[i].id||(t[i].selected=!1)};class qD extends ru{constructor(e=[]){for(let i=e.length-1;i>=0;i--)if(e[i].selected){$0(e,e[i]);break}super(e),this.changing_=!1,Object.defineProperty(this,"selectedIndex",{get(){for(let i=0;i<this.length;i++)if(this[i].selected)return i;return-1},set(){}})}addTrack(e){e.selected&&$0(this,e),super.addTrack(e),e.addEventListener&&(e.selectedChange_=()=>{this.changing_||(this.changing_=!0,$0(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("selectedchange",e.selectedChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener("selectedchange",e.selectedChange_),e.selectedChange_=null)}}class v_ extends ru{addTrack(e){super.addTrack(e),this.queueChange_||(this.queueChange_=()=>this.queueTrigger("change")),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=()=>this.trigger("selectedlanguagechange")),e.addEventListener("modechange",this.queueChange_),["metadata","chapters"].indexOf(e.kind)===-1&&e.addEventListener("modechange",this.triggerSelectedlanguagechange_)}removeTrack(e){super.removeTrack(e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener("modechange",this.triggerSelectedlanguagechange_))}toJSON(){return this.tracks_.map(e=>e.toJSON())}}class cM{constructor(e=[]){this.trackElements_=[],Object.defineProperty(this,"length",{get(){return this.trackElements_.length}});for(let i=0,n=e.length;i<n;i++)this.addTrackElement_(e[i])}addTrackElement_(e){const i=this.trackElements_.length;""+i in this||Object.defineProperty(this,i,{get(){return this.trackElements_[i]}}),this.trackElements_.indexOf(e)===-1&&this.trackElements_.push(e)}getTrackElementByTrack_(e){let i;for(let n=0,s=this.trackElements_.length;n<s;n++)if(e===this.trackElements_[n].track){i=this.trackElements_[n];break}return i}removeTrackElement_(e){for(let i=0,n=this.trackElements_.length;i<n;i++)if(e===this.trackElements_[i]){this.trackElements_[i].track&&typeof this.trackElements_[i].track.off=="function"&&this.trackElements_[i].track.off(),typeof this.trackElements_[i].off=="function"&&this.trackElements_[i].off(),this.trackElements_.splice(i,1);break}}}class Kf{constructor(e){Kf.prototype.setCues_.call(this,e),Object.defineProperty(this,"length",{get(){return this.length_}})}setCues_(e){const i=this.length||0;let n=0;const s=e.length;this.cues_=e,this.length_=e.length;const o=function(l){""+l in this||Object.defineProperty(this,""+l,{get(){return this.cues_[l]}})};if(i<s)for(n=i;n<s;n++)o.call(this,n)}getCueById(e){let i=null;for(let n=0,s=this.length;n<s;n++){const o=this[n];if(o.id===e){i=o;break}}return i}}const dM={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},hM={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},fM={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},hw={disabled:"disabled",hidden:"hidden",showing:"showing"};class b_ extends Ir{constructor(e={}){super();const i={id:e.id||"vjs_track_"+es(),kind:e.kind||"",language:e.language||""};let n=e.label||"";for(const s in i)Object.defineProperty(this,s,{get(){return i[s]},set(){}});Object.defineProperty(this,"label",{get(){return n},set(s){s!==n&&(n=s,this.trigger("labelchange"))}})}}const T_=function(t){return new URL(t,Fe.baseURI)},jD=function(t){return new URL(t,Fe.baseURI).href},x_=function(t){if(typeof t=="string"){const i=t.split("?")[0].replace(/\/+$/,"").match(/\.([^.\/]+)$/);return i?i[1].toLowerCase():""}return""},Cp=function(t,e=te.location){return T_(t).origin!==e.origin};var pM=Object.freeze({__proto__:null,parseUrl:T_,getAbsoluteURL:jD,getFileExtension:x_,isCrossOrigin:Cp});const fw=function(t,e){const i=new te.WebVTT.Parser(te,te.vttjs,te.WebVTT.StringDecoder()),n=[];i.oncue=function(s){e.addCue(s)},i.onparsingerror=function(s){n.push(s)},i.onflush=function(){e.trigger({type:"loadeddata",target:e})},i.parse(t),n.length>0&&(te.console&&te.console.groupCollapsed&&te.console.groupCollapsed(`Text Track parsing errors for ${e.src}`),n.forEach(s=>St.error(s)),te.console&&te.console.groupEnd&&te.console.groupEnd()),i.flush()},pw=function(t,e){const i={uri:t},n=Cp(t);n&&(i.cors=n);const s=e.tech_.crossOrigin()==="use-credentials";s&&(i.withCredentials=s),V3(i,hi(this,function(o,l,c){if(o)return St.error(o,l);e.loaded_=!0,typeof te.WebVTT!="function"?e.tech_&&e.tech_.any(["vttjsloaded","vttjserror"],h=>{if(h.type==="vttjserror"){St.error(`vttjs failed to load, stopping trying to process ${e.src}`);return}return fw(c,e)}):fw(c,e)}))};class nh extends b_{constructor(e={}){if(!e.tech)throw new Error("A tech was not provided.");const i=ni(e,{kind:fM[e.kind]||"subtitles",language:e.language||e.srclang||""});let n=hw[i.mode]||"disabled";const s=i.default;(i.kind==="metadata"||i.kind==="chapters")&&(n="hidden"),super(i),this.tech_=i.tech,this.cues_=[],this.activeCues_=[],this.preload_=this.tech_.preloadTextTracks!==!1;const o=new Kf(this.cues_),l=new Kf(this.activeCues_);let c=!1;this.timeupdateHandler=hi(this,function(f={}){if(!this.tech_.isDisposed()){if(!this.tech_.isReady_){f.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler));return}this.activeCues=this.activeCues,c&&(this.trigger("cuechange"),c=!1),f.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))}});const h=()=>{this.stopTracking()};this.tech_.one("dispose",h),n!=="disabled"&&this.startTracking(),Object.defineProperties(this,{default:{get(){return s},set(){}},mode:{get(){return n},set(f){hw[f]&&n!==f&&(n=f,!this.preload_&&n!=="disabled"&&this.cues.length===0&&pw(this.src,this),this.stopTracking(),n!=="disabled"&&this.startTracking(),this.trigger("modechange"))}},cues:{get(){return this.loaded_?o:null},set(){}},activeCues:{get(){if(!this.loaded_)return null;if(this.cues.length===0)return l;const f=this.tech_.currentTime(),m=[];for(let _=0,E=this.cues.length;_<E;_++){const w=this.cues[_];w.startTime<=f&&w.endTime>=f&&m.push(w)}if(c=!1,m.length!==this.activeCues_.length)c=!0;else for(let _=0;_<m.length;_++)this.activeCues_.indexOf(m[_])===-1&&(c=!0);return this.activeCues_=m,l.setCues_(this.activeCues_),l},set(){}}}),i.src?(this.src=i.src,this.preload_||(this.loaded_=!0),(this.preload_||i.kind!=="subtitles"&&i.kind!=="captions")&&pw(this.src,this)):this.loaded_=!0}startTracking(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)}stopTracking(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)}addCue(e){let i=e;if(!("getCueAsHTML"in i)){i=new te.vttjs.VTTCue(e.startTime,e.endTime,e.text);for(const s in e)s in i||(i[s]=e[s]);i.id=e.id,i.originalCue_=e}const n=this.tech_.textTracks();for(let s=0;s<n.length;s++)n[s]!==this&&n[s].removeCue(i);this.cues_.push(i),this.cues.setCues_(this.cues_)}toJSON(){return py.trackToJson(this)}removeCue(e){let i=this.cues_.length;for(;i--;){const n=this.cues_[i];if(n===e||n.originalCue_&&n.originalCue_===e){this.cues_.splice(i,1),this.cues.setCues_(this.cues_);break}}}}nh.prototype.allowedEvents_={cuechange:"cuechange"};class HD extends b_{constructor(e={}){const i=ni(e,{kind:hM[e.kind]||""});super(i);let n=!1;Object.defineProperty(this,"enabled",{get(){return n},set(s){typeof s!="boolean"||s===n||(n=s,this.trigger("enabledchange"))}}),i.enabled&&(this.enabled=i.enabled),this.loaded_=!0}}class VD extends b_{constructor(e={}){const i=ni(e,{kind:dM[e.kind]||""});super(i);let n=!1;Object.defineProperty(this,"selected",{get(){return n},set(s){typeof s!="boolean"||s===n||(n=s,this.trigger("selectedchange"))}}),i.selected&&(this.selected=i.selected)}}class eo extends Ir{constructor(e={}){super();let i;const n=new nh(e);this.kind=n.kind,this.src=n.src,this.srclang=n.language,this.label=n.label,this.default=n.default,Object.defineProperties(this,{readyState:{get(){return i}},track:{get(){return n}}}),i=eo.NONE,n.addEventListener("loadeddata",()=>{i=eo.LOADED,this.trigger({type:"load",target:this})})}}eo.prototype.allowedEvents_={load:"load"};eo.NONE=0;eo.LOADING=1;eo.LOADED=2;eo.ERROR=3;const Jr={audio:{ListClass:FD,TrackClass:HD,capitalName:"Audio"},video:{ListClass:qD,TrackClass:VD,capitalName:"Video"},text:{ListClass:v_,TrackClass:nh,capitalName:"Text"}};Object.keys(Jr).forEach(function(t){Jr[t].getterName=`${t}Tracks`,Jr[t].privateName=`${t}Tracks_`});const yc={remoteText:{ListClass:v_,TrackClass:nh,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:cM,TrackClass:eo,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},Vn=Object.assign({},Jr,yc);yc.names=Object.keys(yc);Jr.names=Object.keys(Jr);Vn.names=[].concat(yc.names).concat(Jr.names);function mM(t,e,i,n,s={}){const o=t.textTracks();s.kind=e,i&&(s.label=i),n&&(s.language=n),s.tech=t;const l=new Vn.text.TrackClass(s);return o.addTrack(l),l}class _t extends Oe{constructor(e={},i=function(){}){e.reportTouchActivity=!1,super(null,e,i),this.onDurationChange_=n=>this.onDurationChange(n),this.trackProgress_=n=>this.trackProgress(n),this.trackCurrentTime_=n=>this.trackCurrentTime(n),this.stopTrackingCurrentTime_=n=>this.stopTrackingCurrentTime(n),this.disposeSourceHandler_=n=>this.disposeSourceHandler(n),this.queuedHanders_=new Set,this.hasStarted_=!1,this.on("playing",function(){this.hasStarted_=!0}),this.on("loadstart",function(){this.hasStarted_=!1}),Vn.names.forEach(n=>{const s=Vn[n];e&&e[s.getterName]&&(this[s.privateName]=e[s.getterName])}),this.featuresProgressEvents||this.manualProgressOn(),this.featuresTimeupdateEvents||this.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(n=>{e[`native${n}Tracks`]===!1&&(this[`featuresNative${n}Tracks`]=!1)}),e.nativeCaptions===!1||e.nativeTextTracks===!1?this.featuresNativeTextTracks=!1:(e.nativeCaptions===!0||e.nativeTextTracks===!0)&&(this.featuresNativeTextTracks=!0),this.featuresNativeTextTracks||this.emulateTextTracks(),this.preloadTextTracks=e.preloadTextTracks!==!1,this.autoRemoteTextTracks_=new Vn.text.ListClass,this.initTrackListeners(),e.nativeControlsForTouch||this.emitTapEvents(),this.constructor&&(this.name_=this.constructor.name||"Unknown Tech")}triggerSourceset(e){this.isReady_||this.one("ready",()=>this.setTimeout(()=>this.triggerSourceset(e),1)),this.trigger({src:e,type:"sourceset"})}manualProgressOn(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)}manualProgressOff(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)}trackProgress(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(hi(this,function(){const i=this.bufferedPercent();this.bufferedPercent_!==i&&this.trigger("progress"),this.bufferedPercent_=i,i===1&&this.stopTrackingProgress()}),500)}onDurationChange(e){this.duration_=this.duration()}buffered(){return $s(0,0)}bufferedPercent(){return zD(this.buffered(),this.duration_)}stopTrackingProgress(){this.clearInterval(this.progressInterval)}manualTimeUpdatesOn(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)}manualTimeUpdatesOff(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)}trackCurrentTime(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)}stopTrackingCurrentTime(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}dispose(){this.clearTracks(Jr.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),super.dispose()}clearTracks(e){e=[].concat(e),e.forEach(i=>{const n=this[`${i}Tracks`]()||[];let s=n.length;for(;s--;){const o=n[s];i==="text"&&this.removeRemoteTextTrack(o),n.removeTrack(o)}})}cleanupAutoTextTracks(){const e=this.autoRemoteTextTracks_||[];let i=e.length;for(;i--;){const n=e[i];this.removeRemoteTextTrack(n)}}reset(){}crossOrigin(){}setCrossOrigin(){}error(e){return e!==void 0&&(this.error_=new Ei(e),this.trigger("error")),this.error_}played(){return this.hasStarted_?$s(0,0):$s()}play(){}setScrubbing(e){}scrubbing(){}setCurrentTime(e){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}initTrackListeners(){Jr.names.forEach(e=>{const i=Jr[e],n=()=>{this.trigger(`${e}trackchange`)},s=this[i.getterName]();s.addEventListener("removetrack",n),s.addEventListener("addtrack",n),this.on("dispose",()=>{s.removeEventListener("removetrack",n),s.removeEventListener("addtrack",n)})})}addWebVttScript_(){if(!te.WebVTT)if(Fe.body.contains(this.el())){if(!this.options_["vtt.js"]&&fc(US)&&Object.keys(US).length>0){this.trigger("vttjsloaded");return}const e=Fe.createElement("script");e.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",e.onload=()=>{this.trigger("vttjsloaded")},e.onerror=()=>{this.trigger("vttjserror")},this.on("dispose",()=>{e.onload=null,e.onerror=null}),te.WebVTT=!0,this.el().parentNode.appendChild(e)}else this.ready(this.addWebVttScript_)}emulateTextTracks(){const e=this.textTracks(),i=this.remoteTextTracks(),n=c=>e.addTrack(c.track),s=c=>e.removeTrack(c.track);i.on("addtrack",n),i.on("removetrack",s),this.addWebVttScript_();const o=()=>this.trigger("texttrackchange"),l=()=>{o();for(let c=0;c<e.length;c++){const h=e[c];h.removeEventListener("cuechange",o),h.mode==="showing"&&h.addEventListener("cuechange",o)}};l(),e.addEventListener("change",l),e.addEventListener("addtrack",l),e.addEventListener("removetrack",l),this.on("dispose",function(){i.off("addtrack",n),i.off("removetrack",s),e.removeEventListener("change",l),e.removeEventListener("addtrack",l),e.removeEventListener("removetrack",l);for(let c=0;c<e.length;c++)e[c].removeEventListener("cuechange",o)})}addTextTrack(e,i,n){if(!e)throw new Error("TextTrack kind is required but was not provided");return mM(this,e,i,n)}createRemoteTextTrack(e){const i=ni(e,{tech:this});return new yc.remoteTextEl.TrackClass(i)}addRemoteTextTrack(e={},i){const n=this.createRemoteTextTrack(e);return typeof i!="boolean"&&(i=!1),this.remoteTextTrackEls().addTrackElement_(n),this.remoteTextTracks().addTrack(n.track),i===!1&&this.ready(()=>this.autoRemoteTextTracks_.addTrack(n.track)),n}removeRemoteTextTrack(e){const i=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(i),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)}getVideoPlaybackQuality(){return{}}requestPictureInPicture(){return Promise.reject()}disablePictureInPicture(){return!0}setDisablePictureInPicture(){}requestVideoFrameCallback(e){const i=es();return!this.isReady_||this.paused()?(this.queuedHanders_.add(i),this.one("playing",()=>{this.queuedHanders_.has(i)&&(this.queuedHanders_.delete(i),e())})):this.requestNamedAnimationFrame(i,e),i}cancelVideoFrameCallback(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)}setPoster(){}playsinline(){}setPlaysinline(){}overrideNativeAudioTracks(e){}overrideNativeVideoTracks(e){}canPlayType(e){return""}static canPlayType(e){return""}static canPlaySource(e,i){return _t.canPlayType(e.type)}static isTech(e){return e.prototype instanceof _t||e instanceof _t||e===_t}static registerTech(e,i){if(_t.techs_||(_t.techs_={}),!_t.isTech(i))throw new Error(`Tech ${e} must be a Tech`);if(!_t.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!_t.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=Oi(e),_t.techs_[e]=i,_t.techs_[Hd(e)]=i,e!=="Tech"&&_t.defaultTechOrder_.push(e),i}static getTech(e){if(e){if(_t.techs_&&_t.techs_[e])return _t.techs_[e];if(e=Oi(e),te&&te.videojs&&te.videojs[e])return St.warn(`The ${e} tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)`),te.videojs[e]}}}Vn.names.forEach(function(t){const e=Vn[t];_t.prototype[e.getterName]=function(){return this[e.privateName]=this[e.privateName]||new e.ListClass,this[e.privateName]}});_t.prototype.featuresVolumeControl=!0;_t.prototype.featuresMuteControl=!0;_t.prototype.featuresFullscreenResize=!1;_t.prototype.featuresPlaybackRate=!1;_t.prototype.featuresProgressEvents=!1;_t.prototype.featuresSourceset=!1;_t.prototype.featuresTimeupdateEvents=!1;_t.prototype.featuresNativeTextTracks=!1;_t.prototype.featuresVideoFrameCallback=!1;_t.withSourceHandlers=function(t){t.registerSourceHandler=function(i,n){let s=t.sourceHandlers;s||(s=t.sourceHandlers=[]),n===void 0&&(n=s.length),s.splice(n,0,i)},t.canPlayType=function(i){const n=t.sourceHandlers||[];let s;for(let o=0;o<n.length;o++)if(s=n[o].canPlayType(i),s)return s;return""},t.selectSourceHandler=function(i,n){const s=t.sourceHandlers||[];let o;for(let l=0;l<s.length;l++)if(o=s[l].canHandleSource(i,n),o)return s[l];return null},t.canPlaySource=function(i,n){const s=t.selectSourceHandler(i,n);return s?s.canHandleSource(i,n):""},["seekable","seeking","duration"].forEach(function(i){const n=this[i];typeof n=="function"&&(this[i]=function(){return this.sourceHandler_&&this.sourceHandler_[i]?this.sourceHandler_[i].apply(this.sourceHandler_,arguments):n.apply(this,arguments)})},t.prototype),t.prototype.setSource=function(i){let n=t.selectSourceHandler(i,this.options_);n||(t.nativeSourceHandler?n=t.nativeSourceHandler:St.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),n!==t.nativeSourceHandler&&(this.currentSource_=i),this.sourceHandler_=n.handleSource(i,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},t.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}};Oe.registerComponent("Tech",_t);_t.registerTech("Tech",_t);_t.defaultTechOrder_=[];const Ql={},Yf={},Qf={};function gM(t,e){Ql[t]=Ql[t]||[],Ql[t].push(e)}function yM(t,e,i){t.setTimeout(()=>zl(e,Ql[e.type],i,t),1)}function _M(t,e){t.forEach(i=>i.setTech&&i.setTech(e))}function vM(t,e,i){return t.reduceRight(S_(i),e[i]())}function bM(t,e,i,n){return e[i](t.reduce(S_(i),n))}function mw(t,e,i,n=null){const s="call"+Oi(i),o=t.reduce(S_(s),n),l=o===Qf,c=l?null:e[i](o);return SM(t,i,c,l),c}const TM={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},xM={setCurrentTime:1,setMuted:1,setVolume:1},gw={play:1,pause:1};function S_(t){return(e,i)=>e===Qf?Qf:i[t]?i[t](e):e}function SM(t,e,i,n){for(let s=t.length-1;s>=0;s--){const o=t[s];o[e]&&o[e](n,i)}}function wM(t){Yf.hasOwnProperty(t.id())&&delete Yf[t.id()]}function EM(t,e){const i=Yf[t.id()];let n=null;if(i==null)return n=e(t),Yf[t.id()]=[[e,n]],n;for(let s=0;s<i.length;s++){const[o,l]=i[s];o===e&&(n=l)}return n===null&&(n=e(t),i.push([e,n])),n}function zl(t={},e=[],i,n,s=[],o=!1){const[l,...c]=e;if(typeof l=="string")zl(t,Ql[l],i,n,s,o);else if(l){const h=EM(n,l);if(!h.setSource)return s.push(h),zl(t,c,i,n,s,o);h.setSource(Object.assign({},t),function(f,m){if(f)return zl(t,c,i,n,s,o);s.push(h),zl(m,t.type===m.type?c:Ql[m.type],i,n,s,o)})}else c.length?zl(t,c,i,n,s,o):o?i(t,s):zl(t,Ql["*"],i,n,s,!0)}const CM={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},Zf=function(t=""){const e=x_(t);return CM[e.toLowerCase()]||""},AM=(t,e)=>{if(!e)return"";if(t.cache_.source.src===e&&t.cache_.source.type)return t.cache_.source.type;const i=t.cache_.sources.filter(s=>s.src===e);if(i.length)return i[0].type;const n=t.$$("source");for(let s=0;s<n.length;s++){const o=n[s];if(o.type&&o.src&&o.src===e)return o.type}return Zf(e)},GD=function(t){if(Array.isArray(t)){let e=[];t.forEach(function(i){i=GD(i),Array.isArray(i)?e=e.concat(i):la(i)&&e.push(i)}),t=e}else typeof t=="string"&&t.trim()?t=[yw({src:t})]:la(t)&&typeof t.src=="string"&&t.src&&t.src.trim()?t=[yw(t)]:t=[];return t};function yw(t){if(!t.type){const e=Zf(t.src);e&&(t.type=e)}return t}var DM=`<svg xmlns="http://www.w3.org/2000/svg">
  <defs>
    <symbol viewBox="0 0 48 48" id="vjs-icon-play">
      <path d="M16 10v28l22-14z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-pause">
      <path d="M12 38h8V10h-8v28zm16-28v28h8V10h-8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-audio">
      <path d="M24 2C14.06 2 6 10.06 6 20v14c0 3.31 2.69 6 6 6h6V24h-8v-4c0-7.73 6.27-14 14-14s14 6.27 14 14v4h-8v16h6c3.31 0 6-2.69 6-6V20c0-9.94-8.06-18-18-18z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-captions">
      <path d="M38 8H10c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM22 22h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2zm14 0h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-subtitles">
      <path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-enter">
      <path d="M14 28h-4v10h10v-4h-6v-6zm-4-8h4v-6h6v-4H10v10zm24 14h-6v4h10V28h-4v6zm-6-24v4h6v6h4V10H28z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-exit">
      <path d="M10 32h6v6h4V28H10v4zm6-16h-6v4h10V10h-4v6zm12 22h4v-6h6v-4H28v10zm4-22v-6h-4v10h10v-4h-6z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-play-circle">
      <path d="M20 33l12-9-12-9v18zm4-29C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-mute">
      <path d="M33 24c0-3.53-2.04-6.58-5-8.05v4.42l4.91 4.91c.06-.42.09-.85.09-1.28zm5 0c0 1.88-.41 3.65-1.08 5.28l3.03 3.03C41.25 29.82 42 27 42 24c0-8.56-5.99-15.72-14-17.54v4.13c5.78 1.72 10 7.07 10 13.41zM8.55 6L6 8.55 15.45 18H6v12h8l10 10V26.55l8.51 8.51c-1.34 1.03-2.85 1.86-4.51 2.36v4.13a17.94 17.94 0 0 0 7.37-3.62L39.45 42 42 39.45l-18-18L8.55 6zM24 8l-4.18 4.18L24 16.36V8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-low">
      <path d="M14 18v12h8l10 10V8L22 18h-8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-medium">
      <path d="M37 24c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zm-27-6v12h8l10 10V8L18 18h-8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-high">
      <path d="M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-spinner">
      <path d="M18.8 21l9.53-16.51C26.94 4.18 25.49 4 24 4c-4.8 0-9.19 1.69-12.64 4.51l7.33 12.69.11-.2zm24.28-3c-1.84-5.85-6.3-10.52-11.99-12.68L23.77 18h19.31zm.52 2H28.62l.58 1 9.53 16.5C41.99 33.94 44 29.21 44 24c0-1.37-.14-2.71-.4-4zm-26.53 4l-7.8-13.5C6.01 14.06 4 18.79 4 24c0 1.37.14 2.71.4 4h14.98l-2.31-4zM4.92 30c1.84 5.85 6.3 10.52 11.99 12.68L24.23 30H4.92zm22.54 0l-7.8 13.51c1.4.31 2.85.49 4.34.49 4.8 0 9.19-1.69 12.64-4.51L29.31 26.8 27.46 30z"></path>
    </symbol>
    <symbol viewBox="0 0 24 24" id="vjs-icon-hd">
      <path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-8 12H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm2-6h4c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1h-4V9zm1.5 4.5h2v-3h-2v3z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-chapters">
      <path d="M6 26h4v-4H6v4zm0 8h4v-4H6v4zm0-16h4v-4H6v4zm8 8h28v-4H14v4zm0 8h28v-4H14v4zm0-20v4h28v-4H14z"></path>
    </symbol>
    <symbol viewBox="0 0 40 40" id="vjs-icon-downloading">
      <path d="M18.208 36.875q-3.208-.292-5.979-1.729-2.771-1.438-4.812-3.729-2.042-2.292-3.188-5.229-1.146-2.938-1.146-6.23 0-6.583 4.334-11.416 4.333-4.834 10.833-5.5v3.166q-5.167.75-8.583 4.646Q6.25 14.75 6.25 19.958q0 5.209 3.396 9.104 3.396 3.896 8.562 4.646zM20 28.417L11.542 20l2.083-2.083 4.917 4.916v-11.25h2.916v11.25l4.875-4.916L28.417 20zm1.792 8.458v-3.167q1.833-.25 3.541-.958 1.709-.708 3.167-1.875l2.333 2.292q-1.958 1.583-4.25 2.541-2.291.959-4.791 1.167zm6.791-27.792q-1.541-1.125-3.25-1.854-1.708-.729-3.541-1.021V3.042q2.5.25 4.77 1.208 2.271.958 4.271 2.5zm4.584 21.584l-2.25-2.25q1.166-1.5 1.854-3.209.687-1.708.937-3.541h3.209q-.292 2.5-1.229 4.791-.938 2.292-2.521 4.209zm.541-12.417q-.291-1.833-.958-3.562-.667-1.73-1.833-3.188l2.375-2.208q1.541 1.916 2.458 4.208.917 2.292 1.167 4.75z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download">
      <path d="M10.8 40.55q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h26.35v-7.7h3.4v7.7q0 1.4-1 2.4t-2.4 1zM24 32.1L13.9 22.05l2.45-2.45 5.95 5.95V7.15h3.4v18.4l5.95-5.95 2.45 2.45z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-done">
      <path d="M9.8 40.5v-3.45h28.4v3.45zm9.2-9.05L7.4 19.85l2.45-2.35L19 26.65l19.2-19.2 2.4 2.4z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-off">
      <path d="M4.9 4.75L43.25 43.1 41 45.3l-4.75-4.75q-.05.05-.075.025-.025-.025-.075-.025H10.8q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h22.05l-7-7-1.85 1.8L13.9 21.9l1.85-1.85L2.7 7zm26.75 14.7l2.45 2.45-3.75 3.8-2.45-2.5zM25.7 7.15V21.1l-3.4-3.45V7.15z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-share">
      <path d="M36 32.17c-1.52 0-2.89.59-3.93 1.54L17.82 25.4c.11-.45.18-.92.18-1.4s-.07-.95-.18-1.4l14.1-8.23c1.07 1 2.5 1.62 4.08 1.62 3.31 0 6-2.69 6-6s-2.69-6-6-6-6 2.69-6 6c0 .48.07.95.18 1.4l-14.1 8.23c-1.07-1-2.5-1.62-4.08-1.62-3.31 0-6 2.69-6 6s2.69 6 6 6c1.58 0 3.01-.62 4.08-1.62l14.25 8.31c-.1.42-.16.86-.16 1.31A5.83 5.83 0 1 0 36 32.17z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-cog">
      <path d="M38.86 25.95c.08-.64.14-1.29.14-1.95s-.06-1.31-.14-1.95l4.23-3.31c.38-.3.49-.84.24-1.28l-4-6.93c-.25-.43-.77-.61-1.22-.43l-4.98 2.01c-1.03-.79-2.16-1.46-3.38-1.97L29 4.84c-.09-.47-.5-.84-1-.84h-8c-.5 0-.91.37-.99.84l-.75 5.3a14.8 14.8 0 0 0-3.38 1.97L9.9 10.1a1 1 0 0 0-1.22.43l-4 6.93c-.25.43-.14.97.24 1.28l4.22 3.31C9.06 22.69 9 23.34 9 24s.06 1.31.14 1.95l-4.22 3.31c-.38.3-.49.84-.24 1.28l4 6.93c.25.43.77.61 1.22.43l4.98-2.01c1.03.79 2.16 1.46 3.38 1.97l.75 5.3c.08.47.49.84.99.84h8c.5 0 .91-.37.99-.84l.75-5.3a14.8 14.8 0 0 0 3.38-1.97l4.98 2.01a1 1 0 0 0 1.22-.43l4-6.93c.25-.43.14-.97-.24-1.28l-4.22-3.31zM24 31c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-square">
      <path d="M36 8H12c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h24c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zm0 28H12V12h24v24z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-circle">
      <circle cx="24" cy="24" r="20"></circle>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-outline">
      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-inner-circle">
      <path d="M24 4C12.97 4 4 12.97 4 24s8.97 20 20 20 20-8.97 20-20S35.03 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16zm6-16c0 3.31-2.69 6-6 6s-6-2.69-6-6 2.69-6 6-6 6 2.69 6 6z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-cancel">
      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm10 27.17L31.17 34 24 26.83 16.83 34 14 31.17 21.17 24 14 16.83 16.83 14 24 21.17 31.17 14 34 16.83 26.83 24 34 31.17z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-replay">
      <path d="M24 10V2L14 12l10 10v-8c6.63 0 12 5.37 12 12s-5.37 12-12 12-12-5.37-12-12H8c0 8.84 7.16 16 16 16s16-7.16 16-16-7.16-16-16-16z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-repeat">
      <path d="M14 14h20v6l8-8-8-8v6H10v12h4v-8zm20 20H14v-6l-8 8 8 8v-6h24V26h-4v8z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-5">
      <path d="M17.689 98l-8.697 8.696 8.697 8.697 2.486-2.485-4.32-4.319h1.302c4.93 0 9.071 1.722 12.424 5.165 3.352 3.443 5.029 7.638 5.029 12.584h3.55c0-2.958-.553-5.73-1.658-8.313-1.104-2.583-2.622-4.841-4.555-6.774-1.932-1.932-4.19-3.45-6.773-4.555-2.584-1.104-5.355-1.657-8.313-1.657H15.5l4.615-4.615zm-8.08 21.659v13.861h11.357v5.008H9.609V143h12.7c.834 0 1.55-.298 2.146-.894.596-.597.895-1.31.895-2.145v-7.781c0-.835-.299-1.55-.895-2.147a2.929 2.929 0 0 0-2.147-.894h-8.227v-5.096H25.35v-4.384z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-10">
      <path d="M42.315 125.63c0-4.997-1.694-9.235-5.08-12.713-3.388-3.479-7.571-5.218-12.552-5.218h-1.315l4.363 4.363-2.51 2.51-8.787-8.786L25.221 97l2.45 2.45-4.662 4.663h1.375c2.988 0 5.788.557 8.397 1.673 2.61 1.116 4.892 2.65 6.844 4.602 1.953 1.953 3.487 4.234 4.602 6.844 1.116 2.61 1.674 5.41 1.674 8.398zM8.183 142v-19.657H3.176V117.8h9.643V142zm13.63 0c-1.156 0-2.127-.393-2.912-1.178-.778-.778-1.168-1.746-1.168-2.902v-16.04c0-1.156.393-2.127 1.178-2.912.779-.779 1.746-1.168 2.902-1.168h7.696c1.156 0 2.126.392 2.911 1.177.779.78 1.168 1.747 1.168 2.903v16.04c0 1.156-.392 2.127-1.177 2.912-.779.779-1.746 1.168-2.902 1.168zm.556-4.636h6.583v-15.02H22.37z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-30">
      <path d="M26.047 97l-8.733 8.732 8.733 8.733 2.496-2.494-4.336-4.338h1.307c4.95 0 9.108 1.73 12.474 5.187 3.367 3.458 5.051 7.668 5.051 12.635h3.565c0-2.97-.556-5.751-1.665-8.346-1.109-2.594-2.633-4.862-4.574-6.802-1.94-1.941-4.208-3.466-6.803-4.575-2.594-1.109-5.375-1.664-8.345-1.664H23.85l4.634-4.634zM2.555 117.531v4.688h10.297v5.25H5.873v4.687h6.979v5.156H2.555V142H13.36c1.061 0 1.95-.395 2.668-1.186.718-.79 1.076-1.772 1.076-2.94v-16.218c0-1.168-.358-2.149-1.076-2.94-.717-.79-1.607-1.185-2.668-1.185zm22.482.14c-1.149 0-2.11.39-2.885 1.165-.78.78-1.172 1.744-1.172 2.893v15.943c0 1.149.388 2.11 1.163 2.885.78.78 1.745 1.172 2.894 1.172h7.649c1.148 0 2.11-.388 2.884-1.163.78-.78 1.17-1.745 1.17-2.894v-15.943c0-1.15-.386-2.111-1.16-2.885-.78-.78-1.746-1.172-2.894-1.172zm.553 4.518h6.545v14.93H25.59z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-5">
      <path d="M29.508 97l-2.431 2.43 4.625 4.625h-1.364c-2.965 0-5.742.554-8.332 1.66-2.589 1.107-4.851 2.629-6.788 4.566-1.937 1.937-3.458 4.2-4.565 6.788-1.107 2.59-1.66 5.367-1.66 8.331h3.557c0-4.957 1.68-9.16 5.04-12.611 3.36-3.45 7.51-5.177 12.451-5.177h1.304l-4.326 4.33 2.49 2.49 8.715-8.716zm-9.783 21.61v13.89h11.382v5.018H19.725V142h12.727a2.93 2.93 0 0 0 2.15-.896 2.93 2.93 0 0 0 .896-2.15v-7.798c0-.837-.299-1.554-.896-2.152a2.93 2.93 0 0 0-2.15-.896h-8.245V123h11.29v-4.392z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-10">
      <path d="M23.119 97l-2.386 2.383 4.538 4.538h-1.339c-2.908 0-5.633.543-8.173 1.63-2.54 1.085-4.76 2.577-6.66 4.478-1.9 1.9-3.392 4.12-4.478 6.66-1.085 2.54-1.629 5.264-1.629 8.172h3.49c0-4.863 1.648-8.986 4.944-12.372 3.297-3.385 7.368-5.078 12.216-5.078h1.279l-4.245 4.247 2.443 2.442 8.55-8.55zm-9.52 21.45v4.42h4.871V142h4.513v-23.55zm18.136 0c-1.125 0-2.066.377-2.824 1.135-.764.764-1.148 1.709-1.148 2.834v15.612c0 1.124.38 2.066 1.139 2.824.764.764 1.708 1.145 2.833 1.145h7.489c1.125 0 2.066-.378 2.824-1.136.764-.764 1.145-1.709 1.145-2.833v-15.612c0-1.125-.378-2.067-1.136-2.825-.764-.764-1.708-1.145-2.833-1.145zm.54 4.42h6.408v14.617h-6.407z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-30">
      <path d="M25.549 97l-2.437 2.434 4.634 4.635H26.38c-2.97 0-5.753.555-8.347 1.664-2.594 1.109-4.861 2.633-6.802 4.574-1.94 1.94-3.465 4.207-4.574 6.802-1.109 2.594-1.664 5.377-1.664 8.347h3.565c0-4.967 1.683-9.178 5.05-12.636 3.366-3.458 7.525-5.187 12.475-5.187h1.307l-4.335 4.338 2.495 2.494 8.732-8.732zm-11.553 20.53v4.689h10.297v5.249h-6.978v4.688h6.978v5.156H13.996V142h10.808c1.06 0 1.948-.395 2.666-1.186.718-.79 1.077-1.771 1.077-2.94v-16.217c0-1.169-.36-2.15-1.077-2.94-.718-.79-1.605-1.186-2.666-1.186zm21.174.168c-1.149 0-2.11.389-2.884 1.163-.78.78-1.172 1.745-1.172 2.894v15.942c0 1.15.388 2.11 1.162 2.885.78.78 1.745 1.17 2.894 1.17h7.649c1.149 0 2.11-.386 2.885-1.16.78-.78 1.17-1.746 1.17-2.895v-15.942c0-1.15-.387-2.11-1.161-2.885-.78-.78-1.745-1.172-2.894-1.172zm.552 4.516h6.542v14.931h-6.542z"></path>
    </symbol>
    <symbol viewBox="0 0 512 512" id="vjs-icon-audio-description">
      <g fill-rule="evenodd"><path d="M227.29 381.351V162.993c50.38-1.017 89.108-3.028 117.631 17.126 27.374 19.342 48.734 56.965 44.89 105.325-4.067 51.155-41.335 94.139-89.776 98.475-24.085 2.155-71.972 0-71.972 0s-.84-1.352-.773-2.568m48.755-54.804c31.43 1.26 53.208-16.633 56.495-45.386 4.403-38.51-21.188-63.552-58.041-60.796v103.612c-.036 1.466.575 2.22 1.546 2.57"></path><path d="M383.78 381.328c13.336 3.71 17.387-11.06 23.215-21.408 12.722-22.571 22.294-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.226 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M425.154 381.328c13.336 3.71 17.384-11.061 23.215-21.408 12.721-22.571 22.291-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.511c-.586 3.874 2.226 7.315 3.866 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M466.26 381.328c13.337 3.71 17.385-11.061 23.216-21.408 12.722-22.571 22.292-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.225 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894M4.477 383.005H72.58l18.573-28.484 64.169-.135s.065 19.413.065 28.62h48.756V160.307h-58.816c-5.653 9.537-140.85 222.697-140.85 222.697zm152.667-145.282v71.158l-40.453-.27 40.453-70.888z"></path></g>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-next-item">
      <path d="M12 36l17-12-17-12v24zm20-24v24h4V12h-4z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-previous-item">
      <path d="M12 12h4v24h-4zm7 12l17 12V12z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-shuffle">
      <path d="M21.17 18.34L10.83 8 8 10.83l10.34 10.34 2.83-2.83zM29 8l4.09 4.09L8 37.17 10.83 40l25.09-25.09L40 19V8H29zm.66 18.83l-2.83 2.83 6.26 6.26L29 40h11V29l-4.09 4.09-6.25-6.26z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-cast">
      <path d="M42 6H6c-2.21 0-4 1.79-4 4v6h4v-6h36v28H28v4h14c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4zM2 36v6h6c0-3.31-2.69-6-6-6zm0-8v4c5.52 0 10 4.48 10 10h4c0-7.73-6.27-14-14-14zm0-8v4c9.94 0 18 8.06 18 18h4c0-12.15-9.85-22-22-22z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-picture-in-picture-enter">
      <path d="M38 22H22v11.99h16V22zm8 16V9.96C46 7.76 44.2 6 42 6H6C3.8 6 2 7.76 2 9.96V38c0 2.2 1.8 4 4 4h36c2.2 0 4-1.8 4-4zm-4 .04H6V9.94h36v28.1z"></path>
    </symbol>
    <symbol viewBox="0 0 22 18" id="vjs-icon-picture-in-picture-exit">
      <path d="M18 4H4v10h14V4zm4 12V1.98C22 .88 21.1 0 20 0H2C.9 0 0 .88 0 1.98V16c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H2V1.97h18v14.05z"></path>
      <path fill="none" d="M-1-3h24v24H-1z"></path>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-facebook">
      <path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759H734V905H479V609h255V391q0-186 104-288.5T1115 0q147 0 228 12z"></path>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-linkedin">
      <path d="M477 625v991H147V625h330zm21-306q1 73-50.5 122T312 490h-2q-82 0-132-49t-50-122q0-74 51.5-122.5T314 148t133 48.5T498 319zm1166 729v568h-329v-530q0-105-40.5-164.5T1168 862q-63 0-105.5 34.5T999 982q-11 30-11 81v553H659q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5T1285 602q171 0 275 113.5t104 332.5z"></path>
    </symbol>
    <symbol viewBox="0 0 1200 1227" id="vjs-icon-twitter">
      <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z"/>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-tumblr">
      <path d="M1328 1329l80 237q-23 35-111 66t-177 32q-104 2-190.5-26T787 1564t-95-106-55.5-120-16.5-118V676H452V461q72-26 129-69.5t91-90 58-102 34-99T779 12q1-5 4.5-8.5T791 0h244v424h333v252h-334v518q0 30 6.5 56t22.5 52.5 49.5 41.5 81.5 14q78-2 134-29z"></path>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-pinterest">
      <path d="M1664 896q0 209-103 385.5T1281.5 1561 896 1664q-111 0-218-32 59-93 78-164 9-34 54-211 20 39 73 67.5t114 28.5q121 0 216-68.5t147-188.5 52-270q0-114-59.5-214T1180 449t-255-63q-105 0-196 29t-154.5 77-109 110.5-67 129.5T377 866q0 104 40 183t117 111q30 12 38-20 2-7 8-31t8-30q6-23-11-43-51-61-51-151 0-151 104.5-259.5T904 517q151 0 235.5 82t84.5 213q0 170-68.5 289T980 1220q-61 0-98-43.5T859 1072q8-35 26.5-93.5t30-103T927 800q0-50-27-83t-77-33q-62 0-105 57t-43 142q0 73 25 122l-99 418q-17 70-13 177-206-91-333-281T128 896q0-209 103-385.5T510.5 231 896 128t385.5 103T1561 510.5 1664 896z"></path>
    </symbol>
  </defs>
</svg>`;const _w=Vf?10009:Gf?461:8,Vu={codes:{play:415,pause:19,ff:417,rw:412,back:_w},names:{415:"play",19:"pause",417:"ff",412:"rw",[_w]:"back"},isEventKey(t,e){return e=e.toLowerCase(),!!(this.names[t.keyCode]&&this.names[t.keyCode]===e)},getEventName(t){if(this.names[t.keyCode])return this.names[t.keyCode];if(this.codes[t.code]){const e=this.codes[t.code];return this.names[e]}return null}},vw=5;class kM extends Ir{constructor(e){super(),this.player_=e,this.focusableComponents=[],this.isListening_=!1,this.isPaused_=!1,this.onKeyDown_=this.onKeyDown_.bind(this),this.lastFocusedComponent_=null}start(){this.isListening_||(this.player_.on("keydown",this.onKeyDown_),this.player_.on("modalKeydown",this.onKeyDown_),this.player_.on("loadedmetadata",()=>{this.focus(this.updateFocusableComponents()[0])}),this.player_.on("modalclose",()=>{this.refocusComponent()}),this.player_.on("focusin",this.handlePlayerFocus_.bind(this)),this.player_.on("focusout",this.handlePlayerBlur_.bind(this)),this.isListening_=!0,this.player_.errorDisplay&&this.player_.errorDisplay.on("aftermodalfill",()=>{this.updateFocusableComponents(),this.focusableComponents.length&&(this.focusableComponents.length>1?this.focusableComponents[1].focus():this.focusableComponents[0].focus())}))}stop(){this.player_.off("keydown",this.onKeyDown_),this.isListening_=!1}onKeyDown_(e){const i=e.originalEvent?e.originalEvent:e;if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(i.key)){if(this.isPaused_)return;i.preventDefault();const n=i.key.substring(5).toLowerCase();this.move(n)}else if(Vu.isEventKey(i,"play")||Vu.isEventKey(i,"pause")||Vu.isEventKey(i,"ff")||Vu.isEventKey(i,"rw")){i.preventDefault();const n=Vu.getEventName(i);this.performMediaAction_(n)}else Vu.isEventKey(i,"Back")&&e.target&&typeof e.target.closeable=="function"&&e.target.closeable()&&(i.preventDefault(),e.target.close())}performMediaAction_(e){if(this.player_)switch(e){case"play":this.player_.paused()&&this.player_.play();break;case"pause":this.player_.paused()||this.player_.pause();break;case"ff":this.userSeek_(this.player_.currentTime()+vw);break;case"rw":this.userSeek_(this.player_.currentTime()-vw);break}}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}pause(){this.isPaused_=!0}resume(){this.isPaused_=!1}handlePlayerBlur_(e){const i=e.relatedTarget;let n=null;const s=this.getCurrentComponent(e.target);i&&(n=!!i.closest(".video-js"),i.classList.contains("vjs-text-track-settings")&&!this.isPaused_&&this.searchForTrackSelect_()),(!e.currentTarget.contains(e.relatedTarget)&&!n||!i)&&(s&&s.name()==="CloseButton"?this.refocusComponent():(this.pause(),s&&s.el()&&(this.lastFocusedComponent_=s)))}handlePlayerFocus_(){this.getCurrentComponent()&&this.getCurrentComponent().getIsFocusable()&&this.resume()}updateFocusableComponents(){const e=this.player_,i=[];function n(s){for(const o of s)o.hasOwnProperty("el_")&&o.getIsFocusable()&&o.getIsAvailableToBeFocused(o.el())&&i.push(o),o.hasOwnProperty("children_")&&o.children_.length>0&&n(o.children_)}return e.children_.forEach(s=>{if(s.hasOwnProperty("el_"))if(s.getIsFocusable&&s.getIsAvailableToBeFocused&&s.getIsFocusable()&&s.getIsAvailableToBeFocused(s.el())){i.push(s);return}else s.hasOwnProperty("children_")&&s.children_.length>0?n(s.children_):s.hasOwnProperty("items")&&s.items.length>0?n(s.items):this.findSuitableDOMChild(s)&&i.push(s);if(s.name_==="ErrorDisplay"&&s.opened_){const o=s.el_.querySelector(".vjs-errors-ok-button-container");o&&o.querySelectorAll("button").forEach((c,h)=>{i.push({name:()=>"ModalButton"+(h+1),el:()=>c,getPositions:()=>{const f=c.getBoundingClientRect(),m={x:f.x,y:f.y,width:f.width,height:f.height,top:f.top,right:f.right,bottom:f.bottom,left:f.left},_={x:f.left+f.width/2,y:f.top+f.height/2,width:0,height:0,top:f.top+f.height/2,right:f.left+f.width/2,bottom:f.top+f.height/2,left:f.left+f.width/2};return{boundingClientRect:m,center:_}},getIsAvailableToBeFocused:()=>!0,getIsFocusable:f=>!0,focus:()=>c.focus()})})}}),this.focusableComponents=i,this.focusableComponents}findSuitableDOMChild(e){function i(n){if(e.getIsFocusable(n)&&e.getIsAvailableToBeFocused(n))return n;for(let s=0;s<n.children.length;s++){const o=n.children[s],l=i(o);if(l)return l}return null}return e.el()?i(e.el()):null}getCurrentComponent(e){this.updateFocusableComponents();const i=e||document.activeElement;if(this.focusableComponents.length){for(const n of this.focusableComponents)if(n.el()===i)return n}}add(e){const i=[...this.focusableComponents];e.hasOwnProperty("el_")&&e.getIsFocusable()&&e.getIsAvailableToBeFocused(e.el())&&i.push(e),this.focusableComponents=i,this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents})}remove(e){for(let i=0;i<this.focusableComponents.length;i++)if(this.focusableComponents[i].name()===e.name()){this.focusableComponents.splice(i,1),this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents});return}}clear(){this.focusableComponents.length>0&&(this.focusableComponents=[],this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents}))}move(e){const i=this.getCurrentComponent();if(!i)return;const n=i.getPositions(),s=this.focusableComponents.filter(l=>l!==i&&this.isInDirection_(n.boundingClientRect,l.getPositions().boundingClientRect,e)),o=this.findBestCandidate_(n.center,s,e);o?this.focus(o):this.trigger({type:"endOfFocusableComponents",direction:e,focusedComponent:i})}findBestCandidate_(e,i,n){let s=1/0,o=null;for(const l of i){const c=l.getPositions().center,h=this.calculateDistance_(e,c,n);h<s&&(s=h,o=l)}return o}isInDirection_(e,i,n){switch(n){case"right":return i.left>=e.right;case"left":return i.right<=e.left;case"down":return i.top>=e.bottom;case"up":return i.bottom<=e.top;default:return!1}}refocusComponent(){if(this.lastFocusedComponent_){this.player_.userActive()||this.player_.userActive(!0),this.updateFocusableComponents();for(let e=0;e<this.focusableComponents.length;e++)if(this.focusableComponents[e].name()===this.lastFocusedComponent_.name()){this.focus(this.focusableComponents[e]);return}}else this.focus(this.updateFocusableComponents()[0])}focus(e){typeof e=="object"&&(e.getIsAvailableToBeFocused(e.el())?e.focus():this.findSuitableDOMChild(e)&&this.findSuitableDOMChild(e).focus())}calculateDistance_(e,i,n){const s=Math.abs(e.x-i.x),o=Math.abs(e.y-i.y);let l;switch(n){case"right":case"left":l=s+o*100;break;case"up":l=o*2+s*.5;break;case"down":l=o*5+s;break;default:l=s+o}return l}searchForTrackSelect_(){const e=this;for(const i of e.updateFocusableComponents())if(i.constructor.name==="TextTrackSelect"){e.focus(i);break}}}class $M extends Oe{constructor(e,i,n){const s=ni({createEl:!1},i);if(super(e,s,n),!i.playerOptions.sources||i.playerOptions.sources.length===0)for(let o=0,l=i.playerOptions.techOrder;o<l.length;o++){const c=Oi(l[o]);let h=_t.getTech(c);if(c||(h=Oe.getComponent(c)),h&&h.isSupported()){e.loadTech_(c);break}}else e.src(i.playerOptions.sources)}}Oe.registerComponent("MediaLoader",$M);class Ap extends Oe{constructor(e,i){super(e,i),this.options_.controlText&&this.controlText(this.options_.controlText),this.handleMouseOver_=n=>this.handleMouseOver(n),this.handleMouseOut_=n=>this.handleMouseOut(n),this.handleClick_=n=>this.handleClick(n),this.handleKeyDown_=n=>this.handleKeyDown(n),this.emitTapEvents(),this.enable()}createEl(e="div",i={},n={}){i=Object.assign({className:this.buildCSSClass(),tabIndex:0},i),e==="button"&&St.error(`Creating a ClickableComponent with an HTML element of ${e} is not supported; use a Button instead.`),n=Object.assign({role:"button"},n),this.tabIndex_=i.tabIndex;const s=ut(e,i,n);return this.player_.options_.experimentalSvgIcons||s.appendChild(ut("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(s),s}dispose(){this.controlTextEl_=null,super.dispose()}createControlTextEl(e){return this.controlTextEl_=ut("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_}controlText(e,i=this.el()){if(e===void 0)return this.controlText_||"Need Text";const n=this.localize(e);this.controlText_=e,nl(this.controlTextEl_,n),!this.nonIconControl&&!this.player_.options_.noUITitleAttributes&&i.setAttribute("title",n)}buildCSSClass(){return`vjs-control vjs-button ${super.buildCSSClass()}`}enable(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),typeof this.tabIndex_<"u"&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))}disable(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),typeof this.tabIndex_<"u"&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)}handleLanguagechange(){this.controlText(this.controlText_)}handleClick(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)}handleKeyDown(e){e.key===" "||e.key==="Enter"?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}Oe.registerComponent("ClickableComponent",Ap);class my extends Ap{constructor(e,i){super(e,i),this.update(),this.update_=n=>this.update(n),e.on("posterchange",this.update_)}dispose(){this.player().off("posterchange",this.update_),super.dispose()}createEl(){return ut("div",{className:"vjs-poster"})}crossOrigin(e){if(typeof e>"u")return this.$("img")?this.$("img").crossOrigin:this.player_.tech_&&this.player_.tech_.isReady_?this.player_.crossOrigin():this.player_.options_.crossOrigin||this.player_.options_.crossorigin||null;if(e!==null&&e!=="anonymous"&&e!=="use-credentials"){this.player_.log.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`);return}this.$("img")&&(this.$("img").crossOrigin=e)}update(e){const i=this.player().poster();this.setSrc(i),i?this.show():this.hide()}setSrc(e){if(!e){this.el_.textContent="";return}this.$("img")||this.el_.appendChild(ut("picture",{className:"vjs-poster",tabIndex:-1},{},ut("img",{loading:"lazy",crossOrigin:this.crossOrigin()},{alt:""}))),this.$("img").src=e}handleClick(e){this.player_.controls()&&(this.player_.tech(!0)&&this.player_.tech(!0).focus(),this.player_.paused()?na(this.player_.play()):this.player_.pause())}}my.prototype.crossorigin=my.prototype.crossOrigin;Oe.registerComponent("PosterImage",my);const Qr="#222",bw="#ccc",OM={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function O0(t,e){let i;if(t.length===4)i=t[1]+t[1]+t[2]+t[2]+t[3]+t[3];else if(t.length===7)i=t.slice(1);else throw new Error("Invalid color code provided, "+t+"; must be formatted as e.g. #f0e or #f604e2.");return"rgba("+parseInt(i.slice(0,2),16)+","+parseInt(i.slice(2,4),16)+","+parseInt(i.slice(4,6),16)+","+e+")"}function ea(t,e,i){try{t.style[e]=i}catch{return}}function Tw(t){return t?`${t}px`:""}class IM extends Oe{constructor(e,i,n){super(e,i,n);const s=l=>this.updateDisplay(l),o=l=>{this.updateDisplayOverlay(),this.updateDisplay(l)};e.on("loadstart",l=>this.toggleDisplay(l)),e.on("useractive",s),e.on("userinactive",s),e.on("texttrackchange",s),e.on("loadedmetadata",l=>{this.updateDisplayOverlay(),this.preselectTrack(l)}),e.ready(hi(this,function(){if(e.tech_&&e.tech_.featuresNativeTextTracks){this.hide();return}e.on("fullscreenchange",o),e.on("playerresize",o);const l=te.screen.orientation||te,c=te.screen.orientation?"change":"orientationchange";l.addEventListener(c,o),e.on("dispose",()=>l.removeEventListener(c,o));const h=this.options_.playerOptions.tracks||[];for(let f=0;f<h.length;f++)this.player_.addRemoteTextTrack(h[f],!0);this.preselectTrack()}))}preselectTrack(){const e={captions:1,subtitles:1},i=this.player_.textTracks(),n=this.player_.cache_.selectedLanguage;let s,o,l;for(let c=0;c<i.length;c++){const h=i[c];n&&n.enabled&&n.language&&n.language===h.language&&h.kind in e?h.kind===n.kind?l=h:l||(l=h):n&&!n.enabled?(l=null,s=null,o=null):h.default&&(h.kind==="descriptions"&&!s?s=h:h.kind in e&&!o&&(o=h))}l?l.mode="showing":o?o.mode="showing":s&&(s.mode="showing")}toggleDisplay(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()}createEl(){return super.createEl("div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})}clearDisplay(){typeof te.WebVTT=="function"&&te.WebVTT.processCues(te,[],this.el_)}updateDisplay(){const e=this.player_.textTracks(),i=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),i){const l=[];for(let c=0;c<e.length;++c){const h=e[c];h.mode==="showing"&&l.push(h)}this.updateForTrack(l);return}let n=null,s=null,o=e.length;for(;o--;){const l=e[o];l.mode==="showing"&&(l.kind==="descriptions"?n=l:s=l)}if(s?(this.getAttribute("aria-live")!=="off"&&this.setAttribute("aria-live","off"),this.updateForTrack(s)):n&&(this.getAttribute("aria-live")!=="assertive"&&this.setAttribute("aria-live","assertive"),this.updateForTrack(n)),!te.CSS.supports("inset","10px")){const l=this.el_,c=l.querySelectorAll(".vjs-text-track-cue"),h=this.player_.controlBar.el_.getBoundingClientRect().height,f=this.player_.el_.getBoundingClientRect().height;l.style="",ea(l,"position","relative"),ea(l,"height",f-h+"px"),ea(l,"top","unset"),Wf?ea(l,"bottom",f+"px"):ea(l,"bottom","0px"),c.length>0&&c.forEach(m=>{if(m.style.inset){const _=m.style.inset.split(" ");_.length===3&&Object.assign(m.style,{top:_[0],right:_[1],bottom:_[2],left:"unset"})}})}}updateDisplayOverlay(){if(!this.player_.videoHeight()||!te.CSS.supports("inset-inline: 10px"))return;const e=this.player_.currentWidth(),i=this.player_.currentHeight(),n=e/i,s=this.player_.videoWidth()/this.player_.videoHeight();let o=0,l=0;Math.abs(n-s)>.1&&(n>s?o=Math.round((e-i*s)/2):l=Math.round((i-e/s)/2)),ea(this.el_,"insetInline",Tw(o)),ea(this.el_,"insetBlock",Tw(l))}updateDisplayState(e){const i=this.player_.textTrackSettings.getValues(),n=e.activeCues;let s=n.length;for(;s--;){const o=n[s];if(!o)continue;const l=o.displayState;if(i.color&&(l.firstChild.style.color=i.color),i.textOpacity&&ea(l.firstChild,"color",O0(i.color||"#fff",i.textOpacity)),i.backgroundColor&&(l.firstChild.style.backgroundColor=i.backgroundColor),i.backgroundOpacity&&ea(l.firstChild,"backgroundColor",O0(i.backgroundColor||"#000",i.backgroundOpacity)),i.windowColor&&(i.windowOpacity?ea(l,"backgroundColor",O0(i.windowColor,i.windowOpacity)):l.style.backgroundColor=i.windowColor),i.edgeStyle&&(i.edgeStyle==="dropshadow"?l.firstChild.style.textShadow=`2px 2px 3px ${Qr}, 2px 2px 4px ${Qr}, 2px 2px 5px ${Qr}`:i.edgeStyle==="raised"?l.firstChild.style.textShadow=`1px 1px ${Qr}, 2px 2px ${Qr}, 3px 3px ${Qr}`:i.edgeStyle==="depressed"?l.firstChild.style.textShadow=`1px 1px ${bw}, 0 1px ${bw}, -1px -1px ${Qr}, 0 -1px ${Qr}`:i.edgeStyle==="uniform"&&(l.firstChild.style.textShadow=`0 0 4px ${Qr}, 0 0 4px ${Qr}, 0 0 4px ${Qr}, 0 0 4px ${Qr}`)),i.fontPercent&&i.fontPercent!==1){const c=te.parseFloat(l.style.fontSize);l.style.fontSize=c*i.fontPercent+"px",l.style.height="auto",l.style.top="auto"}i.fontFamily&&i.fontFamily!=="default"&&(i.fontFamily==="small-caps"?l.firstChild.style.fontVariant="small-caps":l.firstChild.style.fontFamily=OM[i.fontFamily])}}updateForTrack(e){if(Array.isArray(e)||(e=[e]),typeof te.WebVTT!="function"||e.every(n=>!n.activeCues))return;const i=[];for(let n=0;n<e.length;++n){const s=e[n];for(let o=0;o<s.activeCues.length;++o)i.push(s.activeCues[o])}te.WebVTT.processCues(te,i,this.el_);for(let n=0;n<e.length;++n){const s=e[n];for(let o=0;o<s.activeCues.length;++o){const l=s.activeCues[o].displayState;Yl(l,"vjs-text-track-cue","vjs-text-track-cue-"+(s.language?s.language:n)),s.language&&pc(l,"lang",s.language)}this.player_.textTrackSettings&&this.updateDisplayState(s)}}}Oe.registerComponent("TextTrackDisplay",IM);class RM extends Oe{createEl(){const e=this.player_.isAudio(),i=this.localize(e?"Audio Player":"Video Player"),n=ut("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[i])}),s=super.createEl("div",{className:"vjs-loading-spinner",dir:"ltr"});return s.appendChild(n),s}handleLanguagechange(){this.$(".vjs-control-text").textContent=this.localize("{1} is loading.",[this.player_.isAudio()?"Audio Player":"Video Player"])}}Oe.registerComponent("LoadingSpinner",RM);class Mn extends Ap{createEl(e,i={},n={}){e="button",i=Object.assign({className:this.buildCSSClass()},i),n=Object.assign({type:"button"},n);const s=ut(e,i,n);return this.player_.options_.experimentalSvgIcons||s.appendChild(ut("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(s),s}addChild(e,i={}){const n=this.constructor.name;return St.warn(`Adding an actionable (user controllable) child to a Button (${n}) is not supported; use a ClickableComponent instead.`),Oe.prototype.addChild.call(this,e,i)}enable(){super.enable(),this.el_.removeAttribute("disabled")}disable(){super.disable(),this.el_.setAttribute("disabled","disabled")}handleKeyDown(e){if(e.key===" "||e.key==="Enter"){e.stopPropagation();return}super.handleKeyDown(e)}}Oe.registerComponent("Button",Mn);class WD extends Mn{constructor(e,i){super(e,i),this.mouseused_=!1,this.setIcon("play"),this.on("mousedown",n=>this.handleMouseDown(n))}buildCSSClass(){return"vjs-big-play-button"}handleClick(e){const i=this.player_.play();if(e.type==="tap"||this.mouseused_&&"clientX"in e&&"clientY"in e){na(i),this.player_.tech(!0)&&this.player_.tech(!0).focus();return}const n=this.player_.getChild("controlBar"),s=n&&n.getChild("playToggle");if(!s){this.player_.tech(!0).focus();return}const o=()=>s.focus();Vd(i)?i.then(o,()=>{}):this.setTimeout(o,1)}handleKeyDown(e){this.mouseused_=!1,super.handleKeyDown(e)}handleMouseDown(e){this.mouseused_=!0}}WD.prototype.controlText_="Play Video";Oe.registerComponent("BigPlayButton",WD);class MM extends Mn{constructor(e,i){super(e,i),this.setIcon("cancel"),this.controlText(i&&i.controlText||this.localize("Close"))}buildCSSClass(){return`vjs-close-button ${super.buildCSSClass()}`}handleClick(e){this.trigger({type:"close",bubbles:!1})}handleKeyDown(e){e.key==="Escape"?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}Oe.registerComponent("CloseButton",MM);class XD extends Mn{constructor(e,i={}){super(e,i),i.replay=i.replay===void 0||i.replay,this.setIcon("play"),this.on(e,"play",n=>this.handlePlay(n)),this.on(e,"pause",n=>this.handlePause(n)),i.replay&&this.on(e,"ended",n=>this.handleEnded(n))}buildCSSClass(){return`vjs-play-control ${super.buildCSSClass()}`}handleClick(e){this.player_.paused()?na(this.player_.play()):this.player_.pause()}handleSeeked(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)}handlePlay(e){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.setIcon("pause"),this.controlText("Pause")}handlePause(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.setIcon("play"),this.controlText("Play")}handleEnded(e){this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.setIcon("replay"),this.controlText("Replay"),this.one(this.player_,"seeked",i=>this.handleSeeked(i))}}XD.prototype.controlText_="Play";Oe.registerComponent("PlayToggle",XD);class Sc extends Oe{constructor(e,i){super(e,i),this.on(e,["timeupdate","ended","seeking"],n=>this.update(n)),this.updateTextNode_()}createEl(){const e=this.buildCSSClass(),i=super.createEl("div",{className:`${e} vjs-time-control vjs-control`}),n=ut("span",{className:"vjs-control-text",textContent:`${this.localize(this.labelText_)}`},{role:"presentation"});return i.appendChild(n),this.contentEl_=ut("span",{className:`${e}-display`},{role:"presentation"}),i.appendChild(this.contentEl_),i}dispose(){this.contentEl_=null,this.textNode_=null,super.dispose()}update(e){!this.player_.options_.enableSmoothSeeking&&e.type==="seeking"||this.updateContent(e)}updateTextNode_(e=0){e=nu(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",()=>{if(!this.contentEl_)return;let i=this.textNode_;i&&this.contentEl_.firstChild!==i&&(i=null,St.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),this.textNode_=Fe.createTextNode(this.formattedTime_),this.textNode_&&(i?this.contentEl_.replaceChild(this.textNode_,i):this.contentEl_.appendChild(this.textNode_))}))}updateContent(e){}}Sc.prototype.labelText_="Time";Sc.prototype.controlText_="Time";Oe.registerComponent("TimeDisplay",Sc);class w_ extends Sc{buildCSSClass(){return"vjs-current-time"}updateContent(e){let i;this.player_.ended()?i=this.player_.duration():e&&e.target&&typeof e.target.pendingSeekTime=="function"?i=e.target.pendingSeekTime():i=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(i)}}w_.prototype.labelText_="Current Time";w_.prototype.controlText_="Current Time";Oe.registerComponent("CurrentTimeDisplay",w_);class E_ extends Sc{constructor(e,i){super(e,i);const n=s=>this.updateContent(s);this.on(e,"durationchange",n),this.on(e,"loadstart",n),this.on(e,"loadedmetadata",n)}buildCSSClass(){return"vjs-duration"}updateContent(e){const i=this.player_.duration();this.updateTextNode_(i)}}E_.prototype.labelText_="Duration";E_.prototype.controlText_="Duration";Oe.registerComponent("DurationDisplay",E_);class NM extends Oe{createEl(){const e=super.createEl("div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),i=super.createEl("div"),n=super.createEl("span",{textContent:"/"});return i.appendChild(n),e.appendChild(i),e}}Oe.registerComponent("TimeDivider",NM);class C_ extends Sc{constructor(e,i){super(e,i),this.on(e,"durationchange",n=>this.updateContent(n))}buildCSSClass(){return"vjs-remaining-time"}createEl(){const e=super.createEl();return this.options_.displayNegative!==!1&&e.insertBefore(ut("span",{},{"aria-hidden":!0},"-"),this.contentEl_),e}updateContent(e){if(typeof this.player_.duration()!="number")return;let i;this.player_.ended()?i=0:this.player_.remainingTimeDisplay?i=this.player_.remainingTimeDisplay():i=this.player_.remainingTime(),this.updateTextNode_(i)}}C_.prototype.labelText_="Remaining Time";C_.prototype.controlText_="Remaining Time";Oe.registerComponent("RemainingTimeDisplay",C_);class BM extends Oe{constructor(e,i){super(e,i),this.updateShowing(),this.on(this.player(),"durationchange",n=>this.updateShowing(n))}createEl(){const e=super.createEl("div",{className:"vjs-live-control vjs-control"});return this.contentEl_=ut("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(ut("span",{className:"vjs-control-text",textContent:`${this.localize("Stream Type")}`})),this.contentEl_.appendChild(Fe.createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e}dispose(){this.contentEl_=null,super.dispose()}updateShowing(e){this.player().duration()===1/0?this.show():this.hide()}}Oe.registerComponent("LiveDisplay",BM);class KD extends Mn{constructor(e,i){super(e,i),this.updateLiveEdgeStatus(),this.player_.liveTracker&&(this.updateLiveEdgeStatusHandler_=n=>this.updateLiveEdgeStatus(n),this.on(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_))}createEl(){const e=super.createEl("button",{className:"vjs-seek-to-live-control vjs-control"});return this.setIcon("circle",e),this.textEl_=ut("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),e.appendChild(this.textEl_),e}updateLiveEdgeStatus(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))}handleClick(){this.player_.liveTracker.seekToLiveEdge()}dispose(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,super.dispose()}}KD.prototype.controlText_="Seek to live, currently playing live";Oe.registerComponent("SeekToLive",KD);function rh(t,e,i){return t=Number(t),Math.min(i,Math.max(e,isNaN(t)?e:t))}var LM=Object.freeze({__proto__:null,clamp:rh});class A_ extends Oe{constructor(e,i){super(e,i),this.handleMouseDown_=n=>this.handleMouseDown(n),this.handleMouseUp_=n=>this.handleMouseUp(n),this.handleKeyDown_=n=>this.handleKeyDown(n),this.handleClick_=n=>this.handleClick(n),this.handleMouseMove_=n=>this.handleMouseMove(n),this.update_=n=>this.update(n),this.bar=this.getChild(this.options_.barName),this.vertical(!!this.options_.vertical),this.enable()}enabled(){return this.enabled_}enable(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)}disable(){if(!this.enabled())return;const e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}createEl(e,i={},n={}){return i.className=i.className+" vjs-slider",i=Object.assign({tabIndex:0},i),n=Object.assign({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100},n),super.createEl(e,i,n)}handleMouseDown(e){const i=this.bar.el_.ownerDocument;e.type==="mousedown"&&e.preventDefault(),e.type==="touchstart"&&!ua&&e.preventDefault(),TD(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(i,"mousemove",this.handleMouseMove_),this.on(i,"mouseup",this.handleMouseUp_),this.on(i,"touchmove",this.handleMouseMove_),this.on(i,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)}handleMouseMove(e){}handleMouseUp(e){const i=this.bar.el_.ownerDocument;xD(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(i,"mousemove",this.handleMouseMove_),this.off(i,"mouseup",this.handleMouseUp_),this.off(i,"touchmove",this.handleMouseMove_),this.off(i,"touchend",this.handleMouseUp_),this.update()}update(){if(!this.el_||!this.bar)return;const e=this.getProgress();return e===this.progress_||(this.progress_=e,this.requestNamedAnimationFrame("Slider#update",()=>{const i=this.vertical()?"height":"width";this.bar.el().style[i]=(e*100).toFixed(2)+"%"})),e}getProgress(){return Number(rh(this.getPercent(),0,1).toFixed(4))}calculateDistance(e){const i=Tp(this.el_,e);return this.vertical()?i.y:i.x}handleKeyDown(e){const i=this.options_.playerOptions.spatialNavigation,n=i&&i.enabled,s=i&&i.horizontalSeek;n?s&&e.key==="ArrowLeft"||!s&&e.key==="ArrowDown"?(e.preventDefault(),e.stopPropagation(),this.stepBack()):s&&e.key==="ArrowRight"||!s&&e.key==="ArrowUp"?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(this.pendingSeekTime()&&(this.pendingSeekTime(null),this.userSeek_(this.player_.currentTime())),super.handleKeyDown(e)):e.key==="ArrowLeft"||e.key==="ArrowDown"?(e.preventDefault(),e.stopPropagation(),this.stepBack()):e.key==="ArrowUp"||e.key==="ArrowRight"?(e.preventDefault(),e.stopPropagation(),this.stepForward()):super.handleKeyDown(e)}handleClick(e){e.stopPropagation(),e.preventDefault()}vertical(e){if(e===void 0)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")}}Oe.registerComponent("Slider",A_);const I0=(t,e)=>rh(t/e*100,0,100).toFixed(2)+"%";class UM extends Oe{constructor(e,i){super(e,i),this.partEls_=[],this.on(e,"progress",n=>this.update(n))}createEl(){const e=super.createEl("div",{className:"vjs-load-progress"}),i=ut("span",{className:"vjs-control-text"}),n=ut("span",{textContent:this.localize("Loaded")}),s=Fe.createTextNode(": ");return this.percentageEl_=ut("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),e.appendChild(i),i.appendChild(n),i.appendChild(s),i.appendChild(this.percentageEl_),e}dispose(){this.partEls_=null,this.percentageEl_=null,super.dispose()}update(e){this.requestNamedAnimationFrame("LoadProgressBar#update",()=>{const i=this.player_.liveTracker,n=this.player_.buffered(),s=i&&i.isLive()?i.seekableEnd():this.player_.duration(),o=this.player_.bufferedEnd(),l=this.partEls_,c=I0(o,s);this.percent_!==c&&(this.el_.style.width=c,nl(this.percentageEl_,c),this.percent_=c);for(let h=0;h<n.length;h++){const f=n.start(h),m=n.end(h);let _=l[h];_||(_=this.el_.appendChild(ut()),l[h]=_),!(_.dataset.start===f&&_.dataset.end===m)&&(_.dataset.start=f,_.dataset.end=m,_.style.left=I0(f,o),_.style.width=I0(m-f,o))}for(let h=l.length;h>n.length;h--)this.el_.removeChild(l[h-1]);l.length=n.length})}}Oe.registerComponent("LoadProgressBar",UM);class PM extends Oe{constructor(e,i){super(e,i),this.update=ca(hi(this,this.update),ts)}createEl(){return super.createEl("div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})}update(e,i,n){const s=Zd(this.el_),o=mc(this.player_.el()),l=e.width*i;if(!o||!s)return;let c=e.left-o.left+l,h=e.width-l+(o.right-e.right);h||(h=e.width-l,c=l);let f=s.width/2;c<f?f+=f-c:h<f&&(f=h),f<0?f=0:f>s.width&&(f=s.width),f=Math.round(f),this.el_.style.right=`-${f}px`,this.write(n)}write(e){nl(this.el_,e)}updateTime(e,i,n,s){this.requestNamedAnimationFrame("TimeTooltip#updateTime",()=>{let o;const l=this.player_.duration();if(this.player_.liveTracker&&this.player_.liveTracker.isLive()){const c=this.player_.liveTracker.liveWindow(),h=c-i*c;o=(h<1?"":"-")+nu(h,c)}else o=nu(n,l);this.update(e,i,o),s&&s()})}}Oe.registerComponent("TimeTooltip",PM);class D_ extends Oe{constructor(e,i){super(e,i),this.setIcon("circle"),this.update=ca(hi(this,this.update),ts)}createEl(){return super.createEl("div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})}update(e,i,n){const s=this.getChild("timeTooltip");if(!s)return;const o=n&&n.target&&typeof n.target.pendingSeekTime=="function"?n.target.pendingSeekTime():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();s.updateTime(e,i,o)}}D_.prototype.options_={children:[]};!In&&!Os&&D_.prototype.options_.children.push("timeTooltip");Oe.registerComponent("PlayProgressBar",D_);class YD extends Oe{constructor(e,i){super(e,i),this.update=ca(hi(this,this.update),ts)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,i){const n=i*this.player_.duration();this.getChild("timeTooltip").updateTime(e,i,n,()=>{this.el_.style.left=`${e.width*i}px`})}}YD.prototype.options_={children:["timeTooltip"]};Oe.registerComponent("MouseTimeDisplay",YD);class Dp extends A_{constructor(e,i){i=ni(Dp.prototype.options_,i),i.children=[...i.children];const n=e.options_.disableSeekWhileScrubbingOnMobile&&(In||Os)||e.options_.disableSeekWhileScrubbingOnSTV;(!In&&!Os||n)&&i.children.splice(1,0,"mouseTimeDisplay"),super(e,i),this.shouldDisableSeekWhileScrubbing_=n,this.pendingSeekTime_=null,this.setEventHandlers_()}setEventHandlers_(){this.update_=hi(this,this.update),this.update=ca(this.update_,ts),this.on(this.player_,["durationchange","timeupdate"],this.update),this.on(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=e=>this.enableInterval_(e),this.disableIntervalHandler_=e=>this.disableInterval_(e),this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in Fe&&"visibilityState"in Fe&&this.on(Fe,"visibilitychange",this.toggleVisibility_)}toggleVisibility_(e){Fe.visibilityState==="hidden"?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(!this.player_.ended()&&!this.player_.paused()&&this.enableInterval_(),this.update())}enableInterval_(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,ts))}disableInterval_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&e.type!=="ended"||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)}createEl(){return super.createEl("div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})}update(e){if(Fe.visibilityState==="hidden")return;const i=super.update();return this.requestNamedAnimationFrame("SeekBar#update",()=>{const n=this.player_.ended()?this.player_.duration():this.getCurrentTime_(),s=this.player_.liveTracker;let o=this.player_.duration();s&&s.isLive()&&(o=this.player_.liveTracker.liveCurrentTime()),this.percent_!==i&&(this.el_.setAttribute("aria-valuenow",(i*100).toFixed(2)),this.percent_=i),(this.currentTime_!==n||this.duration_!==o)&&(this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[nu(n,o),nu(o,o)],"{1} of {2}")),this.currentTime_=n,this.duration_=o),this.bar&&this.bar.update(mc(this.el()),this.getProgress(),e)}),i}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}getCurrentTime_(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()}pendingSeekTime(e){if(e!==void 0)if(e!==null){const i=this.player_.duration();this.pendingSeekTime_=Math.max(0,Math.min(e,i))}else this.pendingSeekTime_=null;return this.pendingSeekTime_}getPercent(){if(this.pendingSeekTime()!==null)return this.pendingSeekTime()/this.player_.duration();const e=this.getCurrentTime_();let i;const n=this.player_.liveTracker;return n&&n.isLive()?(i=(e-n.seekableStart())/n.liveWindow(),n.atLiveEdge()&&(i=1)):i=e/this.player_.duration(),i}handleMouseDown(e){Jd(e)&&(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.shouldDisableSeekWhileScrubbing_||this.player_.pause(),super.handleMouseDown(e))}handleMouseMove(e,i=!1){if(!Jd(e)||isNaN(this.player_.duration()))return;!i&&!this.player_.scrubbing()&&this.player_.scrubbing(!0);let n;const s=this.calculateDistance(e),o=this.player_.liveTracker;if(!o||!o.isLive())n=s*this.player_.duration(),n===this.player_.duration()&&(n=n-.1);else{if(s>=.99){o.seekToLiveEdge();return}const l=o.seekableStart(),c=o.liveCurrentTime();if(n=l+s*o.liveWindow(),n>=c&&(n=c),n<=l&&(n=l+.1),n===1/0)return}this.shouldDisableSeekWhileScrubbing_?this.pendingSeekTime(n):this.userSeek_(n),this.player_.options_.enableSmoothSeeking&&this.update()}enable(){super.enable();const e=this.getChild("mouseTimeDisplay");e&&e.show()}disable(){super.disable();const e=this.getChild("mouseTimeDisplay");e&&e.hide()}handleMouseUp(e){super.handleMouseUp(e),e&&e.stopPropagation(),this.player_.scrubbing(!1),this.pendingSeekTime()!==null&&(this.userSeek_(this.pendingSeekTime()),this.pendingSeekTime(null)),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?na(this.player_.play()):this.update_()}handlePendingSeek_(e){this.player_.paused()||this.player_.pause();const i=this.pendingSeekTime()!==null?this.pendingSeekTime():this.player_.currentTime();this.pendingSeekTime(i+e),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}stepForward(){this.shouldDisableSeekWhileScrubbing_?this.handlePendingSeek_(this.options().stepSeconds):this.userSeek_(this.player_.currentTime()+this.options().stepSeconds)}stepBack(){this.shouldDisableSeekWhileScrubbing_?this.handlePendingSeek_(-this.options().stepSeconds):this.userSeek_(this.player_.currentTime()-this.options().stepSeconds)}handleAction(e){this.pendingSeekTime()!==null&&(this.userSeek_(this.pendingSeekTime()),this.pendingSeekTime(null)),this.player_.paused()?this.player_.play():this.player_.pause()}handleKeyDown(e){const i=this.player_.liveTracker;if(e.key===" "||e.key==="Enter")e.preventDefault(),e.stopPropagation(),this.handleAction(e);else if(e.key==="Home")e.preventDefault(),e.stopPropagation(),this.userSeek_(0);else if(e.key==="End")e.preventDefault(),e.stopPropagation(),i&&i.isLive()?this.userSeek_(i.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(e.key)){e.preventDefault(),e.stopPropagation();const n=parseInt(e.key,10)*.1;i&&i.isLive()?this.userSeek_(i.seekableStart()+i.liveWindow()*n):this.userSeek_(this.player_.duration()*n)}else e.key==="PageDown"?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-this.options().stepSeconds*this.options().pageMultiplier)):e.key==="PageUp"?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+this.options().stepSeconds*this.options().pageMultiplier)):super.handleKeyDown(e)}dispose(){this.disableInterval_(),this.off(this.player_,["durationchange","timeupdate"],this.update),this.off(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in Fe&&"visibilityState"in Fe&&this.off(Fe,"visibilitychange",this.toggleVisibility_),super.dispose()}}Dp.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar",stepSeconds:5,pageMultiplier:12};Oe.registerComponent("SeekBar",Dp);class QD extends Oe{constructor(e,i){super(e,i),this.handleMouseMove=ca(hi(this,this.handleMouseMove),ts),this.throttledHandleMouseSeek=ca(hi(this,this.handleMouseSeek),ts),this.handleMouseUpHandler_=n=>this.handleMouseUp(n),this.handleMouseDownHandler_=n=>this.handleMouseDown(n),this.enable()}createEl(){return super.createEl("div",{className:"vjs-progress-control vjs-control"})}handleMouseMove(e){const i=this.getChild("seekBar");if(!i)return;const n=i.getChild("playProgressBar"),s=i.getChild("mouseTimeDisplay");if(!n&&!s)return;const o=i.el(),l=Zd(o);let c=Tp(o,e).x;c=rh(c,0,1),s&&s.update(l,c),n&&n.update(l,i.getProgress())}handleMouseSeek(e){const i=this.getChild("seekBar");i&&i.handleMouseMove(e)}enabled(){return this.enabled_}disable(){if(this.children().forEach(e=>e.disable&&e.disable()),!!this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,["mousemove","touchmove"],this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){const e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&na(this.player_.play())}}enable(){this.children().forEach(e=>e.enable&&e.enable()),!this.enabled()&&(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,["mousemove","touchmove"],this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)}removeListenersAddedOnMousedownAndTouchstart(){const e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)}handleMouseDown(e){const i=this.el_.ownerDocument,n=this.getChild("seekBar");n&&n.handleMouseDown(e),this.on(i,"mousemove",this.throttledHandleMouseSeek),this.on(i,"touchmove",this.throttledHandleMouseSeek),this.on(i,"mouseup",this.handleMouseUpHandler_),this.on(i,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const i=this.getChild("seekBar");i&&i.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()}}QD.prototype.options_={children:["seekBar"]};Oe.registerComponent("ProgressControl",QD);class ZD extends Mn{constructor(e,i){super(e,i),this.setIcon("picture-in-picture-enter"),this.on(e,["enterpictureinpicture","leavepictureinpicture"],n=>this.handlePictureInPictureChange(n)),this.on(e,["disablepictureinpicturechanged","loadedmetadata"],n=>this.handlePictureInPictureEnabledChange(n)),this.on(e,["loadedmetadata","audioonlymodechange","audiopostermodechange"],()=>this.handlePictureInPictureAudioModeChange()),this.disable()}buildCSSClass(){return`vjs-picture-in-picture-control vjs-hidden ${super.buildCSSClass()}`}handlePictureInPictureAudioModeChange(){if(!(this.player_.currentType().substring(0,5)==="audio"||this.player_.audioPosterMode()||this.player_.audioOnlyMode())){this.show();return}this.player_.isInPictureInPicture()&&this.player_.exitPictureInPicture(),this.hide()}handlePictureInPictureEnabledChange(){Fe.pictureInPictureEnabled&&this.player_.disablePictureInPicture()===!1||this.player_.options_.enableDocumentPictureInPicture&&"documentPictureInPicture"in te?this.enable():this.disable()}handlePictureInPictureChange(e){this.player_.isInPictureInPicture()?(this.setIcon("picture-in-picture-exit"),this.controlText("Exit Picture-in-Picture")):(this.setIcon("picture-in-picture-enter"),this.controlText("Picture-in-Picture")),this.handlePictureInPictureEnabledChange()}handleClick(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()}show(){typeof Fe.exitPictureInPicture=="function"&&super.show()}}ZD.prototype.controlText_="Picture-in-Picture";Oe.registerComponent("PictureInPictureToggle",ZD);class JD extends Mn{constructor(e,i){super(e,i),this.setIcon("fullscreen-enter"),this.on(e,"fullscreenchange",n=>this.handleFullscreenChange(n)),Fe[e.fsApi_.fullscreenEnabled]===!1&&this.disable()}buildCSSClass(){return`vjs-fullscreen-control ${super.buildCSSClass()}`}handleFullscreenChange(e){this.player_.isFullscreen()?(this.controlText("Exit Fullscreen"),this.setIcon("fullscreen-exit")):(this.controlText("Fullscreen"),this.setIcon("fullscreen-enter"))}handleClick(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()}}JD.prototype.controlText_="Fullscreen";Oe.registerComponent("FullscreenToggle",JD);const zM=function(t,e){e.tech_&&!e.tech_.featuresVolumeControl&&t.addClass("vjs-hidden"),t.on(e,"loadstart",function(){e.tech_.featuresVolumeControl?t.removeClass("vjs-hidden"):t.addClass("vjs-hidden")})};class FM extends Oe{createEl(){const e=super.createEl("div",{className:"vjs-volume-level"});return this.setIcon("circle",e),e.appendChild(super.createEl("span",{className:"vjs-control-text"})),e}}Oe.registerComponent("VolumeLevel",FM);class qM extends Oe{constructor(e,i){super(e,i),this.update=ca(hi(this,this.update),ts)}createEl(){return super.createEl("div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})}update(e,i,n,s){if(!n){const o=mc(this.el_),l=mc(this.player_.el()),c=e.width*i;if(!l||!o)return;const h=e.left-l.left+c,f=e.width-c+(l.right-e.right);let m=o.width/2;h<m?m+=m-h:f<m&&(m=f),m<0?m=0:m>o.width&&(m=o.width),this.el_.style.right=`-${m}px`}this.write(`${s}%`)}write(e){nl(this.el_,e)}updateVolume(e,i,n,s,o){this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",()=>{this.update(e,i,n,s.toFixed(0)),o&&o()})}}Oe.registerComponent("VolumeLevelTooltip",qM);class e4 extends Oe{constructor(e,i){super(e,i),this.update=ca(hi(this,this.update),ts)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,i,n){const s=100*i;this.getChild("volumeLevelTooltip").updateVolume(e,i,n,s,()=>{n?this.el_.style.bottom=`${e.height*i}px`:this.el_.style.left=`${e.width*i}px`})}}e4.prototype.options_={children:["volumeLevelTooltip"]};Oe.registerComponent("MouseVolumeLevelDisplay",e4);class kp extends A_{constructor(e,i){super(e,i),this.on("slideractive",n=>this.updateLastVolume_(n)),this.on(e,"volumechange",n=>this.updateARIAAttributes(n)),e.ready(()=>this.updateARIAAttributes())}createEl(){return super.createEl("div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})}handleMouseDown(e){Jd(e)&&super.handleMouseDown(e)}handleMouseMove(e){const i=this.getChild("mouseVolumeLevelDisplay");if(i){const n=this.el(),s=mc(n),o=this.vertical();let l=Tp(n,e);l=o?l.y:l.x,l=rh(l,0,1),i.update(s,l,o)}Jd(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))}checkMuted(){this.player_.muted()&&this.player_.muted(!1)}getPercent(){return this.player_.muted()?0:this.player_.volume()}stepForward(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)}stepBack(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)}updateARIAAttributes(e){const i=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",i),this.el_.setAttribute("aria-valuetext",i+"%")}volumeAsPercentage_(){return Math.round(this.player_.volume()*100)}updateLastVolume_(){const e=this.player_.volume();this.one("sliderinactive",()=>{this.player_.volume()===0&&this.player_.lastVolume_(e)})}}kp.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"};!In&&!Os&&kp.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay");kp.prototype.playerEvent="volumechange";Oe.registerComponent("VolumeBar",kp);class t4 extends Oe{constructor(e,i={}){i.vertical=i.vertical||!1,(typeof i.volumeBar>"u"||fc(i.volumeBar))&&(i.volumeBar=i.volumeBar||{},i.volumeBar.vertical=i.vertical),super(e,i),zM(this,e),this.throttledHandleMouseMove=ca(hi(this,this.handleMouseMove),ts),this.handleMouseUpHandler_=n=>this.handleMouseUp(n),this.on("mousedown",n=>this.handleMouseDown(n)),this.on("touchstart",n=>this.handleMouseDown(n)),this.on("mousemove",n=>this.handleMouseMove(n)),this.on(this.volumeBar,["focus","slideractive"],()=>{this.volumeBar.addClass("vjs-slider-active"),this.addClass("vjs-slider-active"),this.trigger("slideractive")}),this.on(this.volumeBar,["blur","sliderinactive"],()=>{this.volumeBar.removeClass("vjs-slider-active"),this.removeClass("vjs-slider-active"),this.trigger("sliderinactive")})}createEl(){let e="vjs-volume-horizontal";return this.options_.vertical&&(e="vjs-volume-vertical"),super.createEl("div",{className:`vjs-volume-control vjs-control ${e}`})}handleMouseDown(e){const i=this.el_.ownerDocument;this.on(i,"mousemove",this.throttledHandleMouseMove),this.on(i,"touchmove",this.throttledHandleMouseMove),this.on(i,"mouseup",this.handleMouseUpHandler_),this.on(i,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const i=this.el_.ownerDocument;this.off(i,"mousemove",this.throttledHandleMouseMove),this.off(i,"touchmove",this.throttledHandleMouseMove),this.off(i,"mouseup",this.handleMouseUpHandler_),this.off(i,"touchend",this.handleMouseUpHandler_)}handleMouseMove(e){this.volumeBar.handleMouseMove(e)}}t4.prototype.options_={children:["volumeBar"]};Oe.registerComponent("VolumeControl",t4);const jM=function(t,e){e.tech_&&!e.tech_.featuresMuteControl&&t.addClass("vjs-hidden"),t.on(e,"loadstart",function(){e.tech_.featuresMuteControl?t.removeClass("vjs-hidden"):t.addClass("vjs-hidden")})};class i4 extends Mn{constructor(e,i){super(e,i),jM(this,e),this.on(e,["loadstart","volumechange"],n=>this.update(n))}buildCSSClass(){return`vjs-mute-control ${super.buildCSSClass()}`}handleClick(e){const i=this.player_.volume(),n=this.player_.lastVolume_();if(i===0){const s=n<.1?.1:n;this.player_.volume(s),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())}update(e){this.updateIcon_(),this.updateControlText_()}updateIcon_(){const e=this.player_.volume();let i=3;this.setIcon("volume-high"),In&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),e===0||this.player_.muted()?(this.setIcon("volume-mute"),i=0):e<.33?(this.setIcon("volume-low"),i=1):e<.67&&(this.setIcon("volume-medium"),i=2),vp(this.el_,[0,1,2,3].reduce((n,s)=>n+`${s?" ":""}vjs-vol-${s}`,"")),Yl(this.el_,`vjs-vol-${i}`)}updateControlText_(){const i=this.player_.muted()||this.player_.volume()===0?"Unmute":"Mute";this.controlText()!==i&&this.controlText(i)}}i4.prototype.controlText_="Mute";Oe.registerComponent("MuteToggle",i4);class n4 extends Oe{constructor(e,i={}){typeof i.inline<"u"?i.inline=i.inline:i.inline=!0,(typeof i.volumeControl>"u"||fc(i.volumeControl))&&(i.volumeControl=i.volumeControl||{},i.volumeControl.vertical=!i.inline),super(e,i),this.handleKeyPressHandler_=n=>this.handleKeyPress(n),this.on(e,["loadstart"],n=>this.volumePanelState_(n)),this.on(this.muteToggle,"keyup",n=>this.handleKeyPress(n)),this.on(this.volumeControl,"keyup",n=>this.handleVolumeControlKeyUp(n)),this.on("keydown",n=>this.handleKeyPress(n)),this.on("mouseover",n=>this.handleMouseOver(n)),this.on("mouseout",n=>this.handleMouseOut(n)),this.on(this.volumeControl,["slideractive"],this.sliderActive_),this.on(this.volumeControl,["sliderinactive"],this.sliderInactive_)}sliderActive_(){this.addClass("vjs-slider-active")}sliderInactive_(){this.removeClass("vjs-slider-active")}volumePanelState_(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")}createEl(){let e="vjs-volume-panel-horizontal";return this.options_.inline||(e="vjs-volume-panel-vertical"),super.createEl("div",{className:`vjs-volume-panel vjs-control ${e}`})}dispose(){this.handleMouseOut(),super.dispose()}handleVolumeControlKeyUp(e){e.key==="Escape"&&this.muteToggle.focus()}handleMouseOver(e){this.addClass("vjs-hover"),Or(Fe,"keyup",this.handleKeyPressHandler_)}handleMouseOut(e){this.removeClass("vjs-hover"),Rn(Fe,"keyup",this.handleKeyPressHandler_)}handleKeyPress(e){e.key==="Escape"&&this.handleMouseOut()}}n4.prototype.options_={children:["muteToggle","volumeControl"]};Oe.registerComponent("VolumePanel",n4);class r4 extends Mn{constructor(e,i){super(e,i),this.validOptions=[5,10,30],this.skipTime=this.getSkipForwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`forward-${this.skipTime}`),this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipForwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.forward}buildCSSClass(){return`vjs-skip-forward-${this.getSkipForwardTime()} ${super.buildCSSClass()}`}handleClick(e){if(isNaN(this.player_.duration()))return;const i=this.player_.currentTime(),n=this.player_.liveTracker,s=n&&n.isLive()?n.seekableEnd():this.player_.duration();let o;i+this.skipTime<=s?o=i+this.skipTime:o=s,this.player_.currentTime(o)}handleLanguagechange(){this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime]))}}r4.prototype.controlText_="Skip Forward";Oe.registerComponent("SkipForward",r4);class s4 extends Mn{constructor(e,i){super(e,i),this.validOptions=[5,10,30],this.skipTime=this.getSkipBackwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`replay-${this.skipTime}`),this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipBackwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.backward}buildCSSClass(){return`vjs-skip-backward-${this.getSkipBackwardTime()} ${super.buildCSSClass()}`}handleClick(e){const i=this.player_.currentTime(),n=this.player_.liveTracker,s=n&&n.isLive()&&n.seekableStart();let o;s&&i-this.skipTime<=s?o=s:i>=this.skipTime?o=i-this.skipTime:o=0,this.player_.currentTime(o)}handleLanguagechange(){this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime]))}}s4.prototype.controlText_="Skip Backward";Oe.registerComponent("SkipBackward",s4);class a4 extends Oe{constructor(e,i){super(e,i),i&&(this.menuButton_=i.menuButton),this.focusedChild_=-1,this.on("keydown",n=>this.handleKeyDown(n)),this.boundHandleBlur_=n=>this.handleBlur(n),this.boundHandleTapClick_=n=>this.handleTapClick(n)}addEventListenerForItem(e){e instanceof Oe&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))}removeEventListenerForItem(e){e instanceof Oe&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))}removeChild(e){typeof e=="string"&&(e=this.getChild(e)),this.removeEventListenerForItem(e),super.removeChild(e)}addItem(e){const i=this.addChild(e);i&&this.addEventListenerForItem(i)}createEl(){const e=this.options_.contentElType||"ul";this.contentEl_=ut(e,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");const i=super.createEl("div",{append:this.contentEl_,className:"vjs-menu"});return i.appendChild(this.contentEl_),Or(i,"click",function(n){n.preventDefault(),n.stopImmediatePropagation()}),i}dispose(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,super.dispose()}handleBlur(e){const i=e.relatedTarget||Fe.activeElement;if(!this.children().some(n=>n.el()===i)){const n=this.menuButton_;n&&n.buttonPressed_&&i!==n.el().firstChild&&n.unpressButton()}}handleTapClick(e){if(this.menuButton_){this.menuButton_.unpressButton();const i=this.children();if(!Array.isArray(i))return;const n=i.filter(s=>s.el()===e.target)[0];if(!n)return;n.name()!=="CaptionSettingsMenuItem"&&this.menuButton_.focus()}}handleKeyDown(e){e.key==="ArrowLeft"||e.key==="ArrowDown"?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(e.key==="ArrowRight"||e.key==="ArrowUp")&&(e.preventDefault(),e.stopPropagation(),this.stepBack())}stepForward(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_+1),this.focus(e)}stepBack(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_-1),this.focus(e)}focus(e=0){const i=this.children().slice();i.length&&i[0].hasClass("vjs-menu-title")&&i.shift(),i.length>0&&(e<0?e=0:e>=i.length&&(e=i.length-1),this.focusedChild_=e,i[e].el_.focus())}}Oe.registerComponent("Menu",a4);class k_ extends Oe{constructor(e,i={}){super(e,i),this.menuButton_=new Mn(e,i),this.menuButton_.controlText(this.controlText_),this.menuButton_.el_.setAttribute("aria-haspopup","true");const n=Mn.prototype.buildCSSClass();this.menuButton_.el_.className=this.buildCSSClass()+" "+n,this.menuButton_.removeClass("vjs-control"),this.addChild(this.menuButton_),this.update(),this.enabled_=!0;const s=o=>this.handleClick(o);this.handleMenuKeyUp_=o=>this.handleMenuKeyUp(o),this.on(this.menuButton_,"tap",s),this.on(this.menuButton_,"click",s),this.on(this.menuButton_,"keydown",o=>this.handleKeyDown(o)),this.on(this.menuButton_,"mouseenter",()=>{this.addClass("vjs-hover"),this.menu.show(),Or(Fe,"keyup",this.handleMenuKeyUp_)}),this.on("mouseleave",o=>this.handleMouseLeave(o)),this.on("keydown",o=>this.handleSubmenuKeyDown(o))}update(){const e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))}createMenu(){const e=new a4(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){const i=ut("li",{className:"vjs-menu-title",textContent:Oi(this.options_.title),tabIndex:-1}),n=new Oe(this.player_,{el:i});e.addItem(n)}if(this.items=this.createItems(),this.items)for(let i=0;i<this.items.length;i++)e.addItem(this.items[i]);return e}createItems(){}createEl(){return super.createEl("div",{className:this.buildWrapperCSSClass()},{})}setIcon(e){super.setIcon(e,this.menuButton_.el_)}buildWrapperCSSClass(){let e="vjs-menu-button";this.options_.inline===!0?e+="-inline":e+="-popup";const i=Mn.prototype.buildCSSClass();return`vjs-menu-button ${e} ${i} ${super.buildCSSClass()}`}buildCSSClass(){let e="vjs-menu-button";return this.options_.inline===!0?e+="-inline":e+="-popup",`vjs-menu-button ${e} ${super.buildCSSClass()}`}controlText(e,i=this.menuButton_.el()){return this.menuButton_.controlText(e,i)}dispose(){this.handleMouseLeave(),super.dispose()}handleClick(e){this.buttonPressed_?this.unpressButton():this.pressButton()}handleMouseLeave(e){this.removeClass("vjs-hover"),Rn(Fe,"keyup",this.handleMenuKeyUp_)}focus(){this.menuButton_.focus()}blur(){this.menuButton_.blur()}handleKeyDown(e){e.key==="Escape"||e.key==="Tab"?(this.buttonPressed_&&this.unpressButton(),!e.key==="Tab"&&(e.preventDefault(),this.menuButton_.focus())):(e.key==="Up"||e.key==="Down"&&!(this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled))&&(this.buttonPressed_||(e.preventDefault(),this.pressButton()))}handleMenuKeyUp(e){(e.key==="Escape"||e.key==="Tab")&&this.removeClass("vjs-hover")}handleSubmenuKeyPress(e){this.handleSubmenuKeyDown(e)}handleSubmenuKeyDown(e){(e.key==="Escape"||e.key==="Tab")&&(this.buttonPressed_&&this.unpressButton(),!e.key==="Tab"&&(e.preventDefault(),this.menuButton_.focus()))}pressButton(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),In&&gD())return;this.menu.focus()}}unpressButton(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))}disable(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()}enable(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()}}Oe.registerComponent("MenuButton",k_);class $_ extends k_{constructor(e,i){const n=i.tracks;if(super(e,i),this.items.length<=1&&this.hide(),!n)return;const s=hi(this,this.update);n.addEventListener("removetrack",s),n.addEventListener("addtrack",s),n.addEventListener("labelchange",s),this.player_.on("ready",s),this.player_.on("dispose",function(){n.removeEventListener("removetrack",s),n.removeEventListener("addtrack",s),n.removeEventListener("labelchange",s)})}}Oe.registerComponent("TrackButton",$_);class sh extends Ap{constructor(e,i){super(e,i),this.selectable=i.selectable,this.isSelected_=i.selected||!1,this.multiSelectable=i.multiSelectable,this.selected(this.isSelected_),this.selectable?this.multiSelectable?this.el_.setAttribute("role","menuitemcheckbox"):this.el_.setAttribute("role","menuitemradio"):this.el_.setAttribute("role","menuitem")}createEl(e,i,n){this.nonIconControl=!0;const s=super.createEl("li",Object.assign({className:"vjs-menu-item",tabIndex:-1},i),n),o=ut("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)});return this.player_.options_.experimentalSvgIcons?s.appendChild(o):s.replaceChild(o,s.querySelector(".vjs-icon-placeholder")),s}handleKeyDown(e){["Tab","Escape","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"].includes(e.key)||super.handleKeyDown(e)}handleClick(e){this.selected(!0)}selected(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))}}Oe.registerComponent("MenuItem",sh);class ah extends sh{constructor(e,i){const n=i.track,s=e.textTracks();i.label=n.label||n.language||"Unknown",i.selected=n.mode==="showing",super(e,i),this.track=n,this.kinds=(i.kinds||[i.kind||this.track.kind]).filter(Boolean);const o=(...c)=>{this.handleTracksChange.apply(this,c)},l=(...c)=>{this.handleSelectedLanguageChange.apply(this,c)};if(e.on(["loadstart","texttrackchange"],o),s.addEventListener("change",o),s.addEventListener("selectedlanguagechange",l),this.on("dispose",function(){e.off(["loadstart","texttrackchange"],o),s.removeEventListener("change",o),s.removeEventListener("selectedlanguagechange",l)}),s.onchange===void 0){let c;this.on(["tap","click"],function(){if(typeof te.Event!="object")try{c=new te.Event("change")}catch{}c||(c=Fe.createEvent("Event"),c.initEvent("change",!0,!0)),s.dispatchEvent(c)})}this.handleTracksChange()}handleClick(e){const i=this.track,n=this.player_.textTracks();if(super.handleClick(e),!!n)for(let s=0;s<n.length;s++){const o=n[s];this.kinds.indexOf(o.kind)!==-1&&(o===i?o.mode!=="showing"&&(o.mode="showing"):o.mode!=="disabled"&&(o.mode="disabled"))}}handleTracksChange(e){const i=this.track.mode==="showing";i!==this.isSelected_&&this.selected(i)}handleSelectedLanguageChange(e){if(this.track.mode==="showing"){const i=this.player_.cache_.selectedLanguage;if(i&&i.enabled&&i.language===this.track.language&&i.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}}dispose(){this.track=null,super.dispose()}}Oe.registerComponent("TextTrackMenuItem",ah);class o4 extends ah{constructor(e,i){i.track={player:e,kind:i.kind,kinds:i.kinds,default:!1,mode:"disabled"},i.kinds||(i.kinds=[i.kind]),i.label?i.track.label=i.label:i.track.label=i.kinds.join(" and ")+" off",i.selectable=!0,i.multiSelectable=!1,super(e,i)}handleTracksChange(e){const i=this.player().textTracks();let n=!0;for(let s=0,o=i.length;s<o;s++){const l=i[s];if(this.options_.kinds.indexOf(l.kind)>-1&&l.mode==="showing"){n=!1;break}}n!==this.isSelected_&&this.selected(n)}handleSelectedLanguageChange(e){const i=this.player().textTracks();let n=!0;for(let s=0,o=i.length;s<o;s++){const l=i[s];if(["captions","descriptions","subtitles"].indexOf(l.kind)>-1&&l.mode==="showing"){n=!1;break}}n&&(this.player_.cache_.selectedLanguage={enabled:!1})}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.label),super.handleLanguagechange()}}Oe.registerComponent("OffTextTrackMenuItem",o4);class wc extends $_{constructor(e,i={}){i.tracks=e.textTracks(),super(e,i)}createItems(e=[],i=ah){let n;this.label_&&(n=`${this.label_} off`),e.push(new o4(this.player_,{kinds:this.kinds_,kind:this.kind_,label:n})),this.hideThreshold_+=1;const s=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(let o=0;o<s.length;o++){const l=s[o];if(this.kinds_.indexOf(l.kind)>-1){const c=new i(this.player_,{track:l,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});c.addClass(`vjs-${l.kind}-menu-item`),e.push(c)}}return e}}Oe.registerComponent("TextTrackButton",wc);class l4 extends sh{constructor(e,i){const n=i.track,s=i.cue,o=e.currentTime();i.selectable=!0,i.multiSelectable=!1,i.label=s.text,i.selected=s.startTime<=o&&o<s.endTime,super(e,i),this.track=n,this.cue=s}handleClick(e){super.handleClick(),this.player_.currentTime(this.cue.startTime)}}Oe.registerComponent("ChaptersTrackMenuItem",l4);class O_ extends wc{constructor(e,i,n){super(e,i,n),this.setIcon("chapters"),this.selectCurrentItem_=()=>{this.items.forEach(s=>{s.selected(this.track_.activeCues[0]===s.cue)})}}buildCSSClass(){return`vjs-chapters-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-chapters-button ${super.buildWrapperCSSClass()}`}update(e){if(e&&e.track&&e.track.kind!=="chapters")return;const i=this.findChaptersTrack();i!==this.track_?(this.setTrack(i),super.update()):(!this.items||i&&i.cues&&i.cues.length!==this.items.length)&&super.update()}setTrack(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){const i=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);i&&i.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";const i=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);i&&i.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}}findChaptersTrack(){const e=this.player_.textTracks()||[];for(let i=e.length-1;i>=0;i--){const n=e[i];if(n.kind===this.kind_)return n}}getMenuCaption(){return this.track_&&this.track_.label?this.track_.label:this.localize(Oi(this.kind_))}createMenu(){return this.options_.title=this.getMenuCaption(),super.createMenu()}createItems(){const e=[];if(!this.track_)return e;const i=this.track_.cues;if(!i)return e;for(let n=0,s=i.length;n<s;n++){const o=i[n],l=new l4(this.player_,{track:this.track_,cue:o});e.push(l)}return e}}O_.prototype.kind_="chapters";O_.prototype.controlText_="Chapters";Oe.registerComponent("ChaptersButton",O_);class I_ extends wc{constructor(e,i,n){super(e,i,n),this.setIcon("audio-description");const s=e.textTracks(),o=hi(this,this.handleTracksChange);s.addEventListener("change",o),this.on("dispose",function(){s.removeEventListener("change",o)})}handleTracksChange(e){const i=this.player().textTracks();let n=!1;for(let s=0,o=i.length;s<o;s++){const l=i[s];if(l.kind!==this.kind_&&l.mode==="showing"){n=!0;break}}n?this.disable():this.enable()}buildCSSClass(){return`vjs-descriptions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-descriptions-button ${super.buildWrapperCSSClass()}`}}I_.prototype.kind_="descriptions";I_.prototype.controlText_="Descriptions";Oe.registerComponent("DescriptionsButton",I_);class R_ extends wc{constructor(e,i,n){super(e,i,n),this.setIcon("subtitles")}buildCSSClass(){return`vjs-subtitles-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subtitles-button ${super.buildWrapperCSSClass()}`}}R_.prototype.kind_="subtitles";R_.prototype.controlText_="Subtitles";Oe.registerComponent("SubtitlesButton",R_);class M_ extends ah{constructor(e,i){i.track={player:e,kind:i.kind,label:i.kind+" settings",selectable:!1,default:!1,mode:"disabled"},i.selectable=!1,i.name="CaptionSettingsMenuItem",super(e,i),this.addClass("vjs-texttrack-settings"),this.controlText(", opens "+i.kind+" settings dialog")}handleClick(e){this.player().getChild("textTrackSettings").open()}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.kind+" settings"),super.handleLanguagechange()}}Oe.registerComponent("CaptionSettingsMenuItem",M_);class N_ extends wc{constructor(e,i,n){super(e,i,n),this.setIcon("captions")}buildCSSClass(){return`vjs-captions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-captions-button ${super.buildWrapperCSSClass()}`}createItems(){const e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new M_(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),super.createItems(e)}}N_.prototype.kind_="captions";N_.prototype.controlText_="Captions";Oe.registerComponent("CaptionsButton",N_);class u4 extends ah{createEl(e,i,n){const s=super.createEl(e,i,n),o=s.querySelector(".vjs-menu-item-text");return this.options_.track.kind==="captions"&&(this.player_.options_.experimentalSvgIcons?this.setIcon("captions",s):o.appendChild(ut("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),o.appendChild(ut("span",{className:"vjs-control-text",textContent:` ${this.localize("Captions")}`}))),s}}Oe.registerComponent("SubsCapsMenuItem",u4);class B_ extends wc{constructor(e,i={}){super(e,i),this.label_="subtitles",this.setIcon("subtitles"),["en","en-us","en-ca","fr-ca"].indexOf(this.player_.language_)>-1&&(this.label_="captions",this.setIcon("captions")),this.menuButton_.controlText(Oi(this.label_))}buildCSSClass(){return`vjs-subs-caps-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subs-caps-button ${super.buildWrapperCSSClass()}`}createItems(){let e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new M_(this.player_,{kind:this.label_})),this.hideThreshold_+=1),e=super.createItems(e,u4),e}}B_.prototype.kinds_=["captions","subtitles"];B_.prototype.controlText_="Subtitles";Oe.registerComponent("SubsCapsButton",B_);class c4 extends sh{constructor(e,i){const n=i.track,s=e.audioTracks();i.label=n.label||n.language||"Unknown",i.selected=n.enabled,super(e,i),this.track=n,this.addClass(`vjs-${n.kind}-menu-item`);const o=(...l)=>{this.handleTracksChange.apply(this,l)};s.addEventListener("change",o),this.on("dispose",()=>{s.removeEventListener("change",o)})}createEl(e,i,n){const s=super.createEl(e,i,n),o=s.querySelector(".vjs-menu-item-text");return["main-desc","descriptions"].indexOf(this.options_.track.kind)>=0&&(o.appendChild(ut("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),o.appendChild(ut("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),s}handleClick(e){if(super.handleClick(e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks){const i=this.player_.audioTracks();for(let n=0;n<i.length;n++){const s=i[n];s!==this.track&&(s.enabled=s===this.track)}}}handleTracksChange(e){this.selected(this.track.enabled)}}Oe.registerComponent("AudioTrackMenuItem",c4);class d4 extends $_{constructor(e,i={}){i.tracks=e.audioTracks(),super(e,i),this.setIcon("audio")}buildCSSClass(){return`vjs-audio-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-audio-button ${super.buildWrapperCSSClass()}`}createItems(e=[]){this.hideThreshold_=1;const i=this.player_.audioTracks();for(let n=0;n<i.length;n++){const s=i[n];e.push(new c4(this.player_,{track:s,selectable:!0,multiSelectable:!1}))}return e}}d4.prototype.controlText_="Audio Track";Oe.registerComponent("AudioTrackButton",d4);class L_ extends sh{constructor(e,i){const n=i.rate,s=parseFloat(n,10);i.label=n,i.selected=s===e.playbackRate(),i.selectable=!0,i.multiSelectable=!1,super(e,i),this.label=n,this.rate=s,this.on(e,"ratechange",o=>this.update(o))}handleClick(e){super.handleClick(),this.player().playbackRate(this.rate)}update(e){this.selected(this.player().playbackRate()===this.rate)}}L_.prototype.contentElType="button";Oe.registerComponent("PlaybackRateMenuItem",L_);class h4 extends k_{constructor(e,i){super(e,i),this.menuButton_.el_.setAttribute("aria-describedby",this.labelElId_),this.updateVisibility(),this.updateLabel(),this.on(e,"loadstart",n=>this.updateVisibility(n)),this.on(e,"ratechange",n=>this.updateLabel(n)),this.on(e,"playbackrateschange",n=>this.handlePlaybackRateschange(n))}createEl(){const e=super.createEl();return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=ut("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),e.appendChild(this.labelEl_),e}dispose(){this.labelEl_=null,super.dispose()}buildCSSClass(){return`vjs-playback-rate ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-playback-rate ${super.buildWrapperCSSClass()}`}createItems(){const e=this.playbackRates(),i=[];for(let n=e.length-1;n>=0;n--)i.push(new L_(this.player(),{rate:e[n]+"x"}));return i}handlePlaybackRateschange(e){this.update()}playbackRates(){const e=this.player();return e.playbackRates&&e.playbackRates()||[]}playbackRateSupported(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0}updateVisibility(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")}updateLabel(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")}}h4.prototype.controlText_="Playback Rate";Oe.registerComponent("PlaybackRateMenuButton",h4);class f4 extends Oe{buildCSSClass(){return`vjs-spacer ${super.buildCSSClass()}`}createEl(e="div",i={},n={}){return i.className||(i.className=this.buildCSSClass()),super.createEl(e,i,n)}}Oe.registerComponent("Spacer",f4);class HM extends f4{buildCSSClass(){return`vjs-custom-control-spacer ${super.buildCSSClass()}`}createEl(){return super.createEl("div",{className:this.buildCSSClass(),textContent:""})}}Oe.registerComponent("CustomControlSpacer",HM);class p4 extends Oe{createEl(){return super.createEl("div",{className:"vjs-control-bar",dir:"ltr"})}}p4.prototype.options_={children:["playToggle","skipBackward","skipForward","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","pictureInPictureToggle","fullscreenToggle"]};Oe.registerComponent("ControlBar",p4);class m4 extends xc{constructor(e,i){super(e,i),this.on(e,"error",n=>{this.open(n)})}buildCSSClass(){return`vjs-error-display ${super.buildCSSClass()}`}content(){const e=this.player().error();return e?this.localize(e.message):""}}m4.prototype.options_=Object.assign({},xc.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0});Oe.registerComponent("ErrorDisplay",m4);class g4 extends Oe{constructor(e,i={}){super(e,i),this.el_.setAttribute("aria-labelledby",this.selectLabelledbyIds)}createEl(){return this.selectLabelledbyIds=[this.options_.legendId,this.options_.labelId].join(" ").trim(),ut("select",{id:this.options_.id},{},this.options_.SelectOptions.map(i=>{const n=(this.options_.labelId?this.options_.labelId:`vjs-track-option-${es()}`)+"-"+i[1].replace(/\W+/g,""),s=ut("option",{id:n,value:this.localize(i[0]),textContent:this.localize(i[1])});return s.setAttribute("aria-labelledby",`${this.selectLabelledbyIds} ${n}`),s}))}}Oe.registerComponent("TextTrackSelect",g4);class Zl extends Oe{constructor(e,i={}){super(e,i);const n=ut("legend",{textContent:this.localize(this.options_.legendText),id:this.options_.legendId});this.el().appendChild(n);const s=this.options_.selects;for(const o of s){const l=this.options_.selectConfigs[o],c=l.className,h=l.id.replace("%s",this.options_.id_);let f=null;const m=`vjs_select_${es()}`;if(this.options_.type==="colors"){f=ut("span",{className:c});const E=ut("label",{id:h,className:"vjs-label",textContent:this.localize(l.label)});E.setAttribute("for",m),f.appendChild(E)}const _=new g4(e,{SelectOptions:l.options,legendId:this.options_.legendId,id:m,labelId:h});this.addChild(_),this.options_.type==="colors"&&(f.appendChild(_.el()),this.el().appendChild(f))}}createEl(){return ut("fieldset",{className:this.options_.className})}}Oe.registerComponent("TextTrackFieldset",Zl);class y4 extends Oe{constructor(e,i={}){super(e,i);const n=this.options_.textTrackComponentid,s=new Zl(e,{id_:n,legendId:`captions-text-legend-${n}`,legendText:this.localize("Text"),className:"vjs-fg vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(s);const o=new Zl(e,{id_:n,legendId:`captions-background-${n}`,legendText:this.localize("Text Background"),className:"vjs-bg vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(o);const l=new Zl(e,{id_:n,legendId:`captions-window-${n}`,legendText:this.localize("Caption Area Background"),className:"vjs-window vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(l)}createEl(){return ut("div",{className:"vjs-track-settings-colors"})}}Oe.registerComponent("TextTrackSettingsColors",y4);class _4 extends Oe{constructor(e,i={}){super(e,i);const n=this.options_.textTrackComponentid,s=new Zl(e,{id_:n,legendId:`captions-font-size-${n}`,legendText:"Font Size",className:"vjs-font-percent vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(s);const o=new Zl(e,{id_:n,legendId:`captions-edge-style-${n}`,legendText:this.localize("Text Edge Style"),className:"vjs-edge-style vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(o);const l=new Zl(e,{id_:n,legendId:`captions-font-family-${n}`,legendText:this.localize("Font Family"),className:"vjs-font-family vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(l)}createEl(){return ut("div",{className:"vjs-track-settings-font"})}}Oe.registerComponent("TextTrackSettingsFont",_4);class v4 extends Oe{constructor(e,i={}){super(e,i);const n=new Mn(e,{controlText:this.localize("restore all settings to the default values"),className:"vjs-default-button"});n.el().classList.remove("vjs-control","vjs-button"),n.el().textContent=this.localize("Reset"),this.addChild(n);const s=this.localize("Done"),o=new Mn(e,{controlText:s,className:"vjs-done-button"});o.el().classList.remove("vjs-control","vjs-button"),o.el().textContent=s,this.addChild(o)}createEl(){return ut("div",{className:"vjs-track-settings-controls"})}}Oe.registerComponent("TrackSettingsControls",v4);const R0="vjs-text-track-settings",xw=["#000","Black"],Sw=["#00F","Blue"],ww=["#0FF","Cyan"],Ew=["#0F0","Green"],Cw=["#F0F","Magenta"],Aw=["#F00","Red"],Dw=["#FFF","White"],kw=["#FF0","Yellow"],M0=["1","Opaque"],N0=["0.5","Semi-Transparent"],$w=["0","Transparent"],Zo={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[xw,Dw,Aw,Ew,Sw,kw,Cw,ww],className:"vjs-bg-color"},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Opacity",options:[M0,N0,$w],className:"vjs-bg-opacity vjs-opacity"},color:{selector:".vjs-text-color > select",id:"captions-foreground-color-%s",label:"Color",options:[Dw,xw,Aw,Ew,Sw,kw,Cw,ww],className:"vjs-text-color"},edgeStyle:{selector:".vjs-edge-style > select",id:"",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Drop shadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:t=>t==="1.00"?null:Number(t)},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Opacity",options:[M0,N0],className:"vjs-text-opacity vjs-opacity"},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color",className:"vjs-window-color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Opacity",options:[$w,N0,M0],className:"vjs-window-opacity vjs-opacity"}};Zo.windowColor.options=Zo.backgroundColor.options;function b4(t,e){if(e&&(t=e(t)),t&&t!=="none")return t}function VM(t,e){const i=t.options[t.options.selectedIndex].value;return b4(i,e)}function GM(t,e,i){if(e){for(let n=0;n<t.options.length;n++)if(b4(t.options[n].value,i)===e){t.selectedIndex=n;break}}}class WM extends xc{constructor(e,i){i.temporary=!1,super(e,i),this.updateDisplay=this.updateDisplay.bind(this),this.fill(),this.hasBeenOpened_=this.hasBeenFilled_=!0,this.renderModalComponents(e),this.endDialog=ut("p",{className:"vjs-control-text",textContent:this.localize("End of dialog window.")}),this.el().appendChild(this.endDialog),this.setDefaults(),i.persistTextTrackSettings===void 0&&(this.options_.persistTextTrackSettings=this.options_.playerOptions.persistTextTrackSettings),this.bindFunctionsToSelectsAndButtons(),this.options_.persistTextTrackSettings&&this.restoreSettings()}renderModalComponents(e){const i=new y4(e,{textTrackComponentid:this.id_,selectConfigs:Zo,fieldSets:[["color","textOpacity"],["backgroundColor","backgroundOpacity"],["windowColor","windowOpacity"]]});this.addChild(i);const n=new _4(e,{textTrackComponentid:this.id_,selectConfigs:Zo,fieldSets:[["fontPercent"],["edgeStyle"],["fontFamily"]]});this.addChild(n);const s=new v4(e);this.addChild(s)}bindFunctionsToSelectsAndButtons(){this.on(this.$(".vjs-done-button"),["click","tap"],()=>{this.saveSettings(),this.close()}),this.on(this.$(".vjs-default-button"),["click","tap"],()=>{this.setDefaults(),this.updateDisplay()}),Zu(Zo,e=>{this.on(this.$(e.selector),"change",this.updateDisplay)})}dispose(){this.endDialog=null,super.dispose()}label(){return this.localize("Caption Settings Dialog")}description(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")}buildCSSClass(){return super.buildCSSClass()+" vjs-text-track-settings"}getValues(){return uD(Zo,(e,i,n)=>{const s=VM(this.$(i.selector),i.parser);return s!==void 0&&(e[n]=s),e},{})}setValues(e){Zu(Zo,(i,n)=>{GM(this.$(i.selector),e[n],i.parser)})}setDefaults(){Zu(Zo,e=>{const i=e.hasOwnProperty("default")?e.default:0;this.$(e.selector).selectedIndex=i})}restoreSettings(){let e;try{e=JSON.parse(te.localStorage.getItem(R0))}catch(i){St.warn(i)}e&&this.setValues(e)}saveSettings(){if(!this.options_.persistTextTrackSettings)return;const e=this.getValues();try{Object.keys(e).length?te.localStorage.setItem(R0,JSON.stringify(e)):te.localStorage.removeItem(R0)}catch(i){St.warn(i)}}updateDisplay(){const e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()}handleLanguagechange(){this.fill(),this.renderModalComponents(this.player_),this.bindFunctionsToSelectsAndButtons()}}Oe.registerComponent("TextTrackSettings",WM);class XM extends Oe{constructor(e,i){let n=i.ResizeObserver||te.ResizeObserver;i.ResizeObserver===null&&(n=!1);const s=ni({createEl:!n,reportTouchActivity:!1},i);super(e,s),this.ResizeObserver=i.ResizeObserver||te.ResizeObserver,this.loadListener_=null,this.resizeObserver_=null,this.debouncedHandler_=ID(()=>{this.resizeHandler()},100,!1,this),n?(this.resizeObserver_=new this.ResizeObserver(this.debouncedHandler_),this.resizeObserver_.observe(e.el())):(this.loadListener_=()=>{if(!this.el_||!this.el_.contentWindow)return;const o=this.debouncedHandler_;let l=this.unloadListener_=function(){Rn(this,"resize",o),Rn(this,"unload",l),l=null};Or(this.el_.contentWindow,"unload",l),Or(this.el_.contentWindow,"resize",o)},this.one("load",this.loadListener_))}createEl(){return super.createEl("iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})}resizeHandler(){!this.player_||!this.player_.trigger||this.player_.trigger("playerresize")}dispose(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,super.dispose()}}Oe.registerComponent("ResizeManager",XM);const KM={trackingThreshold:20,liveTolerance:15};class YM extends Oe{constructor(e,i){const n=ni(KM,i,{createEl:!1});super(e,n),this.trackLiveHandler_=()=>this.trackLive_(),this.handlePlay_=s=>this.handlePlay(s),this.handleFirstTimeupdate_=s=>this.handleFirstTimeupdate(s),this.handleSeeked_=s=>this.handleSeeked(s),this.seekToLiveEdge_=s=>this.seekToLiveEdge(s),this.reset_(),this.on(this.player_,"durationchange",s=>this.handleDurationchange(s)),this.on(this.player_,"canplay",()=>this.toggleTracking())}trackLive_(){const e=this.player_.seekable();if(!e||!e.length)return;const i=Number(te.performance.now().toFixed(4)),n=this.lastTime_===-1?0:(i-this.lastTime_)/1e3;this.lastTime_=i,this.pastSeekEnd_=this.pastSeekEnd()+n;const s=this.liveCurrentTime(),o=this.player_.currentTime();let l=this.player_.paused()||this.seekedBehindLive_||Math.abs(s-o)>this.options_.liveTolerance;(!this.timeupdateSeen_||s===1/0)&&(l=!1),l!==this.behindLiveEdge_&&(this.behindLiveEdge_=l,this.trigger("liveedgechange"))}handleDurationchange(){this.toggleTracking()}toggleTracking(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())}startTracking(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,ts),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))}handleFirstTimeupdate(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)}handleSeeked(){const e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()}handlePlay(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)}reset_(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)}nextSeekedFromUser(){this.nextSeekedFromUser_=!0}stopTracking(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))}seekableEnd(){const e=this.player_.seekable(),i=[];let n=e?e.length:0;for(;n--;)i.push(e.end(n));return i.length?i.sort()[i.length-1]:1/0}seekableStart(){const e=this.player_.seekable(),i=[];let n=e?e.length:0;for(;n--;)i.push(e.start(n));return i.length?i.sort()[0]:0}liveWindow(){const e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()}isLive(){return this.isTracking()}atLiveEdge(){return!this.behindLiveEdge()}liveCurrentTime(){return this.pastSeekEnd()+this.seekableEnd()}pastSeekEnd(){const e=this.seekableEnd();return this.lastSeekEnd_!==-1&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_}behindLiveEdge(){return this.behindLiveEdge_}isTracking(){return typeof this.trackingInterval_=="number"}seekToLiveEdge(){this.seekedBehindLive_=!1,!this.atLiveEdge()&&(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))}dispose(){this.stopTracking(),super.dispose()}}Oe.registerComponent("LiveTracker",YM);class QM extends Oe{constructor(e,i){super(e,i),this.on("statechanged",n=>this.updateDom_()),this.updateDom_()}createEl(){return this.els={title:ut("div",{className:"vjs-title-bar-title",id:`vjs-title-bar-title-${es()}`}),description:ut("div",{className:"vjs-title-bar-description",id:`vjs-title-bar-description-${es()}`})},ut("div",{className:"vjs-title-bar"},{},cD(this.els))}updateDom_(){const e=this.player_.tech_,i=e&&e.el_,n={title:"aria-labelledby",description:"aria-describedby"};["title","description"].forEach(s=>{const o=this.state[s],l=this.els[s],c=n[s];xp(l),o&&nl(l,o),i&&(i.removeAttribute(c),o&&i.setAttribute(c,l.id))}),this.state.title||this.state.description?this.show():this.hide()}update(e){this.setState(e)}dispose(){const e=this.player_.tech_,i=e&&e.el_;i&&(i.removeAttribute("aria-labelledby"),i.removeAttribute("aria-describedby")),super.dispose(),this.els=null}}Oe.registerComponent("TitleBar",QM);const ZM={initialDisplay:4e3,position:[],takeFocus:!1};class JM extends Mn{constructor(e,i){i=ni(ZM,i),super(e,i),this.controlText(i.controlText),this.hide(),this.on(this.player_,["useractive","userinactive"],n=>{this.removeClass("force-display")})}buildCSSClass(){return`vjs-transient-button focus-visible ${this.options_.position.map(e=>`vjs-${e}`).join(" ")}`}createEl(){const e=ut("button",{},{type:"button",class:this.buildCSSClass()},ut("span"));return this.controlTextEl_=e.querySelector("span"),e}show(){super.show(),this.addClass("force-display"),this.options_.takeFocus&&this.el().focus({preventScroll:!0}),this.forceDisplayTimeout=this.player_.setTimeout(()=>{this.removeClass("force-display")},this.options_.initialDisplay)}hide(){this.removeClass("force-display"),super.hide()}dispose(){this.player_.clearTimeout(this.forceDisplayTimeout),super.dispose()}}Oe.registerComponent("TransientButton",JM);const gy=t=>{const e=t.el();if(e.hasAttribute("src"))return t.triggerSourceset(e.src),!0;const i=t.$$("source"),n=[];let s="";if(!i.length)return!1;for(let o=0;o<i.length;o++){const l=i[o].src;l&&n.indexOf(l)===-1&&n.push(l)}return n.length?(n.length===1&&(s=n[0]),t.triggerSourceset(s),!0):!1},eN=Object.defineProperty({},"innerHTML",{get(){return this.cloneNode(!0).innerHTML},set(t){const e=Fe.createElement(this.nodeName.toLowerCase());e.innerHTML=t;const i=Fe.createDocumentFragment();for(;e.childNodes.length;)i.appendChild(e.childNodes[0]);return this.innerText="",te.Element.prototype.appendChild.call(this,i),this.innerHTML}}),T4=(t,e)=>{let i={};for(let n=0;n<t.length&&(i=Object.getOwnPropertyDescriptor(t[n],e),!(i&&i.set&&i.get));n++);return i.enumerable=!0,i.configurable=!0,i},tN=t=>T4([t.el(),te.HTMLMediaElement.prototype,te.Element.prototype,eN],"innerHTML"),Ow=function(t){const e=t.el();if(e.resetSourceWatch_)return;const i={},n=tN(t),s=o=>(...l)=>{const c=o.apply(e,l);return gy(t),c};["append","appendChild","insertAdjacentHTML"].forEach(o=>{e[o]&&(i[o]=e[o],e[o]=s(i[o]))}),Object.defineProperty(e,"innerHTML",ni(n,{set:s(n.set)})),e.resetSourceWatch_=()=>{e.resetSourceWatch_=null,Object.keys(i).forEach(o=>{e[o]=i[o]}),Object.defineProperty(e,"innerHTML",n)},t.one("sourceset",e.resetSourceWatch_)},iN=Object.defineProperty({},"src",{get(){return this.hasAttribute("src")?jD(te.Element.prototype.getAttribute.call(this,"src")):""},set(t){return te.Element.prototype.setAttribute.call(this,"src",t),t}}),nN=t=>T4([t.el(),te.HTMLMediaElement.prototype,iN],"src"),rN=function(t){if(!t.featuresSourceset)return;const e=t.el();if(e.resetSourceset_)return;const i=nN(t),n=e.setAttribute,s=e.load;Object.defineProperty(e,"src",ni(i,{set:o=>{const l=i.set.call(e,o);return t.triggerSourceset(e.src),l}})),e.setAttribute=(o,l)=>{const c=n.call(e,o,l);return/src/i.test(o)&&t.triggerSourceset(e.src),c},e.load=()=>{const o=s.call(e);return gy(t)||(t.triggerSourceset(""),Ow(t)),o},e.currentSrc?t.triggerSourceset(e.currentSrc):gy(t)||Ow(t),e.resetSourceset_=()=>{e.resetSourceset_=null,e.load=s,e.setAttribute=n,Object.defineProperty(e,"src",i),e.resetSourceWatch_&&e.resetSourceWatch_()}};class We extends _t{constructor(e,i){super(e,i);const n=e.source;let s=!1;if(this.featuresVideoFrameCallback=this.featuresVideoFrameCallback&&this.el_.tagName==="VIDEO",n&&(this.el_.currentSrc!==n.src||e.tag&&e.tag.initNetworkState_===3)?this.setSource(n):this.handleLateInit_(this.el_),e.enableSourceset&&this.setupSourcesetHandling_(),this.isScrubbing_=!1,this.el_.hasChildNodes()){const o=this.el_.childNodes;let l=o.length;const c=[];for(;l--;){const h=o[l];h.nodeName.toLowerCase()==="track"&&(this.featuresNativeTextTracks?(this.remoteTextTrackEls().addTrackElement_(h),this.remoteTextTracks().addTrack(h.track),this.textTracks().addTrack(h.track),!s&&!this.el_.hasAttribute("crossorigin")&&Cp(h.src)&&(s=!0)):c.push(h))}for(let h=0;h<c.length;h++)this.el_.removeChild(c[h])}this.proxyNativeTracks_(),this.featuresNativeTextTracks&&s&&St.warn(`Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.
This may prevent text tracks from loading.`),this.restoreMetadataTracksInIOSNativePlayer_(),(Qd||yp)&&e.nativeControlsForTouch===!0&&this.setControls(!0),this.proxyWebkitFullscreen_(),this.triggerReady()}dispose(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),We.disposeMediaElement(this.el_),this.options_=null,super.dispose()}setupSourcesetHandling_(){rN(this)}restoreMetadataTracksInIOSNativePlayer_(){const e=this.textTracks();let i;const n=()=>{i=[];for(let o=0;o<e.length;o++){const l=e[o];l.kind==="metadata"&&i.push({track:l,storedMode:l.mode})}};n(),e.addEventListener("change",n),this.on("dispose",()=>e.removeEventListener("change",n));const s=()=>{for(let o=0;o<i.length;o++){const l=i[o];l.track.mode==="disabled"&&l.track.mode!==l.storedMode&&(l.track.mode=l.storedMode)}e.removeEventListener("change",s)};this.on("webkitbeginfullscreen",()=>{e.removeEventListener("change",n),e.removeEventListener("change",s),e.addEventListener("change",s)}),this.on("webkitendfullscreen",()=>{e.removeEventListener("change",n),e.addEventListener("change",n),e.removeEventListener("change",s)})}overrideNative_(e,i){if(i!==this[`featuresNative${e}Tracks`])return;const n=e.toLowerCase();this[`${n}TracksListeners_`]&&Object.keys(this[`${n}TracksListeners_`]).forEach(s=>{this.el()[`${n}Tracks`].removeEventListener(s,this[`${n}TracksListeners_`][s])}),this[`featuresNative${e}Tracks`]=!i,this[`${n}TracksListeners_`]=null,this.proxyNativeTracksForType_(n)}overrideNativeAudioTracks(e){this.overrideNative_("Audio",e)}overrideNativeVideoTracks(e){this.overrideNative_("Video",e)}proxyNativeTracksForType_(e){const i=Jr[e],n=this.el()[i.getterName],s=this[i.getterName]();if(!this[`featuresNative${i.capitalName}Tracks`]||!n||!n.addEventListener)return;const o={change:c=>{const h={type:"change",target:s,currentTarget:s,srcElement:s};s.trigger(h),e==="text"&&this[yc.remoteText.getterName]().trigger(h)},addtrack(c){s.addTrack(c.track)},removetrack(c){s.removeTrack(c.track)}},l=function(){const c=[];for(let h=0;h<s.length;h++){let f=!1;for(let m=0;m<n.length;m++)if(n[m]===s[h]){f=!0;break}f||c.push(s[h])}for(;c.length;)s.removeTrack(c.shift())};this[i.getterName+"Listeners_"]=o,Object.keys(o).forEach(c=>{const h=o[c];n.addEventListener(c,h),this.on("dispose",f=>n.removeEventListener(c,h))}),this.on("loadstart",l),this.on("dispose",c=>this.off("loadstart",l))}proxyNativeTracks_(){Jr.names.forEach(e=>{this.proxyNativeTracksForType_(e)})}createEl(){let e=this.options_.tag;if(!e||!(this.options_.playerElIngest||this.movingMediaElementInDOM)){if(e){const n=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(n,e),We.disposeMediaElement(e),e=n}else{e=Fe.createElement("video");const n=this.options_.tag&&Qo(this.options_.tag),s=ni({},n);(!Qd||this.options_.nativeControlsForTouch!==!0)&&delete s.controls,vD(e,Object.assign(s,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}typeof this.options_.preload<"u"&&pc(e,"preload",this.options_.preload),this.options_.disablePictureInPicture!==void 0&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);const i=["loop","muted","playsinline","autoplay"];for(let n=0;n<i.length;n++){const s=i[n],o=this.options_[s];typeof o<"u"&&(o?pc(e,s,s):bp(e,s),e[s]=o)}return e}handleLateInit_(e){if(e.networkState===0||e.networkState===3)return;if(e.readyState===0){let n=!1;const s=function(){n=!0};this.on("loadstart",s);const o=function(){n||this.trigger("loadstart")};this.on("loadedmetadata",o),this.ready(function(){this.off("loadstart",s),this.off("loadedmetadata",o),n||this.trigger("loadstart")});return}const i=["loadstart"];i.push("loadedmetadata"),e.readyState>=2&&i.push("loadeddata"),e.readyState>=3&&i.push("canplay"),e.readyState>=4&&i.push("canplaythrough"),this.ready(function(){i.forEach(function(n){this.trigger(n)},this)})}setScrubbing(e){this.isScrubbing_=e}scrubbing(){return this.isScrubbing_}setCurrentTime(e){try{this.isScrubbing_&&this.el_.fastSeek&&_p?this.el_.fastSeek(e):this.el_.currentTime=e}catch(i){St(i,"Video is not ready. (Video.js)")}}duration(){if(this.el_.duration===1/0&&Os&&ua&&this.el_.currentTime===0){const e=()=>{this.el_.currentTime>0&&(this.el_.duration===1/0&&this.trigger("durationchange"),this.off("timeupdate",e))};return this.on("timeupdate",e),NaN}return this.el_.duration||NaN}width(){return this.el_.offsetWidth}height(){return this.el_.offsetHeight}proxyWebkitFullscreen_(){if(!("webkitDisplayingFullscreen"in this.el_))return;const e=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},i=function(){"webkitPresentationMode"in this.el_&&this.el_.webkitPresentationMode!=="picture-in-picture"&&(this.one("webkitendfullscreen",e),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",i),this.on("dispose",()=>{this.off("webkitbeginfullscreen",i),this.off("webkitendfullscreen",e)})}supportsFullScreen(){return typeof this.el_.webkitEnterFullScreen=="function"}enterFullScreen(){const e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)na(this.el_.play()),this.setTimeout(function(){e.pause();try{e.webkitEnterFullScreen()}catch(i){this.trigger("fullscreenerror",i)}},0);else try{e.webkitEnterFullScreen()}catch(i){this.trigger("fullscreenerror",i)}}exitFullScreen(){if(!this.el_.webkitDisplayingFullscreen){this.trigger("fullscreenerror",new Error("The video is not fullscreen"));return}this.el_.webkitExitFullScreen()}requestPictureInPicture(){return this.el_.requestPictureInPicture()}requestVideoFrameCallback(e){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(e):super.requestVideoFrameCallback(e)}cancelVideoFrameCallback(e){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(e):super.cancelVideoFrameCallback(e)}src(e){if(e===void 0)return this.el_.src;this.setSrc(e)}addSourceElement(e,i){if(!e)return St.error("Invalid source URL."),!1;const n={src:e};i&&(n.type=i);const s=ut("source",{},n);return this.el_.appendChild(s),!0}removeSourceElement(e){if(!e)return St.error("Source URL is required to remove the source element."),!1;const i=this.el_.querySelectorAll("source");for(const n of i)if(n.src===e)return this.el_.removeChild(n),!0;return St.warn(`No matching source element found with src: ${e}`),!1}reset(){We.resetMediaElement(this.el_)}currentSrc(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc}setControls(e){this.el_.controls=!!e}addTextTrack(e,i,n){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,i,n):super.addTextTrack(e,i,n)}createRemoteTextTrack(e){if(!this.featuresNativeTextTracks)return super.createRemoteTextTrack(e);const i=Fe.createElement("track");return e.kind&&(i.kind=e.kind),e.label&&(i.label=e.label),(e.language||e.srclang)&&(i.srclang=e.language||e.srclang),e.default&&(i.default=e.default),e.id&&(i.id=e.id),e.src&&(i.src=e.src),i}addRemoteTextTrack(e,i){const n=super.addRemoteTextTrack(e,i);return this.featuresNativeTextTracks&&this.el().appendChild(n),n}removeRemoteTextTrack(e){if(super.removeRemoteTextTrack(e),this.featuresNativeTextTracks){const i=this.$$("track");let n=i.length;for(;n--;)(e===i[n]||e===i[n].track)&&this.el().removeChild(i[n])}}getVideoPlaybackQuality(){if(typeof this.el().getVideoPlaybackQuality=="function")return this.el().getVideoPlaybackQuality();const e={};return typeof this.el().webkitDroppedFrameCount<"u"&&typeof this.el().webkitDecodedFrameCount<"u"&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),te.performance&&(e.creationTime=te.performance.now()),e}}pp(We,"TEST_VID",function(){if(!vc())return;const t=Fe.createElement("video"),e=Fe.createElement("track");return e.kind="captions",e.srclang="en",e.label="English",t.appendChild(e),t});We.isSupported=function(){try{We.TEST_VID.volume=.5}catch{return!1}return!!(We.TEST_VID&&We.TEST_VID.canPlayType)};We.canPlayType=function(t){return We.TEST_VID.canPlayType(t)};We.canPlaySource=function(t,e){return We.canPlayType(t.type)};We.canControlVolume=function(){try{const t=We.TEST_VID.volume;We.TEST_VID.volume=t/2+.1;const e=t!==We.TEST_VID.volume;return e&&In?(te.setTimeout(()=>{We&&We.prototype&&(We.prototype.featuresVolumeControl=t!==We.TEST_VID.volume)}),!1):e}catch{return!1}};We.canMuteVolume=function(){try{const t=We.TEST_VID.muted;return We.TEST_VID.muted=!t,We.TEST_VID.muted?pc(We.TEST_VID,"muted","muted"):bp(We.TEST_VID,"muted","muted"),t!==We.TEST_VID.muted}catch{return!1}};We.canControlPlaybackRate=function(){if(Os&&ua&&mp<58)return!1;try{const t=We.TEST_VID.playbackRate;return We.TEST_VID.playbackRate=t/2+.1,t!==We.TEST_VID.playbackRate}catch{return!1}};We.canOverrideAttributes=function(){try{const t=()=>{};Object.defineProperty(Fe.createElement("video"),"src",{get:t,set:t}),Object.defineProperty(Fe.createElement("audio"),"src",{get:t,set:t}),Object.defineProperty(Fe.createElement("video"),"innerHTML",{get:t,set:t}),Object.defineProperty(Fe.createElement("audio"),"innerHTML",{get:t,set:t})}catch{return!1}return!0};We.supportsNativeTextTracks=function(){return _p||In&&ua};We.supportsNativeVideoTracks=function(){return!!(We.TEST_VID&&We.TEST_VID.videoTracks)};We.supportsNativeAudioTracks=function(){return!!(We.TEST_VID&&We.TEST_VID.audioTracks)};We.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"];[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function([t,e]){pp(We.prototype,t,()=>We[e](),!0)});We.prototype.featuresVolumeControl=We.canControlVolume();We.prototype.movingMediaElementInDOM=!In;We.prototype.featuresFullscreenResize=!0;We.prototype.featuresProgressEvents=!0;We.prototype.featuresTimeupdateEvents=!0;We.prototype.featuresVideoFrameCallback=!!(We.TEST_VID&&We.TEST_VID.requestVideoFrameCallback);We.disposeMediaElement=function(t){if(t){for(t.parentNode&&t.parentNode.removeChild(t);t.hasChildNodes();)t.removeChild(t.firstChild);t.removeAttribute("src"),typeof t.load=="function"&&(function(){try{t.load()}catch{}})()}};We.resetMediaElement=function(t){if(!t)return;const e=t.querySelectorAll("source");let i=e.length;for(;i--;)t.removeChild(e[i]);t.removeAttribute("src"),typeof t.load=="function"&&(function(){try{t.load()}catch{}})()};["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(t){We.prototype[t]=function(){return this.el_[t]||this.el_.hasAttribute(t)}});["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(t){We.prototype["set"+Oi(t)]=function(e){this.el_[t]=e,e?this.el_.setAttribute(t,t):this.el_.removeAttribute(t)}});["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(t){We.prototype[t]=function(){return this.el_[t]}});["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(t){We.prototype["set"+Oi(t)]=function(e){this.el_[t]=e}});["pause","load","play"].forEach(function(t){We.prototype[t]=function(){return this.el_[t]()}});_t.withSourceHandlers(We);We.nativeSourceHandler={};We.nativeSourceHandler.canPlayType=function(t){try{return We.TEST_VID.canPlayType(t)}catch{return""}};We.nativeSourceHandler.canHandleSource=function(t,e){if(t.type)return We.nativeSourceHandler.canPlayType(t.type);if(t.src){const i=x_(t.src);return We.nativeSourceHandler.canPlayType(`video/${i}`)}return""};We.nativeSourceHandler.handleSource=function(t,e,i){e.setSrc(t.src)};We.nativeSourceHandler.dispose=function(){};We.registerSourceHandler(We.nativeSourceHandler);_t.registerTech("Html5",We);const x4=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],B0={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},yy=["tiny","xsmall","small","medium","large","xlarge","huge"],$f={};yy.forEach(t=>{const e=t.charAt(0)==="x"?`x-${t.substring(1)}`:t;$f[t]=`vjs-layout-${e}`});const sN={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0};class Vt extends Oe{constructor(e,i,n){if(e.id=e.id||i.id||`vjs_video_${es()}`,i=Object.assign(Vt.getTagSettings(e),i),i.initChildren=!1,i.createEl=!1,i.evented=!1,i.reportTouchActivity=!1,!i.language){const l=e.closest("[lang]");l&&(i.language=l.getAttribute("lang"))}if(super(null,i,n),this.boundDocumentFullscreenChange_=l=>this.documentFullscreenChange_(l),this.boundFullWindowOnEscKey_=l=>this.fullWindowOnEscKey(l),this.boundUpdateStyleEl_=l=>this.updateStyleEl_(l),this.boundApplyInitTime_=l=>this.applyInitTime_(l),this.boundUpdateCurrentBreakpoint_=l=>this.updateCurrentBreakpoint_(l),this.boundHandleTechClick_=l=>this.handleTechClick_(l),this.boundHandleTechDoubleClick_=l=>this.handleTechDoubleClick_(l),this.boundHandleTechTouchStart_=l=>this.handleTechTouchStart_(l),this.boundHandleTechTouchMove_=l=>this.handleTechTouchMove_(l),this.boundHandleTechTouchEnd_=l=>this.handleTechTouchEnd_(l),this.boundHandleTechTap_=l=>this.handleTechTap_(l),this.boundUpdatePlayerHeightOnAudioOnlyMode_=l=>this.updatePlayerHeightOnAudioOnlyMode_(l),this.isFullscreen_=!1,this.log=oD(this.id_),this.fsApi_=qf,this.isPosterFromTech_=!1,this.queuedCallbacks_=[],this.isReady_=!1,this.hasStarted_=!1,this.userActive_=!1,this.debugEnabled_=!1,this.audioOnlyMode_=!1,this.audioPosterMode_=!1,this.audioOnlyCache_={controlBarHeight:null,playerHeight:null,hiddenChildren:[]},!this.options_||!this.options_.techOrder||!this.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(this.tag=e,this.tagAttributes=e&&Qo(e),this.language(this.options_.language),i.languages){const l={};Object.getOwnPropertyNames(i.languages).forEach(function(c){l[c.toLowerCase()]=i.languages[c]}),this.languages_=l}else this.languages_=Vt.prototype.options_.languages;this.resetCache_(),this.poster_=i.poster||"",this.controls_=!!i.controls,e.controls=!1,e.removeAttribute("controls"),this.changingSrc_=!1,this.playCallbacks_=[],this.playTerminatedQueue_=[],e.hasAttribute("autoplay")?this.autoplay(!0):this.autoplay(this.options_.autoplay),i.plugins&&Object.keys(i.plugins).forEach(l=>{if(typeof this[l]!="function")throw new Error(`plugin "${l}" does not exist`)}),this.scrubbing_=!1,this.el_=this.createEl(),y_(this,{eventBusKey:"el_"}),this.fsApi_.requestFullscreen&&(Or(Fe,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),this.on(this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_)),this.fluid_&&this.on(["playerreset","resize"],this.boundUpdateStyleEl_);const s=ni(this.options_);if(i.plugins&&Object.keys(i.plugins).forEach(l=>{this[l](i.plugins[l])}),i.debug&&this.debug(!0),this.options_.playerOptions=s,this.middleware_=[],this.playbackRates(i.playbackRates),i.experimentalSvgIcons){const c=new te.DOMParser().parseFromString(DM,"image/svg+xml");if(c.querySelector("parsererror"))St.warn("Failed to load SVG Icons. Falling back to Font Icons."),this.options_.experimentalSvgIcons=null;else{const f=c.documentElement;f.style.display="none",this.el_.appendChild(f),this.addClass("vjs-svg-icons-enabled")}}this.initChildren(),this.isAudio(e.nodeName.toLowerCase()==="audio"),this.controls()?this.addClass("vjs-controls-enabled"):this.addClass("vjs-controls-disabled"),this.el_.setAttribute("role","region"),this.isAudio()?this.el_.setAttribute("aria-label",this.localize("Audio Player")):this.el_.setAttribute("aria-label",this.localize("Video Player")),this.isAudio()&&this.addClass("vjs-audio"),i.spatialNavigation&&i.spatialNavigation.enabled&&(this.spatialNavigation=new kM(this),this.addClass("vjs-spatial-navigation-enabled")),Qd&&this.addClass("vjs-touch-enabled"),In||this.addClass("vjs-workinghover"),Vt.players[this.id_]=this;const o=ay.split(".")[0];this.addClass(`vjs-v${o}`),this.userActive(!0),this.reportUserActivity(),this.one("play",l=>this.listenForUserActivity_(l)),this.on("keydown",l=>this.handleKeyDown(l)),this.on("languagechange",l=>this.handleLanguagechange(l)),this.breakpoints(this.options_.breakpoints),this.responsive(this.options_.responsive),this.on("ready",()=>{this.audioPosterMode(this.options_.audioPosterMode),this.audioOnlyMode(this.options_.audioOnlyMode)})}dispose(){this.trigger("dispose"),this.off("dispose"),Rn(Fe,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),Rn(Fe,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),Vt.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),wM(this),Vn.names.forEach(e=>{const i=Vn[e],n=this[i.getterName]();n&&n.off&&n.off()}),super.dispose({restoreEl:this.options_.restoreEl})}createEl(){let e=this.tag,i,n=this.playerElIngest_=e.parentNode&&e.parentNode.hasAttribute&&e.parentNode.hasAttribute("data-vjs-player");const s=this.tag.tagName.toLowerCase()==="video-js";n?i=this.el_=e.parentNode:s||(i=this.el_=super.createEl("div"));const o=Qo(e);if(s){for(i=this.el_=e,e=this.tag=Fe.createElement("video");i.children.length;)e.appendChild(i.firstChild);jd(i,"video-js")||Yl(i,"video-js"),i.appendChild(e),n=this.playerElIngest_=i,Object.keys(i).forEach(h=>{try{e[h]=i[h]}catch{}})}e.setAttribute("tabindex","-1"),o.tabindex="-1",ua&&gp&&(e.setAttribute("role","application"),o.role="application"),e.removeAttribute("width"),e.removeAttribute("height"),"width"in o&&delete o.width,"height"in o&&delete o.height,Object.getOwnPropertyNames(o).forEach(function(h){s&&h==="class"||i.setAttribute(h,o[h]),s&&e.setAttribute(h,o[h])}),e.playerId=e.id,e.id+="_html5_api",e.className="vjs-tech",e.player=i.player=this,this.addClass("vjs-paused");const l=["IS_SMART_TV","IS_TIZEN","IS_WEBOS","IS_ANDROID","IS_IPAD","IS_IPHONE","IS_CHROMECAST_RECEIVER"].filter(h=>mD[h]).map(h=>"vjs-device-"+h.substring(3).toLowerCase().replace(/\_/g,"-"));if(this.addClass(...l),te.VIDEOJS_NO_DYNAMIC_STYLE!==!0){this.styleEl_=$D("vjs-styles-dimensions");const h=tl(".vjs-styles-defaults"),f=tl("head");f.insertBefore(this.styleEl_,h?h.nextSibling:f.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);const c=e.getElementsByTagName("a");for(let h=0;h<c.length;h++){const f=c.item(h);Yl(f,"vjs-hidden"),f.setAttribute("hidden","hidden")}return e.initNetworkState_=e.networkState,e.parentNode&&!n&&e.parentNode.insertBefore(i,e),ly(e,i),this.children_.unshift(e),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=i,i}crossOrigin(e){if(typeof e>"u")return this.techGet_("crossOrigin");if(e!==null&&e!=="anonymous"&&e!=="use-credentials"){St.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`);return}this.techCall_("setCrossOrigin",e),this.posterImage&&this.posterImage.crossOrigin(e)}width(e){return this.dimension("width",e)}height(e){return this.dimension("height",e)}dimension(e,i){const n=e+"_";if(i===void 0)return this[n]||0;if(i===""||i==="auto"){this[n]=void 0,this.updateStyleEl_();return}const s=parseFloat(i);if(isNaN(s)){St.error(`Improper value "${i}" supplied for for ${e}`);return}this[n]=s,this.updateStyleEl_()}fluid(e){if(e===void 0)return!!this.fluid_;this.fluid_=!!e,Ja(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),iM(this,()=>{this.on(["playerreset","resize"],this.boundUpdateStyleEl_)})):this.removeClass("vjs-fluid"),this.updateStyleEl_()}fill(e){if(e===void 0)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")}aspectRatio(e){if(e===void 0)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()}updateStyleEl_(){if(te.VIDEOJS_NO_DYNAMIC_STYLE===!0){const c=typeof this.width_=="number"?this.width_:this.options_.width,h=typeof this.height_=="number"?this.height_:this.options_.height,f=this.tech_&&this.tech_.el();f&&(c>=0&&(f.width=c),h>=0&&(f.height=h));return}let e,i,n,s;this.aspectRatio_!==void 0&&this.aspectRatio_!=="auto"?n=this.aspectRatio_:this.videoWidth()>0?n=this.videoWidth()+":"+this.videoHeight():n="16:9";const o=n.split(":"),l=o[1]/o[0];this.width_!==void 0?e=this.width_:this.height_!==void 0?e=this.height_/l:e=this.videoWidth()||300,this.height_!==void 0?i=this.height_:i=e*l,/^[^a-zA-Z]/.test(this.id())?s="dimensions-"+this.id():s=this.id()+"-dimensions",this.addClass(s),OD(this.styleEl_,`
      .${s} {
        width: ${e}px;
        height: ${i}px;
      }

      .${s}.vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: ${l*100}%;
      }
    `)}loadTech_(e,i){this.tech_&&this.unloadTech_();const n=Oi(e),s=e.charAt(0).toLowerCase()+e.slice(1);n!=="Html5"&&this.tag&&(_t.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=n,this.isReady_=!1;let o=this.autoplay();(typeof this.autoplay()=="string"||this.autoplay()===!0&&this.options_.normalizeAutoplay)&&(o=!1);const l={source:i,autoplay:o,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:`${this.id()}_${s}_api`,playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset};Vn.names.forEach(h=>{const f=Vn[h];l[f.getterName]=this[f.privateName]}),Object.assign(l,this.options_[n]),Object.assign(l,this.options_[s]),Object.assign(l,this.options_[e.toLowerCase()]),this.tag&&(l.tag=this.tag),i&&i.src===this.cache_.src&&this.cache_.currentTime>0&&(l.startTime=this.cache_.currentTime);const c=_t.getTech(e);if(!c)throw new Error(`No Tech named '${n}' exists! '${n}' should be registered using videojs.registerTech()'`);this.tech_=new c(l),this.tech_.ready(hi(this,this.handleTechReady_),!0),py.jsonToTextTracks(this.textTracksJson_||[],this.tech_),x4.forEach(h=>{this.on(this.tech_,h,f=>this[`handleTech${Oi(h)}_`](f))}),Object.keys(B0).forEach(h=>{this.on(this.tech_,h,f=>{if(this.tech_.playbackRate()===0&&this.tech_.seeking()){this.queuedCallbacks_.push({callback:this[`handleTech${B0[h]}_`].bind(this),event:f});return}this[`handleTech${B0[h]}_`](f)})}),this.on(this.tech_,"loadstart",h=>this.handleTechLoadStart_(h)),this.on(this.tech_,"sourceset",h=>this.handleTechSourceset_(h)),this.on(this.tech_,"waiting",h=>this.handleTechWaiting_(h)),this.on(this.tech_,"ended",h=>this.handleTechEnded_(h)),this.on(this.tech_,"seeking",h=>this.handleTechSeeking_(h)),this.on(this.tech_,"play",h=>this.handleTechPlay_(h)),this.on(this.tech_,"pause",h=>this.handleTechPause_(h)),this.on(this.tech_,"durationchange",h=>this.handleTechDurationChange_(h)),this.on(this.tech_,"fullscreenchange",(h,f)=>this.handleTechFullscreenChange_(h,f)),this.on(this.tech_,"fullscreenerror",(h,f)=>this.handleTechFullscreenError_(h,f)),this.on(this.tech_,"enterpictureinpicture",h=>this.handleTechEnterPictureInPicture_(h)),this.on(this.tech_,"leavepictureinpicture",h=>this.handleTechLeavePictureInPicture_(h)),this.on(this.tech_,"error",h=>this.handleTechError_(h)),this.on(this.tech_,"posterchange",h=>this.handleTechPosterChange_(h)),this.on(this.tech_,"textdata",h=>this.handleTechTextData_(h)),this.on(this.tech_,"ratechange",h=>this.handleTechRateChange_(h)),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode!==this.el()&&(n!=="Html5"||!this.tag)&&ly(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)}unloadTech_(){Vn.names.forEach(e=>{const i=Vn[e];this[i.privateName]=this[i.getterName]()}),this.textTracksJson_=py.textTracksToJson(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1}tech(e){return e===void 0&&St.warn(`Using the tech directly can be dangerous. I hope you know what you're doing.
See https://github.com/videojs/video.js/issues/2617 for more info.
`),this.tech_}version(){return{"video.js":ay}}addTechControlsListeners_(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)}removeTechControlsListeners_(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)}handleTechReady_(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()}handleTechLoadStart_(){this.removeClass("vjs-ended","vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):this.trigger("loadstart"),this.manualAutoplay_(this.autoplay()===!0&&this.options_.normalizeAutoplay?"play":this.autoplay())}manualAutoplay_(e){if(!this.tech_||typeof e!="string")return;const i=()=>{const s=this.muted();this.muted(!0);const o=()=>{this.muted(s)};this.playTerminatedQueue_.push(o);const l=this.play();if(Vd(l))return l.catch(c=>{throw o(),new Error(`Rejection at manualAutoplay. Restoring muted value. ${c||""}`)})};let n;if(e==="any"&&!this.muted()?(n=this.play(),Vd(n)&&(n=n.catch(i))):e==="muted"&&!this.muted()?n=i():n=this.play(),!!Vd(n))return n.then(()=>{this.trigger({type:"autoplay-success",autoplay:e})}).catch(()=>{this.trigger({type:"autoplay-failure",autoplay:e})})}updateSourceCaches_(e=""){let i=e,n="";typeof i!="string"&&(i=e.src,n=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],i&&!n&&(n=AM(this,i)),this.cache_.source=ni({},e,{src:i,type:n});const s=this.cache_.sources.filter(h=>h.src&&h.src===i),o=[],l=this.$$("source"),c=[];for(let h=0;h<l.length;h++){const f=Qo(l[h]);o.push(f),f.src&&f.src===i&&c.push(f.src)}c.length&&!s.length?this.cache_.sources=o:s.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=i}handleTechSourceset_(e){if(!this.changingSrc_){let i=o=>this.updateSourceCaches_(o);const n=this.currentSource().src,s=e.src;n&&!/^blob:/.test(n)&&/^blob:/.test(s)&&(!this.lastSource_||this.lastSource_.tech!==s&&this.lastSource_.player!==n)&&(i=()=>{}),i(s),e.src||this.tech_.any(["sourceset","loadstart"],o=>{if(o.type==="sourceset")return;const l=this.techGet_("currentSrc");this.lastSource_.tech=l,this.updateSourceCaches_(l)})}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})}hasStarted(e){if(e===void 0)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?this.addClass("vjs-has-started"):this.removeClass("vjs-has-started"))}handleTechPlay_(){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")}handleTechRateChange_(){this.tech_.playbackRate()>0&&this.cache_.lastPlaybackRate===0&&(this.queuedCallbacks_.forEach(e=>e.callback(e.event)),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")}handleTechWaiting_(){this.addClass("vjs-waiting"),this.trigger("waiting");const e=this.currentTime(),i=()=>{e!==this.currentTime()&&(this.removeClass("vjs-waiting"),this.off("timeupdate",i))};this.on("timeupdate",i)}handleTechCanPlay_(){this.removeClass("vjs-waiting"),this.trigger("canplay")}handleTechCanPlayThrough_(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")}handleTechPlaying_(){this.removeClass("vjs-waiting"),this.trigger("playing")}handleTechSeeking_(){this.addClass("vjs-seeking"),this.trigger("seeking")}handleTechSeeked_(){this.removeClass("vjs-seeking","vjs-ended"),this.trigger("seeked")}handleTechPause_(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")}handleTechEnded_(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")}handleTechDurationChange_(){this.duration(this.techGet_("duration"))}handleTechClick_(e){this.controls_&&(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.click===void 0||this.options_.userActions.click!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.click=="function"?this.options_.userActions.click.call(this,e):this.paused()?na(this.play()):this.pause())}handleTechDoubleClick_(e){if(!this.controls_)return;Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),n=>n.contains(e.target))||(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.doubleClick===void 0||this.options_.userActions.doubleClick!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.doubleClick=="function"?this.options_.userActions.doubleClick.call(this,e):this.isInPictureInPicture()&&!Fe.pictureInPictureElement?this.exitPictureInPicture():this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}handleTechTap_(){this.userActive(!this.userActive())}handleTechTouchStart_(){this.userWasActive=this.userActive()}handleTechTouchMove_(){this.userWasActive&&this.reportUserActivity()}handleTechTouchEnd_(e){e.cancelable&&e.preventDefault()}toggleFullscreenClass_(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")}documentFullscreenChange_(e){const i=e.target.player;if(i&&i!==this)return;const n=this.el();let s=Fe[this.fsApi_.fullscreenElement]===n;!s&&n.matches&&(s=n.matches(":"+this.fsApi_.fullscreen)),this.isFullscreen(s)}handleTechFullscreenChange_(e,i){i&&(i.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",()=>{this.removeClass("vjs-ios-native-fs")})),this.isFullscreen(i.isFullscreen))}handleTechFullscreenError_(e,i){this.trigger("fullscreenerror",i)}togglePictureInPictureClass_(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")}handleTechEnterPictureInPicture_(e){this.isInPictureInPicture(!0)}handleTechLeavePictureInPicture_(e){this.isInPictureInPicture(!1)}handleTechError_(){const e=this.tech_.error();e&&this.error(e)}handleTechTextData_(){let e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)}getCache(){return this.cache_}resetCache_(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}}techCall_(e,i){this.ready(function(){if(e in xM)return bM(this.middleware_,this.tech_,e,i);if(e in gw)return mw(this.middleware_,this.tech_,e,i);try{this.tech_&&this.tech_[e](i)}catch(n){throw St(n),n}},!0)}techGet_(e){if(!(!this.tech_||!this.tech_.isReady_)){if(e in TM)return vM(this.middleware_,this.tech_,e);if(e in gw)return mw(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(i){throw this.tech_[e]===void 0?(St(`Video.js: ${e} method not defined for ${this.techName_} playback technology.`,i),i):i.name==="TypeError"?(St(`Video.js: ${e} unavailable on ${this.techName_} playback technology element.`,i),this.tech_.isReady_=!1,i):(St(i),i)}}}play(){return new Promise(e=>{this.play_(e)})}play_(e=na){this.playCallbacks_.push(e);const i=!!(!this.changingSrc_&&(this.src()||this.currentSrc())),n=!!(_p||In);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!i){this.waitToPlay_=l=>{this.play_()},this.one(["ready","loadstart"],this.waitToPlay_),!i&&n&&this.load();return}const s=this.techGet_("play");n&&this.hasClass("vjs-ended")&&this.resetProgressBar_(),s===null?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(s)}runPlayTerminatedQueue_(){const e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(i){i()})}runPlayCallbacks_(e){const i=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],i.forEach(function(n){n(e)})}pause(){this.techCall_("pause")}paused(){return this.techGet_("paused")!==!1}played(){return this.techGet_("played")||$s(0,0)}scrubbing(e){if(typeof e>"u")return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")}currentTime(e){if(e===void 0)return this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime;if(e<0&&(e=0),!this.isReady_||this.changingSrc_||!this.tech_||!this.tech_.isReady_){this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),this.one("canplay",this.boundApplyInitTime_);return}this.techCall_("setCurrentTime",e),this.cache_.initTime=0,isFinite(e)&&(this.cache_.currentTime=Number(e))}applyInitTime_(){this.currentTime(this.cache_.initTime)}duration(e){if(e===void 0)return this.cache_.duration!==void 0?this.cache_.duration:NaN;e=parseFloat(e),e<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))}remainingTime(){return this.duration()-this.currentTime()}remainingTimeDisplay(){return Math.floor(this.duration())-Math.floor(this.currentTime())}buffered(){let e=this.techGet_("buffered");return(!e||!e.length)&&(e=$s(0,0)),e}seekable(){let e=this.techGet_("seekable");return(!e||!e.length)&&(e=$s(0,0)),e}seeking(){return this.techGet_("seeking")}ended(){return this.techGet_("ended")}networkState(){return this.techGet_("networkState")}readyState(){return this.techGet_("readyState")}bufferedPercent(){return zD(this.buffered(),this.duration())}bufferedEnd(){const e=this.buffered(),i=this.duration();let n=e.end(e.length-1);return n>i&&(n=i),n}volume(e){let i;if(e!==void 0){i=Math.max(0,Math.min(1,e)),this.cache_.volume=i,this.techCall_("setVolume",i),i>0&&this.lastVolume_(i);return}return i=parseFloat(this.techGet_("volume")),isNaN(i)?1:i}muted(e){if(e!==void 0){this.techCall_("setMuted",e);return}return this.techGet_("muted")||!1}defaultMuted(e){return e!==void 0&&this.techCall_("setDefaultMuted",e),this.techGet_("defaultMuted")||!1}lastVolume_(e){if(e!==void 0&&e!==0){this.cache_.lastVolume=e;return}return this.cache_.lastVolume}supportsFullScreen(){return this.techGet_("supportsFullScreen")||!1}isFullscreen(e){if(e!==void 0){const i=this.isFullscreen_;this.isFullscreen_=!!e,this.isFullscreen_!==i&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),this.toggleFullscreenClass_();return}return this.isFullscreen_}requestFullscreen(e){this.isInPictureInPicture()&&this.exitPictureInPicture();const i=this;return new Promise((n,s)=>{function o(){i.off("fullscreenerror",c),i.off("fullscreenchange",l)}function l(){o(),n()}function c(f,m){o(),s(m)}i.one("fullscreenchange",l),i.one("fullscreenerror",c);const h=i.requestFullscreenHelper_(e);h&&(h.then(o,o),h.then(n,s))})}requestFullscreenHelper_(e){let i;if(this.fsApi_.prefixed||(i=this.options_.fullscreen&&this.options_.fullscreen.options||{},e!==void 0&&(i=e)),this.fsApi_.requestFullscreen){const n=this.el_[this.fsApi_.requestFullscreen](i);return n&&n.then(()=>this.isFullscreen(!0),()=>this.isFullscreen(!1)),n}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()}exitFullscreen(){const e=this;return new Promise((i,n)=>{function s(){e.off("fullscreenerror",l),e.off("fullscreenchange",o)}function o(){s(),i()}function l(h,f){s(),n(f)}e.one("fullscreenchange",o),e.one("fullscreenerror",l);const c=e.exitFullscreenHelper_();c&&(c.then(s,s),c.then(i,n))})}exitFullscreenHelper_(){if(this.fsApi_.requestFullscreen){const e=Fe[this.fsApi_.exitFullscreen]();return e&&na(e.then(()=>this.isFullscreen(!1))),e}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()}enterFullWindow(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=Fe.documentElement.style.overflow,Or(Fe,"keydown",this.boundFullWindowOnEscKey_),Fe.documentElement.style.overflow="hidden",Yl(Fe.body,"vjs-full-window"),this.trigger("enterFullWindow")}fullWindowOnEscKey(e){e.key==="Escape"&&this.isFullscreen()===!0&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())}exitFullWindow(){this.isFullscreen(!1),this.isFullWindow=!1,Rn(Fe,"keydown",this.boundFullWindowOnEscKey_),Fe.documentElement.style.overflow=this.docOrigOverflow,vp(Fe.body,"vjs-full-window"),this.trigger("exitFullWindow")}disablePictureInPicture(e){if(e===void 0)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")}isInPictureInPicture(e){if(e!==void 0){this.isInPictureInPicture_=!!e,this.togglePictureInPictureClass_();return}return!!this.isInPictureInPicture_}requestPictureInPicture(){if(this.options_.enableDocumentPictureInPicture&&te.documentPictureInPicture){const e=Fe.createElement(this.el().tagName);return e.classList=this.el().classList,e.classList.add("vjs-pip-container"),this.posterImage&&e.appendChild(this.posterImage.el().cloneNode(!0)),this.titleBar&&e.appendChild(this.titleBar.el().cloneNode(!0)),e.appendChild(ut("p",{className:"vjs-pip-text"},{},this.localize("Playing in picture-in-picture"))),te.documentPictureInPicture.requestWindow({width:this.videoWidth(),height:this.videoHeight()}).then(i=>(AD(i),this.el_.parentNode.insertBefore(e,this.el_),i.document.body.appendChild(this.el_),i.document.body.classList.add("vjs-pip-window"),this.player_.isInPictureInPicture(!0),this.player_.trigger({type:"enterpictureinpicture",pipWindow:i}),i.addEventListener("pagehide",n=>{const s=n.target.querySelector(".video-js");e.parentNode.replaceChild(s,e),this.player_.isInPictureInPicture(!1),this.player_.trigger("leavepictureinpicture")}),i))}return"pictureInPictureEnabled"in Fe&&this.disablePictureInPicture()===!1?this.techGet_("requestPictureInPicture"):Promise.reject("No PiP mode is available")}exitPictureInPicture(){if(te.documentPictureInPicture&&te.documentPictureInPicture.window)return te.documentPictureInPicture.window.close(),Promise.resolve();if("pictureInPictureEnabled"in Fe)return Fe.exitPictureInPicture()}handleKeyDown(e){const{userActions:i}=this.options_;!i||!i.hotkeys||(s=>{const o=s.tagName.toLowerCase();if(s.isContentEditable)return!0;const l=["button","checkbox","hidden","radio","reset","submit"];return o==="input"?l.indexOf(s.type)===-1:["textarea"].indexOf(o)!==-1})(this.el_.ownerDocument.activeElement)||(typeof i.hotkeys=="function"?i.hotkeys.call(this,e):this.handleHotkeys(e))}handleHotkeys(e){const i=this.options_.userActions?this.options_.userActions.hotkeys:{},{fullscreenKey:n=l=>e.key.toLowerCase()==="f",muteKey:s=l=>e.key.toLowerCase()==="m",playPauseKey:o=l=>e.key.toLowerCase()==="k"||e.key.toLowerCase()===" "}=i;if(n.call(this,e)){e.preventDefault(),e.stopPropagation();const l=Oe.getComponent("FullscreenToggle");Fe[this.fsApi_.fullscreenEnabled]!==!1&&l.prototype.handleClick.call(this,e)}else s.call(this,e)?(e.preventDefault(),e.stopPropagation(),Oe.getComponent("MuteToggle").prototype.handleClick.call(this,e)):o.call(this,e)&&(e.preventDefault(),e.stopPropagation(),Oe.getComponent("PlayToggle").prototype.handleClick.call(this,e))}canPlayType(e){let i;for(let n=0,s=this.options_.techOrder;n<s.length;n++){const o=s[n];let l=_t.getTech(o);if(l||(l=Oe.getComponent(o)),!l){St.error(`The "${o}" tech is undefined. Skipped browser support check for that tech.`);continue}if(l.isSupported()&&(i=l.canPlayType(e),i))return i}return""}selectSource(e){const i=this.options_.techOrder.map(c=>[c,_t.getTech(c)]).filter(([c,h])=>h?h.isSupported():(St.error(`The "${c}" tech is undefined. Skipped browser support check for that tech.`),!1)),n=function(c,h,f){let m;return c.some(_=>h.some(E=>{if(m=f(_,E),m)return!0})),m};let s;const o=c=>(h,f)=>c(f,h),l=([c,h],f)=>{if(h.canPlaySource(f,this.options_[c.toLowerCase()]))return{source:f,tech:c}};return this.options_.sourceOrder?s=n(e,i,o(l)):s=n(i,e,l),s||!1}handleSrc_(e,i){if(typeof e>"u")return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();const n=GD(e);if(!n.length){this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0);return}if(this.changingSrc_=!0,i||(this.cache_.sources=n),this.updateSourceCaches_(n[0]),yM(this,n[0],(s,o)=>{if(this.middleware_=o,i||(this.cache_.sources=n),this.updateSourceCaches_(s),this.src_(s)){if(n.length>1)return this.handleSrc_(n.slice(1));this.changingSrc_=!1,this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),this.triggerReady();return}_M(o,this.tech_)}),n.length>1){const s=()=>{this.error(null),this.handleSrc_(n.slice(1),!0)},o=()=>{this.off("error",s)};this.one("error",s),this.one("playing",o),this.resetRetryOnError_=()=>{this.off("error",s),this.off("playing",o)}}}src(e){return this.handleSrc_(e,!1)}src_(e){const i=this.selectSource([e]);return i?BD(i.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(i.tech,i.source),this.tech_.ready(()=>{this.changingSrc_=!1}),!1):!0}addSourceElement(e,i){return this.tech_?this.tech_.addSourceElement(e,i):!1}removeSourceElement(e){return this.tech_?this.tech_.removeSourceElement(e):!1}load(){if(this.tech_&&this.tech_.vhs){this.src(this.currentSource());return}this.techCall_("load")}reset(){if(this.paused())this.doReset_();else{const e=this.play();na(e.then(()=>this.doReset_()))}}doReset_(){this.tech_&&this.tech_.clearTracks("text"),this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),this.error(null),this.titleBar&&this.titleBar.update({title:void 0,description:void 0}),Ja(this)&&this.trigger("playerreset")}resetControlBarUI_(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()}resetProgressBar_(){this.currentTime(0);const{currentTimeDisplay:e,durationDisplay:i,progressControl:n,remainingTimeDisplay:s}=this.controlBar||{},{seekBar:o}=n||{};e&&e.updateContent(),i&&i.updateContent(),s&&s.updateContent(),o&&(o.update(),o.loadProgressBar&&o.loadProgressBar.update())}resetPlaybackRate_(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()}resetVolumeBar_(){this.volume(1),this.trigger("volumechange")}currentSources(){const e=this.currentSource(),i=[];return Object.keys(e).length!==0&&i.push(e),this.cache_.sources||i}currentSource(){return this.cache_.source||{}}currentSrc(){return this.currentSource()&&this.currentSource().src||""}currentType(){return this.currentSource()&&this.currentSource().type||""}preload(e){if(e!==void 0){this.techCall_("setPreload",e),this.options_.preload=e;return}return this.techGet_("preload")}autoplay(e){if(e===void 0)return this.options_.autoplay||!1;let i;typeof e=="string"&&/(any|play|muted)/.test(e)||e===!0&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_(typeof e=="string"?e:"play"),i=!1):e?this.options_.autoplay=!0:this.options_.autoplay=!1,i=typeof i>"u"?this.options_.autoplay:i,this.tech_&&this.techCall_("setAutoplay",i)}playsinline(e){return e!==void 0&&(this.techCall_("setPlaysinline",e),this.options_.playsinline=e),this.techGet_("playsinline")}loop(e){if(e!==void 0){this.techCall_("setLoop",e),this.options_.loop=e;return}return this.techGet_("loop")}poster(e){if(e===void 0)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))}handleTechPosterChange_(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){const e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}}controls(e){if(e===void 0)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))}usingNativeControls(e){if(e===void 0)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))}error(e){if(e===void 0)return this.error_||null;if(el("beforeerror").forEach(i=>{const n=i(this,e);if(!(la(n)&&!Array.isArray(n)||typeof n=="string"||typeof n=="number"||n===null)){this.log.error("please return a value that MediaError expects in beforeerror hooks");return}e=n}),this.options_.suppressNotSupportedError&&e&&e.code===4){const i=function(){this.error(e)};this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],i),this.one("loadstart",function(){this.off(["click","touchstart"],i)});return}if(e===null){this.error_=null,this.removeClass("vjs-error"),this.errorDisplay&&this.errorDisplay.close();return}this.error_=new Ei(e),this.addClass("vjs-error"),St.error(`(CODE:${this.error_.code} ${Ei.errorTypes[this.error_.code]})`,this.error_.message,this.error_),this.trigger("error"),el("error").forEach(i=>i(this,this.error_))}reportUserActivity(e){this.userActivity_=!0}userActive(e){if(e===void 0)return this.userActive_;if(e=!!e,e!==this.userActive_){if(this.userActive_=e,this.userActive_){this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),this.trigger("useractive");return}this.tech_&&this.tech_.one("mousemove",function(i){i.stopPropagation(),i.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}}listenForUserActivity_(){let e,i,n;const s=hi(this,this.reportUserActivity),o=function(_){(_.screenX!==i||_.screenY!==n)&&(i=_.screenX,n=_.screenY,s())},l=function(){s(),this.clearInterval(e),e=this.setInterval(s,250)},c=function(_){s(),this.clearInterval(e)};this.on("mousedown",l),this.on("mousemove",o),this.on("mouseup",c),this.on("mouseleave",c);const h=this.getChild("controlBar");h&&!In&&!Os&&(h.on("mouseenter",function(_){this.player().options_.inactivityTimeout!==0&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),h.on("mouseleave",function(_){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",s),this.on("keyup",s);let f;const m=function(){if(!this.userActivity_)return;this.userActivity_=!1,this.userActive(!0),this.clearTimeout(f);const _=this.options_.inactivityTimeout;_<=0||(f=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},_))};this.setInterval(m,250)}playbackRate(e){if(e!==void 0){this.techCall_("setPlaybackRate",e);return}return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1}defaultPlaybackRate(e){return e!==void 0?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1}isAudio(e){if(e!==void 0){this.isAudio_=!!e;return}return!!this.isAudio_}updatePlayerHeightOnAudioOnlyMode_(){const e=this.getChild("ControlBar");!e||this.audioOnlyCache_.controlBarHeight===e.currentHeight()||(this.audioOnlyCache_.controlBarHeight=e.currentHeight(),this.height(this.audioOnlyCache_.controlBarHeight))}enableAudioOnlyUI_(){this.addClass("vjs-audio-only-mode");const e=this.children(),i=this.getChild("ControlBar"),n=i&&i.currentHeight();e.forEach(s=>{s!==i&&s.el_&&!s.hasClass("vjs-hidden")&&(s.hide(),this.audioOnlyCache_.hiddenChildren.push(s))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.audioOnlyCache_.controlBarHeight=n,this.on("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.height(n),this.trigger("audioonlymodechange")}disableAudioOnlyUI_(){this.removeClass("vjs-audio-only-mode"),this.off("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.audioOnlyCache_.hiddenChildren.forEach(e=>e.show()),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")}audioOnlyMode(e){if(typeof e!="boolean"||e===this.audioOnlyMode_)return this.audioOnlyMode_;if(this.audioOnlyMode_=e,e){const i=[];return this.isInPictureInPicture()&&i.push(this.exitPictureInPicture()),this.isFullscreen()&&i.push(this.exitFullscreen()),this.audioPosterMode()&&i.push(this.audioPosterMode(!1)),Promise.all(i).then(()=>this.enableAudioOnlyUI_())}return Promise.resolve().then(()=>this.disableAudioOnlyUI_())}enablePosterModeUI_(){(this.tech_&&this.tech_).hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}disablePosterModeUI_(){(this.tech_&&this.tech_).show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}audioPosterMode(e){return typeof e!="boolean"||e===this.audioPosterMode_?this.audioPosterMode_:(this.audioPosterMode_=e,e?this.audioOnlyMode()?this.audioOnlyMode(!1).then(()=>{this.enablePosterModeUI_()}):Promise.resolve().then(()=>{this.enablePosterModeUI_()}):Promise.resolve().then(()=>{this.disablePosterModeUI_()}))}addTextTrack(e,i,n){if(this.tech_)return this.tech_.addTextTrack(e,i,n)}addRemoteTextTrack(e,i){if(this.tech_)return this.tech_.addRemoteTextTrack(e,i)}removeRemoteTextTrack(e={}){let{track:i}=e;if(i||(i=e),this.tech_)return this.tech_.removeRemoteTextTrack(i)}getVideoPlaybackQuality(){return this.techGet_("getVideoPlaybackQuality")}videoWidth(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0}videoHeight(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0}language(e){if(e===void 0)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),Ja(this)&&this.trigger("languagechange"))}languages(){return ni(Vt.prototype.options_.languages,this.languages_)}toJSON(){const e=ni(this.options_),i=e.tracks;e.tracks=[];for(let n=0;n<i.length;n++){let s=i[n];s=ni(s),s.player=void 0,e.tracks[n]=s}return e}createModal(e,i){i=i||{},i.content=e||"";const n=new xc(this,i);return this.addChild(n),n.on("dispose",()=>{this.removeChild(n)}),n.open(),n}updateCurrentBreakpoint_(){if(!this.responsive())return;const e=this.currentBreakpoint(),i=this.currentWidth();for(let n=0;n<yy.length;n++){const s=yy[n],o=this.breakpoints_[s];if(i<=o){if(e===s)return;e&&this.removeClass($f[e]),this.addClass($f[s]),this.breakpoint_=s;break}}}removeCurrentBreakpoint_(){const e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)}breakpoints(e){return e===void 0?Object.assign(this.breakpoints_):(this.breakpoint_="",this.breakpoints_=Object.assign({},sN,e),this.updateCurrentBreakpoint_(),Object.assign(this.breakpoints_))}responsive(e){if(e===void 0)return this.responsive_;e=!!e;const i=this.responsive_;if(e!==i)return this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e}currentBreakpoint(){return this.breakpoint_}currentBreakpointClass(){return $f[this.breakpoint_]||""}loadMedia(e,i){if(!e||typeof e!="object")return;const n=this.crossOrigin();this.reset(),this.cache_.media=ni(e);const{artist:s,artwork:o,description:l,poster:c,src:h,textTracks:f,title:m}=this.cache_.media;!o&&c&&(this.cache_.media.artwork=[{src:c,type:Zf(c)}]),n&&this.crossOrigin(n),h&&this.src(h),c&&this.poster(c),Array.isArray(f)&&f.forEach(_=>this.addRemoteTextTrack(_,!1)),this.titleBar&&this.titleBar.update({title:m,description:l||s||""}),this.ready(i)}getMedia(){if(!this.cache_.media){const e=this.poster(),i=this.currentSources(),n=Array.prototype.map.call(this.remoteTextTracks(),o=>({kind:o.kind,label:o.label,language:o.language,src:o.src})),s={src:i,textTracks:n};return e&&(s.poster=e,s.artwork=[{src:s.poster,type:Zf(s.poster)}]),s}return ni(this.cache_.media)}static getTagSettings(e){const i={sources:[],tracks:[]},n=Qo(e),s=n["data-setup"];if(jd(e,"vjs-fill")&&(n.fill=!0),jd(e,"vjs-fluid")&&(n.fluid=!0),s!==null)try{Object.assign(n,JSON.parse(s||"{}"))}catch(o){St.error("data-setup",o)}if(Object.assign(i,n),e.hasChildNodes()){const o=e.childNodes;for(let l=0,c=o.length;l<c;l++){const h=o[l],f=h.nodeName.toLowerCase();f==="source"?i.sources.push(Qo(h)):f==="track"&&i.tracks.push(Qo(h))}}return i}debug(e){if(e===void 0)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)}playbackRates(e){if(e===void 0)return this.cache_.playbackRates;Array.isArray(e)&&e.every(i=>typeof i=="number")&&(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))}}Vt.prototype.videoTracks=()=>{};Vt.prototype.audioTracks=()=>{};Vt.prototype.textTracks=()=>{};Vt.prototype.remoteTextTracks=()=>{};Vt.prototype.remoteTextTrackEls=()=>{};Vn.names.forEach(function(t){const e=Vn[t];Vt.prototype[e.getterName]=function(){return this.tech_?this.tech_[e.getterName]():(this[e.privateName]=this[e.privateName]||new e.ListClass,this[e.privateName])}});Vt.prototype.crossorigin=Vt.prototype.crossOrigin;Vt.players={};const Id=te.navigator;Vt.prototype.options_={techOrder:_t.defaultTechOrder_,html5:{},enableSourceset:!0,inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","titleBar","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:Id&&(Id.languages&&Id.languages[0]||Id.userLanguage||Id.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1,spatialNavigation:{enabled:!1,horizontalSeek:!1},enableSmoothSeeking:!1,disableSeekWhileScrubbingOnMobile:!1,disableSeekWhileScrubbingOnSTV:!1};x4.forEach(function(t){Vt.prototype[`handleTech${Oi(t)}_`]=function(){return this.trigger(t)}});Oe.registerComponent("Player",Vt);const Jf="plugin",tc="activePlugins_",Ku={},ep=t=>Ku.hasOwnProperty(t),Of=t=>ep(t)?Ku[t]:void 0,S4=(t,e)=>{t[tc]=t[tc]||{},t[tc][e]=!0},tp=(t,e,i)=>{const n=(i?"before":"")+"pluginsetup";t.trigger(n,e),t.trigger(n+":"+e.name,e)},aN=function(t,e){const i=function(){tp(this,{name:t,plugin:e,instance:null},!0);const n=e.apply(this,arguments);return S4(this,t),tp(this,{name:t,plugin:e,instance:n}),n};return Object.keys(e).forEach(function(n){i[n]=e[n]}),i},Iw=(t,e)=>(e.prototype.name=t,function(...i){tp(this,{name:t,plugin:e,instance:null},!0);const n=new e(this,...i);return this[t]=()=>n,tp(this,n.getEventHash()),n});class dr{constructor(e){if(this.constructor===dr)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=e,this.log||(this.log=this.player.log.createLogger(this.name)),y_(this),delete this.trigger,ND(this,this.constructor.defaultState),S4(e,this.name),this.dispose=this.dispose.bind(this),e.on("dispose",this.dispose)}version(){return this.constructor.VERSION}getEventHash(e={}){return e.name=this.name,e.plugin=this.constructor,e.instance=this,e}trigger(e,i={}){return Tc(this.eventBusEl_,e,this.getEventHash(i))}handleStateChanged(e){}dispose(){const{name:e,player:i}=this;this.trigger("dispose"),this.off(),i.off("dispose",this.dispose),i[tc][e]=!1,this.player=this.state=null,i[e]=Iw(e,Ku[e])}static isBasic(e){const i=typeof e=="string"?Of(e):e;return typeof i=="function"&&!dr.prototype.isPrototypeOf(i.prototype)}static registerPlugin(e,i){if(typeof e!="string")throw new Error(`Illegal plugin name, "${e}", must be a string, was ${typeof e}.`);if(ep(e))St.warn(`A plugin named "${e}" already exists. You may want to avoid re-registering plugins!`);else if(Vt.prototype.hasOwnProperty(e))throw new Error(`Illegal plugin name, "${e}", cannot share a name with an existing player method!`);if(typeof i!="function")throw new Error(`Illegal plugin for "${e}", must be a function, was ${typeof i}.`);return Ku[e]=i,e!==Jf&&(dr.isBasic(i)?Vt.prototype[e]=aN(e,i):Vt.prototype[e]=Iw(e,i)),i}static deregisterPlugin(e){if(e===Jf)throw new Error("Cannot de-register base plugin.");ep(e)&&(delete Ku[e],delete Vt.prototype[e])}static getPlugins(e=Object.keys(Ku)){let i;return e.forEach(n=>{const s=Of(n);s&&(i=i||{},i[n]=s)}),i}static getPluginVersion(e){const i=Of(e);return i&&i.VERSION||""}}dr.getPlugin=Of;dr.BASE_PLUGIN_NAME=Jf;dr.registerPlugin(Jf,dr);Vt.prototype.usingPlugin=function(t){return!!this[tc]&&this[tc][t]===!0};Vt.prototype.hasPlugin=function(t){return!!ep(t)};function oN(t,e){let i=!1;return function(...n){return i||St.warn(t),i=!0,e.apply(this,n)}}function Is(t,e,i,n){return oN(`${e} is deprecated and will be removed in ${t}.0; please use ${i} instead.`,n)}var lN={NetworkBadStatus:"networkbadstatus",NetworkRequestFailed:"networkrequestfailed",NetworkRequestAborted:"networkrequestaborted",NetworkRequestTimeout:"networkrequesttimeout",NetworkBodyParserFailed:"networkbodyparserfailed",StreamingHlsPlaylistParserError:"streaminghlsplaylistparsererror",StreamingDashManifestParserError:"streamingdashmanifestparsererror",StreamingContentSteeringParserError:"streamingcontentsteeringparsererror",StreamingVttParserError:"streamingvttparsererror",StreamingFailedToSelectNextSegment:"streamingfailedtoselectnextsegment",StreamingFailedToDecryptSegment:"streamingfailedtodecryptsegment",StreamingFailedToTransmuxSegment:"streamingfailedtotransmuxsegment",StreamingFailedToAppendSegment:"streamingfailedtoappendsegment",StreamingCodecsChangeError:"streamingcodecschangeerror"};const w4=t=>t.indexOf("#")===0?t.slice(1):t;function _e(t,e,i){let n=_e.getPlayer(t);if(n)return e&&St.warn(`Player "${t}" is already initialised. Options will not be applied.`),i&&n.ready(i),n;const s=typeof t=="string"?tl("#"+w4(t)):t;if(!bc(s))throw new TypeError("The element or ID supplied is not valid. (videojs)");const l=("getRootNode"in s?s.getRootNode()instanceof te.ShadowRoot:!1)?s.getRootNode():s.ownerDocument.body;(!s.ownerDocument.defaultView||!l.contains(s))&&St.warn("The element supplied is not included in the DOM"),e=e||{},e.restoreEl===!0&&(e.restoreEl=(s.parentNode&&s.parentNode.hasAttribute&&s.parentNode.hasAttribute("data-vjs-player")?s.parentNode:s).cloneNode(!0)),el("beforesetup").forEach(h=>{const f=h(s,ni(e));if(!la(f)||Array.isArray(f)){St.error("please return an object in beforesetup hooks");return}e=ni(e,f)});const c=Oe.getComponent("Player");return n=new c(s,e,i),el("setup").forEach(h=>h(n)),n}_e.hooks_=Ka;_e.hooks=el;_e.hook=q8;_e.hookOnce=j8;_e.removeHook=aD;if(te.VIDEOJS_NO_DYNAMIC_STYLE!==!0&&vc()){let t=tl(".vjs-styles-defaults");if(!t){t=$D("vjs-styles-defaults");const e=tl("head");e&&e.insertBefore(t,e.firstChild),OD(t,`
      .video-js {
        width: 300px;
        height: 150px;
      }

      .vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: 56.25%
      }
    `)}}cy(1,_e);_e.VERSION=ay;_e.options=Vt.prototype.options_;_e.getPlayers=()=>Vt.players;_e.getPlayer=t=>{const e=Vt.players;let i;if(typeof t=="string"){const n=w4(t),s=e[n];if(s)return s;i=tl("#"+n)}else i=t;if(bc(i)){const{player:n,playerId:s}=i;if(n||e[s])return n||e[s]}};_e.getAllPlayers=()=>Object.keys(Vt.players).map(t=>Vt.players[t]).filter(Boolean);_e.players=Vt.players;_e.getComponent=Oe.getComponent;_e.registerComponent=(t,e)=>(_t.isTech(e)&&St.warn(`The ${t} tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)`),Oe.registerComponent.call(Oe,t,e));_e.getTech=_t.getTech;_e.registerTech=_t.registerTech;_e.use=gM;Object.defineProperty(_e,"middleware",{value:{},writeable:!1,enumerable:!0});Object.defineProperty(_e.middleware,"TERMINATOR",{value:Qf,writeable:!1,enumerable:!0});_e.browser=mD;_e.obj=G8;_e.mergeOptions=Is(9,"videojs.mergeOptions","videojs.obj.merge",ni);_e.defineLazyProperty=Is(9,"videojs.defineLazyProperty","videojs.obj.defineLazyProperty",pp);_e.bind=Is(9,"videojs.bind","native Function.prototype.bind",hi);_e.registerPlugin=dr.registerPlugin;_e.deregisterPlugin=dr.deregisterPlugin;_e.plugin=(t,e)=>(St.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),dr.registerPlugin(t,e));_e.getPlugins=dr.getPlugins;_e.getPlugin=dr.getPlugin;_e.getPluginVersion=dr.getPluginVersion;_e.addLanguage=function(t,e){return t=(""+t).toLowerCase(),_e.options.languages=ni(_e.options.languages,{[t]:e}),_e.options.languages[t]};_e.log=St;_e.createLogger=oD;_e.time=oM;_e.createTimeRange=Is(9,"videojs.createTimeRange","videojs.time.createTimeRanges",$s);_e.createTimeRanges=Is(9,"videojs.createTimeRanges","videojs.time.createTimeRanges",$s);_e.formatTime=Is(9,"videojs.formatTime","videojs.time.formatTime",nu);_e.setFormatTime=Is(9,"videojs.setFormatTime","videojs.time.setFormatTime",UD);_e.resetFormatTime=Is(9,"videojs.resetFormatTime","videojs.time.resetFormatTime",PD);_e.parseUrl=Is(9,"videojs.parseUrl","videojs.url.parseUrl",T_);_e.isCrossOrigin=Is(9,"videojs.isCrossOrigin","videojs.url.isCrossOrigin",Cp);_e.EventTarget=Ir;_e.any=g_;_e.on=Or;_e.one=wp;_e.off=Rn;_e.trigger=Tc;_e.xhr=V3;_e.TrackList=ru;_e.TextTrack=nh;_e.TextTrackList=v_;_e.AudioTrack=HD;_e.AudioTrackList=FD;_e.VideoTrack=VD;_e.VideoTrackList=qD;["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(t=>{_e[t]=function(){return St.warn(`videojs.${t}() is deprecated; use videojs.dom.${t}() instead`),DD[t].apply(null,arguments)}});_e.computedStyle=Is(9,"videojs.computedStyle","videojs.dom.computedStyle",gc);_e.dom=DD;_e.fn=tM;_e.num=LM;_e.str=sM;_e.url=pM;_e.Error=lN;class uN{constructor(e){let i=this;return i.id=e.id,i.label=i.id,i.width=e.width,i.height=e.height,i.bitrate=e.bandwidth,i.frameRate=e.frameRate,i.enabled_=e.enabled,Object.defineProperty(i,"enabled",{get(){return i.enabled_()},set(n){i.enabled_(n)}}),i}}class ip extends _e.EventTarget{constructor(){super();let e=this;return e.levels_=[],e.selectedIndex_=-1,Object.defineProperty(e,"selectedIndex",{get(){return e.selectedIndex_}}),Object.defineProperty(e,"length",{get(){return e.levels_.length}}),e[Symbol.iterator]=()=>e.levels_.values(),e}addQualityLevel(e){let i=this.getQualityLevelById(e.id);if(i)return i;const n=this.levels_.length;return i=new uN(e),""+n in this||Object.defineProperty(this,n,{get(){return this.levels_[n]}}),this.levels_.push(i),this.trigger({qualityLevel:i,type:"addqualitylevel"}),i}removeQualityLevel(e){let i=null;for(let n=0,s=this.length;n<s;n++)if(this[n]===e){i=this.levels_.splice(n,1)[0],this.selectedIndex_===n?this.selectedIndex_=-1:this.selectedIndex_>n&&this.selectedIndex_--;break}return i&&this.trigger({qualityLevel:e,type:"removequalitylevel"}),i}getQualityLevelById(e){for(let i=0,n=this.length;i<n;i++){const s=this[i];if(s.id===e)return s}return null}dispose(){this.selectedIndex_=-1,this.levels_.length=0}}ip.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"};for(const t in ip.prototype.allowedEvents_)ip.prototype["on"+t]=null;var E4="4.1.0";const cN=function(t,e){const i=t.qualityLevels,n=new ip,s=function(){n.dispose(),t.qualityLevels=i,t.off("dispose",s)};return t.on("dispose",s),t.qualityLevels=()=>n,t.qualityLevels.VERSION=E4,n},C4=function(t){return cN(this,_e.obj.merge({},t))};_e.registerPlugin("qualityLevels",C4);C4.VERSION=E4;const ur=cp,np=(t,e)=>e&&e.responseURL&&t!==e.responseURL?e.responseURL:t,ns=t=>_e.log.debug?_e.log.debug.bind(_e,"VHS:",`${t} >`):function(){};function Gt(...t){const e=_e.obj||_e;return(e.merge||e.mergeOptions).apply(e,t)}function pn(...t){const e=_e.time||_e;return(e.createTimeRanges||e.createTimeRanges).apply(e,t)}function dN(t){if(t.length===0)return"Buffered Ranges are empty";let e=`Buffered Ranges: 
`;for(let i=0;i<t.length;i++){const n=t.start(i),s=t.end(i);e+=`${n} --> ${s}. Duration (${s-n})
`}return e}const ra=1/30,sa=ra*3,A4=function(t,e){const i=[];let n;if(t&&t.length)for(n=0;n<t.length;n++)e(t.start(n),t.end(n))&&i.push([t.start(n),t.end(n)]);return pn(i)},Yu=function(t,e){return A4(t,function(i,n){return i-sa<=e&&n+sa>=e})},wf=function(t,e){return A4(t,function(i){return i-ra>=e})},hN=function(t){if(t.length<2)return pn();const e=[];for(let i=1;i<t.length;i++){const n=t.end(i-1),s=t.start(i);e.push([n,s])}return pn(e)},fN=function(t,e){let i=null,n=null,s=0;const o=[],l=[];if(!t||!t.length||!e||!e.length)return pn();let c=t.length;for(;c--;)o.push({time:t.start(c),type:"start"}),o.push({time:t.end(c),type:"end"});for(c=e.length;c--;)o.push({time:e.start(c),type:"start"}),o.push({time:e.end(c),type:"end"});for(o.sort(function(h,f){return h.time-f.time}),c=0;c<o.length;c++)o[c].type==="start"?(s++,s===2&&(i=o[c].time)):o[c].type==="end"&&(s--,s===1&&(n=o[c].time)),i!==null&&n!==null&&(l.push([i,n]),i=null,n=null);return pn(l)},D4=t=>{const e=[];if(!t||!t.length)return"";for(let i=0;i<t.length;i++)e.push(t.start(i)+" => "+t.end(i));return e.join(", ")},pN=function(t,e,i=1){return((t.length?t.end(t.length-1):0)-e)/i},Gl=t=>{const e=[];for(let i=0;i<t.length;i++)e.push({start:t.start(i),end:t.end(i)});return e},mN=function(t,e){if(t===e)return!1;if(!t&&e||!e&&t||t.length!==e.length)return!0;for(let i=0;i<t.length;i++)if(t.start(i)!==e.start(i)||t.end(i)!==e.end(i))return!0;return!1},L0=function(t){if(!(!t||!t.length||!t.end))return t.end(t.length-1)},U_=function(t,e){let i=0;if(!t||!t.length)return i;for(let n=0;n<t.length;n++){const s=t.start(n),o=t.end(n);if(!(e>o)){if(e>s&&e<=o){i+=o-e;continue}i+=o-s}}return i},P_=(t,e)=>{if(!e.preload)return e.duration;let i=0;return(e.parts||[]).forEach(function(n){i+=n.duration}),(e.preloadHints||[]).forEach(function(n){n.type==="PART"&&(i+=t.partTargetDuration)}),i},_y=t=>(t.segments||[]).reduce((e,i,n)=>(i.parts?i.parts.forEach(function(s,o){e.push({duration:s.duration,segmentIndex:n,partIndex:o,part:s,segment:i})}):e.push({duration:i.duration,segmentIndex:n,partIndex:null,segment:i,part:null}),e),[]),k4=t=>{const e=t.segments&&t.segments.length&&t.segments[t.segments.length-1];return e&&e.parts||[]},$4=({preloadSegment:t})=>{if(!t)return;const{parts:e,preloadHints:i}=t;let n=(i||[]).reduce((s,o)=>s+(o.type==="PART"?1:0),0);return n+=e&&e.length?e.length:0,n},O4=(t,e)=>{if(e.endList)return 0;if(t&&t.suggestedPresentationDelay)return t.suggestedPresentationDelay;const i=k4(e).length>0;return i&&e.serverControl&&e.serverControl.partHoldBack?e.serverControl.partHoldBack:i&&e.partTargetDuration?e.partTargetDuration*3:e.serverControl&&e.serverControl.holdBack?e.serverControl.holdBack:e.targetDuration?e.targetDuration*3:0},gN=function(t,e){let i=0,n=e-t.mediaSequence,s=t.segments[n];if(s){if(typeof s.start<"u")return{result:s.start,precise:!0};if(typeof s.end<"u")return{result:s.end-s.duration,precise:!0}}for(;n--;){if(s=t.segments[n],typeof s.end<"u")return{result:i+s.end,precise:!0};if(i+=P_(t,s),typeof s.start<"u")return{result:i+s.start,precise:!0}}return{result:i,precise:!1}},yN=function(t,e){let i=0,n,s=e-t.mediaSequence;for(;s<t.segments.length;s++){if(n=t.segments[s],typeof n.start<"u")return{result:n.start-i,precise:!0};if(i+=P_(t,n),typeof n.end<"u")return{result:n.end-i,precise:!0}}return{result:-1,precise:!1}},I4=function(t,e,i){if(typeof e>"u"&&(e=t.mediaSequence+t.segments.length),e<t.mediaSequence)return 0;const n=gN(t,e);if(n.precise)return n.result;const s=yN(t,e);return s.precise?s.result:n.result+i},R4=function(t,e,i){if(!t)return 0;if(typeof i!="number"&&(i=0),typeof e>"u"){if(t.totalDuration)return t.totalDuration;if(!t.endList)return te.Infinity}return I4(t,e,i)},Gd=function({defaultDuration:t,durationList:e,startIndex:i,endIndex:n}){let s=0;if(i>n&&([i,n]=[n,i]),i<0){for(let o=i;o<Math.min(0,n);o++)s+=t;i=0}for(let o=i;o<n;o++)s+=e[o].duration;return s},M4=function(t,e,i,n){if(!t||!t.segments)return null;if(t.endList)return R4(t);if(e===null)return null;e=e||0;let s=I4(t,t.mediaSequence+t.segments.length,e);return i&&(n=typeof n=="number"?n:O4(null,t),s-=n),Math.max(0,s)},_N=function(t,e,i){const s=e||0;let o=M4(t,e,!0,i);return o===null?pn():(o<s&&(o=s),pn(s,o))},vN=function({playlist:t,currentTime:e,startingSegmentIndex:i,startingPartIndex:n,startTime:s,exactManifestTimings:o}){let l=e-s;const c=_y(t);let h=0;for(let f=0;f<c.length;f++){const m=c[f];if(i===m.segmentIndex&&!(typeof n=="number"&&typeof m.partIndex=="number"&&n!==m.partIndex)){h=f;break}}if(l<0){if(h>0)for(let f=h-1;f>=0;f--){const m=c[f];if(l+=m.duration,o){if(l<0)continue}else if(l+ra<=0)continue;return{partIndex:m.partIndex,segmentIndex:m.segmentIndex,startTime:s-Gd({defaultDuration:t.targetDuration,durationList:c,startIndex:h,endIndex:f})}}return{partIndex:c[0]&&c[0].partIndex||null,segmentIndex:c[0]&&c[0].segmentIndex||0,startTime:e}}if(h<0){for(let f=h;f<0;f++)if(l-=t.targetDuration,l<0)return{partIndex:c[0]&&c[0].partIndex||null,segmentIndex:c[0]&&c[0].segmentIndex||0,startTime:e};h=0}for(let f=h;f<c.length;f++){const m=c[f];l-=m.duration;const _=m.duration>ra,E=l===0,w=_&&l+ra>=0;if(!((E||w)&&f!==c.length-1)){if(o){if(l>0)continue}else if(l-ra>=0)continue;return{partIndex:m.partIndex,segmentIndex:m.segmentIndex,startTime:s+Gd({defaultDuration:t.targetDuration,durationList:c,startIndex:h,endIndex:f})}}}return{segmentIndex:c[c.length-1].segmentIndex,partIndex:c[c.length-1].partIndex,startTime:e}},N4=function(t){return t.excludeUntil&&t.excludeUntil>Date.now()},z_=function(t){return t.excludeUntil&&t.excludeUntil===1/0},$p=function(t){const e=N4(t);return!t.disabled&&!e},bN=function(t){return t.disabled},TN=function(t){for(let e=0;e<t.segments.length;e++)if(t.segments[e].key)return!0;return!1},B4=function(t,e){return e.attributes&&e.attributes[t]},xN=function(t,e,i,n=0){return B4("BANDWIDTH",i)?(t*i.attributes.BANDWIDTH-n*8)/e:NaN},vy=(t,e)=>{if(t.playlists.length===1)return!0;const i=e.attributes.BANDWIDTH||Number.MAX_VALUE;return t.playlists.filter(n=>$p(n)?(n.attributes.BANDWIDTH||0)<i:!1).length===0},F_=(t,e)=>!t&&!e||!t&&e||t&&!e?!1:!!(t===e||t.id&&e.id&&t.id===e.id||t.resolvedUri&&e.resolvedUri&&t.resolvedUri===e.resolvedUri||t.uri&&e.uri&&t.uri===e.uri),Rw=function(t,e){const i=t&&t.mediaGroups&&t.mediaGroups.AUDIO||{};let n=!1;for(const s in i){for(const o in i[s])if(n=e(i[s][o]),n)break;if(n)break}return!!n},oh=t=>{if(!t||!t.playlists||!t.playlists.length)return Rw(t,i=>i.playlists&&i.playlists.length||i.uri);for(let e=0;e<t.playlists.length;e++){const i=t.playlists[e],n=i.attributes&&i.attributes.CODECS;if(!(n&&n.split(",").every(o=>X3(o))||Rw(t,o=>F_(i,o))))return!1}return!0};var cr={liveEdgeDelay:O4,duration:R4,seekable:_N,getMediaInfoForTime:vN,isEnabled:$p,isDisabled:bN,isExcluded:N4,isIncompatible:z_,playlistEnd:M4,isAes:TN,hasAttribute:B4,estimateSegmentRequestTime:xN,isLowestEnabledRendition:vy,isAudioOnly:oh,playlistMatch:F_,segmentDurationWithParts:P_};const{log:L4}=_e,ic=(t,e)=>`${t}-${e}`,U4=(t,e,i)=>`placeholder-uri-${t}-${e}-${i}`,SN=({onwarn:t,oninfo:e,manifestString:i,customTagParsers:n=[],customTagMappers:s=[],llhls:o})=>{const l=new cR;t&&l.on("warn",t),e&&l.on("info",e),n.forEach(f=>l.addParser(f)),s.forEach(f=>l.addTagMapper(f)),l.push(i),l.end();const c=l.manifest;if(o||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function(f){c.hasOwnProperty(f)&&delete c[f]}),c.segments&&c.segments.forEach(function(f){["parts","preloadHints"].forEach(function(m){f.hasOwnProperty(m)&&delete f[m]})})),!c.targetDuration){let f=10;c.segments&&c.segments.length&&(f=c.segments.reduce((m,_)=>Math.max(m,_.duration),0)),t&&t({message:`manifest has no targetDuration defaulting to ${f}`}),c.targetDuration=f}const h=k4(c);if(h.length&&!c.partTargetDuration){const f=h.reduce((m,_)=>Math.max(m,_.duration),0);t&&(t({message:`manifest has no partTargetDuration defaulting to ${f}`}),L4.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),c.partTargetDuration=f}return c},Ec=(t,e)=>{t.mediaGroups&&["AUDIO","SUBTITLES"].forEach(i=>{if(t.mediaGroups[i])for(const n in t.mediaGroups[i])for(const s in t.mediaGroups[i][n]){const o=t.mediaGroups[i][n][s];e(o,i,n,s)}})},P4=({playlist:t,uri:e,id:i})=>{t.id=i,t.playlistErrors_=0,e&&(t.uri=e),t.attributes=t.attributes||{}},wN=t=>{let e=t.playlists.length;for(;e--;){const i=t.playlists[e];P4({playlist:i,id:ic(e,i.uri)}),i.resolvedUri=ur(t.uri,i.uri),t.playlists[i.id]=i,t.playlists[i.uri]=i,i.attributes.BANDWIDTH||L4.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}},EN=t=>{Ec(t,e=>{e.uri&&(e.resolvedUri=ur(t.uri,e.uri))})},CN=(t,e)=>{const i=ic(0,e),n={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:te.location.href,resolvedUri:te.location.href,playlists:[{uri:e,id:i,resolvedUri:e,attributes:{}}]};return n.playlists[i]=n.playlists[0],n.playlists[e]=n.playlists[0],n},z4=(t,e,i=U4)=>{t.uri=e;for(let s=0;s<t.playlists.length;s++)if(!t.playlists[s].uri){const o=`placeholder-uri-${s}`;t.playlists[s].uri=o}const n=oh(t);Ec(t,(s,o,l,c)=>{if(!s.playlists||!s.playlists.length){if(n&&o==="AUDIO"&&!s.uri)for(let h=0;h<t.playlists.length;h++){const f=t.playlists[h];if(f.attributes&&f.attributes.AUDIO&&f.attributes.AUDIO===l)return}s.playlists=[Li({},s)]}s.playlists.forEach(function(h,f){const m=i(o,l,c,h),_=ic(f,m);h.uri?h.resolvedUri=h.resolvedUri||ur(t.uri,h.uri):(h.uri=f===0?m:_,h.resolvedUri=h.uri),h.id=h.id||_,h.attributes=h.attributes||{},t.playlists[h.id]=h,t.playlists[h.uri]=h})}),wN(t),EN(t)};class Mw{constructor(){this.offset_=null,this.pendingDateRanges_=new Map,this.processedDateRanges_=new Map}setOffset(e=[]){if(this.offset_!==null||!e.length)return;const[i]=e;i.programDateTime!==void 0&&(this.offset_=i.programDateTime/1e3)}setPendingDateRanges(e=[]){if(!e.length)return;const[i]=e,n=i.startDate.getTime();this.trimProcessedDateRanges_(n),this.pendingDateRanges_=e.reduce((s,o)=>(s.set(o.id,o),s),new Map)}processDateRange(e){this.pendingDateRanges_.delete(e.id),this.processedDateRanges_.set(e.id,e)}getDateRangesToProcess(){if(this.offset_===null)return[];const e={},i=[];this.pendingDateRanges_.forEach((n,s)=>{if(!this.processedDateRanges_.has(s)&&(n.startTime=n.startDate.getTime()/1e3-this.offset_,n.processDateRange=()=>this.processDateRange(n),i.push(n),!!n.class))if(e[n.class]){const o=e[n.class].push(n);n.classListIndex=o-1}else e[n.class]=[n],n.classListIndex=0});for(const n of i){const s=e[n.class]||[];n.endDate?n.endTime=n.endDate.getTime()/1e3-this.offset_:n.endOnNext&&s[n.classListIndex+1]?n.endTime=s[n.classListIndex+1].startTime:n.duration?n.endTime=n.startTime+n.duration:n.plannedDuration?n.endTime=n.startTime+n.plannedDuration:n.endTime=n.startTime}return i}trimProcessedDateRanges_(e){new Map(this.processedDateRanges_).forEach((n,s)=>{n.startDate.getTime()<e&&this.processedDateRanges_.delete(s)})}}const F4=22,Jl=({requestType:t,request:e,error:i,parseFailure:n})=>{const s=e.status<200||e.status>299,o=e.status>=400&&e.status<=499,l={uri:e.uri,requestType:t},c=s&&!o||n;if(i&&o)l.error=Li({},i),l.errorType=_e.Error.NetworkRequestFailed;else if(e.aborted)l.errorType=_e.Error.NetworkRequestAborted;else if(e.timedout)l.errorType=_e.Error.NetworkRequestTimeout;else if(c){const h=n?_e.Error.NetworkBodyParserFailed:_e.Error.NetworkBadStatus;l.errorType=h,l.status=e.status,l.headers=e.headers}return l},AN=ns("CodecUtils"),q4=function(t){const e=t.attributes||{};if(e.CODECS)return ta(e.CODECS)},j4=(t,e)=>{const i=e.attributes||{};return t&&t.mediaGroups&&t.mediaGroups.AUDIO&&i.AUDIO&&t.mediaGroups.AUDIO[i.AUDIO]},DN=(t,e)=>{if(!j4(t,e))return!0;const i=e.attributes||{},n=t.mediaGroups.AUDIO[i.AUDIO];for(const s in n)if(!n[s].uri&&!n[s].playlists)return!0;return!1},eh=function(t){const e={};return t.forEach(({mediaType:i,type:n,details:s})=>{e[i]=e[i]||[],e[i].push(W3(`${n}${s}`))}),Object.keys(e).forEach(function(i){if(e[i].length>1){AN(`multiple ${i} codecs found as attributes: ${e[i].join(", ")}. Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs.`),e[i]=null;return}e[i]=e[i][0]}),e},Nw=function(t){let e=0;return t.audio&&e++,t.video&&e++,e},Wd=function(t,e){const i=e.attributes||{},n=eh(q4(e)||[]);if(j4(t,e)&&!n.audio&&!DN(t,e)){const s=eh(hR(t,i.AUDIO)||[]);s.audio&&(n.audio=s.audio)}return n},{EventTarget:kN}=_e,$N=(t,e)=>{if(e.endList||!e.serverControl)return t;const i={};if(e.serverControl.canBlockReload){const{preloadSegment:n}=e;let s=e.mediaSequence+e.segments.length;if(n){const o=n.parts||[],l=$4(e)-1;l>-1&&l!==o.length-1&&(i._HLS_part=l),(l>-1||o.length)&&s--}i._HLS_msn=s}if(e.serverControl&&e.serverControl.canSkipUntil&&(i._HLS_skip=e.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(i).length){const n=new te.URL(t);["_HLS_skip","_HLS_msn","_HLS_part"].forEach(function(s){i.hasOwnProperty(s)&&n.searchParams.set(s,i[s])}),t=n.toString()}return t},ON=(t,e)=>{if(!t)return e;const i=Gt(t,e);if(t.preloadHints&&!e.preloadHints&&delete i.preloadHints,t.parts&&!e.parts)delete i.parts;else if(t.parts&&e.parts)for(let n=0;n<e.parts.length;n++)t.parts&&t.parts[n]&&(i.parts[n]=Gt(t.parts[n],e.parts[n]));return!t.skipped&&e.skipped&&(i.skipped=!1),t.preload&&!e.preload&&(i.preload=!1),i},IN=(t,e,i)=>{const n=t.slice(),s=e.slice();i=i||0;const o=[];let l;for(let c=0;c<s.length;c++){const h=n[c+i],f=s[c];h?(l=h.map||l,o.push(ON(h,f))):(l&&!f.map&&(f.map=l),o.push(f))}return o},H4=(t,e)=>{!t.resolvedUri&&t.uri&&(t.resolvedUri=ur(e,t.uri)),t.key&&!t.key.resolvedUri&&(t.key.resolvedUri=ur(e,t.key.uri)),t.map&&!t.map.resolvedUri&&(t.map.resolvedUri=ur(e,t.map.uri)),t.map&&t.map.key&&!t.map.key.resolvedUri&&(t.map.key.resolvedUri=ur(e,t.map.key.uri)),t.parts&&t.parts.length&&t.parts.forEach(i=>{i.resolvedUri||(i.resolvedUri=ur(e,i.uri))}),t.preloadHints&&t.preloadHints.length&&t.preloadHints.forEach(i=>{i.resolvedUri||(i.resolvedUri=ur(e,i.uri))})},V4=function(t){const e=t.segments||[],i=t.preloadSegment;if(i&&i.parts&&i.parts.length){if(i.preloadHints){for(let n=0;n<i.preloadHints.length;n++)if(i.preloadHints[n].type==="MAP")return e}i.duration=t.targetDuration,i.preload=!0,e.push(i)}return e},G4=(t,e)=>t===e||t.segments&&e.segments&&t.segments.length===e.segments.length&&t.endList===e.endList&&t.mediaSequence===e.mediaSequence&&t.preloadSegment===e.preloadSegment,by=(t,e,i=G4)=>{const n=Gt(t,{}),s=n.playlists[e.id];if(!s||i(s,e))return null;e.segments=V4(e);const o=Gt(s,e);if(o.preloadSegment&&!e.preloadSegment&&delete o.preloadSegment,s.segments){if(e.skip){e.segments=e.segments||[];for(let l=0;l<e.skip.skippedSegments;l++)e.segments.unshift({skipped:!0})}o.segments=IN(s.segments,e.segments,e.mediaSequence-s.mediaSequence)}o.segments.forEach(l=>{H4(l,o.resolvedUri)});for(let l=0;l<n.playlists.length;l++)n.playlists[l].id===e.id&&(n.playlists[l]=o);return n.playlists[e.id]=o,n.playlists[e.uri]=o,Ec(t,(l,c,h,f)=>{if(l.playlists)for(let m=0;m<l.playlists.length;m++)e.id===l.playlists[m].id&&(l.playlists[m]=o)}),n},Ty=(t,e)=>{const i=t.segments||[],n=i[i.length-1],s=n&&n.parts&&n.parts[n.parts.length-1],o=s&&s.duration||n&&n.duration;return e&&o?o*1e3:(t.partTargetDuration||t.targetDuration||10)*500},Bw=(t,e,i)=>{if(!t)return;const n=[];return t.forEach(s=>{if(!s.attributes)return;const{BANDWIDTH:o,RESOLUTION:l,CODECS:c}=s.attributes;n.push({id:s.id,bandwidth:o,resolution:l,codecs:c})}),{type:e,isLive:i,renditions:n}};class Qu extends kN{constructor(e,i,n={}){if(super(),!e)throw new Error("A non-empty playlist URL or object is required");this.logger_=ns("PlaylistLoader");const{withCredentials:s=!1}=n;this.src=e,this.vhs_=i,this.withCredentials=s,this.addDateRangesToTextTrack_=n.addDateRangesToTextTrack;const o=i.options_;this.customTagParsers=o&&o.customTagParsers||[],this.customTagMappers=o&&o.customTagMappers||[],this.llhls=o&&o.llhls,this.dateRangesStorage_=new Mw,this.state="HAVE_NOTHING",this.handleMediaupdatetimeout_=this.handleMediaupdatetimeout_.bind(this),this.on("mediaupdatetimeout",this.handleMediaupdatetimeout_),this.on("loadedplaylist",this.handleLoadedPlaylist_.bind(this))}handleLoadedPlaylist_(){const e=this.media();if(!e)return;this.dateRangesStorage_.setOffset(e.segments),this.dateRangesStorage_.setPendingDateRanges(e.dateRanges);const i=this.dateRangesStorage_.getDateRangesToProcess();!i.length||!this.addDateRangesToTextTrack_||this.addDateRangesToTextTrack_(i)}handleMediaupdatetimeout_(){if(this.state!=="HAVE_METADATA")return;const e=this.media();let i=ur(this.main.uri,e.uri);this.llhls&&(i=$N(i,e)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:i,withCredentials:this.withCredentials,requestType:"hls-playlist"},(n,s)=>{if(this.request){if(n)return this.playlistRequestError(this.request,this.media(),"HAVE_METADATA");this.haveMetadata({playlistString:this.request.responseText,url:this.media().uri,id:this.media().id})}})}playlistRequestError(e,i,n){const{uri:s,id:o}=i;this.request=null,n&&(this.state=n),this.error={playlist:this.main.playlists[o],status:e.status,message:`HLS playlist request error at URL: ${s}.`,responseText:e.responseText,code:e.status>=500?4:2,metadata:Jl({requestType:e.requestType,request:e,error:e.error})},this.trigger("error")}parseManifest_({url:e,manifestString:i}){try{const n=SN({onwarn:({message:s})=>this.logger_(`m3u8-parser warn for ${e}: ${s}`),oninfo:({message:s})=>this.logger_(`m3u8-parser info for ${e}: ${s}`),manifestString:i,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,llhls:this.llhls});return!n.playlists||!n.playlists.length||this.excludeAudioOnlyVariants(n.playlists),n}catch(n){this.error=n,this.error.metadata={errorType:_e.Error.StreamingHlsPlaylistParserError,error:n}}}excludeAudioOnlyVariants(e){const i=n=>{const s=n.attributes||{},{width:o,height:l}=s.RESOLUTION||{};if(o&&l)return!0;const c=q4(n)||[];return!!eh(c).video};e.some(i)&&e.forEach(n=>{i(n)||(n.excludeUntil=1/0)})}haveMetadata({playlistString:e,playlistObject:i,url:n,id:s}){this.request=null,this.state="HAVE_METADATA";const o={playlistInfo:{type:"media",uri:n}};this.trigger({type:"playlistparsestart",metadata:o});const l=i||this.parseManifest_({url:n,manifestString:e});l.lastRequest=Date.now(),P4({playlist:l,uri:n,id:s});const c=by(this.main,l);this.targetDuration=l.partTargetDuration||l.targetDuration,this.pendingMedia_=null,c?(this.main=c,this.media_=this.main.playlists[s]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(Ty(this.media(),!!c)),o.parsedPlaylist=Bw(this.main.playlists,o.playlistInfo.type,!this.media_.endList),this.trigger({type:"playlistparsecomplete",metadata:o}),this.trigger("loadedplaylist")}dispose(){this.trigger("dispose"),this.stopRequest(),te.clearTimeout(this.mediaUpdateTimeout),te.clearTimeout(this.finalRenditionTimeout),this.dateRangesStorage_=new Mw,this.off()}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e,i){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);if(typeof e=="string"){if(!this.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.main.playlists[e]}if(te.clearTimeout(this.finalRenditionTimeout),i){const c=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;this.finalRenditionTimeout=te.setTimeout(this.media.bind(this,e,!1),c);return}const n=this.state,s=!this.media_||e.id!==this.media_.id,o=this.main.playlists[e.id];if(o&&o.endList||e.endList&&e.segments.length){this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,s&&(this.trigger("mediachanging"),n==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange"));return}if(this.updateMediaUpdateTimeout_(Ty(e,!0)),!s)return;if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e;const l={playlistInfo:{type:"media",uri:e.uri}};this.trigger({type:"playlistrequeststart",metadata:l}),this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials,requestType:"hls-playlist"},(c,h)=>{if(this.request){if(e.lastRequest=Date.now(),e.resolvedUri=np(e.resolvedUri,h),c)return this.playlistRequestError(this.request,e,n);this.trigger({type:"playlistrequestcomplete",metadata:l}),this.haveMetadata({playlistString:h.responseText,url:e.uri,id:e.id}),n==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}})}pause(){this.mediaUpdateTimeout&&(te.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),this.state==="HAVE_NOTHING"&&(this.started=!1),this.state==="SWITCHING_MEDIA"?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MAIN_MANIFEST":this.state==="HAVE_CURRENT_METADATA"&&(this.state="HAVE_METADATA")}load(e){this.mediaUpdateTimeout&&(te.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);const i=this.media();if(e){const n=i?(i.partTargetDuration||i.targetDuration)/2*1e3:5e3;this.mediaUpdateTimeout=te.setTimeout(()=>{this.mediaUpdateTimeout=null,this.load()},n);return}if(!this.started){this.start();return}i&&!i.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist")}updateMediaUpdateTimeout_(e){this.mediaUpdateTimeout&&(te.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),!(!this.media()||this.media().endList)&&(this.mediaUpdateTimeout=te.setTimeout(()=>{this.mediaUpdateTimeout=null,this.trigger("mediaupdatetimeout"),this.updateMediaUpdateTimeout_(e)},e))}start(){if(this.started=!0,typeof this.src=="object"){this.src.uri||(this.src.uri=te.location.href),this.src.resolvedUri=this.src.uri,setTimeout(()=>{this.setupInitialPlaylist(this.src)},0);return}const e={playlistInfo:{type:"multivariant",uri:this.src}};this.trigger({type:"playlistrequeststart",metadata:e}),this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials,requestType:"hls-playlist"},(i,n)=>{if(!this.request)return;if(this.request=null,i)return this.error={status:n.status,message:`HLS playlist request error at URL: ${this.src}.`,responseText:n.responseText,code:2,metadata:Jl({requestType:n.requestType,request:n,error:i})},this.state==="HAVE_NOTHING"&&(this.started=!1),this.trigger("error");this.trigger({type:"playlistrequestcomplete",metadata:e}),this.src=np(this.src,n),this.trigger({type:"playlistparsestart",metadata:e});const s=this.parseManifest_({manifestString:n.responseText,url:this.src});e.parsedPlaylist=Bw(s.playlists,e.playlistInfo.type,!1),this.trigger({type:"playlistparsecomplete",metadata:e}),this.setupInitialPlaylist(s)})}srcUri(){return typeof this.src=="string"?this.src:this.src.uri}setupInitialPlaylist(e){if(this.state="HAVE_MAIN_MANIFEST",e.playlists){this.main=e,z4(this.main,this.srcUri()),e.playlists.forEach(n=>{n.segments=V4(n),n.segments.forEach(s=>{H4(s,n.resolvedUri)})}),this.trigger("loadedplaylist"),this.request||this.media(this.main.playlists[0]);return}const i=this.srcUri()||te.location.href;this.main=CN(e,i),this.haveMetadata({playlistObject:e,url:i,id:this.main.playlists[0].id}),this.trigger("loadedmetadata")}updateOrDeleteClone(e,i){const n=this.main,s=e.ID;let o=n.playlists.length;for(;o--;){const l=n.playlists[o];if(l.attributes["PATHWAY-ID"]===s){const c=l.resolvedUri,h=l.id;if(i){const f=this.createCloneURI_(l.resolvedUri,e),m=ic(s,f),_=this.createCloneAttributes_(s,l.attributes),E=this.createClonePlaylist_(l,m,e,_);n.playlists[o]=E,n.playlists[m]=E,n.playlists[f]=E}else n.playlists.splice(o,1);delete n.playlists[h],delete n.playlists[c]}}this.updateOrDeleteCloneMedia(e,i)}updateOrDeleteCloneMedia(e,i){const n=this.main,s=e.ID;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(o=>{if(!(!n.mediaGroups[o]||!n.mediaGroups[o][s])){for(const l in n.mediaGroups[o])if(l===s){for(const c in n.mediaGroups[o][l])n.mediaGroups[o][l][c].playlists.forEach((f,m)=>{const _=n.playlists[f.id],E=_.id,w=_.resolvedUri;delete n.playlists[E],delete n.playlists[w]});delete n.mediaGroups[o][l]}}}),i&&this.createClonedMediaGroups_(e)}addClonePathway(e,i={}){const n=this.main,s=n.playlists.length,o=this.createCloneURI_(i.resolvedUri,e),l=ic(e.ID,o),c=this.createCloneAttributes_(e.ID,i.attributes),h=this.createClonePlaylist_(i,l,e,c);n.playlists[s]=h,n.playlists[l]=h,n.playlists[o]=h,this.createClonedMediaGroups_(e)}createClonedMediaGroups_(e){const i=e.ID,n=e["BASE-ID"],s=this.main;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(o=>{if(!(!s.mediaGroups[o]||s.mediaGroups[o][i]))for(const l in s.mediaGroups[o]){if(l===n)s.mediaGroups[o][i]={};else continue;for(const c in s.mediaGroups[o][l]){const h=s.mediaGroups[o][l][c];s.mediaGroups[o][i][c]=Li({},h);const f=s.mediaGroups[o][i][c],m=this.createCloneURI_(h.resolvedUri,e);f.resolvedUri=m,f.uri=m,f.playlists=[],h.playlists.forEach((_,E)=>{const w=s.playlists[_.id],A=U4(o,i,c),C=ic(i,A);if(w&&!s.playlists[C]){const M=this.createClonePlaylist_(w,C,e),O=M.resolvedUri;s.playlists[C]=M,s.playlists[O]=M}f.playlists[E]=this.createClonePlaylist_(_,C,e)})}}})}createClonePlaylist_(e,i,n,s){const o=this.createCloneURI_(e.resolvedUri,n),l={resolvedUri:o,uri:o,id:i};return e.segments&&(l.segments=[]),s&&(l.attributes=s),Gt(e,l)}createCloneURI_(e,i){const n=new URL(e);n.hostname=i["URI-REPLACEMENT"].HOST;const s=i["URI-REPLACEMENT"].PARAMS;for(const o of Object.keys(s))n.searchParams.set(o,s[o]);return n.href}createCloneAttributes_(e,i){const n={"PATHWAY-ID":e};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(s=>{i[s]&&(n[s]=e)}),n}getKeyIdSet(e){const i=new Set;if(!e||!e.contentProtection)return i;for(const n in e.contentProtection)if(e.contentProtection[n]&&e.contentProtection[n].attributes&&e.contentProtection[n].attributes.keyId){const s=e.contentProtection[n].attributes.keyId;i.add(s.toLowerCase())}return i}}const xy=function(t,e,i,n){const s=t.responseType==="arraybuffer"?t.response:t.responseText;!e&&s&&(t.responseTime=Date.now(),t.roundTripTime=t.responseTime-t.requestTime,t.bytesReceived=s.byteLength||s.length,t.bandwidth||(t.bandwidth=Math.floor(t.bytesReceived/t.roundTripTime*8*1e3))),i.headers&&(t.responseHeaders=i.headers),e&&e.code==="ETIMEDOUT"&&(t.timedout=!0),!e&&!t.aborted&&i.statusCode!==200&&i.statusCode!==206&&i.statusCode!==0&&(e=new Error("XHR Failed with a response of: "+(t&&(s||t.responseText)))),n(e,t)},RN=(t,e)=>{if(!t||!t.size)return;let i=e;return t.forEach(n=>{i=n(i)}),i},MN=(t,e,i,n)=>{!t||!t.size||t.forEach(s=>{s(e,i,n)})},W4=function(){const t=function e(i,n){i=Gt({timeout:45e3},i);const s=e.beforeRequest||_e.Vhs.xhr.beforeRequest,o=e._requestCallbackSet||_e.Vhs.xhr._requestCallbackSet||new Set,l=e._responseCallbackSet||_e.Vhs.xhr._responseCallbackSet;s&&typeof s=="function"&&(_e.log.warn("beforeRequest is deprecated, use onRequest instead."),o.add(s));const c=_e.Vhs.xhr.original===!0?_e.xhr:_e.Vhs.xhr,h=RN(o,i);o.delete(s);const f=c(h||i,function(_,E){return MN(l,f,_,E),xy(f,_,E,n)}),m=f.abort;return f.abort=function(){return f.aborted=!0,m.apply(f,arguments)},f.uri=i.uri,f.requestType=i.requestType,f.requestTime=Date.now(),f};return t.original=!0,t},NN=function(t){let e;const i=t.offset;return typeof t.offset=="bigint"||typeof t.length=="bigint"?e=te.BigInt(t.offset)+te.BigInt(t.length)-te.BigInt(1):e=t.offset+t.length-1,"bytes="+i+"-"+e},Sy=function(t){const e={};return t.byterange&&(e.Range=NN(t.byterange)),e},BN=function(t,e){return t.start(e)+"-"+t.end(e)},LN=function(t,e){const i=t.toString(16);return"00".substring(0,2-i.length)+i+(e%2?" ":"")},UN=function(t){return t>=32&&t<126?String.fromCharCode(t):"."},X4=function(t){const e={};return Object.keys(t).forEach(i=>{const n=t[i];Y3(n)?e[i]={bytes:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength}:e[i]=n}),e},rp=function(t){const e=t.byterange||{length:1/0,offset:0};return[e.length,e.offset,t.resolvedUri].join(",")},K4=function(t){return t.resolvedUri},Y4=t=>{const e=Array.prototype.slice.call(t),i=16;let n="",s,o;for(let l=0;l<e.length/i;l++)s=e.slice(l*i,l*i+i).map(LN).join(""),o=e.slice(l*i,l*i+i).map(UN).join(""),n+=s+" "+o+`
`;return n},PN=({bytes:t})=>Y4(t),zN=t=>{let e="",i;for(i=0;i<t.length;i++)e+=BN(t,i)+" ";return e};var FN=Object.freeze({__proto__:null,createTransferableMessage:X4,initSegmentId:rp,segmentKeyId:K4,hexDump:Y4,tagDump:PN,textRanges:zN});const Q4=.25,qN=(t,e)=>{if(!e.dateTimeObject)return null;const i=e.videoTimingInfo.transmuxerPrependedSeconds,s=e.videoTimingInfo.transmuxedPresentationStart+i,o=t-s;return new Date(e.dateTimeObject.getTime()+o*1e3)},jN=t=>t.transmuxedPresentationEnd-t.transmuxedPresentationStart-t.transmuxerPrependedSeconds,HN=(t,e)=>{let i;try{i=new Date(t)}catch{return null}if(!e||!e.segments||e.segments.length===0)return null;let n=e.segments[0];if(i<new Date(n.dateTimeObject))return null;for(let h=0;h<e.segments.length-1;h++){n=e.segments[h];const f=new Date(e.segments[h+1].dateTimeObject);if(i<f)break}const s=e.segments[e.segments.length-1],o=s.dateTimeObject,l=s.videoTimingInfo?jN(s.videoTimingInfo):s.duration+s.duration*Q4,c=new Date(o.getTime()+l*1e3);return i>c?null:(i>new Date(o)&&(n=s),{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:cr.duration(e,e.mediaSequence+e.segments.indexOf(n)),type:n.videoTimingInfo?"accurate":"estimate"})},VN=(t,e)=>{if(!e||!e.segments||e.segments.length===0)return null;let i=0,n;for(let o=0;o<e.segments.length&&(n=e.segments[o],i=n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationEnd:i+n.duration,!(t<=i));o++);const s=e.segments[e.segments.length-1];if(s.videoTimingInfo&&s.videoTimingInfo.transmuxedPresentationEnd<t)return null;if(t>i){if(t>i+s.duration*Q4)return null;n=s}return{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:i-n.duration,type:n.videoTimingInfo?"accurate":"estimate"}},GN=(t,e)=>{let i,n;try{i=new Date(t),n=new Date(e)}catch{}const s=i.getTime();return(n.getTime()-s)/1e3},WN=t=>{if(!t.segments||t.segments.length===0)return!1;for(let e=0;e<t.segments.length;e++)if(!t.segments[e].dateTimeObject)return!1;return!0},XN=({playlist:t,time:e=void 0,callback:i})=>{if(!i)throw new Error("getProgramTime: callback must be provided");if(!t||e===void 0)return i({message:"getProgramTime: playlist and time must be provided"});const n=VN(e,t);if(!n)return i({message:"valid programTime was not found"});if(n.type==="estimate")return i({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:n.estimatedStart});const s={mediaSeconds:e},o=qN(e,n.segment);return o&&(s.programDateTime=o.toISOString()),i(null,s)},Z4=({programTime:t,playlist:e,retryCount:i=2,seekTo:n,pauseAfterSeek:s=!0,tech:o,callback:l})=>{if(!l)throw new Error("seekToProgramTime: callback must be provided");if(typeof t>"u"||!e||!n)return l({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!e.endList&&!o.hasStarted_)return l({message:"player must be playing a live stream to start buffering"});if(!WN(e))return l({message:"programDateTime tags must be provided in the manifest "+e.resolvedUri});const c=HN(t,e);if(!c)return l({message:`${t} was not found in the stream`});const h=c.segment,f=GN(h.dateTimeObject,t);if(c.type==="estimate"){if(i===0)return l({message:`${t} is not buffered yet. Try again`});n(c.estimatedStart+f),o.one("seeked",()=>{Z4({programTime:t,playlist:e,retryCount:i-1,seekTo:n,pauseAfterSeek:s,tech:o,callback:l})});return}const m=h.start+f,_=()=>l(null,o.currentTime());o.one("seeked",_),s&&o.pause(),n(m)},U0=(t,e)=>{if(t.readyState===4)return e()},KN=(t,e,i,n)=>{let s=[],o,l=!1;const c=function(_,E,w,A){return E.abort(),l=!0,i(_,E,w,A)},h=function(_,E){if(l)return;if(_)return _.metadata=Jl({requestType:n,request:E,error:_}),c(_,E,"",s);const w=E.responseText.substring(s&&s.byteLength||0,E.responseText.length);if(s=xR(s,Q3(w,!0)),o=o||Ud(s),s.length<10||o&&s.length<o+2)return U0(E,()=>c(_,E,"",s));const A=d_(s);return A==="ts"&&s.length<188?U0(E,()=>c(_,E,"",s)):!A&&s.length<376?U0(E,()=>c(_,E,"",s)):c(null,E,A,s)},m=e({uri:t,beforeSend(_){_.overrideMimeType("text/plain; charset=x-user-defined"),_.addEventListener("progress",function({total:E,loaded:w}){return xy(_,null,{statusCode:_.status},h)})}},function(_,E){return xy(m,_,E,h)});return m},{EventTarget:YN}=_e,Lw=function(t,e){if(!G4(t,e)||t.sidx&&e.sidx&&(t.sidx.offset!==e.sidx.offset||t.sidx.length!==e.sidx.length))return!1;if(!t.sidx&&e.sidx||t.sidx&&!e.sidx||t.segments&&!e.segments||!t.segments&&e.segments)return!1;if(!t.segments&&!e.segments)return!0;for(let i=0;i<t.segments.length;i++){const n=t.segments[i],s=e.segments[i];if(n.uri!==s.uri)return!1;if(!n.byterange&&!s.byterange)continue;const o=n.byterange,l=s.byterange;if(o&&!l||!o&&l||o.offset!==l.offset||o.length!==l.length)return!1}return!0},QN=(t,e,i,n)=>{const s=n.attributes.NAME||i;return`placeholder-uri-${t}-${e}-${s}`},ZN=({mainXml:t,srcUrl:e,clientOffset:i,sidxMapping:n,previousManifest:s})=>{const o=b8(t,{manifestUri:e,clientOffset:i,sidxMapping:n,previousManifest:s});return z4(o,e,QN),o},JN=(t,e)=>{Ec(t,(i,n,s,o)=>{(!e.mediaGroups[n][s]||!(o in e.mediaGroups[n][s]))&&delete t.mediaGroups[n][s][o]})},e5=(t,e,i)=>{let n=!0,s=Gt(t,{duration:e.duration,minimumUpdatePeriod:e.minimumUpdatePeriod,timelineStarts:e.timelineStarts});for(let o=0;o<e.playlists.length;o++){const l=e.playlists[o];if(l.sidx){const h=hp(l.sidx);i&&i[h]&&i[h].sidx&&l_(l,i[h].sidx,l.sidx.resolvedUri)}const c=by(s,l,Lw);c&&(s=c,n=!1)}return Ec(e,(o,l,c,h)=>{if(o.playlists&&o.playlists.length){const f=o.playlists[0].id,m=by(s,o.playlists[0],Lw);m&&(s=m,h in s.mediaGroups[l][c]||(s.mediaGroups[l][c][h]=o),s.mediaGroups[l][c][h].playlists[0]=s.playlists[f],n=!1)}}),JN(s,e),e.minimumUpdatePeriod!==t.minimumUpdatePeriod&&(n=!1),n?null:s},t5=(t,e)=>(!t.map&&!e.map||!!(t.map&&e.map&&t.map.byterange.offset===e.map.byterange.offset&&t.map.byterange.length===e.map.byterange.length))&&t.uri===e.uri&&t.byterange.offset===e.byterange.offset&&t.byterange.length===e.byterange.length,Uw=(t,e)=>{const i={};for(const n in t){const o=t[n].sidx;if(o){const l=hp(o);if(!e[l])break;const c=e[l].sidxInfo;t5(c,o)&&(i[l]=e[l])}}return i},i5=(t,e)=>{let n=Uw(t.playlists,e);return Ec(t,(s,o,l,c)=>{if(s.playlists&&s.playlists.length){const h=s.playlists;n=Gt(n,Uw(h,e))}}),n};class wy extends YN{constructor(e,i,n={},s){super(),this.isPaused_=!0,this.mainPlaylistLoader_=s||this,s||(this.isMain_=!0);const{withCredentials:o=!1}=n;if(this.vhs_=i,this.withCredentials=o,this.addMetadataToTextTrack=n.addMetadataToTextTrack,!e)throw new Error("A non-empty playlist URL or object is required");this.on("minimumUpdatePeriod",()=>{this.refreshXml_()}),this.on("mediaupdatetimeout",()=>{this.refreshMedia_(this.media().id)}),this.state="HAVE_NOTHING",this.loadedPlaylists_={},this.logger_=ns("DashPlaylistLoader"),this.isMain_?(this.mainPlaylistLoader_.srcUrl=e,this.mainPlaylistLoader_.sidxMapping_={}):this.childPlaylist_=e}get isPaused(){return this.isPaused_}requestErrored_(e,i,n){if(!this.request)return!0;if(this.request=null,e)return this.error=typeof e=="object"&&!(e instanceof Error)?e:{status:i.status,message:"DASH request error at URL: "+i.uri,response:i.response,code:2,metadata:e.metadata},n&&(this.state=n),this.trigger("error"),!0}addSidxSegments_(e,i,n){const s=e.sidx&&hp(e.sidx);if(!e.sidx||!s||this.mainPlaylistLoader_.sidxMapping_[s]){te.clearTimeout(this.mediaRequest_),this.mediaRequest_=te.setTimeout(()=>n(!1),0);return}const o=np(e.sidx.resolvedUri),l=(h,f)=>{if(this.requestErrored_(h,f,i))return;const m=this.mainPlaylistLoader_.sidxMapping_,{requestType:_}=f;let E;try{E=E8(ot(f.response).subarray(8))}catch(w){w.metadata=Jl({requestType:_,request:f,parseFailure:!0}),this.requestErrored_(w,f,i);return}return m[s]={sidxInfo:e.sidx,sidx:E},l_(e,E,e.sidx.resolvedUri),n(!0)},c="dash-sidx";this.request=KN(o,this.vhs_.xhr,(h,f,m,_)=>{if(h)return l(h,f);if(!m||m!=="mp4"){const A=m||"unknown";return l({status:f.status,message:`Unsupported ${A} container type for sidx segment at URL: ${o}`,response:"",playlist:e,internal:!0,playlistExclusionDuration:1/0,code:2},f)}const{offset:E,length:w}=e.sidx.byterange;if(_.length>=w+E)return l(h,{response:_.subarray(E,E+w),status:f.status,uri:f.uri});this.request=this.vhs_.xhr({uri:o,responseType:"arraybuffer",requestType:"dash-sidx",headers:Sy({byterange:e.sidx.byterange})},l)},c)}dispose(){this.isPaused_=!0,this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},te.clearTimeout(this.minimumUpdatePeriodTimeout_),te.clearTimeout(this.mediaRequest_),te.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.off()}hasPendingRequest(){return this.request||this.mediaRequest_}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);const i=this.state;if(typeof e=="string"){if(!this.mainPlaylistLoader_.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.mainPlaylistLoader_.main.playlists[e]}const n=!this.media_||e.id!==this.media_.id;if(n&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList){this.state="HAVE_METADATA",this.media_=e,n&&(this.trigger("mediachanging"),this.trigger("mediachange"));return}n&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,i,s=>{this.haveMetadata({startingState:i,playlist:e})}))}haveMetadata({startingState:e,playlist:i}){this.state="HAVE_METADATA",this.loadedPlaylists_[i.id]=i,te.clearTimeout(this.mediaRequest_),this.mediaRequest_=null,this.refreshMedia_(i.id),e==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}pause(){this.isPaused_=!0,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),te.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMain_&&(te.clearTimeout(this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_),this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_=null),this.state==="HAVE_NOTHING"&&(this.started=!1)}load(e){this.isPaused_=!1,te.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;const i=this.media();if(e){const n=i?i.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=te.setTimeout(()=>this.load(),n);return}if(!this.started){this.start();return}i&&!i.endList?(this.isMain_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist")}start(){if(this.started=!0,!this.isMain_){te.clearTimeout(this.mediaRequest_),this.mediaRequest_=te.setTimeout(()=>this.haveMain_(),0);return}this.requestMain_((e,i)=>{this.haveMain_(),!this.hasPendingRequest()&&!this.media_&&this.media(this.mainPlaylistLoader_.main.playlists[0])})}requestMain_(e){const i={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};this.trigger({type:"manifestrequeststart",metadata:i}),this.request=this.vhs_.xhr({uri:this.mainPlaylistLoader_.srcUrl,withCredentials:this.withCredentials,requestType:"dash-manifest"},(n,s)=>{if(n){const{requestType:l}=s;n.metadata=Jl({requestType:l,request:s,error:n})}if(this.requestErrored_(n,s)){this.state==="HAVE_NOTHING"&&(this.started=!1);return}this.trigger({type:"manifestrequestcomplete",metadata:i});const o=s.responseText!==this.mainPlaylistLoader_.mainXml_;if(this.mainPlaylistLoader_.mainXml_=s.responseText,s.responseHeaders&&s.responseHeaders.date?this.mainLoaded_=Date.parse(s.responseHeaders.date):this.mainLoaded_=Date.now(),this.mainPlaylistLoader_.srcUrl=np(this.mainPlaylistLoader_.srcUrl,s),o){this.handleMain_(),this.syncClientServerClock_(()=>e(s,o));return}return e(s,o)})}syncClientServerClock_(e){const i=T8(this.mainPlaylistLoader_.mainXml_);if(i===null)return this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e();if(i.method==="DIRECT")return this.mainPlaylistLoader_.clientOffset_=i.value-Date.now(),e();this.request=this.vhs_.xhr({uri:ur(this.mainPlaylistLoader_.srcUrl,i.value),method:i.method,withCredentials:this.withCredentials,requestType:"dash-clock-sync"},(n,s)=>{if(!this.request)return;if(n){const{requestType:l}=s;return this.error.metadata=Jl({requestType:l,request:s,error:n}),this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e()}let o;i.method==="HEAD"?!s.responseHeaders||!s.responseHeaders.date?o=this.mainLoaded_:o=Date.parse(s.responseHeaders.date):o=Date.parse(s.responseText),this.mainPlaylistLoader_.clientOffset_=o-Date.now(),e()})}haveMain_(){this.state="HAVE_MAIN_MANIFEST",this.isMain_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)}handleMain_(){te.clearTimeout(this.mediaRequest_),this.mediaRequest_=null;const e=this.mainPlaylistLoader_.main,i={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};this.trigger({type:"manifestparsestart",metadata:i});let n;try{n=ZN({mainXml:this.mainPlaylistLoader_.mainXml_,srcUrl:this.mainPlaylistLoader_.srcUrl,clientOffset:this.mainPlaylistLoader_.clientOffset_,sidxMapping:this.mainPlaylistLoader_.sidxMapping_,previousManifest:e})}catch(o){this.error=o,this.error.metadata={errorType:_e.Error.StreamingDashManifestParserError,error:o},this.trigger("error")}e&&(n=e5(e,n,this.mainPlaylistLoader_.sidxMapping_)),this.mainPlaylistLoader_.main=n||e;const s=this.mainPlaylistLoader_.main.locations&&this.mainPlaylistLoader_.main.locations[0];if(s&&s!==this.mainPlaylistLoader_.srcUrl&&(this.mainPlaylistLoader_.srcUrl=s),(!e||n&&n.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),this.addEventStreamToMetadataTrack_(n),n){const{duration:o,endList:l}=n,c=[];n.playlists.forEach(f=>{c.push({id:f.id,bandwidth:f.attributes.BANDWIDTH,resolution:f.attributes.RESOLUTION,codecs:f.attributes.CODECS})});const h={duration:o,isLive:!l,renditions:c};i.parsedManifest=h,this.trigger({type:"manifestparsecomplete",metadata:i})}return!!n}updateMinimumUpdatePeriodTimeout_(){const e=this.mainPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&(te.clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);let i=e.main&&e.main.minimumUpdatePeriod;if(i===0&&(e.media()?i=e.media().targetDuration*1e3:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),typeof i!="number"||i<=0){i<0&&this.logger_(`found invalid minimumUpdatePeriod of ${i}, not setting a timeout`);return}this.createMUPTimeout_(i)}createMUPTimeout_(e){const i=this.mainPlaylistLoader_;i.minimumUpdatePeriodTimeout_=te.setTimeout(()=>{i.minimumUpdatePeriodTimeout_=null,i.trigger("minimumUpdatePeriod"),i.createMUPTimeout_(e)},e)}refreshXml_(){this.requestMain_((e,i)=>{i&&(this.media_&&(this.media_=this.mainPlaylistLoader_.main.playlists[this.media_.id]),this.mainPlaylistLoader_.sidxMapping_=i5(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.sidxMapping_),this.addSidxSegments_(this.media(),this.state,n=>{this.refreshMedia_(this.media().id)}))})}refreshMedia_(e){if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMain_&&this.handleMain_();const i=this.mainPlaylistLoader_.main.playlists,n=!this.media_||this.media_!==i[e];if(n?this.media_=i[e]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){const s=()=>{this.media().endList||(this.mediaUpdateTimeout=te.setTimeout(()=>{this.trigger("mediaupdatetimeout"),s()},Ty(this.media(),!!n)))};s()}this.trigger("loadedplaylist")}addEventStreamToMetadataTrack_(e){if(e&&this.mainPlaylistLoader_.main.eventStream){const i=this.mainPlaylistLoader_.main.eventStream.map(n=>({cueTime:n.start,frames:[{data:n.messageData}]}));this.addMetadataToTextTrack("EventStream",i,this.mainPlaylistLoader_.main.duration)}}getKeyIdSet(e){if(e.contentProtection){const i=new Set;for(const n in e.contentProtection){const s=e.contentProtection[n].attributes["cenc:default_KID"];s&&i.add(s.replace(/-/g,"").toLowerCase())}return i}}}var hn={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30};const n5=t=>{const e=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e.buffer},J4=function(t){return t.on=t.addEventListener,t.off=t.removeEventListener,t},r5=function(t){try{return URL.createObjectURL(new Blob([t],{type:"application/javascript"}))}catch{const i=new BlobBuilder;return i.append(t),URL.createObjectURL(i.getBlob())}},ek=function(t){return function(){const e=r5(t),i=J4(new Worker(e));i.objURL=e;const n=i.terminate;return i.on=i.addEventListener,i.off=i.removeEventListener,i.terminate=function(){return URL.revokeObjectURL(e),n.call(this)},i}},tk=function(t){return`var browserWorkerPolyFill = ${J4.toString()};
browserWorkerPolyFill(self);
`+t},ik=function(t){return t.toString().replace(/^function.+?{/,"").slice(0,-1)},s5=tk(ik(function(){var t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=function(){this.init=function(){var p={};this.on=function(b,S){p[b]||(p[b]=[]),p[b]=p[b].concat(S)},this.off=function(b,S){var x;return p[b]?(x=p[b].indexOf(S),p[b]=p[b].slice(),p[b].splice(x,1),x>-1):!1},this.trigger=function(b){var S,x,D,I;if(S=p[b],!!S)if(arguments.length===2)for(D=S.length,x=0;x<D;++x)S[x].call(this,arguments[1]);else{for(I=[],x=arguments.length,x=1;x<arguments.length;++x)I.push(arguments[x]);for(D=S.length,x=0;x<D;++x)S[x].apply(this,I)}},this.dispose=function(){p={}}}};e.prototype.pipe=function(p){return this.on("data",function(b){p.push(b)}),this.on("done",function(b){p.flush(b)}),this.on("partialdone",function(b){p.partialFlush(b)}),this.on("endedtimeline",function(b){p.endTimeline(b)}),this.on("reset",function(b){p.reset(b)}),p},e.prototype.push=function(p){this.trigger("data",p)},e.prototype.flush=function(p){this.trigger("done",p)},e.prototype.partialFlush=function(p){this.trigger("partialdone",p)},e.prototype.endTimeline=function(p){this.trigger("endedtimeline",p)},e.prototype.reset=function(p){this.trigger("reset",p)};var i=e,n=Math.pow(2,32),s=function(p){var b=new DataView(p.buffer,p.byteOffset,p.byteLength),S;return b.getBigUint64?(S=b.getBigUint64(0),S<Number.MAX_SAFE_INTEGER?Number(S):S):b.getUint32(0)*n+b.getUint32(4)},o={getUint64:s,MAX_UINT32:n},l=o.MAX_UINT32,c,h,f,m,_,E,w,A,C,M,O,$,B,U,j,W,z,Y,L,H,se,ae,ce,fe,be,J,ee,de,ue,ve,P,ne,ye,ke,le,ze;(function(){var p;if(ce={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(p in ce)ce.hasOwnProperty(p)&&(ce[p]=[p.charCodeAt(0),p.charCodeAt(1),p.charCodeAt(2),p.charCodeAt(3)]);fe=new Uint8Array([105,115,111,109]),J=new Uint8Array([97,118,99,49]),be=new Uint8Array([0,0,0,1]),ee=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),de=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),ue={video:ee,audio:de},ne=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),P=new Uint8Array([0,0,0,0,0,0,0,0]),ye=new Uint8Array([0,0,0,0,0,0,0,0]),ke=ye,le=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),ze=ye,ve=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),c=function(p){var b=[],S=0,x,D,I;for(x=1;x<arguments.length;x++)b.push(arguments[x]);for(x=b.length;x--;)S+=b[x].byteLength;for(D=new Uint8Array(S+8),I=new DataView(D.buffer,D.byteOffset,D.byteLength),I.setUint32(0,D.byteLength),D.set(p,4),x=0,S=8;x<b.length;x++)D.set(b[x],S),S+=b[x].byteLength;return D},h=function(){return c(ce.dinf,c(ce.dref,ne))},f=function(p){return c(ce.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,p.audioobjecttype<<3|p.samplingfrequencyindex>>>1,p.samplingfrequencyindex<<7|p.channelcount<<3,6,1,2]))},m=function(){return c(ce.ftyp,fe,be,fe,J)},W=function(p){return c(ce.hdlr,ue[p])},_=function(p){return c(ce.mdat,p)},j=function(p){var b=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,p.duration>>>24&255,p.duration>>>16&255,p.duration>>>8&255,p.duration&255,85,196,0,0]);return p.samplerate&&(b[12]=p.samplerate>>>24&255,b[13]=p.samplerate>>>16&255,b[14]=p.samplerate>>>8&255,b[15]=p.samplerate&255),c(ce.mdhd,b)},U=function(p){return c(ce.mdia,j(p),W(p.type),w(p))},E=function(p){return c(ce.mfhd,new Uint8Array([0,0,0,0,(p&4278190080)>>24,(p&16711680)>>16,(p&65280)>>8,p&255]))},w=function(p){return c(ce.minf,p.type==="video"?c(ce.vmhd,ve):c(ce.smhd,P),h(),Y(p))},A=function(p,b){for(var S=[],x=b.length;x--;)S[x]=H(b[x]);return c.apply(null,[ce.moof,E(p)].concat(S))},C=function(p){for(var b=p.length,S=[];b--;)S[b]=$(p[b]);return c.apply(null,[ce.moov,O(4294967295)].concat(S).concat(M(p)))},M=function(p){for(var b=p.length,S=[];b--;)S[b]=se(p[b]);return c.apply(null,[ce.mvex].concat(S))},O=function(p){var b=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(p&4278190080)>>24,(p&16711680)>>16,(p&65280)>>8,p&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return c(ce.mvhd,b)},z=function(p){var b=p.samples||[],S=new Uint8Array(4+b.length),x,D;for(D=0;D<b.length;D++)x=b[D].flags,S[D+4]=x.dependsOn<<4|x.isDependedOn<<2|x.hasRedundancy;return c(ce.sdtp,S)},Y=function(p){return c(ce.stbl,L(p),c(ce.stts,ze),c(ce.stsc,ke),c(ce.stsz,le),c(ce.stco,ye))},(function(){var p,b;L=function(S){return c(ce.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),S.type==="video"?p(S):b(S))},p=function(S){var x=S.sps||[],D=S.pps||[],I=[],X=[],K,Z;for(K=0;K<x.length;K++)I.push((x[K].byteLength&65280)>>>8),I.push(x[K].byteLength&255),I=I.concat(Array.prototype.slice.call(x[K]));for(K=0;K<D.length;K++)X.push((D[K].byteLength&65280)>>>8),X.push(D[K].byteLength&255),X=X.concat(Array.prototype.slice.call(D[K]));if(Z=[ce.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(S.width&65280)>>8,S.width&255,(S.height&65280)>>8,S.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c(ce.avcC,new Uint8Array([1,S.profileIdc,S.profileCompatibility,S.levelIdc,255].concat([x.length],I,[D.length],X))),c(ce.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],S.sarRatio){var ie=S.sarRatio[0],me=S.sarRatio[1];Z.push(c(ce.pasp,new Uint8Array([(ie&4278190080)>>24,(ie&16711680)>>16,(ie&65280)>>8,ie&255,(me&4278190080)>>24,(me&16711680)>>16,(me&65280)>>8,me&255])))}return c.apply(null,Z)},b=function(S){return c(ce.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(S.channelcount&65280)>>8,S.channelcount&255,(S.samplesize&65280)>>8,S.samplesize&255,0,0,0,0,(S.samplerate&65280)>>8,S.samplerate&255,0,0]),f(S))}})(),B=function(p){var b=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(p.id&4278190080)>>24,(p.id&16711680)>>16,(p.id&65280)>>8,p.id&255,0,0,0,0,(p.duration&4278190080)>>24,(p.duration&16711680)>>16,(p.duration&65280)>>8,p.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(p.width&65280)>>8,p.width&255,0,0,(p.height&65280)>>8,p.height&255,0,0]);return c(ce.tkhd,b)},H=function(p){var b,S,x,D,I,X,K;return b=c(ce.tfhd,new Uint8Array([0,0,0,58,(p.id&4278190080)>>24,(p.id&16711680)>>16,(p.id&65280)>>8,p.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),X=Math.floor(p.baseMediaDecodeTime/l),K=Math.floor(p.baseMediaDecodeTime%l),S=c(ce.tfdt,new Uint8Array([1,0,0,0,X>>>24&255,X>>>16&255,X>>>8&255,X&255,K>>>24&255,K>>>16&255,K>>>8&255,K&255])),I=92,p.type==="audio"?(x=ae(p,I),c(ce.traf,b,S,x)):(D=z(p),x=ae(p,D.length+I),c(ce.traf,b,S,x,D))},$=function(p){return p.duration=p.duration||4294967295,c(ce.trak,B(p),U(p))},se=function(p){var b=new Uint8Array([0,0,0,0,(p.id&4278190080)>>24,(p.id&16711680)>>16,(p.id&65280)>>8,p.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return p.type!=="video"&&(b[b.length-1]=0),c(ce.trex,b)},(function(){var p,b,S;S=function(x,D){var I=0,X=0,K=0,Z=0;return x.length&&(x[0].duration!==void 0&&(I=1),x[0].size!==void 0&&(X=2),x[0].flags!==void 0&&(K=4),x[0].compositionTimeOffset!==void 0&&(Z=8)),[0,0,I|X|K|Z,1,(x.length&4278190080)>>>24,(x.length&16711680)>>>16,(x.length&65280)>>>8,x.length&255,(D&4278190080)>>>24,(D&16711680)>>>16,(D&65280)>>>8,D&255]},b=function(x,D){var I,X,K,Z,ie,me;for(Z=x.samples||[],D+=20+16*Z.length,K=S(Z,D),X=new Uint8Array(K.length+Z.length*16),X.set(K),I=K.length,me=0;me<Z.length;me++)ie=Z[me],X[I++]=(ie.duration&4278190080)>>>24,X[I++]=(ie.duration&16711680)>>>16,X[I++]=(ie.duration&65280)>>>8,X[I++]=ie.duration&255,X[I++]=(ie.size&4278190080)>>>24,X[I++]=(ie.size&16711680)>>>16,X[I++]=(ie.size&65280)>>>8,X[I++]=ie.size&255,X[I++]=ie.flags.isLeading<<2|ie.flags.dependsOn,X[I++]=ie.flags.isDependedOn<<6|ie.flags.hasRedundancy<<4|ie.flags.paddingValue<<1|ie.flags.isNonSyncSample,X[I++]=ie.flags.degradationPriority&61440,X[I++]=ie.flags.degradationPriority&15,X[I++]=(ie.compositionTimeOffset&4278190080)>>>24,X[I++]=(ie.compositionTimeOffset&16711680)>>>16,X[I++]=(ie.compositionTimeOffset&65280)>>>8,X[I++]=ie.compositionTimeOffset&255;return c(ce.trun,X)},p=function(x,D){var I,X,K,Z,ie,me;for(Z=x.samples||[],D+=20+8*Z.length,K=S(Z,D),I=new Uint8Array(K.length+Z.length*8),I.set(K),X=K.length,me=0;me<Z.length;me++)ie=Z[me],I[X++]=(ie.duration&4278190080)>>>24,I[X++]=(ie.duration&16711680)>>>16,I[X++]=(ie.duration&65280)>>>8,I[X++]=ie.duration&255,I[X++]=(ie.size&4278190080)>>>24,I[X++]=(ie.size&16711680)>>>16,I[X++]=(ie.size&65280)>>>8,I[X++]=ie.size&255;return c(ce.trun,I)},ae=function(x,D){return x.type==="audio"?p(x,D):b(x,D)}})();var it={ftyp:m,mdat:_,moof:A,moov:C,initSegment:function(p){var b=m(),S=C(p),x;return x=new Uint8Array(b.byteLength+S.byteLength),x.set(b),x.set(S,b.byteLength),x}},Je=function(p){var b,S,x=[],D=[];for(D.byteLength=0,D.nalCount=0,D.duration=0,x.byteLength=0,b=0;b<p.length;b++)S=p[b],S.nalUnitType==="access_unit_delimiter_rbsp"?(x.length&&(x.duration=S.dts-x.dts,D.byteLength+=x.byteLength,D.nalCount+=x.length,D.duration+=x.duration,D.push(x)),x=[S],x.byteLength=S.data.byteLength,x.pts=S.pts,x.dts=S.dts):(S.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(x.keyFrame=!0),x.duration=S.dts-x.dts,x.byteLength+=S.data.byteLength,x.push(S));return D.length&&(!x.duration||x.duration<=0)&&(x.duration=D[D.length-1].duration),D.byteLength+=x.byteLength,D.nalCount+=x.length,D.duration+=x.duration,D.push(x),D},Qe=function(p){var b,S,x=[],D=[];for(x.byteLength=0,x.nalCount=0,x.duration=0,x.pts=p[0].pts,x.dts=p[0].dts,D.byteLength=0,D.nalCount=0,D.duration=0,D.pts=p[0].pts,D.dts=p[0].dts,b=0;b<p.length;b++)S=p[b],S.keyFrame?(x.length&&(D.push(x),D.byteLength+=x.byteLength,D.nalCount+=x.nalCount,D.duration+=x.duration),x=[S],x.nalCount=S.length,x.byteLength=S.byteLength,x.pts=S.pts,x.dts=S.dts,x.duration=S.duration):(x.duration+=S.duration,x.nalCount+=S.length,x.byteLength+=S.byteLength,x.push(S));return D.length&&x.duration<=0&&(x.duration=D[D.length-1].duration),D.byteLength+=x.byteLength,D.nalCount+=x.nalCount,D.duration+=x.duration,D.push(x),D},bt=function(p){var b;return!p[0][0].keyFrame&&p.length>1&&(b=p.shift(),p.byteLength-=b.byteLength,p.nalCount-=b.nalCount,p[0][0].dts=b.dts,p[0][0].pts=b.pts,p[0][0].duration+=b.duration),p},ri=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},fi=function(p,b){var S=ri();return S.dataOffset=b,S.compositionTimeOffset=p.pts-p.dts,S.duration=p.duration,S.size=4*p.length,S.size+=p.byteLength,p.keyFrame&&(S.flags.dependsOn=2,S.flags.isNonSyncSample=0),S},mn=function(p,b){var S,x,D,I,X,K=b||0,Z=[];for(S=0;S<p.length;S++)for(I=p[S],x=0;x<I.length;x++)X=I[x],D=fi(X,K),K+=D.size,Z.push(D);return Z},Lt=function(p){var b,S,x,D,I,X,K=0,Z=p.byteLength,ie=p.nalCount,me=Z+4*ie,Ce=new Uint8Array(me),je=new DataView(Ce.buffer);for(b=0;b<p.length;b++)for(D=p[b],S=0;S<D.length;S++)for(I=D[S],x=0;x<I.length;x++)X=I[x],je.setUint32(K,X.data.byteLength),K+=4,Ce.set(X.data,K),K+=X.data.byteLength;return Ce},Nn=function(p,b){var S,x=b||0,D=[];return S=fi(p,x),D.push(S),D},Ut=function(p){var b,S,x=0,D=p.byteLength,I=p.length,X=D+4*I,K=new Uint8Array(X),Z=new DataView(K.buffer);for(b=0;b<p.length;b++)S=p[b],Z.setUint32(x,S.data.byteLength),x+=4,K.set(S.data,x),x+=S.data.byteLength;return K},rs={groupNalsIntoFrames:Je,groupFramesIntoGops:Qe,extendFirstKeyFrame:bt,generateSampleTable:mn,concatenateNalData:Lt,generateSampleTableForFrame:Nn,concatenateNalDataForFrame:Ut},Ui=[33,16,5,32,164,27],Wi=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],ft=function(p){for(var b=[];p--;)b.push(0);return b},Pt=function(p){return Object.keys(p).reduce(function(b,S){return b[S]=new Uint8Array(p[S].reduce(function(x,D){return x.concat(D)},[])),b},{})},Ot,Dt=function(){if(!Ot){var p={96e3:[Ui,[227,64],ft(154),[56]],88200:[Ui,[231],ft(170),[56]],64e3:[Ui,[248,192],ft(240),[56]],48e3:[Ui,[255,192],ft(268),[55,148,128],ft(54),[112]],44100:[Ui,[255,192],ft(268),[55,163,128],ft(84),[112]],32e3:[Ui,[255,192],ft(268),[55,234],ft(226),[112]],24e3:[Ui,[255,192],ft(268),[55,255,128],ft(268),[111,112],ft(126),[224]],16e3:[Ui,[255,192],ft(268),[55,255,128],ft(268),[111,255],ft(269),[223,108],ft(195),[1,192]],12e3:[Wi,ft(268),[3,127,248],ft(268),[6,255,240],ft(268),[13,255,224],ft(268),[27,253,128],ft(259),[56]],11025:[Wi,ft(268),[3,127,248],ft(268),[6,255,240],ft(268),[13,255,224],ft(268),[27,255,192],ft(268),[55,175,128],ft(108),[112]],8e3:[Wi,ft(268),[3,121,16],ft(47),[7]]};Ot=Pt(p)}return Ot},si=9e4,Rr,Wn,Pi,Xi,Rs,Sn,ss;Rr=function(p){return p*si},Wn=function(p,b){return p*b},Pi=function(p){return p/si},Xi=function(p,b){return p/b},Rs=function(p,b){return Rr(Xi(p,b))},Sn=function(p,b){return Wn(Pi(p),b)},ss=function(p,b,S){return Pi(S?p:p-b)};var It={ONE_SECOND_IN_TS:si,secondsToVideoTs:Rr,secondsToAudioTs:Wn,videoTsToSeconds:Pi,audioTsToSeconds:Xi,audioTsToVideoTs:Rs,videoTsToAudioTs:Sn,metadataTsToSeconds:ss},Xn=Dt,yi=It,Bn=function(p){var b,S,x=0;for(b=0;b<p.length;b++)S=p[b],x+=S.data.byteLength;return x},zi=function(p,b,S,x){var D,I=0,X=0,K=0,Z=0,ie,me,Ce;if(b.length&&(D=yi.audioTsToVideoTs(p.baseMediaDecodeTime,p.samplerate),I=Math.ceil(yi.ONE_SECOND_IN_TS/(p.samplerate/1024)),S&&x&&(X=D-Math.max(S,x),K=Math.floor(X/I),Z=K*I),!(K<1||Z>yi.ONE_SECOND_IN_TS/2))){for(ie=Xn()[p.samplerate],ie||(ie=b[0].data),me=0;me<K;me++)Ce=b[0],b.splice(0,0,{data:ie,dts:Ce.dts-I,pts:Ce.pts-I});return p.baseMediaDecodeTime-=Math.floor(yi.videoTsToAudioTs(Z,p.samplerate)),Z}},da=function(p,b,S){return b.minSegmentDts>=S?p:(b.minSegmentDts=1/0,p.filter(function(x){return x.dts>=S?(b.minSegmentDts=Math.min(b.minSegmentDts,x.dts),b.minSegmentPts=b.minSegmentDts,!0):!1}))},Mr=function(p){var b,S,x=[];for(b=0;b<p.length;b++)S=p[b],x.push({size:S.data.byteLength,duration:1024});return x},ha=function(p){var b,S,x=0,D=new Uint8Array(Bn(p));for(b=0;b<p.length;b++)S=p[b],D.set(S.data,x),x+=S.data.byteLength;return D},hr={prefixWithSilence:zi,trimAdtsFramesByEarliestDts:da,generateSampleTable:Mr,concatenateFrameData:ha},Nr=It.ONE_SECOND_IN_TS,q=function(p,b){typeof b.pts=="number"&&(p.timelineStartInfo.pts===void 0&&(p.timelineStartInfo.pts=b.pts),p.minSegmentPts===void 0?p.minSegmentPts=b.pts:p.minSegmentPts=Math.min(p.minSegmentPts,b.pts),p.maxSegmentPts===void 0?p.maxSegmentPts=b.pts:p.maxSegmentPts=Math.max(p.maxSegmentPts,b.pts)),typeof b.dts=="number"&&(p.timelineStartInfo.dts===void 0&&(p.timelineStartInfo.dts=b.dts),p.minSegmentDts===void 0?p.minSegmentDts=b.dts:p.minSegmentDts=Math.min(p.minSegmentDts,b.dts),p.maxSegmentDts===void 0?p.maxSegmentDts=b.dts:p.maxSegmentDts=Math.max(p.maxSegmentDts,b.dts))},V=function(p){delete p.minSegmentDts,delete p.maxSegmentDts,delete p.minSegmentPts,delete p.maxSegmentPts},re=function(p,b){var S,x,D=p.minSegmentDts;return b||(D-=p.timelineStartInfo.dts),S=p.timelineStartInfo.baseMediaDecodeTime,S+=D,S=Math.max(0,S),p.type==="audio"&&(x=p.samplerate/Nr,S*=x,S=Math.floor(S)),S},xe={clearDtsInfo:V,calculateTrackBaseMediaDecodeTime:re,collectDtsInfo:q},qe=4,nt=128,Rt=function(p){for(var b=0,S={payloadType:-1,payloadSize:0},x=0,D=0;b<p.byteLength&&p[b]!==nt;){for(;p[b]===255;)x+=255,b++;for(x+=p[b++];p[b]===255;)D+=255,b++;if(D+=p[b++],!S.payload&&x===qe){var I=String.fromCharCode(p[b+3],p[b+4],p[b+5],p[b+6]);if(I==="GA94"){S.payloadType=x,S.payloadSize=D,S.payload=p.subarray(b,b+D);break}else S.payload=void 0}b+=D,x=0,D=0}return S},pi=function(p){return p.payload[0]!==181||(p.payload[1]<<8|p.payload[2])!==49||String.fromCharCode(p.payload[3],p.payload[4],p.payload[5],p.payload[6])!=="GA94"||p.payload[7]!==3?null:p.payload.subarray(8,p.payload.length-1)},tn=function(p,b){var S=[],x,D,I,X;if(!(b[0]&64))return S;for(D=b[0]&31,x=0;x<D;x++)I=x*3,X={type:b[I+2]&3,pts:p},b[I+2]&4&&(X.ccData=b[I+3]<<8|b[I+4],S.push(X));return S},wn=function(p){for(var b=p.byteLength,S=[],x=1,D,I;x<b-2;)p[x]===0&&p[x+1]===0&&p[x+2]===3?(S.push(x+2),x+=2):x++;if(S.length===0)return p;D=b-S.length,I=new Uint8Array(D);var X=0;for(x=0;x<D;X++,x++)X===S[0]&&(X++,S.shift()),I[x]=p[X];return I},nn={parseSei:Rt,parseUserData:pi,parseCaptionPackets:tn,discardEmulationPreventionBytes:wn,USER_DATA_REGISTERED_ITU_T_T35:qe},gn=i,Ki=nn,Wt=function(p){p=p||{},Wt.prototype.init.call(this),this.parse708captions_=typeof p.parse708captions=="boolean"?p.parse708captions:!0,this.captionPackets_=[],this.ccStreams_=[new Ht(0,0),new Ht(0,1),new Ht(1,0),new Ht(1,1)],this.parse708captions_&&(this.cc708Stream_=new gt({captionServices:p.captionServices})),this.reset(),this.ccStreams_.forEach(function(b){b.on("data",this.trigger.bind(this,"data")),b.on("partialdone",this.trigger.bind(this,"partialdone")),b.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};Wt.prototype=new gn,Wt.prototype.push=function(p){var b,S,x;if(p.nalUnitType==="sei_rbsp"&&(b=Ki.parseSei(p.escapedRBSP),!!b.payload&&b.payloadType===Ki.USER_DATA_REGISTERED_ITU_T_T35&&(S=Ki.parseUserData(b),!!S))){if(p.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(p.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}x=Ki.parseCaptionPackets(p.pts,S),this.captionPackets_=this.captionPackets_.concat(x),this.latestDts_!==p.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=p.dts}},Wt.prototype.flushCCStreams=function(p){this.ccStreams_.forEach(function(b){return p==="flush"?b.flush():b.partialFlush()},this)},Wt.prototype.flushStream=function(p){if(!this.captionPackets_.length){this.flushCCStreams(p);return}this.captionPackets_.forEach(function(b,S){b.presortIndex=S}),this.captionPackets_.sort(function(b,S){return b.pts===S.pts?b.presortIndex-S.presortIndex:b.pts-S.pts}),this.captionPackets_.forEach(function(b){b.type<2?this.dispatchCea608Packet(b):this.dispatchCea708Packet(b)},this),this.captionPackets_.length=0,this.flushCCStreams(p)},Wt.prototype.flush=function(){return this.flushStream("flush")},Wt.prototype.partialFlush=function(){return this.flushStream("partialFlush")},Wt.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(p){p.reset()})},Wt.prototype.dispatchCea608Packet=function(p){this.setsTextOrXDSActive(p)?this.activeCea608Channel_[p.type]=null:this.setsChannel1Active(p)?this.activeCea608Channel_[p.type]=0:this.setsChannel2Active(p)&&(this.activeCea608Channel_[p.type]=1),this.activeCea608Channel_[p.type]!==null&&this.ccStreams_[(p.type<<1)+this.activeCea608Channel_[p.type]].push(p)},Wt.prototype.setsChannel1Active=function(p){return(p.ccData&30720)===4096},Wt.prototype.setsChannel2Active=function(p){return(p.ccData&30720)===6144},Wt.prototype.setsTextOrXDSActive=function(p){return(p.ccData&28928)===256||(p.ccData&30974)===4138||(p.ccData&30974)===6186},Wt.prototype.dispatchCea708Packet=function(p){this.parse708captions_&&this.cc708Stream_.push(p)};var rn={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},Ln=function(p){var b=rn[p]||p;return p&4096&&p===b?"":String.fromCharCode(b)},Ii=function(p){return 32<=p&&p<=127||160<=p&&p<=255},rt=function(p){this.windowNum=p,this.reset()};rt.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},rt.prototype.getText=function(){return this.rows.join(`
`)},rt.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},rt.prototype.newLine=function(p){for(this.rows.length>=this.virtualRowCount&&typeof this.beforeRowOverflow=="function"&&this.beforeRowOverflow(p),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},rt.prototype.isEmpty=function(){return this.rows.length===0?!0:this.rows.length===1?this.rows[0]==="":!1},rt.prototype.addText=function(p){this.rows[this.rowIdx]+=p},rt.prototype.backspace=function(){if(!this.isEmpty()){var p=this.rows[this.rowIdx];this.rows[this.rowIdx]=p.substr(0,p.length-1)}};var ci=function(p,b,S){this.serviceNum=p,this.text="",this.currentWindow=new rt(-1),this.windows=[],this.stream=S,typeof b=="string"&&this.createTextDecoder(b)};ci.prototype.init=function(p,b){this.startPts=p;for(var S=0;S<8;S++)this.windows[S]=new rt(S),typeof b=="function"&&(this.windows[S].beforeRowOverflow=b)},ci.prototype.setCurrentWindow=function(p){this.currentWindow=this.windows[p]},ci.prototype.createTextDecoder=function(p){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(p)}catch(b){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+p+" encoding. "+b})}};var gt=function(p){p=p||{},gt.prototype.init.call(this);var b=this,S=p.captionServices||{},x={},D;Object.keys(S).forEach(I=>{D=S[I],/^SERVICE/.test(I)&&(x[I]=D.encoding)}),this.serviceEncodings=x,this.current708Packet=null,this.services={},this.push=function(I){I.type===3?(b.new708Packet(),b.add708Bytes(I)):(b.current708Packet===null&&b.new708Packet(),b.add708Bytes(I))}};gt.prototype=new gn,gt.prototype.new708Packet=function(){this.current708Packet!==null&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},gt.prototype.add708Bytes=function(p){var b=p.ccData,S=b>>>8,x=b&255;this.current708Packet.ptsVals.push(p.pts),this.current708Packet.data.push(S),this.current708Packet.data.push(x)},gt.prototype.push708Packet=function(){var p=this.current708Packet,b=p.data,S=null,x=null,D=0,I=b[D++];for(p.seq=I>>6,p.sizeCode=I&63;D<b.length;D++)I=b[D++],S=I>>5,x=I&31,S===7&&x>0&&(I=b[D++],S=I),this.pushServiceBlock(S,D,x),x>0&&(D+=x-1)},gt.prototype.pushServiceBlock=function(p,b,S){var x,D=b,I=this.current708Packet.data,X=this.services[p];for(X||(X=this.initService(p,D));D<b+S&&D<I.length;D++)x=I[D],Ii(x)?D=this.handleText(D,X):x===24?D=this.multiByteCharacter(D,X):x===16?D=this.extendedCommands(D,X):128<=x&&x<=135?D=this.setCurrentWindow(D,X):152<=x&&x<=159?D=this.defineWindow(D,X):x===136?D=this.clearWindows(D,X):x===140?D=this.deleteWindows(D,X):x===137?D=this.displayWindows(D,X):x===138?D=this.hideWindows(D,X):x===139?D=this.toggleWindows(D,X):x===151?D=this.setWindowAttributes(D,X):x===144?D=this.setPenAttributes(D,X):x===145?D=this.setPenColor(D,X):x===146?D=this.setPenLocation(D,X):x===143?X=this.reset(D,X):x===8?X.currentWindow.backspace():x===12?X.currentWindow.clearText():x===13?X.currentWindow.pendingNewLine=!0:x===14?X.currentWindow.clearText():x===141&&D++},gt.prototype.extendedCommands=function(p,b){var S=this.current708Packet.data,x=S[++p];return Ii(x)&&(p=this.handleText(p,b,{isExtended:!0})),p},gt.prototype.getPts=function(p){return this.current708Packet.ptsVals[Math.floor(p/2)]},gt.prototype.initService=function(p,b){var x="SERVICE"+p,S=this,x,D;return x in this.serviceEncodings&&(D=this.serviceEncodings[x]),this.services[p]=new ci(p,D,S),this.services[p].init(this.getPts(b),function(I){S.flushDisplayed(I,S.services[p])}),this.services[p]},gt.prototype.handleText=function(p,b,S){var x=S&&S.isExtended,D=S&&S.isMultiByte,I=this.current708Packet.data,X=x?4096:0,K=I[p],Z=I[p+1],ie=b.currentWindow,me,Ce;function je(Ie){return Ie.map(Ge=>("0"+(Ge&255).toString(16)).slice(-2)).join("")}if(D?(Ce=[K,Z],p++):Ce=[K],b.textDecoder_&&!x)me=b.textDecoder_.decode(new Uint8Array(Ce));else if(D){const Ie=je(Ce);me=String.fromCharCode(parseInt(Ie,16))}else me=Ln(X|K);return ie.pendingNewLine&&!ie.isEmpty()&&ie.newLine(this.getPts(p)),ie.pendingNewLine=!1,ie.addText(me),p},gt.prototype.multiByteCharacter=function(p,b){var S=this.current708Packet.data,x=S[p+1],D=S[p+2];return Ii(x)&&Ii(D)&&(p=this.handleText(++p,b,{isMultiByte:!0})),p},gt.prototype.setCurrentWindow=function(p,b){var S=this.current708Packet.data,x=S[p],D=x&7;return b.setCurrentWindow(D),p},gt.prototype.defineWindow=function(p,b){var S=this.current708Packet.data,x=S[p],D=x&7;b.setCurrentWindow(D);var I=b.currentWindow;return x=S[++p],I.visible=(x&32)>>5,I.rowLock=(x&16)>>4,I.columnLock=(x&8)>>3,I.priority=x&7,x=S[++p],I.relativePositioning=(x&128)>>7,I.anchorVertical=x&127,x=S[++p],I.anchorHorizontal=x,x=S[++p],I.anchorPoint=(x&240)>>4,I.rowCount=x&15,x=S[++p],I.columnCount=x&63,x=S[++p],I.windowStyle=(x&56)>>3,I.penStyle=x&7,I.virtualRowCount=I.rowCount+1,p},gt.prototype.setWindowAttributes=function(p,b){var S=this.current708Packet.data,x=S[p],D=b.currentWindow.winAttr;return x=S[++p],D.fillOpacity=(x&192)>>6,D.fillRed=(x&48)>>4,D.fillGreen=(x&12)>>2,D.fillBlue=x&3,x=S[++p],D.borderType=(x&192)>>6,D.borderRed=(x&48)>>4,D.borderGreen=(x&12)>>2,D.borderBlue=x&3,x=S[++p],D.borderType+=(x&128)>>5,D.wordWrap=(x&64)>>6,D.printDirection=(x&48)>>4,D.scrollDirection=(x&12)>>2,D.justify=x&3,x=S[++p],D.effectSpeed=(x&240)>>4,D.effectDirection=(x&12)>>2,D.displayEffect=x&3,p},gt.prototype.flushDisplayed=function(p,b){for(var S=[],x=0;x<8;x++)b.windows[x].visible&&!b.windows[x].isEmpty()&&S.push(b.windows[x].getText());b.endPts=p,b.text=S.join(`

`),this.pushCaption(b),b.startPts=p},gt.prototype.pushCaption=function(p){p.text!==""&&(this.trigger("data",{startPts:p.startPts,endPts:p.endPts,text:p.text,stream:"cc708_"+p.serviceNum}),p.text="",p.startPts=p.endPts)},gt.prototype.displayWindows=function(p,b){var S=this.current708Packet.data,x=S[++p],D=this.getPts(p);this.flushDisplayed(D,b);for(var I=0;I<8;I++)x&1<<I&&(b.windows[I].visible=1);return p},gt.prototype.hideWindows=function(p,b){var S=this.current708Packet.data,x=S[++p],D=this.getPts(p);this.flushDisplayed(D,b);for(var I=0;I<8;I++)x&1<<I&&(b.windows[I].visible=0);return p},gt.prototype.toggleWindows=function(p,b){var S=this.current708Packet.data,x=S[++p],D=this.getPts(p);this.flushDisplayed(D,b);for(var I=0;I<8;I++)x&1<<I&&(b.windows[I].visible^=1);return p},gt.prototype.clearWindows=function(p,b){var S=this.current708Packet.data,x=S[++p],D=this.getPts(p);this.flushDisplayed(D,b);for(var I=0;I<8;I++)x&1<<I&&b.windows[I].clearText();return p},gt.prototype.deleteWindows=function(p,b){var S=this.current708Packet.data,x=S[++p],D=this.getPts(p);this.flushDisplayed(D,b);for(var I=0;I<8;I++)x&1<<I&&b.windows[I].reset();return p},gt.prototype.setPenAttributes=function(p,b){var S=this.current708Packet.data,x=S[p],D=b.currentWindow.penAttr;return x=S[++p],D.textTag=(x&240)>>4,D.offset=(x&12)>>2,D.penSize=x&3,x=S[++p],D.italics=(x&128)>>7,D.underline=(x&64)>>6,D.edgeType=(x&56)>>3,D.fontStyle=x&7,p},gt.prototype.setPenColor=function(p,b){var S=this.current708Packet.data,x=S[p],D=b.currentWindow.penColor;return x=S[++p],D.fgOpacity=(x&192)>>6,D.fgRed=(x&48)>>4,D.fgGreen=(x&12)>>2,D.fgBlue=x&3,x=S[++p],D.bgOpacity=(x&192)>>6,D.bgRed=(x&48)>>4,D.bgGreen=(x&12)>>2,D.bgBlue=x&3,x=S[++p],D.edgeRed=(x&48)>>4,D.edgeGreen=(x&12)>>2,D.edgeBlue=x&3,p},gt.prototype.setPenLocation=function(p,b){var S=this.current708Packet.data,x=S[p],D=b.currentWindow.penLoc;return b.currentWindow.pendingNewLine=!0,x=S[++p],D.row=x&15,x=S[++p],D.column=x&63,p},gt.prototype.reset=function(p,b){var S=this.getPts(p);return this.flushDisplayed(S,b),this.initService(b.serviceNum,p)};var Un={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},En=function(p){return p===null?"":(p=Un[p]||p,String.fromCharCode(p))},fa=14,ou=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Ai=function(){for(var p=[],b=fa+1;b--;)p.push({text:"",indent:0,offset:0});return p},Ht=function(p,b){Ht.prototype.init.call(this),this.field_=p||0,this.dataChannel_=b||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(S){var x,D,I,X,K;if(x=S.ccData&32639,x===this.lastControlCode_){this.lastControlCode_=null;return}if((x&61440)===4096?this.lastControlCode_=x:x!==this.PADDING_&&(this.lastControlCode_=null),I=x>>>8,X=x&255,x!==this.PADDING_)if(x===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(x===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(S.pts),this.flushDisplayed(S.pts),D=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=D,this.startPts_=S.pts;else if(x===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(S.pts);else if(x===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(S.pts);else if(x===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(S.pts);else if(x===this.CARRIAGE_RETURN_)this.clearFormatting(S.pts),this.flushDisplayed(S.pts),this.shiftRowsUp_(),this.startPts_=S.pts;else if(x===this.BACKSPACE_)this.mode_==="popOn"?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1);else if(x===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(S.pts),this.displayed_=Ai();else if(x===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Ai();else if(x===this.RESUME_DIRECT_CAPTIONING_)this.mode_!=="paintOn"&&(this.flushDisplayed(S.pts),this.displayed_=Ai()),this.mode_="paintOn",this.startPts_=S.pts;else if(this.isSpecialCharacter(I,X))I=(I&3)<<8,K=En(I|X),this[this.mode_](S.pts,K),this.column_++;else if(this.isExtCharacter(I,X))this.mode_==="popOn"?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1),I=(I&3)<<8,K=En(I|X),this[this.mode_](S.pts,K),this.column_++;else if(this.isMidRowCode(I,X))this.clearFormatting(S.pts),this[this.mode_](S.pts," "),this.column_++,(X&14)===14&&this.addFormatting(S.pts,["i"]),(X&1)===1&&this.addFormatting(S.pts,["u"]);else if(this.isOffsetControlCode(I,X)){const ie=X&3;this.nonDisplayed_[this.row_].offset=ie,this.column_+=ie}else if(this.isPAC(I,X)){var Z=ou.indexOf(x&7968);if(this.mode_==="rollUp"&&(Z-this.rollUpRows_+1<0&&(Z=this.rollUpRows_-1),this.setRollUp(S.pts,Z)),Z!==this.row_&&Z>=0&&Z<=14&&(this.clearFormatting(S.pts),this.row_=Z),X&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(S.pts,["u"]),(x&16)===16){const ie=(x&14)>>1;this.column_=ie*4,this.nonDisplayed_[this.row_].indent+=ie}this.isColorPAC(X)&&(X&14)===14&&this.addFormatting(S.pts,["i"])}else this.isNormalChar(I)&&(X===0&&(X=null),K=En(I),K+=En(X),this[this.mode_](S.pts,K),this.column_+=K.length)}};Ht.prototype=new gn,Ht.prototype.flushDisplayed=function(p){const b=x=>{this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+x+"."})},S=[];this.displayed_.forEach((x,D)=>{if(x&&x.text&&x.text.length){try{x.text=x.text.trim()}catch{b(D)}x.text.length&&S.push({text:x.text,line:D+1,position:10+Math.min(70,x.indent*10)+x.offset*2.5})}else x==null&&b(D)}),S.length&&this.trigger("data",{startPts:this.startPts_,endPts:p,content:S,stream:this.name_})},Ht.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Ai(),this.nonDisplayed_=Ai(),this.lastControlCode_=null,this.column_=0,this.row_=fa,this.rollUpRows_=2,this.formatting_=[]},Ht.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=this.CONTROL_|32,this.END_OF_CAPTION_=this.CONTROL_|47,this.ROLL_UP_2_ROWS_=this.CONTROL_|37,this.ROLL_UP_3_ROWS_=this.CONTROL_|38,this.ROLL_UP_4_ROWS_=this.CONTROL_|39,this.CARRIAGE_RETURN_=this.CONTROL_|45,this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41,this.BACKSPACE_=this.CONTROL_|33,this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44,this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46},Ht.prototype.isSpecialCharacter=function(p,b){return p===this.EXT_&&b>=48&&b<=63},Ht.prototype.isExtCharacter=function(p,b){return(p===this.EXT_+1||p===this.EXT_+2)&&b>=32&&b<=63},Ht.prototype.isMidRowCode=function(p,b){return p===this.EXT_&&b>=32&&b<=47},Ht.prototype.isOffsetControlCode=function(p,b){return p===this.OFFSET_&&b>=33&&b<=35},Ht.prototype.isPAC=function(p,b){return p>=this.BASE_&&p<this.BASE_+8&&b>=64&&b<=127},Ht.prototype.isColorPAC=function(p){return p>=64&&p<=79||p>=96&&p<=127},Ht.prototype.isNormalChar=function(p){return p>=32&&p<=127},Ht.prototype.setRollUp=function(p,b){if(this.mode_!=="rollUp"&&(this.row_=fa,this.mode_="rollUp",this.flushDisplayed(p),this.nonDisplayed_=Ai(),this.displayed_=Ai()),b!==void 0&&b!==this.row_)for(var S=0;S<this.rollUpRows_;S++)this.displayed_[b-S]=this.displayed_[this.row_-S],this.displayed_[this.row_-S]={text:"",indent:0,offset:0};b===void 0&&(b=this.row_),this.topRow_=b-this.rollUpRows_+1},Ht.prototype.addFormatting=function(p,b){this.formatting_=this.formatting_.concat(b);var S=b.reduce(function(x,D){return x+"<"+D+">"},"");this[this.mode_](p,S)},Ht.prototype.clearFormatting=function(p){if(this.formatting_.length){var b=this.formatting_.reverse().reduce(function(S,x){return S+"</"+x+">"},"");this.formatting_=[],this[this.mode_](p,b)}},Ht.prototype.popOn=function(p,b){var S=this.nonDisplayed_[this.row_].text;S+=b,this.nonDisplayed_[this.row_].text=S},Ht.prototype.rollUp=function(p,b){var S=this.displayed_[this.row_].text;S+=b,this.displayed_[this.row_].text=S},Ht.prototype.shiftRowsUp_=function(){var p;for(p=0;p<this.topRow_;p++)this.displayed_[p]={text:"",indent:0,offset:0};for(p=this.row_+1;p<fa+1;p++)this.displayed_[p]={text:"",indent:0,offset:0};for(p=this.topRow_;p<this.row_;p++)this.displayed_[p]=this.displayed_[p+1];this.displayed_[this.row_]={text:"",indent:0,offset:0}},Ht.prototype.paintOn=function(p,b){var S=this.displayed_[this.row_].text;S+=b,this.displayed_[this.row_].text=S};var fr={CaptionStream:Wt,Cea608Stream:Ht,Cea708Stream:gt},Ri={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},as=i,_i=8589934592,Nt=4294967296,pa="shared",io=function(p,b){var S=1;for(p>b&&(S=-1);Math.abs(b-p)>Nt;)p+=S*_i;return p},pr=function(p){var b,S;pr.prototype.init.call(this),this.type_=p||pa,this.push=function(x){if(x.type==="metadata"){this.trigger("data",x);return}this.type_!==pa&&x.type!==this.type_||(S===void 0&&(S=x.dts),x.dts=io(x.dts,S),x.pts=io(x.pts,S),b=x.dts,this.trigger("data",x))},this.flush=function(){S=b,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){S=void 0,b=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};pr.prototype=new as;var os={TimestampRolloverStream:pr,handleRollover:io},Cc=(p,b,S)=>{if(!p)return-1;for(var x=S;x<p.length;x++)if(p[x]===b)return x;return-1},lu={typedArrayIndexOf:Cc},ma=lu.typedArrayIndexOf,Kn={Utf8:3},ls=function(p,b,S){var x,D="";for(x=b;x<S;x++)D+="%"+("00"+p[x].toString(16)).slice(-2);return D},Br=function(p,b,S){return decodeURIComponent(ls(p,b,S))},sn=function(p,b,S){return unescape(ls(p,b,S))},Fi=function(p){return p[0]<<21|p[1]<<14|p[2]<<7|p[3]},Ms={APIC:function(p){var b=1,S,x,D="-->";p.data[0]===Kn.Utf8&&(S=ma(p.data,0,b),!(S<0)&&(p.mimeType=sn(p.data,b,S),b=S+1,p.pictureType=p.data[b],b++,x=ma(p.data,0,b),!(x<0)&&(p.description=Br(p.data,b,x),b=x+1,p.mimeType===D?p.url=sn(p.data,b,p.data.length):p.pictureData=p.data.subarray(b,p.data.length))))},"T*":function(p){p.data[0]===Kn.Utf8&&(p.value=Br(p.data,1,p.data.length).replace(/\0*$/,""),p.values=p.value.split("\0"))},TXXX:function(p){var b;p.data[0]===Kn.Utf8&&(b=ma(p.data,0,1),b!==-1&&(p.description=Br(p.data,1,b),p.value=Br(p.data,b+1,p.data.length).replace(/\0*$/,""),p.data=p.value))},"W*":function(p){p.url=sn(p.data,0,p.data.length).replace(/\0.*$/,"")},WXXX:function(p){var b;p.data[0]===Kn.Utf8&&(b=ma(p.data,0,1),b!==-1&&(p.description=Br(p.data,1,b),p.url=sn(p.data,b+1,p.data.length).replace(/\0.*$/,"")))},PRIV:function(p){var b;for(b=0;b<p.data.length;b++)if(p.data[b]===0){p.owner=sn(p.data,0,b);break}p.privateData=p.data.subarray(b+1),p.data=p.privateData}},Ac=function(p){var b,S,x=10,D=0,I=[];if(!(p.length<10||p[0]!==73||p[1]!==68||p[2]!==51)){D=Fi(p.subarray(6,10)),D+=10;var X=p[5]&64;X&&(x+=4,x+=Fi(p.subarray(10,14)),D-=Fi(p.subarray(16,20)));do{if(b=Fi(p.subarray(x+4,x+8)),b<1)break;S=String.fromCharCode(p[x],p[x+1],p[x+2],p[x+3]);var K={id:S,data:p.subarray(x+10,x+b+10)};K.key=K.id,Ms[K.id]?Ms[K.id](K):K.id[0]==="T"?Ms["T*"](K):K.id[0]==="W"&&Ms["W*"](K),I.push(K),x+=10,x+=b}while(x<D);return I}},no={parseId3Frames:Ac,parseSyncSafeInteger:Fi,frameParsers:Ms},uu=i,ro=Ri,Lr=no,Yi;Yi=function(p){var b={descriptor:p&&p.descriptor},S=0,x=[],D=0,I;if(Yi.prototype.init.call(this),this.dispatchType=ro.METADATA_STREAM_TYPE.toString(16),b.descriptor)for(I=0;I<b.descriptor.length;I++)this.dispatchType+=("00"+b.descriptor[I].toString(16)).slice(-2);this.push=function(X){var K,Z,ie,me,Ce,je;if(X.type==="timed-metadata"){if(X.dataAlignmentIndicator&&(D=0,x.length=0),x.length===0&&(X.data.length<10||X.data[0]!==73||X.data[1]!==68||X.data[2]!==51)){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(x.push(X),D+=X.data.byteLength,x.length===1&&(S=Lr.parseSyncSafeInteger(X.data.subarray(6,10)),S+=10),!(D<S)){for(K={data:new Uint8Array(S),frames:[],pts:x[0].pts,dts:x[0].dts},Ce=0;Ce<S;)K.data.set(x[0].data.subarray(0,S-Ce),Ce),Ce+=x[0].data.byteLength,D-=x[0].data.byteLength,x.shift();Z=10,K.data[5]&64&&(Z+=4,Z+=Lr.parseSyncSafeInteger(K.data.subarray(10,14)),S-=Lr.parseSyncSafeInteger(K.data.subarray(16,20)));do{if(ie=Lr.parseSyncSafeInteger(K.data.subarray(Z+4,Z+8)),ie<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if(je=String.fromCharCode(K.data[Z],K.data[Z+1],K.data[Z+2],K.data[Z+3]),me={id:je,data:K.data.subarray(Z+10,Z+ie+10)},me.key=me.id,Lr.frameParsers[me.id]?Lr.frameParsers[me.id](me):me.id[0]==="T"?Lr.frameParsers["T*"](me):me.id[0]==="W"&&Lr.frameParsers["W*"](me),me.owner==="com.apple.streaming.transportStreamTimestamp"){var Ie=me.data,Ge=(Ie[3]&1)<<30|Ie[4]<<22|Ie[5]<<14|Ie[6]<<6|Ie[7]>>>2;Ge*=4,Ge+=Ie[7]&3,me.timeStamp=Ge,K.pts===void 0&&K.dts===void 0&&(K.pts=me.timeStamp,K.dts=me.timeStamp),this.trigger("timestamp",me)}K.frames.push(me),Z+=10,Z+=ie}while(Z<S);this.trigger("data",K)}}}},Yi.prototype=new uu;var rl=Yi,Ns=i,us=fr,Si=Ri,cu=os.TimestampRolloverStream,cs,Yn,so,ds=188,ao=71;cs=function(){var p=new Uint8Array(ds),b=0;cs.prototype.init.call(this),this.push=function(S){var x=0,D=ds,I;for(b?(I=new Uint8Array(S.byteLength+b),I.set(p.subarray(0,b)),I.set(S,b),b=0):I=S;D<I.byteLength;){if(I[x]===ao&&I[D]===ao){this.trigger("data",I.subarray(x,D)),x+=ds,D+=ds;continue}x++,D++}x<I.byteLength&&(p.set(I.subarray(x),0),b=I.byteLength-x)},this.flush=function(){b===ds&&p[0]===ao&&(this.trigger("data",p),b=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){b=0,this.trigger("reset")}},cs.prototype=new Ns,Yn=function(){var p,b,S,x;Yn.prototype.init.call(this),x=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,p=function(D,I){var X=0;I.payloadUnitStartIndicator&&(X+=D[X]+1),I.type==="pat"?b(D.subarray(X),I):S(D.subarray(X),I)},b=function(D,I){I.section_number=D[7],I.last_section_number=D[8],x.pmtPid=(D[10]&31)<<8|D[11],I.pmtPid=x.pmtPid},S=function(D,I){var X,K,Z,ie;if(D[5]&1){for(x.programMapTable={video:null,audio:null,"timed-metadata":{}},X=(D[1]&15)<<8|D[2],K=3+X-4,Z=(D[10]&15)<<8|D[11],ie=12+Z;ie<K;){var me=D[ie],Ce=(D[ie+1]&31)<<8|D[ie+2];me===Si.H264_STREAM_TYPE&&x.programMapTable.video===null?x.programMapTable.video=Ce:me===Si.ADTS_STREAM_TYPE&&x.programMapTable.audio===null?x.programMapTable.audio=Ce:me===Si.METADATA_STREAM_TYPE&&(x.programMapTable["timed-metadata"][Ce]=me),ie+=((D[ie+3]&15)<<8|D[ie+4])+5}I.programMapTable=x.programMapTable}},this.push=function(D){var I={},X=4;if(I.payloadUnitStartIndicator=!!(D[1]&64),I.pid=D[1]&31,I.pid<<=8,I.pid|=D[2],(D[3]&48)>>>4>1&&(X+=D[X]+1),I.pid===0)I.type="pat",p(D.subarray(X),I),this.trigger("data",I);else if(I.pid===this.pmtPid)for(I.type="pmt",p(D.subarray(X),I),this.trigger("data",I);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===void 0?this.packetsWaitingForPmt.push([D,X,I]):this.processPes_(D,X,I)},this.processPes_=function(D,I,X){X.pid===this.programMapTable.video?X.streamType=Si.H264_STREAM_TYPE:X.pid===this.programMapTable.audio?X.streamType=Si.ADTS_STREAM_TYPE:X.streamType=this.programMapTable["timed-metadata"][X.pid],X.type="pes",X.data=D.subarray(I),this.trigger("data",X)}},Yn.prototype=new Ns,Yn.STREAM_TYPES={h264:27,adts:15},so=function(){var p=this,b=!1,S={data:[],size:0},x={data:[],size:0},D={data:[],size:0},I,X=function(Z,ie){var me;const Ce=Z[0]<<16|Z[1]<<8|Z[2];ie.data=new Uint8Array,Ce===1&&(ie.packetLength=6+(Z[4]<<8|Z[5]),ie.dataAlignmentIndicator=(Z[6]&4)!==0,me=Z[7],me&192&&(ie.pts=(Z[9]&14)<<27|(Z[10]&255)<<20|(Z[11]&254)<<12|(Z[12]&255)<<5|(Z[13]&254)>>>3,ie.pts*=4,ie.pts+=(Z[13]&6)>>>1,ie.dts=ie.pts,me&64&&(ie.dts=(Z[14]&14)<<27|(Z[15]&255)<<20|(Z[16]&254)<<12|(Z[17]&255)<<5|(Z[18]&254)>>>3,ie.dts*=4,ie.dts+=(Z[18]&6)>>>1)),ie.data=Z.subarray(9+Z[8]))},K=function(Z,ie,me){var Ce=new Uint8Array(Z.size),je={type:ie},Ie=0,Ge=0,pt=!1,Mi;if(!(!Z.data.length||Z.size<9)){for(je.trackId=Z.data[0].pid,Ie=0;Ie<Z.data.length;Ie++)Mi=Z.data[Ie],Ce.set(Mi.data,Ge),Ge+=Mi.data.byteLength;X(Ce,je),pt=ie==="video"||je.packetLength<=Z.size,(me||pt)&&(Z.size=0,Z.data.length=0),pt&&p.trigger("data",je)}};so.prototype.init.call(this),this.push=function(Z){({pat:function(){},pes:function(){var ie,me;switch(Z.streamType){case Si.H264_STREAM_TYPE:ie=S,me="video";break;case Si.ADTS_STREAM_TYPE:ie=x,me="audio";break;case Si.METADATA_STREAM_TYPE:ie=D,me="timed-metadata";break;default:return}Z.payloadUnitStartIndicator&&K(ie,me,!0),ie.data.push(Z),ie.size+=Z.data.byteLength},pmt:function(){var ie={type:"metadata",tracks:[]};I=Z.programMapTable,I.video!==null&&ie.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+I.video,codec:"avc",type:"video"}),I.audio!==null&&ie.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+I.audio,codec:"adts",type:"audio"}),b=!0,p.trigger("data",ie)}})[Z.type]()},this.reset=function(){S.size=0,S.data.length=0,x.size=0,x.data.length=0,this.trigger("reset")},this.flushStreams_=function(){K(S,"video"),K(x,"audio"),K(D,"timed-metadata")},this.flush=function(){if(!b&&I){var Z={type:"metadata",tracks:[]};I.video!==null&&Z.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+I.video,codec:"avc",type:"video"}),I.audio!==null&&Z.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+I.audio,codec:"adts",type:"audio"}),p.trigger("data",Z)}b=!1,this.flushStreams_(),this.trigger("done")}},so.prototype=new Ns;var hs={PAT_PID:0,MP2T_PACKET_LENGTH:ds,TransportPacketStream:cs,TransportParseStream:Yn,ElementaryStream:so,TimestampRolloverStream:cu,CaptionStream:us.CaptionStream,Cea608Stream:us.Cea608Stream,Cea708Stream:us.Cea708Stream,MetadataStream:rl};for(var oo in Si)Si.hasOwnProperty(oo)&&(hs[oo]=Si[oo]);var Dc=hs,lo=i,Cn=It.ONE_SECOND_IN_TS,yn,_n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];yn=function(p){var b,S=0;yn.prototype.init.call(this),this.skipWarn_=function(x,D){this.trigger("log",{level:"warn",message:`adts skiping bytes ${x} to ${D} in frame ${S} outside syncword`})},this.push=function(x){var D=0,I,X,K,Z,ie;if(p||(S=0),x.type==="audio"){b&&b.length?(K=b,b=new Uint8Array(K.byteLength+x.data.byteLength),b.set(K),b.set(x.data,K.byteLength)):b=x.data;for(var me;D+7<b.length;){if(b[D]!==255||(b[D+1]&246)!==240){typeof me!="number"&&(me=D),D++;continue}if(typeof me=="number"&&(this.skipWarn_(me,D),me=null),X=(~b[D+1]&1)*2,I=(b[D+3]&3)<<11|b[D+4]<<3|(b[D+5]&224)>>5,Z=((b[D+6]&3)+1)*1024,ie=Z*Cn/_n[(b[D+2]&60)>>>2],b.byteLength-D<I)break;this.trigger("data",{pts:x.pts+S*ie,dts:x.dts+S*ie,sampleCount:Z,audioobjecttype:(b[D+2]>>>6&3)+1,channelcount:(b[D+2]&1)<<2|(b[D+3]&192)>>>6,samplerate:_n[(b[D+2]&60)>>>2],samplingfrequencyindex:(b[D+2]&60)>>>2,samplesize:16,data:b.subarray(D+7+X,D+I)}),S++,D+=I}typeof me=="number"&&(this.skipWarn_(me,D),me=null),b=b.subarray(D)}},this.flush=function(){S=0,this.trigger("done")},this.reset=function(){b=void 0,this.trigger("reset")},this.endTimeline=function(){b=void 0,this.trigger("endedtimeline")}},yn.prototype=new lo;var fs=yn,Qn;Qn=function(p){var b=p.byteLength,S=0,x=0;this.length=function(){return 8*b},this.bitsAvailable=function(){return 8*b+x},this.loadWord=function(){var D=p.byteLength-b,I=new Uint8Array(4),X=Math.min(4,b);if(X===0)throw new Error("no bytes available");I.set(p.subarray(D,D+X)),S=new DataView(I.buffer).getUint32(0),x=X*8,b-=X},this.skipBits=function(D){var I;x>D?(S<<=D,x-=D):(D-=x,I=Math.floor(D/8),D-=I*8,b-=I,this.loadWord(),S<<=D,x-=D)},this.readBits=function(D){var I=Math.min(x,D),X=S>>>32-I;return x-=I,x>0?S<<=I:b>0&&this.loadWord(),I=D-I,I>0?X<<I|this.readBits(I):X},this.skipLeadingZeros=function(){var D;for(D=0;D<x;++D)if((S&2147483648>>>D)!==0)return S<<=D,x-=D,D;return this.loadWord(),D+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var D=this.skipLeadingZeros();return this.readBits(D+1)-1},this.readExpGolomb=function(){var D=this.readUnsignedExpGolomb();return 1&D?1+D>>>1:-1*(D>>>1)},this.readBoolean=function(){return this.readBits(1)===1},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var sl=Qn,ga=i,du=sl,Zn,An,ya;An=function(){var p=0,b,S;An.prototype.init.call(this),this.push=function(x){var D;S?(D=new Uint8Array(S.byteLength+x.data.byteLength),D.set(S),D.set(x.data,S.byteLength),S=D):S=x.data;for(var I=S.byteLength;p<I-3;p++)if(S[p+2]===1){b=p+5;break}for(;b<I;)switch(S[b]){case 0:if(S[b-1]!==0){b+=2;break}else if(S[b-2]!==0){b++;break}p+3!==b-2&&this.trigger("data",S.subarray(p+3,b-2));do b++;while(S[b]!==1&&b<I);p=b-2,b+=3;break;case 1:if(S[b-1]!==0||S[b-2]!==0){b+=3;break}this.trigger("data",S.subarray(p+3,b-2)),p=b-2,b+=3;break;default:b+=3;break}S=S.subarray(p),b-=p,p=0},this.reset=function(){S=null,p=0,this.trigger("reset")},this.flush=function(){S&&S.byteLength>3&&this.trigger("data",S.subarray(p+3)),S=null,p=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},An.prototype=new ga,ya={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},Zn=function(){var p=new An,b,S,x,D,I,X,K;Zn.prototype.init.call(this),b=this,this.push=function(Z){Z.type==="video"&&(S=Z.trackId,x=Z.pts,D=Z.dts,p.push(Z))},p.on("data",function(Z){var ie={trackId:S,pts:x,dts:D,data:Z,nalUnitTypeCode:Z[0]&31};switch(ie.nalUnitTypeCode){case 5:ie.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:ie.nalUnitType="sei_rbsp",ie.escapedRBSP=I(Z.subarray(1));break;case 7:ie.nalUnitType="seq_parameter_set_rbsp",ie.escapedRBSP=I(Z.subarray(1)),ie.config=X(ie.escapedRBSP);break;case 8:ie.nalUnitType="pic_parameter_set_rbsp";break;case 9:ie.nalUnitType="access_unit_delimiter_rbsp";break}b.trigger("data",ie)}),p.on("done",function(){b.trigger("done")}),p.on("partialdone",function(){b.trigger("partialdone")}),p.on("reset",function(){b.trigger("reset")}),p.on("endedtimeline",function(){b.trigger("endedtimeline")}),this.flush=function(){p.flush()},this.partialFlush=function(){p.partialFlush()},this.reset=function(){p.reset()},this.endTimeline=function(){p.endTimeline()},K=function(Z,ie){var me=8,Ce=8,je,Ie;for(je=0;je<Z;je++)Ce!==0&&(Ie=ie.readExpGolomb(),Ce=(me+Ie+256)%256),me=Ce===0?me:Ce},I=function(Z){for(var ie=Z.byteLength,me=[],Ce=1,je,Ie;Ce<ie-2;)Z[Ce]===0&&Z[Ce+1]===0&&Z[Ce+2]===3?(me.push(Ce+2),Ce+=2):Ce++;if(me.length===0)return Z;je=ie-me.length,Ie=new Uint8Array(je);var Ge=0;for(Ce=0;Ce<je;Ge++,Ce++)Ge===me[0]&&(Ge++,me.shift()),Ie[Ce]=Z[Ge];return Ie},X=function(Z){var ie=0,me=0,Ce=0,je=0,Ie,Ge,pt,Mi,zn,Ks,El,di,Ma,bs,Ys,Kt=[1,1],Gr,ln;if(Ie=new du(Z),Ge=Ie.readUnsignedByte(),Mi=Ie.readUnsignedByte(),pt=Ie.readUnsignedByte(),Ie.skipUnsignedExpGolomb(),ya[Ge]&&(zn=Ie.readUnsignedExpGolomb(),zn===3&&Ie.skipBits(1),Ie.skipUnsignedExpGolomb(),Ie.skipUnsignedExpGolomb(),Ie.skipBits(1),Ie.readBoolean()))for(Ys=zn!==3?8:12,ln=0;ln<Ys;ln++)Ie.readBoolean()&&(ln<6?K(16,Ie):K(64,Ie));if(Ie.skipUnsignedExpGolomb(),Ks=Ie.readUnsignedExpGolomb(),Ks===0)Ie.readUnsignedExpGolomb();else if(Ks===1)for(Ie.skipBits(1),Ie.skipExpGolomb(),Ie.skipExpGolomb(),El=Ie.readUnsignedExpGolomb(),ln=0;ln<El;ln++)Ie.skipExpGolomb();if(Ie.skipUnsignedExpGolomb(),Ie.skipBits(1),di=Ie.readUnsignedExpGolomb(),Ma=Ie.readUnsignedExpGolomb(),bs=Ie.readBits(1),bs===0&&Ie.skipBits(1),Ie.skipBits(1),Ie.readBoolean()&&(ie=Ie.readUnsignedExpGolomb(),me=Ie.readUnsignedExpGolomb(),Ce=Ie.readUnsignedExpGolomb(),je=Ie.readUnsignedExpGolomb()),Ie.readBoolean()&&Ie.readBoolean()){switch(Gr=Ie.readUnsignedByte(),Gr){case 1:Kt=[1,1];break;case 2:Kt=[12,11];break;case 3:Kt=[10,11];break;case 4:Kt=[16,11];break;case 5:Kt=[40,33];break;case 6:Kt=[24,11];break;case 7:Kt=[20,11];break;case 8:Kt=[32,11];break;case 9:Kt=[80,33];break;case 10:Kt=[18,11];break;case 11:Kt=[15,11];break;case 12:Kt=[64,33];break;case 13:Kt=[160,99];break;case 14:Kt=[4,3];break;case 15:Kt=[3,2];break;case 16:Kt=[2,1];break;case 255:{Kt=[Ie.readUnsignedByte()<<8|Ie.readUnsignedByte(),Ie.readUnsignedByte()<<8|Ie.readUnsignedByte()];break}}Kt&&Kt[0]/Kt[1]}return{profileIdc:Ge,levelIdc:pt,profileCompatibility:Mi,width:(di+1)*16-ie*2-me*2,height:(2-bs)*(Ma+1)*16-Ce*2-je*2,sarRatio:Kt}}},Zn.prototype=new ga;var _a={H264Stream:Zn},Pn=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],uo=function(p,b){var S=p[b+6]<<21|p[b+7]<<14|p[b+8]<<7|p[b+9],x=p[b+5],D=(x&16)>>4;return S=S>=0?S:0,D?S+20:S+10},va=function(p,b){return p.length-b<10||p[b]!==73||p[b+1]!==68||p[b+2]!==51?b:(b+=uo(p,b),va(p,b))},ba=function(p){var b=va(p,0);return p.length>=b+2&&(p[b]&255)===255&&(p[b+1]&240)===240&&(p[b+1]&22)===16},Ta=function(p){return p[0]<<21|p[1]<<14|p[2]<<7|p[3]},co=function(p,b,S){var x,D="";for(x=b;x<S;x++)D+="%"+("00"+p[x].toString(16)).slice(-2);return D},al=function(p,b,S){return unescape(co(p,b,S))},an=function(p,b){var S=(p[b+5]&224)>>5,x=p[b+4]<<3,D=p[b+3]&6144;return D|x|S},ps=function(p,b){return p[b]===73&&p[b+1]===68&&p[b+2]===51?"timed-metadata":p[b]&!0&&(p[b+1]&240)===240?"audio":null},ho=function(p){for(var b=0;b+5<p.length;){if(p[b]!==255||(p[b+1]&246)!==240){b++;continue}return Pn[(p[b+2]&60)>>>2]}return null},xa=function(p){var b,S,x,D;b=10,p[5]&64&&(b+=4,b+=Ta(p.subarray(10,14)));do{if(S=Ta(p.subarray(b+4,b+8)),S<1)return null;if(D=String.fromCharCode(p[b],p[b+1],p[b+2],p[b+3]),D==="PRIV"){x=p.subarray(b+10,b+S+10);for(var I=0;I<x.byteLength;I++)if(x[I]===0){var X=al(x,0,I);if(X==="com.apple.streaming.transportStreamTimestamp"){var K=x.subarray(I+1),Z=(K[3]&1)<<30|K[4]<<22|K[5]<<14|K[6]<<6|K[7]>>>2;return Z*=4,Z+=K[7]&3,Z}break}}b+=10,b+=S}while(b<p.byteLength);return null},ol={isLikelyAacData:ba,parseId3TagSize:uo,parseAdtsSize:an,parseType:ps,parseSampleRate:ho,parseAacTimestamp:xa},ll=i,fo=ol,Ur;Ur=function(){var p=new Uint8Array,b=0;Ur.prototype.init.call(this),this.setTimestamp=function(S){b=S},this.push=function(S){var x=0,D=0,I,X,K,Z;for(p.length?(Z=p.length,p=new Uint8Array(S.byteLength+Z),p.set(p.subarray(0,Z)),p.set(S,Z)):p=S;p.length-D>=3;){if(p[D]===73&&p[D+1]===68&&p[D+2]===51){if(p.length-D<10||(x=fo.parseId3TagSize(p,D),D+x>p.length))break;X={type:"timed-metadata",data:p.subarray(D,D+x)},this.trigger("data",X),D+=x;continue}else if((p[D]&255)===255&&(p[D+1]&240)===240){if(p.length-D<7||(x=fo.parseAdtsSize(p,D),D+x>p.length))break;K={type:"audio",data:p.subarray(D,D+x),pts:b,dts:b},this.trigger("data",K),D+=x;continue}D++}I=p.length-D,I>0?p=p.subarray(D):p=new Uint8Array},this.reset=function(){p=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){p=new Uint8Array,this.trigger("endedtimeline")}},Ur.prototype=new ll;var po=Ur,hu=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],kc=hu,$c=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],Oc=$c,Bs=i,Sa=it,Ls=rs,wa=hr,Dn=xe,mr=Dc,Ea=It,ul=fs,fu=_a.H264Stream,Ca=po,Ic=ol.isLikelyAacData,mo=It.ONE_SECOND_IN_TS,pu=kc,mu=Oc,go,Pr,Aa,ms,Rc=function(p,b){b.stream=p,this.trigger("log",b)},gu=function(p,b){for(var S=Object.keys(b),x=0;x<S.length;x++){var D=S[x];D==="headOfPipeline"||!b[D].on||b[D].on("log",Rc.bind(p,D))}},yu=function(p,b){var S;if(p.length!==b.length)return!1;for(S=0;S<p.length;S++)if(p[S]!==b[S])return!1;return!0},_u=function(p,b,S,x,D,I){var X=S-b,K=x-b,Z=D-S;return{start:{dts:p,pts:p+X},end:{dts:p+K,pts:p+Z},prependedContentDuration:I,baseMediaDecodeTime:p}};Pr=function(p,b){var S=[],x,D=0,I=0,X=1/0;b=b||{},x=b.firstSequenceNumber||0,Pr.prototype.init.call(this),this.push=function(K){Dn.collectDtsInfo(p,K),p&&pu.forEach(function(Z){p[Z]=K[Z]}),S.push(K)},this.setEarliestDts=function(K){D=K},this.setVideoBaseMediaDecodeTime=function(K){X=K},this.setAudioAppendStart=function(K){I=K},this.flush=function(){var K,Z,ie,me,Ce,je,Ie;if(S.length===0){this.trigger("done","AudioSegmentStream");return}K=wa.trimAdtsFramesByEarliestDts(S,p,D),p.baseMediaDecodeTime=Dn.calculateTrackBaseMediaDecodeTime(p,b.keepOriginalTimestamps),Ie=wa.prefixWithSilence(p,K,I,X),p.samples=wa.generateSampleTable(K),ie=Sa.mdat(wa.concatenateFrameData(K)),S=[],Z=Sa.moof(x,[p]),me=new Uint8Array(Z.byteLength+ie.byteLength),x++,me.set(Z),me.set(ie,Z.byteLength),Dn.clearDtsInfo(p),Ce=Math.ceil(mo*1024/p.samplerate),K.length&&(je=K.length*Ce,this.trigger("segmentTimingInfo",_u(Ea.audioTsToVideoTs(p.baseMediaDecodeTime,p.samplerate),K[0].dts,K[0].pts,K[0].dts+je,K[0].pts+je,Ie||0)),this.trigger("timingInfo",{start:K[0].pts,end:K[0].pts+je})),this.trigger("data",{track:p,boxes:me}),this.trigger("done","AudioSegmentStream")},this.reset=function(){Dn.clearDtsInfo(p),S=[],this.trigger("reset")}},Pr.prototype=new Bs,go=function(p,b){var S,x=[],D=[],I,X;b=b||{},S=b.firstSequenceNumber||0,go.prototype.init.call(this),delete p.minPTS,this.gopCache_=[],this.push=function(K){Dn.collectDtsInfo(p,K),K.nalUnitType==="seq_parameter_set_rbsp"&&!I&&(I=K.config,p.sps=[K.data],mu.forEach(function(Z){p[Z]=I[Z]},this)),K.nalUnitType==="pic_parameter_set_rbsp"&&!X&&(X=K.data,p.pps=[K.data]),x.push(K)},this.flush=function(){for(var K,Z,ie,me,Ce,je,Ie=0,Ge,pt;x.length&&x[0].nalUnitType!=="access_unit_delimiter_rbsp";)x.shift();if(x.length===0){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(K=Ls.groupNalsIntoFrames(x),ie=Ls.groupFramesIntoGops(K),ie[0][0].keyFrame||(Z=this.getGopForFusion_(x[0],p),Z?(Ie=Z.duration,ie.unshift(Z),ie.byteLength+=Z.byteLength,ie.nalCount+=Z.nalCount,ie.pts=Z.pts,ie.dts=Z.dts,ie.duration+=Z.duration):ie=Ls.extendFirstKeyFrame(ie)),D.length){var Mi;if(b.alignGopsAtEnd?Mi=this.alignGopsAtEnd_(ie):Mi=this.alignGopsAtStart_(ie),!Mi){this.gopCache_.unshift({gop:ie.pop(),pps:p.pps,sps:p.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),x=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}Dn.clearDtsInfo(p),ie=Mi}Dn.collectDtsInfo(p,ie),p.samples=Ls.generateSampleTable(ie),Ce=Sa.mdat(Ls.concatenateNalData(ie)),p.baseMediaDecodeTime=Dn.calculateTrackBaseMediaDecodeTime(p,b.keepOriginalTimestamps),this.trigger("processedGopsInfo",ie.map(function(zn){return{pts:zn.pts,dts:zn.dts,byteLength:zn.byteLength}})),Ge=ie[0],pt=ie[ie.length-1],this.trigger("segmentTimingInfo",_u(p.baseMediaDecodeTime,Ge.dts,Ge.pts,pt.dts+pt.duration,pt.pts+pt.duration,Ie)),this.trigger("timingInfo",{start:ie[0].pts,end:ie[ie.length-1].pts+ie[ie.length-1].duration}),this.gopCache_.unshift({gop:ie.pop(),pps:p.pps,sps:p.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),x=[],this.trigger("baseMediaDecodeTime",p.baseMediaDecodeTime),this.trigger("timelineStartInfo",p.timelineStartInfo),me=Sa.moof(S,[p]),je=new Uint8Array(me.byteLength+Ce.byteLength),S++,je.set(me),je.set(Ce,me.byteLength),this.trigger("data",{track:p,boxes:je}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),x=[],this.gopCache_.length=0,D.length=0,this.trigger("reset")},this.resetStream_=function(){Dn.clearDtsInfo(p),I=void 0,X=void 0},this.getGopForFusion_=function(K){var Z=45e3,ie=1/0,me,Ce,je,Ie,Ge;for(Ge=0;Ge<this.gopCache_.length;Ge++)Ie=this.gopCache_[Ge],je=Ie.gop,!(!(p.pps&&yu(p.pps[0],Ie.pps[0]))||!(p.sps&&yu(p.sps[0],Ie.sps[0])))&&(je.dts<p.timelineStartInfo.dts||(me=K.dts-je.dts-je.duration,me>=-1e4&&me<=Z&&(!Ce||ie>me)&&(Ce=Ie,ie=me)));return Ce?Ce.gop:null},this.alignGopsAtStart_=function(K){var Z,ie,me,Ce,je,Ie,Ge,pt;for(je=K.byteLength,Ie=K.nalCount,Ge=K.duration,Z=ie=0;Z<D.length&&ie<K.length&&(me=D[Z],Ce=K[ie],me.pts!==Ce.pts);){if(Ce.pts>me.pts){Z++;continue}ie++,je-=Ce.byteLength,Ie-=Ce.nalCount,Ge-=Ce.duration}return ie===0?K:ie===K.length?null:(pt=K.slice(ie),pt.byteLength=je,pt.duration=Ge,pt.nalCount=Ie,pt.pts=pt[0].pts,pt.dts=pt[0].dts,pt)},this.alignGopsAtEnd_=function(K){var Z,ie,me,Ce,je,Ie;for(Z=D.length-1,ie=K.length-1,je=null,Ie=!1;Z>=0&&ie>=0;){if(me=D[Z],Ce=K[ie],me.pts===Ce.pts){Ie=!0;break}if(me.pts>Ce.pts){Z--;continue}Z===D.length-1&&(je=ie),ie--}if(!Ie&&je===null)return null;var Ge;if(Ie?Ge=ie:Ge=je,Ge===0)return K;var pt=K.slice(Ge),Mi=pt.reduce(function(zn,Ks){return zn.byteLength+=Ks.byteLength,zn.duration+=Ks.duration,zn.nalCount+=Ks.nalCount,zn},{byteLength:0,duration:0,nalCount:0});return pt.byteLength=Mi.byteLength,pt.duration=Mi.duration,pt.nalCount=Mi.nalCount,pt.pts=pt[0].pts,pt.dts=pt[0].dts,pt},this.alignGopsWith=function(K){D=K}},go.prototype=new Bs,ms=function(p,b){this.numberOfTracks=0,this.metadataStream=b,p=p||{},typeof p.remux<"u"?this.remuxTracks=!!p.remux:this.remuxTracks=!0,typeof p.keepOriginalTimestamps=="boolean"?this.keepOriginalTimestamps=p.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,ms.prototype.init.call(this),this.push=function(S){if(S.content||S.text)return this.pendingCaptions.push(S);if(S.frames)return this.pendingMetadata.push(S);this.pendingTracks.push(S.track),this.pendingBytes+=S.boxes.byteLength,S.track.type==="video"&&(this.videoTrack=S.track,this.pendingBoxes.push(S.boxes)),S.track.type==="audio"&&(this.audioTrack=S.track,this.pendingBoxes.unshift(S.boxes))}},ms.prototype=new Bs,ms.prototype.flush=function(p){var b=0,S={captions:[],captionStreams:{},metadata:[],info:{}},x,D,I,X=0,K;if(this.pendingTracks.length<this.numberOfTracks){if(p!=="VideoSegmentStream"&&p!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(X=this.videoTrack.timelineStartInfo.pts,mu.forEach(function(Z){S.info[Z]=this.videoTrack[Z]},this)):this.audioTrack&&(X=this.audioTrack.timelineStartInfo.pts,pu.forEach(function(Z){S.info[Z]=this.audioTrack[Z]},this)),this.videoTrack||this.audioTrack){for(this.pendingTracks.length===1?S.type=this.pendingTracks[0].type:S.type="combined",this.emittedTracks+=this.pendingTracks.length,I=Sa.initSegment(this.pendingTracks),S.initSegment=new Uint8Array(I.byteLength),S.initSegment.set(I),S.data=new Uint8Array(this.pendingBytes),K=0;K<this.pendingBoxes.length;K++)S.data.set(this.pendingBoxes[K],b),b+=this.pendingBoxes[K].byteLength;for(K=0;K<this.pendingCaptions.length;K++)x=this.pendingCaptions[K],x.startTime=Ea.metadataTsToSeconds(x.startPts,X,this.keepOriginalTimestamps),x.endTime=Ea.metadataTsToSeconds(x.endPts,X,this.keepOriginalTimestamps),S.captionStreams[x.stream]=!0,S.captions.push(x);for(K=0;K<this.pendingMetadata.length;K++)D=this.pendingMetadata[K],D.cueTime=Ea.metadataTsToSeconds(D.pts,X,this.keepOriginalTimestamps),S.metadata.push(D);for(S.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",S),K=0;K<S.captions.length;K++)x=S.captions[K],this.trigger("caption",x);for(K=0;K<S.metadata.length;K++)D=S.metadata[K],this.trigger("id3Frame",D)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},ms.prototype.setRemux=function(p){this.remuxTracks=p},Aa=function(p){var b=this,S=!0,x,D;Aa.prototype.init.call(this),p=p||{},this.baseMediaDecodeTime=p.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var I={};this.transmuxPipeline_=I,I.type="aac",I.metadataStream=new mr.MetadataStream,I.aacStream=new Ca,I.audioTimestampRolloverStream=new mr.TimestampRolloverStream("audio"),I.timedMetadataTimestampRolloverStream=new mr.TimestampRolloverStream("timed-metadata"),I.adtsStream=new ul,I.coalesceStream=new ms(p,I.metadataStream),I.headOfPipeline=I.aacStream,I.aacStream.pipe(I.audioTimestampRolloverStream).pipe(I.adtsStream),I.aacStream.pipe(I.timedMetadataTimestampRolloverStream).pipe(I.metadataStream).pipe(I.coalesceStream),I.metadataStream.on("timestamp",function(X){I.aacStream.setTimestamp(X.timeStamp)}),I.aacStream.on("data",function(X){X.type!=="timed-metadata"&&X.type!=="audio"||I.audioSegmentStream||(D=D||{timelineStartInfo:{baseMediaDecodeTime:b.baseMediaDecodeTime},codec:"adts",type:"audio"},I.coalesceStream.numberOfTracks++,I.audioSegmentStream=new Pr(D,p),I.audioSegmentStream.on("log",b.getLogTrigger_("audioSegmentStream")),I.audioSegmentStream.on("timingInfo",b.trigger.bind(b,"audioTimingInfo")),I.adtsStream.pipe(I.audioSegmentStream).pipe(I.coalesceStream),b.trigger("trackinfo",{hasAudio:!!D,hasVideo:!!x}))}),I.coalesceStream.on("data",this.trigger.bind(this,"data")),I.coalesceStream.on("done",this.trigger.bind(this,"done")),gu(this,I)},this.setupTsPipeline=function(){var I={};this.transmuxPipeline_=I,I.type="ts",I.metadataStream=new mr.MetadataStream,I.packetStream=new mr.TransportPacketStream,I.parseStream=new mr.TransportParseStream,I.elementaryStream=new mr.ElementaryStream,I.timestampRolloverStream=new mr.TimestampRolloverStream,I.adtsStream=new ul,I.h264Stream=new fu,I.captionStream=new mr.CaptionStream(p),I.coalesceStream=new ms(p,I.metadataStream),I.headOfPipeline=I.packetStream,I.packetStream.pipe(I.parseStream).pipe(I.elementaryStream).pipe(I.timestampRolloverStream),I.timestampRolloverStream.pipe(I.h264Stream),I.timestampRolloverStream.pipe(I.adtsStream),I.timestampRolloverStream.pipe(I.metadataStream).pipe(I.coalesceStream),I.h264Stream.pipe(I.captionStream).pipe(I.coalesceStream),I.elementaryStream.on("data",function(X){var K;if(X.type==="metadata"){for(K=X.tracks.length;K--;)!x&&X.tracks[K].type==="video"?(x=X.tracks[K],x.timelineStartInfo.baseMediaDecodeTime=b.baseMediaDecodeTime):!D&&X.tracks[K].type==="audio"&&(D=X.tracks[K],D.timelineStartInfo.baseMediaDecodeTime=b.baseMediaDecodeTime);x&&!I.videoSegmentStream&&(I.coalesceStream.numberOfTracks++,I.videoSegmentStream=new go(x,p),I.videoSegmentStream.on("log",b.getLogTrigger_("videoSegmentStream")),I.videoSegmentStream.on("timelineStartInfo",function(Z){D&&!p.keepOriginalTimestamps&&(D.timelineStartInfo=Z,I.audioSegmentStream.setEarliestDts(Z.dts-b.baseMediaDecodeTime))}),I.videoSegmentStream.on("processedGopsInfo",b.trigger.bind(b,"gopInfo")),I.videoSegmentStream.on("segmentTimingInfo",b.trigger.bind(b,"videoSegmentTimingInfo")),I.videoSegmentStream.on("baseMediaDecodeTime",function(Z){D&&I.audioSegmentStream.setVideoBaseMediaDecodeTime(Z)}),I.videoSegmentStream.on("timingInfo",b.trigger.bind(b,"videoTimingInfo")),I.h264Stream.pipe(I.videoSegmentStream).pipe(I.coalesceStream)),D&&!I.audioSegmentStream&&(I.coalesceStream.numberOfTracks++,I.audioSegmentStream=new Pr(D,p),I.audioSegmentStream.on("log",b.getLogTrigger_("audioSegmentStream")),I.audioSegmentStream.on("timingInfo",b.trigger.bind(b,"audioTimingInfo")),I.audioSegmentStream.on("segmentTimingInfo",b.trigger.bind(b,"audioSegmentTimingInfo")),I.adtsStream.pipe(I.audioSegmentStream).pipe(I.coalesceStream)),b.trigger("trackinfo",{hasAudio:!!D,hasVideo:!!x})}}),I.coalesceStream.on("data",this.trigger.bind(this,"data")),I.coalesceStream.on("id3Frame",function(X){X.dispatchType=I.metadataStream.dispatchType,b.trigger("id3Frame",X)}),I.coalesceStream.on("caption",this.trigger.bind(this,"caption")),I.coalesceStream.on("done",this.trigger.bind(this,"done")),gu(this,I)},this.setBaseMediaDecodeTime=function(I){var X=this.transmuxPipeline_;p.keepOriginalTimestamps||(this.baseMediaDecodeTime=I),D&&(D.timelineStartInfo.dts=void 0,D.timelineStartInfo.pts=void 0,Dn.clearDtsInfo(D),X.audioTimestampRolloverStream&&X.audioTimestampRolloverStream.discontinuity()),x&&(X.videoSegmentStream&&(X.videoSegmentStream.gopCache_=[]),x.timelineStartInfo.dts=void 0,x.timelineStartInfo.pts=void 0,Dn.clearDtsInfo(x),X.captionStream.reset()),X.timestampRolloverStream&&X.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(I){D&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(I)},this.setRemux=function(I){var X=this.transmuxPipeline_;p.remux=I,X&&X.coalesceStream&&X.coalesceStream.setRemux(I)},this.alignGopsWith=function(I){x&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(I)},this.getLogTrigger_=function(I){var X=this;return function(K){K.stream=I,X.trigger("log",K)}},this.push=function(I){if(S){var X=Ic(I);X&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():!X&&this.transmuxPipeline_.type!=="ts"&&this.setupTsPipeline(),S=!1}this.transmuxPipeline_.headOfPipeline.push(I)},this.flush=function(){S=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},Aa.prototype=new Bs;var Mc={Transmuxer:Aa},Nc=function(p){return p>>>0},Bc=function(p){return("00"+p.toString(16)).slice(-2)},Us={toUnsigned:Nc,toHexString:Bc},zr=function(p){var b="";return b+=String.fromCharCode(p[0]),b+=String.fromCharCode(p[1]),b+=String.fromCharCode(p[2]),b+=String.fromCharCode(p[3]),b},Ps=zr,cl=Us.toUnsigned,vu=Ps,dl=function(p,b){var S=[],x,D,I,X,K;if(!b.length)return null;for(x=0;x<p.byteLength;)D=cl(p[x]<<24|p[x+1]<<16|p[x+2]<<8|p[x+3]),I=vu(p.subarray(x+4,x+8)),X=D>1?x+D:p.byteLength,I===b[0]&&(b.length===1?S.push(p.subarray(x+8,X)):(K=dl(p.subarray(x+8,X),b.slice(1)),K.length&&(S=S.concat(K)))),x=X;return S},zs=dl,yo=Us.toUnsigned,gs=o.getUint64,bu=function(p){var b={version:p[0],flags:new Uint8Array(p.subarray(1,4))};return b.version===1?b.baseMediaDecodeTime=gs(p.subarray(4)):b.baseMediaDecodeTime=yo(p[4]<<24|p[5]<<16|p[6]<<8|p[7]),b},_o=bu,Tu=function(p){var b=new DataView(p.buffer,p.byteOffset,p.byteLength),S={version:p[0],flags:new Uint8Array(p.subarray(1,4)),trackId:b.getUint32(4)},x=S.flags[2]&1,D=S.flags[2]&2,I=S.flags[2]&8,X=S.flags[2]&16,K=S.flags[2]&32,Z=S.flags[0]&65536,ie=S.flags[0]&131072,me;return me=8,x&&(me+=4,S.baseDataOffset=b.getUint32(12),me+=4),D&&(S.sampleDescriptionIndex=b.getUint32(me),me+=4),I&&(S.defaultSampleDuration=b.getUint32(me),me+=4),X&&(S.defaultSampleSize=b.getUint32(me),me+=4),K&&(S.defaultSampleFlags=b.getUint32(me)),Z&&(S.durationIsEmpty=!0),!x&&ie&&(S.baseDataOffsetIsMoof=!0),S},vo=Tu,hl=function(p){return{isLeading:(p[0]&12)>>>2,dependsOn:p[0]&3,isDependedOn:(p[1]&192)>>>6,hasRedundancy:(p[1]&48)>>>4,paddingValue:(p[1]&14)>>>1,isNonSyncSample:p[1]&1,degradationPriority:p[2]<<8|p[3]}},Da=hl,ys=Da,xu=function(p){var b={version:p[0],flags:new Uint8Array(p.subarray(1,4)),samples:[]},S=new DataView(p.buffer,p.byteOffset,p.byteLength),x=b.flags[2]&1,D=b.flags[2]&4,I=b.flags[1]&1,X=b.flags[1]&2,K=b.flags[1]&4,Z=b.flags[1]&8,ie=S.getUint32(4),me=8,Ce;for(x&&(b.dataOffset=S.getInt32(me),me+=4),D&&ie&&(Ce={flags:ys(p.subarray(me,me+4))},me+=4,I&&(Ce.duration=S.getUint32(me),me+=4),X&&(Ce.size=S.getUint32(me),me+=4),Z&&(b.version===1?Ce.compositionTimeOffset=S.getInt32(me):Ce.compositionTimeOffset=S.getUint32(me),me+=4),b.samples.push(Ce),ie--);ie--;)Ce={},I&&(Ce.duration=S.getUint32(me),me+=4),X&&(Ce.size=S.getUint32(me),me+=4),K&&(Ce.flags=ys(p.subarray(me,me+4)),me+=4),Z&&(b.version===1?Ce.compositionTimeOffset=S.getInt32(me):Ce.compositionTimeOffset=S.getUint32(me),me+=4),b.samples.push(Ce);return b},Fr=xu,fl={tfdt:_o,trun:Fr},ka={parseTfdt:fl.tfdt,parseTrun:fl.trun},pl=function(p){for(var b=0,S=String.fromCharCode(p[b]),x="";S!=="\0";)x+=S,b++,S=String.fromCharCode(p[b]);return x+=S,x},ml={uint8ToCString:pl},$e=ml.uint8ToCString,gl=o.getUint64,yl=function(p){var b=4,S=p[0],x,D,I,X,K,Z,ie,me;if(S===0){x=$e(p.subarray(b)),b+=x.length,D=$e(p.subarray(b)),b+=D.length;var Ce=new DataView(p.buffer);I=Ce.getUint32(b),b+=4,K=Ce.getUint32(b),b+=4,Z=Ce.getUint32(b),b+=4,ie=Ce.getUint32(b),b+=4}else if(S===1){var Ce=new DataView(p.buffer);I=Ce.getUint32(b),b+=4,X=gl(p.subarray(b)),b+=8,Z=Ce.getUint32(b),b+=4,ie=Ce.getUint32(b),b+=4,x=$e(p.subarray(b)),b+=x.length,D=$e(p.subarray(b)),b+=D.length}me=new Uint8Array(p.subarray(b,p.byteLength));var je={scheme_id_uri:x,value:D,timescale:I||1,presentation_time:X,presentation_time_delta:K,event_duration:Z,id:ie,message_data:me};return gr(S,je)?je:void 0},_l=function(p,b,S,x){return p||p===0?p/b:x+S/b},gr=function(p,b){var S=b.scheme_id_uri!=="\0",x=p===0&&$a(b.presentation_time_delta)&&S,D=p===1&&$a(b.presentation_time)&&S;return!(p>1)&&x||D},$a=function(p){return p!==void 0||p!==null},vl={parseEmsgBox:yl,scaleTime:_l},Fs;typeof window<"u"?Fs=window:typeof t<"u"?Fs=t:typeof self<"u"?Fs=self:Fs={};var Qi=Fs,yr=Us.toUnsigned,qr=Us.toHexString,ai=zs,jr=Ps,Oa=vl,qs=vo,bl=Fr,Hr=_o,bo=o.getUint64,_s,Ia,To,_r,g,T,k,N=Qi,F=no.parseId3Frames;_s=function(p){var b={},S=ai(p,["moov","trak"]);return S.reduce(function(x,D){var I,X,K,Z,ie;return I=ai(D,["tkhd"])[0],!I||(X=I[0],K=X===0?12:20,Z=yr(I[K]<<24|I[K+1]<<16|I[K+2]<<8|I[K+3]),ie=ai(D,["mdia","mdhd"])[0],!ie)?null:(X=ie[0],K=X===0?12:20,x[Z]=yr(ie[K]<<24|ie[K+1]<<16|ie[K+2]<<8|ie[K+3]),x)},b)},Ia=function(p,b){var S;S=ai(b,["moof","traf"]);var x=S.reduce(function(D,I){var X=ai(I,["tfhd"])[0],K=yr(X[4]<<24|X[5]<<16|X[6]<<8|X[7]),Z=p[K]||9e4,ie=ai(I,["tfdt"])[0],me=new DataView(ie.buffer,ie.byteOffset,ie.byteLength),Ce;ie[0]===1?Ce=bo(ie.subarray(4,12)):Ce=me.getUint32(4);let je;return typeof Ce=="bigint"?je=Ce/N.BigInt(Z):typeof Ce=="number"&&!isNaN(Ce)&&(je=Ce/Z),je<Number.MAX_SAFE_INTEGER&&(je=Number(je)),je<D&&(D=je),D},1/0);return typeof x=="bigint"||isFinite(x)?x:0},To=function(p,b){var S=ai(b,["moof","traf"]),x=0,D=0,I;if(S&&S.length){var X=ai(S[0],["tfhd"])[0],K=ai(S[0],["trun"])[0],Z=ai(S[0],["tfdt"])[0];if(X){var ie=qs(X);I=ie.trackId}if(Z){var me=Hr(Z);x=me.baseMediaDecodeTime}if(K){var Ce=bl(K);Ce.samples&&Ce.samples.length&&(D=Ce.samples[0].compositionTimeOffset||0)}}var je=p[I]||9e4;typeof x=="bigint"&&(D=N.BigInt(D),je=N.BigInt(je));var Ie=(x+D)/je;return typeof Ie=="bigint"&&Ie<Number.MAX_SAFE_INTEGER&&(Ie=Number(Ie)),Ie},_r=function(p){var b=ai(p,["moov","trak"]),S=[];return b.forEach(function(x){var D=ai(x,["mdia","hdlr"]),I=ai(x,["tkhd"]);D.forEach(function(X,K){var Z=jr(X.subarray(8,12)),ie=I[K],me,Ce,je;Z==="vide"&&(me=new DataView(ie.buffer,ie.byteOffset,ie.byteLength),Ce=me.getUint8(0),je=Ce===0?me.getUint32(12):me.getUint32(20),S.push(je))})}),S},T=function(p){var b=p[0],S=b===0?12:20;return yr(p[S]<<24|p[S+1]<<16|p[S+2]<<8|p[S+3])},g=function(p){var b=ai(p,["moov","trak"]),S=[];return b.forEach(function(x){var D={},I=ai(x,["tkhd"])[0],X,K;I&&(X=new DataView(I.buffer,I.byteOffset,I.byteLength),K=X.getUint8(0),D.id=K===0?X.getUint32(12):X.getUint32(20));var Z=ai(x,["mdia","hdlr"])[0];if(Z){var ie=jr(Z.subarray(8,12));ie==="vide"?D.type="video":ie==="soun"?D.type="audio":D.type=ie}var me=ai(x,["mdia","minf","stbl","stsd"])[0];if(me){var Ce=me.subarray(8);D.codec=jr(Ce.subarray(4,8));var je=ai(Ce,[D.codec])[0],Ie,Ge;je&&(/^[asm]vc[1-9]$/i.test(D.codec)?(Ie=je.subarray(78),Ge=jr(Ie.subarray(4,8)),Ge==="avcC"&&Ie.length>11?(D.codec+=".",D.codec+=qr(Ie[9]),D.codec+=qr(Ie[10]),D.codec+=qr(Ie[11])):D.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(D.codec)?(Ie=je.subarray(28),Ge=jr(Ie.subarray(4,8)),Ge==="esds"&&Ie.length>20&&Ie[19]!==0?(D.codec+="."+qr(Ie[19]),D.codec+="."+qr(Ie[20]>>>2&63).replace(/^0/,"")):D.codec="mp4a.40.2"):D.codec=D.codec.toLowerCase())}var pt=ai(x,["mdia","mdhd"])[0];pt&&(D.timescale=T(pt)),S.push(D)}),S},k=function(p,b=0){var S=ai(p,["emsg"]);return S.map(x=>{var D=Oa.parseEmsgBox(new Uint8Array(x)),I=F(D.message_data);return{cueTime:Oa.scaleTime(D.presentation_time,D.timescale,D.presentation_time_delta,b),duration:Oa.scaleTime(D.event_duration,D.timescale),frames:I}})};var Q={findBox:ai,parseType:jr,timescale:_s,startTime:Ia,compositionStartTime:To,videoTrackIds:_r,tracks:g,getTimescaleFromMediaHeader:T,getEmsgID3:k};const{parseTrun:pe}=ka,{findBox:Ee}=Q;var Be=Qi,Pe=function(p){var b=Ee(p,["moof","traf"]),S=Ee(p,["mdat"]),x=[];return S.forEach(function(D,I){var X=b[I];x.push({mdat:D,traf:X})}),x},Ve=function(p,b,S){var x=b,D=S.defaultSampleDuration||0,I=S.defaultSampleSize||0,X=S.trackId,K=[];return p.forEach(function(Z){var ie=pe(Z),me=ie.samples;me.forEach(function(Ce){Ce.duration===void 0&&(Ce.duration=D),Ce.size===void 0&&(Ce.size=I),Ce.trackId=X,Ce.dts=x,Ce.compositionTimeOffset===void 0&&(Ce.compositionTimeOffset=0),typeof x=="bigint"?(Ce.pts=x+Be.BigInt(Ce.compositionTimeOffset),x+=Be.BigInt(Ce.duration)):(Ce.pts=x+Ce.compositionTimeOffset,x+=Ce.duration)}),K=K.concat(me)}),K},tt={getMdatTrafPairs:Pe,parseSamples:Ve},ct=nn.discardEmulationPreventionBytes,dt=fr.CaptionStream,Xt=zs,Zt=_o,on=vo,{getMdatTrafPairs:vr,parseSamples:Vr}=tt,js=function(p,b){for(var S=p,x=0;x<b.length;x++){var D=b[x];if(S<D.size)return D;S-=D.size}return null},Tl=function(p,b,S){var x=new DataView(p.buffer,p.byteOffset,p.byteLength),D={logs:[],seiNals:[]},I,X,K,Z;for(X=0;X+4<p.length;X+=K)if(K=x.getUint32(X),X+=4,!(K<=0))switch(p[X]&31){case 6:var ie=p.subarray(X+1,X+1+K),me=js(X,b);if(I={nalUnitType:"sei_rbsp",size:K,data:ie,escapedRBSP:ct(ie),trackId:S},me)I.pts=me.pts,I.dts=me.dts,Z=me;else if(Z)I.pts=Z.pts,I.dts=Z.dts;else{D.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+X+" for trackId "+S+". See mux.js#223."});break}D.seiNals.push(I);break}return D},Ra=function(p,b){var S={},x=vr(p);return x.forEach(function(D){var I=D.mdat,X=D.traf,K=Xt(X,["tfhd"]),Z=on(K[0]),ie=Z.trackId,me=Xt(X,["tfdt"]),Ce=me.length>0?Zt(me[0]).baseMediaDecodeTime:0,je=Xt(X,["trun"]),Ie,Ge;b===ie&&je.length>0&&(Ie=Vr(je,Ce,Z),Ge=Tl(I,Ie,ie),S[ie]||(S[ie]={seiNals:[],logs:[]}),S[ie].seiNals=S[ie].seiNals.concat(Ge.seiNals),S[ie].logs=S[ie].logs.concat(Ge.logs))}),S},lh=function(p,b,S){var x;if(b===null)return null;x=Ra(p,b);var D=x[b]||{};return{seiNals:D.seiNals,logs:D.logs,timescale:S}},Su=function(){var p=!1,b,S,x,D,I,X;this.isInitialized=function(){return p},this.init=function(K){b=new dt,p=!0,X=K?K.isPartial:!1,b.on("data",function(Z){Z.startTime=Z.startPts/D,Z.endTime=Z.endPts/D,I.captions.push(Z),I.captionStreams[Z.stream]=!0}),b.on("log",function(Z){I.logs.push(Z)})},this.isNewInit=function(K,Z){return K&&K.length===0||Z&&typeof Z=="object"&&Object.keys(Z).length===0?!1:x!==K[0]||D!==Z[x]},this.parse=function(K,Z,ie){var me;if(this.isInitialized()){if(!Z||!ie)return null;if(this.isNewInit(Z,ie))x=Z[0],D=ie[x];else if(x===null||!D)return S.push(K),null}else return null;for(;S.length>0;){var Ce=S.shift();this.parse(Ce,Z,ie)}return me=lh(K,x,D),me&&me.logs&&(I.logs=I.logs.concat(me.logs)),me===null||!me.seiNals?I.logs.length?{logs:I.logs,captions:[],captionStreams:[]}:null:(this.pushNals(me.seiNals),this.flushStream(),I)},this.pushNals=function(K){if(!this.isInitialized()||!K||K.length===0)return null;K.forEach(function(Z){b.push(Z)})},this.flushStream=function(){if(!this.isInitialized())return null;X?b.partialFlush():b.flush()},this.clearParsedCaptions=function(){I.captions=[],I.captionStreams={},I.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;b.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){S=[],x=null,D=null,I?this.clearParsedCaptions():I={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},xo=Su;const{parseTfdt:Op}=ka,Di=zs,{getTimescaleFromMediaHeader:Lc}=Q,{parseSamples:vs,getMdatTrafPairs:uh}=tt;var Hs=function(){let p=9e4;this.init=function(b){const S=Di(b,["moov","trak","mdia","mdhd"])[0];S&&(p=Lc(S))},this.parseSegment=function(b){const S=[],x=uh(b);let D=0;return x.forEach(function(I){const X=I.mdat,K=I.traf,Z=Di(K,["tfdt"])[0],ie=Di(K,["tfhd"])[0],me=Di(K,["trun"]);if(Z&&(D=Op(Z).baseMediaDecodeTime),me.length&&ie){const Ce=vs(me,D,ie);let je=0;Ce.forEach(function(Ie){const Ge="utf-8",pt=new TextDecoder(Ge),Mi=X.slice(je,je+Ie.size);if(Di(Mi,["vtte"])[0]){je+=Ie.size;return}Di(Mi,["vttc"]).forEach(function(El){const di=Di(El,["payl"])[0],Ma=Di(El,["sttg"])[0],bs=Ie.pts/p,Ys=(Ie.pts+Ie.duration)/p;let Kt,Gr;if(di)try{Kt=pt.decode(di)}catch(ln){console.error(ln)}if(Ma)try{Gr=pt.decode(Ma)}catch(ln){console.error(ln)}Ie.duration&&Kt&&S.push({cueText:Kt,start:bs,end:Ys,settings:Gr})}),je+=Ie.size})}}),S}},xl=Ri,Pc=function(p){var b=p[1]&31;return b<<=8,b|=p[2],b},So=function(p){return!!(p[1]&64)},Sl=function(p){var b=0;return(p[3]&48)>>>4>1&&(b+=p[4]+1),b},Jn=function(p,b){var S=Pc(p);return S===0?"pat":S===b?"pmt":b?"pes":null},wo=function(p){var b=So(p),S=4+Sl(p);return b&&(S+=p[S]+1),(p[S+10]&31)<<8|p[S+11]},Eo=function(p){var b={},S=So(p),x=4+Sl(p);if(S&&(x+=p[x]+1),!!(p[x+5]&1)){var D,I,X;D=(p[x+1]&15)<<8|p[x+2],I=3+D-4,X=(p[x+10]&15)<<8|p[x+11];for(var K=12+X;K<I;){var Z=x+K;b[(p[Z+1]&31)<<8|p[Z+2]]=p[Z],K+=((p[Z+3]&15)<<8|p[Z+4])+5}return b}},wu=function(p,b){var S=Pc(p),x=b[S];switch(x){case xl.H264_STREAM_TYPE:return"video";case xl.ADTS_STREAM_TYPE:return"audio";case xl.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},wl=function(p){var b=So(p);if(!b)return null;var S=4+Sl(p);if(S>=p.byteLength)return null;var x=null,D;return D=p[S+7],D&192&&(x={},x.pts=(p[S+9]&14)<<27|(p[S+10]&255)<<20|(p[S+11]&254)<<12|(p[S+12]&255)<<5|(p[S+13]&254)>>>3,x.pts*=4,x.pts+=(p[S+13]&6)>>>1,x.dts=x.pts,D&64&&(x.dts=(p[S+14]&14)<<27|(p[S+15]&255)<<20|(p[S+16]&254)<<12|(p[S+17]&255)<<5|(p[S+18]&254)>>>3,x.dts*=4,x.dts+=(p[S+18]&6)>>>1)),x},kn=function(p){switch(p){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},er=function(p){for(var b=4+Sl(p),S=p.subarray(b),x=0,D=0,I=!1,X;D<S.byteLength-3;D++)if(S[D+2]===1){x=D+5;break}for(;x<S.byteLength;)switch(S[x]){case 0:if(S[x-1]!==0){x+=2;break}else if(S[x-2]!==0){x++;break}D+3!==x-2&&(X=kn(S[D+3]&31),X==="slice_layer_without_partitioning_rbsp_idr"&&(I=!0));do x++;while(S[x]!==1&&x<S.length);D=x-2,x+=3;break;case 1:if(S[x-1]!==0||S[x-2]!==0){x+=3;break}X=kn(S[D+3]&31),X==="slice_layer_without_partitioning_rbsp_idr"&&(I=!0),D=x-2,x+=3;break;default:x+=3;break}return S=S.subarray(D),x-=D,D=0,S&&S.byteLength>3&&(X=kn(S[D+3]&31),X==="slice_layer_without_partitioning_rbsp_idr"&&(I=!0)),I},Vs={parseType:Jn,parsePat:wo,parsePmt:Eo,parsePayloadUnitStartIndicator:So,parsePesType:wu,parsePesTime:wl,videoPacketContainsKeyFrame:er},br=Ri,vn=os.handleRollover,xt={};xt.ts=Vs,xt.aac=ol;var Gs=It.ONE_SECOND_IN_TS,Zi=188,tr=71,ch=function(p,b){for(var S=0,x=Zi,D,I;x<p.byteLength;){if(p[S]===tr&&p[x]===tr){switch(D=p.subarray(S,x),I=xt.ts.parseType(D,b.pid),I){case"pat":b.pid=xt.ts.parsePat(D);break;case"pmt":var X=xt.ts.parsePmt(D);b.table=b.table||{},Object.keys(X).forEach(function(K){b.table[K]=X[K]});break}S+=Zi,x+=Zi;continue}S++,x++}},qi=function(p,b,S){for(var x=0,D=Zi,I,X,K,Z,ie,me=!1;D<=p.byteLength;){if(p[x]===tr&&(p[D]===tr||D===p.byteLength)){switch(I=p.subarray(x,D),X=xt.ts.parseType(I,b.pid),X){case"pes":K=xt.ts.parsePesType(I,b.table),Z=xt.ts.parsePayloadUnitStartIndicator(I),K==="audio"&&Z&&(ie=xt.ts.parsePesTime(I),ie&&(ie.type="audio",S.audio.push(ie),me=!0));break}if(me)break;x+=Zi,D+=Zi;continue}x++,D++}for(D=p.byteLength,x=D-Zi,me=!1;x>=0;){if(p[x]===tr&&(p[D]===tr||D===p.byteLength)){switch(I=p.subarray(x,D),X=xt.ts.parseType(I,b.pid),X){case"pes":K=xt.ts.parsePesType(I,b.table),Z=xt.ts.parsePayloadUnitStartIndicator(I),K==="audio"&&Z&&(ie=xt.ts.parsePesTime(I),ie&&(ie.type="audio",S.audio.push(ie),me=!0));break}if(me)break;x-=Zi,D-=Zi;continue}x--,D--}},oi=function(p,b,S){for(var x=0,D=Zi,I,X,K,Z,ie,me,Ce,je,Ie=!1,Ge={data:[],size:0};D<p.byteLength;){if(p[x]===tr&&p[D]===tr){switch(I=p.subarray(x,D),X=xt.ts.parseType(I,b.pid),X){case"pes":if(K=xt.ts.parsePesType(I,b.table),Z=xt.ts.parsePayloadUnitStartIndicator(I),K==="video"&&(Z&&!Ie&&(ie=xt.ts.parsePesTime(I),ie&&(ie.type="video",S.video.push(ie),Ie=!0)),!S.firstKeyFrame)){if(Z&&Ge.size!==0){for(me=new Uint8Array(Ge.size),Ce=0;Ge.data.length;)je=Ge.data.shift(),me.set(je,Ce),Ce+=je.byteLength;if(xt.ts.videoPacketContainsKeyFrame(me)){var pt=xt.ts.parsePesTime(me);pt?(S.firstKeyFrame=pt,S.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}Ge.size=0}Ge.data.push(I),Ge.size+=I.byteLength}break}if(Ie&&S.firstKeyFrame)break;x+=Zi,D+=Zi;continue}x++,D++}for(D=p.byteLength,x=D-Zi,Ie=!1;x>=0;){if(p[x]===tr&&p[D]===tr){switch(I=p.subarray(x,D),X=xt.ts.parseType(I,b.pid),X){case"pes":K=xt.ts.parsePesType(I,b.table),Z=xt.ts.parsePayloadUnitStartIndicator(I),K==="video"&&Z&&(ie=xt.ts.parsePesTime(I),ie&&(ie.type="video",S.video.push(ie),Ie=!0));break}if(Ie)break;x-=Zi,D-=Zi;continue}x--,D--}},wt=function(p,b){if(p.audio&&p.audio.length){var S=b;(typeof S>"u"||isNaN(S))&&(S=p.audio[0].dts),p.audio.forEach(function(I){I.dts=vn(I.dts,S),I.pts=vn(I.pts,S),I.dtsTime=I.dts/Gs,I.ptsTime=I.pts/Gs})}if(p.video&&p.video.length){var x=b;if((typeof x>"u"||isNaN(x))&&(x=p.video[0].dts),p.video.forEach(function(I){I.dts=vn(I.dts,x),I.pts=vn(I.pts,x),I.dtsTime=I.dts/Gs,I.ptsTime=I.pts/Gs}),p.firstKeyFrame){var D=p.firstKeyFrame;D.dts=vn(D.dts,x),D.pts=vn(D.pts,x),D.dtsTime=D.dts/Gs,D.ptsTime=D.pts/Gs}}},Ws=function(p){for(var b=!1,S=0,x=null,D=null,I=0,X=0,K;p.length-X>=3;){var Z=xt.aac.parseType(p,X);switch(Z){case"timed-metadata":if(p.length-X<10){b=!0;break}if(I=xt.aac.parseId3TagSize(p,X),I>p.length){b=!0;break}D===null&&(K=p.subarray(X,X+I),D=xt.aac.parseAacTimestamp(K)),X+=I;break;case"audio":if(p.length-X<7){b=!0;break}if(I=xt.aac.parseAdtsSize(p,X),I>p.length){b=!0;break}x===null&&(K=p.subarray(X,X+I),x=xt.aac.parseSampleRate(K)),S++,X+=I;break;default:X++;break}if(b)return null}if(x===null||D===null)return null;var ie=Gs/x,me={audio:[{type:"audio",dts:D,pts:D},{type:"audio",dts:D+S*1024*ie,pts:D+S*1024*ie}]};return me},ir=function(p){var b={pid:null,table:null},S={};ch(p,b);for(var x in b.table)if(b.table.hasOwnProperty(x)){var D=b.table[x];switch(D){case br.H264_STREAM_TYPE:S.video=[],oi(p,b,S),S.video.length===0&&delete S.video;break;case br.ADTS_STREAM_TYPE:S.audio=[],qi(p,b,S),S.audio.length===0&&delete S.audio;break}}return S},zc=function(p,b){var S=xt.aac.isLikelyAacData(p),x;return S?x=Ws(p):x=ir(p),!x||!x.audio&&!x.video?null:(wt(x,b),x)},Xs={inspect:zc,parseAudioPes_:qi};const dh=function(p,b){b.on("data",function(S){const x=S.initSegment;S.initSegment={data:x.buffer,byteOffset:x.byteOffset,byteLength:x.byteLength};const D=S.data;S.data=D.buffer,p.postMessage({action:"data",segment:S,byteOffset:D.byteOffset,byteLength:D.byteLength},[S.data])}),b.on("done",function(S){p.postMessage({action:"done"})}),b.on("gopInfo",function(S){p.postMessage({action:"gopInfo",gopInfo:S})}),b.on("videoSegmentTimingInfo",function(S){const x={start:{decode:It.videoTsToSeconds(S.start.dts),presentation:It.videoTsToSeconds(S.start.pts)},end:{decode:It.videoTsToSeconds(S.end.dts),presentation:It.videoTsToSeconds(S.end.pts)},baseMediaDecodeTime:It.videoTsToSeconds(S.baseMediaDecodeTime)};S.prependedContentDuration&&(x.prependedContentDuration=It.videoTsToSeconds(S.prependedContentDuration)),p.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:x})}),b.on("audioSegmentTimingInfo",function(S){const x={start:{decode:It.videoTsToSeconds(S.start.dts),presentation:It.videoTsToSeconds(S.start.pts)},end:{decode:It.videoTsToSeconds(S.end.dts),presentation:It.videoTsToSeconds(S.end.pts)},baseMediaDecodeTime:It.videoTsToSeconds(S.baseMediaDecodeTime)};S.prependedContentDuration&&(x.prependedContentDuration=It.videoTsToSeconds(S.prependedContentDuration)),p.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:x})}),b.on("id3Frame",function(S){p.postMessage({action:"id3Frame",id3Frame:S})}),b.on("caption",function(S){p.postMessage({action:"caption",caption:S})}),b.on("trackinfo",function(S){p.postMessage({action:"trackinfo",trackInfo:S})}),b.on("audioTimingInfo",function(S){p.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:It.videoTsToSeconds(S.start),end:It.videoTsToSeconds(S.end)}})}),b.on("videoTimingInfo",function(S){p.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:It.videoTsToSeconds(S.start),end:It.videoTsToSeconds(S.end)}})}),b.on("log",function(S){p.postMessage({action:"log",log:S})})};class Fc{constructor(b,S){this.options=S||{},this.self=b,this.init()}init(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new Mc.Transmuxer(this.options),dh(this.self,this.transmuxer)}pushMp4Captions(b){this.captionParser||(this.captionParser=new xo,this.captionParser.init());const S=new Uint8Array(b.data,b.byteOffset,b.byteLength),x=this.captionParser.parse(S,b.trackIds,b.timescales);this.self.postMessage({action:"mp4Captions",captions:x&&x.captions||[],logs:x&&x.logs||[],data:S.buffer},[S.buffer])}initMp4WebVttParser(b){this.webVttParser||(this.webVttParser=new Hs);const S=new Uint8Array(b.data,b.byteOffset,b.byteLength);this.webVttParser.init(S)}getMp4WebVttText(b){this.webVttParser||(this.webVttParser=new Hs);const S=new Uint8Array(b.data,b.byteOffset,b.byteLength),x=this.webVttParser.parseSegment(S);this.self.postMessage({action:"getMp4WebVttText",mp4VttCues:x||[],data:S.buffer},[S.buffer])}probeMp4StartTime({timescales:b,data:S}){const x=Q.startTime(b,S);this.self.postMessage({action:"probeMp4StartTime",startTime:x,data:S},[S.buffer])}probeMp4Tracks({data:b}){const S=Q.tracks(b);this.self.postMessage({action:"probeMp4Tracks",tracks:S,data:b},[b.buffer])}probeEmsgID3({data:b,offset:S}){const x=Q.getEmsgID3(b,S);this.self.postMessage({action:"probeEmsgID3",id3Frames:x,emsgData:b},[b.buffer])}probeTs({data:b,baseStartTime:S}){const x=typeof S=="number"&&!isNaN(S)?S*It.ONE_SECOND_IN_TS:void 0,D=Xs.inspect(b,x);let I=null;D&&(I={hasVideo:D.video&&D.video.length===2||!1,hasAudio:D.audio&&D.audio.length===2||!1},I.hasVideo&&(I.videoStart=D.video[0].ptsTime),I.hasAudio&&(I.audioStart=D.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:I,data:b},[b.buffer])}clearAllMp4Captions(){this.captionParser&&this.captionParser.clearAllCaptions()}clearParsedMp4Captions(){this.captionParser&&this.captionParser.clearParsedCaptions()}push(b){const S=new Uint8Array(b.data,b.byteOffset,b.byteLength);this.transmuxer.push(S)}reset(){this.transmuxer.reset()}setTimestampOffset(b){const S=b.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(It.secondsToVideoTs(S)))}setAudioAppendStart(b){this.transmuxer.setAudioAppendStart(Math.ceil(It.secondsToVideoTs(b.appendStart)))}setRemux(b){this.transmuxer.setRemux(b.remux)}flush(b){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})}endTimeline(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})}alignGopsWith(b){this.transmuxer.alignGopsWith(b.gopsToAlignWith.slice())}}self.onmessage=function(p){if(p.data.action==="init"&&p.data.options){this.messageHandlers=new Fc(self,p.data.options);return}this.messageHandlers||(this.messageHandlers=new Fc(self)),p.data&&p.data.action&&p.data.action!=="init"&&this.messageHandlers[p.data.action]&&this.messageHandlers[p.data.action](p.data)}}));var a5=ek(s5);const o5=(t,e,i)=>{const{type:n,initSegment:s,captions:o,captionStreams:l,metadata:c,videoFrameDtsTime:h,videoFramePtsTime:f}=t.data.segment;e.buffer.push({captions:o,captionStreams:l,metadata:c});const m=t.data.segment.boxes||{data:t.data.segment.data},_={type:n,data:new Uint8Array(m.data,m.data.byteOffset,m.data.byteLength),initSegment:new Uint8Array(s.data,s.byteOffset,s.byteLength)};typeof h<"u"&&(_.videoFrameDtsTime=h),typeof f<"u"&&(_.videoFramePtsTime=f),i(_)},l5=({transmuxedData:t,callback:e})=>{t.buffer=[],e(t)},u5=(t,e)=>{e.gopInfo=t.data.gopInfo},nk=t=>{const{transmuxer:e,bytes:i,audioAppendStart:n,gopsToAlignWith:s,remux:o,onData:l,onTrackInfo:c,onAudioTimingInfo:h,onVideoTimingInfo:f,onVideoSegmentTimingInfo:m,onAudioSegmentTimingInfo:_,onId3:E,onCaptions:w,onDone:A,onEndedTimeline:C,onTransmuxerLog:M,isEndOfTimeline:O,segment:$,triggerSegmentEventFn:B}=t,U={buffer:[]};let j=O;const W=Y=>{e.currentTransmux===t&&(Y.data.action==="data"&&o5(Y,U,l),Y.data.action==="trackinfo"&&c(Y.data.trackInfo),Y.data.action==="gopInfo"&&u5(Y,U),Y.data.action==="audioTimingInfo"&&h(Y.data.audioTimingInfo),Y.data.action==="videoTimingInfo"&&f(Y.data.videoTimingInfo),Y.data.action==="videoSegmentTimingInfo"&&m(Y.data.videoSegmentTimingInfo),Y.data.action==="audioSegmentTimingInfo"&&_(Y.data.audioSegmentTimingInfo),Y.data.action==="id3Frame"&&E([Y.data.id3Frame],Y.data.id3Frame.dispatchType),Y.data.action==="caption"&&w(Y.data.caption),Y.data.action==="endedtimeline"&&(j=!1,C()),Y.data.action==="log"&&M(Y.data.log),Y.data.type==="transmuxed"&&(j||(e.onmessage=null,l5({transmuxedData:U,callback:A}),rk(e))))},z=()=>{const Y={message:"Received an error message from the transmuxer worker",metadata:{errorType:_e.Error.StreamingFailedToTransmuxSegment,segmentInfo:Hl({segment:$})}};A(null,Y)};if(e.onmessage=W,e.onerror=z,n&&e.postMessage({action:"setAudioAppendStart",appendStart:n}),Array.isArray(s)&&e.postMessage({action:"alignGopsWith",gopsToAlignWith:s}),typeof o<"u"&&e.postMessage({action:"setRemux",remux:o}),i.byteLength){const Y=i instanceof ArrayBuffer?i:i.buffer,L=i instanceof ArrayBuffer?0:i.byteOffset;B({type:"segmenttransmuxingstart",segment:$}),e.postMessage({action:"push",data:Y,byteOffset:L,byteLength:i.byteLength},[Y])}O&&e.postMessage({action:"endTimeline"}),e.postMessage({action:"flush"})},rk=t=>{t.currentTransmux=null,t.transmuxQueue.length&&(t.currentTransmux=t.transmuxQueue.shift(),typeof t.currentTransmux=="function"?t.currentTransmux():nk(t.currentTransmux))},Pw=(t,e)=>{t.postMessage({action:e}),rk(t)},sk=(t,e)=>{if(!e.currentTransmux){e.currentTransmux=t,Pw(e,t);return}e.transmuxQueue.push(Pw.bind(null,e,t))},c5=t=>{sk("reset",t)},d5=t=>{sk("endTimeline",t)},ak=t=>{if(!t.transmuxer.currentTransmux){t.transmuxer.currentTransmux=t,nk(t);return}t.transmuxer.transmuxQueue.push(t)},h5=t=>{const e=new a5;e.currentTransmux=null,e.transmuxQueue=[];const i=e.terminate;return e.terminate=()=>(e.currentTransmux=null,e.transmuxQueue.length=0,i.call(e)),e.postMessage({action:"init",options:t}),e};var P0={reset:c5,endTimeline:d5,transmux:ak,createTransmuxer:h5};const nc=function(t){const e=t.transmuxer,i=t.endAction||t.action,n=t.callback,s=Li({},t,{endAction:null,transmuxer:null,callback:null}),o=l=>{l.data.action===i&&(e.removeEventListener("message",o),l.data.data&&(l.data.data=new Uint8Array(l.data.data,t.byteOffset||0,t.byteLength||l.data.data.byteLength),t.data&&(t.data=l.data.data)),n(l.data))};if(e.addEventListener("message",o),t.data){const l=t.data instanceof ArrayBuffer;s.byteOffset=l?0:t.data.byteOffset,s.byteLength=t.data.byteLength;const c=[l?t.data:t.data.buffer];e.postMessage(s,c)}else e.postMessage(s)},aa={FAILURE:2,TIMEOUT:-101,ABORTED:-102},ok="wvtt",Ey=t=>{t.forEach(e=>{e.abort()})},f5=t=>({bandwidth:t.bandwidth,bytesReceived:t.bytesReceived||0,roundTripTime:t.roundTripTime||0}),p5=t=>{const e=t.target,n={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-e.requestTime||0};return n.bytesReceived=t.loaded,n.bandwidth=Math.floor(n.bytesReceived/n.roundTripTime*8*1e3),n},q_=(t,e)=>{const{requestType:i}=e,n=Jl({requestType:i,request:e,error:t});return e.timedout?{status:e.status,message:"HLS request timed-out at URL: "+e.uri,code:aa.TIMEOUT,xhr:e,metadata:n}:e.aborted?{status:e.status,message:"HLS request aborted at URL: "+e.uri,code:aa.ABORTED,xhr:e,metadata:n}:t?{status:e.status,message:"HLS request errored at URL: "+e.uri,code:aa.FAILURE,xhr:e,metadata:n}:e.responseType==="arraybuffer"&&e.response.byteLength===0?{status:e.status,message:"Empty HLS response at URL: "+e.uri,code:aa.FAILURE,xhr:e,metadata:n}:null},zw=(t,e,i,n)=>(s,o)=>{const l=o.response,c=q_(s,o);if(c)return i(c,t);if(l.byteLength!==16)return i({status:o.status,message:"Invalid HLS key at URL: "+o.uri,code:aa.FAILURE,xhr:o},t);const h=new DataView(l),f=new Uint32Array([h.getUint32(0),h.getUint32(4),h.getUint32(8),h.getUint32(12)]);for(let _=0;_<e.length;_++)e[_].bytes=f;const m={uri:o.uri};return n({type:"segmentkeyloadcomplete",segment:t,keyInfo:m}),i(null,t)},m5=(t,e)=>{e===ok&&t.transmuxer.postMessage({action:"initMp4WebVttParser",data:t.map.bytes})},g5=(t,e,i)=>{e===ok&&nc({action:"getMp4WebVttText",data:t.bytes,transmuxer:t.transmuxer,callback:({data:n,mp4VttCues:s})=>{t.bytes=n,i(null,t,{mp4VttCues:s})}})},lk=(t,e)=>{const i=d_(t.map.bytes);if(i!=="mp4"){const n=t.map.resolvedUri||t.map.uri,s=i||"unknown";return e({internal:!0,message:`Found unsupported ${s} container for initialization segment at URL: ${n}`,code:aa.FAILURE,metadata:{mediaType:s}})}nc({action:"probeMp4Tracks",data:t.map.bytes,transmuxer:t.transmuxer,callback:({tracks:n,data:s})=>(t.map.bytes=s,n.forEach(function(o){t.map.tracks=t.map.tracks||{},!t.map.tracks[o.type]&&(t.map.tracks[o.type]=o,typeof o.id=="number"&&o.timescale&&(t.map.timescales=t.map.timescales||{},t.map.timescales[o.id]=o.timescale),o.type==="text"&&m5(t,o.codec))}),e(null))})},y5=({segment:t,finishProcessingFn:e,triggerSegmentEventFn:i})=>(n,s)=>{const o=q_(n,s);if(o)return e(o,t);const l=new Uint8Array(s.response);if(i({type:"segmentloaded",segment:t}),t.map.key)return t.map.encryptedBytes=l,e(null,t);t.map.bytes=l,lk(t,function(c){if(c)return c.xhr=s,c.status=s.status,e(c,t);e(null,t)})},_5=({segment:t,finishProcessingFn:e,responseType:i,triggerSegmentEventFn:n})=>(s,o)=>{const l=q_(s,o);if(l)return e(l,t);n({type:"segmentloaded",segment:t});const c=i==="arraybuffer"||!o.responseText?o.response:n5(o.responseText.substring(t.lastReachedChar||0));return t.stats=f5(o),t.key?t.encryptedBytes=new Uint8Array(c):t.bytes=new Uint8Array(c),e(null,t)},v5=({segment:t,bytes:e,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:o,id3Fn:l,captionsFn:c,isEndOfTimeline:h,endedTimelineFn:f,dataFn:m,doneFn:_,onTransmuxerLog:E,triggerSegmentEventFn:w})=>{const A=t.map&&t.map.tracks||{},C=!!(A.audio&&A.video);let M=n.bind(null,t,"audio","start");const O=n.bind(null,t,"audio","end");let $=n.bind(null,t,"video","start");const B=n.bind(null,t,"video","end"),U=()=>ak({bytes:e,transmuxer:t.transmuxer,audioAppendStart:t.audioAppendStart,gopsToAlignWith:t.gopsToAlignWith,remux:C,onData:j=>{j.type=j.type==="combined"?"video":j.type,m(t,j)},onTrackInfo:j=>{i&&(C&&(j.isMuxed=!0),i(t,j))},onAudioTimingInfo:j=>{M&&typeof j.start<"u"&&(M(j.start),M=null),O&&typeof j.end<"u"&&O(j.end)},onVideoTimingInfo:j=>{$&&typeof j.start<"u"&&($(j.start),$=null),B&&typeof j.end<"u"&&B(j.end)},onVideoSegmentTimingInfo:j=>{const W={pts:{start:j.start.presentation,end:j.end.presentation},dts:{start:j.start.decode,end:j.end.decode}};w({type:"segmenttransmuxingtiminginfoavailable",segment:t,timingInfo:W}),s(j)},onAudioSegmentTimingInfo:j=>{const W={pts:{start:j.start.pts,end:j.end.pts},dts:{start:j.start.dts,end:j.end.dts}};w({type:"segmenttransmuxingtiminginfoavailable",segment:t,timingInfo:W}),o(j)},onId3:(j,W)=>{l(t,j,W)},onCaptions:j=>{c(t,[j])},isEndOfTimeline:h,onEndedTimeline:()=>{f()},onTransmuxerLog:E,onDone:(j,W)=>{_&&(j.type=j.type==="combined"?"video":j.type,w({type:"segmenttransmuxingcomplete",segment:t}),_(W,t,j))},segment:t,triggerSegmentEventFn:w});nc({action:"probeTs",transmuxer:t.transmuxer,data:e,baseStartTime:t.baseStartTime,callback:j=>{t.bytes=e=j.data;const W=j.result;W&&(i(t,{hasAudio:W.hasAudio,hasVideo:W.hasVideo,isMuxed:C}),i=null),U()}})},uk=({segment:t,bytes:e,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:o,id3Fn:l,captionsFn:c,isEndOfTimeline:h,endedTimelineFn:f,dataFn:m,doneFn:_,onTransmuxerLog:E,triggerSegmentEventFn:w})=>{let A=new Uint8Array(e);if(z8(A)){t.isFmp4=!0;const{tracks:C}=t.map;if(C.text&&(!C.audio||!C.video)){m(t,{data:A,type:"text"}),g5(t,C.text.codec,_);return}const O={isFmp4:!0,hasVideo:!!C.video,hasAudio:!!C.audio};C.audio&&C.audio.codec&&C.audio.codec!=="enca"&&(O.audioCodec=C.audio.codec),C.video&&C.video.codec&&C.video.codec!=="encv"&&(O.videoCodec=C.video.codec),C.video&&C.audio&&(O.isMuxed=!0),i(t,O);const $=(B,U)=>{m(t,{data:A,type:O.hasAudio&&!O.isMuxed?"audio":"video"}),U&&U.length&&l(t,U),B&&B.length&&c(t,B),_(null,t,{})};nc({action:"probeMp4StartTime",timescales:t.map.timescales,data:A,transmuxer:t.transmuxer,callback:({data:B,startTime:U})=>{e=B.buffer,t.bytes=A=B,O.hasAudio&&!O.isMuxed&&n(t,"audio","start",U),O.hasVideo&&n(t,"video","start",U),nc({action:"probeEmsgID3",data:A,transmuxer:t.transmuxer,offset:U,callback:({emsgData:j,id3Frames:W})=>{if(e=j.buffer,t.bytes=A=j,!C.video||!j.byteLength||!t.transmuxer){$(void 0,W);return}nc({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:t.transmuxer,data:A,timescales:t.map.timescales,trackIds:[C.video.id],callback:z=>{e=z.data.buffer,t.bytes=A=z.data,z.logs.forEach(function(Y){E(Gt(Y,{stream:"mp4CaptionParser"}))}),$(z.captions,W)}})}})}});return}if(!t.transmuxer){_(null,t,{});return}if(typeof t.container>"u"&&(t.container=d_(A)),t.container!=="ts"&&t.container!=="aac"){i(t,{hasAudio:!1,hasVideo:!1}),_(null,t,{});return}v5({segment:t,bytes:e,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:o,id3Fn:l,captionsFn:c,isEndOfTimeline:h,endedTimelineFn:f,dataFn:m,doneFn:_,onTransmuxerLog:E,triggerSegmentEventFn:w})},ck=function({id:t,key:e,encryptedBytes:i,decryptionWorker:n,segment:s,doneFn:o},l){const c=f=>{if(f.data.source===t){n.removeEventListener("message",c);const m=f.data.decrypted;l(new Uint8Array(m.bytes,m.byteOffset,m.byteLength))}};n.onerror=()=>{const f="An error occurred in the decryption worker",m=Hl({segment:s}),_={message:f,metadata:{error:new Error(f),errorType:_e.Error.StreamingFailedToDecryptSegment,segmentInfo:m,keyInfo:{uri:s.key.resolvedUri||s.map.key.resolvedUri}}};o(_,s)},n.addEventListener("message",c);let h;e.bytes.slice?h=e.bytes.slice():h=new Uint32Array(Array.prototype.slice.call(e.bytes)),n.postMessage(X4({source:t,encrypted:i,key:h,iv:e.iv}),[i.buffer,h.buffer])},b5=({decryptionWorker:t,segment:e,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:o,id3Fn:l,captionsFn:c,isEndOfTimeline:h,endedTimelineFn:f,dataFn:m,doneFn:_,onTransmuxerLog:E,triggerSegmentEventFn:w})=>{w({type:"segmentdecryptionstart"}),ck({id:e.requestId,key:e.key,encryptedBytes:e.encryptedBytes,decryptionWorker:t,segment:e,doneFn:_},A=>{e.bytes=A,w({type:"segmentdecryptioncomplete",segment:e}),uk({segment:e,bytes:e.bytes,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:o,id3Fn:l,captionsFn:c,isEndOfTimeline:h,endedTimelineFn:f,dataFn:m,doneFn:_,onTransmuxerLog:E,triggerSegmentEventFn:w})})},T5=({activeXhrs:t,decryptionWorker:e,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:o,id3Fn:l,captionsFn:c,isEndOfTimeline:h,endedTimelineFn:f,dataFn:m,doneFn:_,onTransmuxerLog:E,triggerSegmentEventFn:w})=>{let A=0,C=!1;return(M,O)=>{if(!C){if(M)return C=!0,Ey(t),_(M,O);if(A+=1,A===t.length){const $=function(){if(O.encryptedBytes)return b5({decryptionWorker:e,segment:O,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:o,id3Fn:l,captionsFn:c,isEndOfTimeline:h,endedTimelineFn:f,dataFn:m,doneFn:_,onTransmuxerLog:E,triggerSegmentEventFn:w});uk({segment:O,bytes:O.bytes,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:o,id3Fn:l,captionsFn:c,isEndOfTimeline:h,endedTimelineFn:f,dataFn:m,doneFn:_,onTransmuxerLog:E,triggerSegmentEventFn:w})};if(O.endOfAllRequests=Date.now(),O.map&&O.map.encryptedBytes&&!O.map.bytes)return w({type:"segmentdecryptionstart",segment:O}),ck({decryptionWorker:e,id:O.requestId+"-init",encryptedBytes:O.map.encryptedBytes,key:O.map.key,segment:O,doneFn:_},B=>{O.map.bytes=B,w({type:"segmentdecryptioncomplete",segment:O}),lk(O,U=>{if(U)return Ey(t),_(U,O);$()})});$()}}}},x5=({loadendState:t,abortFn:e})=>i=>{i.target.aborted&&e&&!t.calledAbortFn&&(e(),t.calledAbortFn=!0)},S5=({segment:t,progressFn:e,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:o,id3Fn:l,captionsFn:c,isEndOfTimeline:h,endedTimelineFn:f,dataFn:m})=>_=>{if(!_.target.aborted)return t.stats=Gt(t.stats,p5(_)),!t.stats.firstBytesReceivedAt&&t.stats.bytesReceived&&(t.stats.firstBytesReceivedAt=Date.now()),e(_,t)},w5=({xhr:t,xhrOptions:e,decryptionWorker:i,segment:n,abortFn:s,progressFn:o,trackInfoFn:l,timingInfoFn:c,videoSegmentTimingInfoFn:h,audioSegmentTimingInfoFn:f,id3Fn:m,captionsFn:_,isEndOfTimeline:E,endedTimelineFn:w,dataFn:A,doneFn:C,onTransmuxerLog:M,triggerSegmentEventFn:O})=>{const $=[],B=T5({activeXhrs:$,decryptionWorker:i,trackInfoFn:l,timingInfoFn:c,videoSegmentTimingInfoFn:h,audioSegmentTimingInfoFn:f,id3Fn:m,captionsFn:_,isEndOfTimeline:E,endedTimelineFn:w,dataFn:A,doneFn:C,onTransmuxerLog:M,triggerSegmentEventFn:O});if(n.key&&!n.key.bytes){const Y=[n.key];n.map&&!n.map.bytes&&n.map.key&&n.map.key.resolvedUri===n.key.resolvedUri&&Y.push(n.map.key);const L=Gt(e,{uri:n.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),H=zw(n,Y,B,O),se={uri:n.key.resolvedUri};O({type:"segmentkeyloadstart",segment:n,keyInfo:se});const ae=t(L,H);$.push(ae)}if(n.map&&!n.map.bytes){if(n.map.key&&(!n.key||n.key.resolvedUri!==n.map.key.resolvedUri)){const ae=Gt(e,{uri:n.map.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),ce=zw(n,[n.map.key],B,O),fe={uri:n.map.key.resolvedUri};O({type:"segmentkeyloadstart",segment:n,keyInfo:fe});const be=t(ae,ce);$.push(be)}const L=Gt(e,{uri:n.map.resolvedUri,responseType:"arraybuffer",headers:Sy(n.map),requestType:"segment-media-initialization"}),H=y5({segment:n,finishProcessingFn:B,triggerSegmentEventFn:O});O({type:"segmentloadstart",segment:n});const se=t(L,H);$.push(se)}const U=Gt(e,{uri:n.part&&n.part.resolvedUri||n.resolvedUri,responseType:"arraybuffer",headers:Sy(n),requestType:"segment"}),j=_5({segment:n,finishProcessingFn:B,responseType:U.responseType,triggerSegmentEventFn:O});O({type:"segmentloadstart",segment:n});const W=t(U,j);W.addEventListener("progress",S5({segment:n,progressFn:o,trackInfoFn:l,timingInfoFn:c,videoSegmentTimingInfoFn:h,audioSegmentTimingInfoFn:f,id3Fn:m,captionsFn:_,isEndOfTimeline:E,endedTimelineFn:w,dataFn:A})),$.push(W);const z={};return $.forEach(Y=>{Y.addEventListener("loadend",x5({loadendState:z,abortFn:s}))}),()=>Ey($)},Ef=ns("PlaylistSelector"),Fw=function(t){if(!t||!t.playlist)return;const e=t.playlist;return JSON.stringify({id:e.id,bandwidth:t.bandwidth,width:t.width,height:t.height,codecs:e.attributes&&e.attributes.CODECS||""})},rc=function(t,e){if(!t)return"";const i=te.getComputedStyle(t);return i?i[e]:""},sc=function(t,e){const i=t.slice();t.sort(function(n,s){const o=e(n,s);return o===0?i.indexOf(n)-i.indexOf(s):o})},j_=function(t,e){let i,n;return t.attributes.BANDWIDTH&&(i=t.attributes.BANDWIDTH),i=i||te.Number.MAX_VALUE,e.attributes.BANDWIDTH&&(n=e.attributes.BANDWIDTH),n=n||te.Number.MAX_VALUE,i-n},E5=function(t,e){let i,n;return t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width&&(i=t.attributes.RESOLUTION.width),i=i||te.Number.MAX_VALUE,e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(n=e.attributes.RESOLUTION.width),n=n||te.Number.MAX_VALUE,i===n&&t.attributes.BANDWIDTH&&e.attributes.BANDWIDTH?t.attributes.BANDWIDTH-e.attributes.BANDWIDTH:i-n};let dk=function(t){const{main:e,bandwidth:i,playerWidth:n,playerHeight:s,playerObjectFit:o,limitRenditionByPlayerDimensions:l,playlistController:c}=t;if(!e)return;const h={bandwidth:i,width:n,height:s,limitRenditionByPlayerDimensions:l};let f=e.playlists;cr.isAudioOnly(e)&&(f=c.getAudioTrackPlaylists_(),h.audioOnly=!0);let m=f.map(z=>{let Y;const L=z.attributes&&z.attributes.RESOLUTION&&z.attributes.RESOLUTION.width,H=z.attributes&&z.attributes.RESOLUTION&&z.attributes.RESOLUTION.height;return Y=z.attributes&&z.attributes.BANDWIDTH,Y=Y||te.Number.MAX_VALUE,{bandwidth:Y,width:L,height:H,playlist:z}});sc(m,(z,Y)=>z.bandwidth-Y.bandwidth),m=m.filter(z=>!cr.isIncompatible(z.playlist));let _=m.filter(z=>cr.isEnabled(z.playlist));_.length||(_=m.filter(z=>!cr.isDisabled(z.playlist)));const E=_.filter(z=>z.bandwidth*hn.BANDWIDTH_VARIANCE<i);let w=E[E.length-1];const A=E.filter(z=>z.bandwidth===w.bandwidth)[0];if(l===!1){const z=A||_[0]||m[0];if(z&&z.playlist){let Y="sortedPlaylistReps";return A&&(Y="bandwidthBestRep"),_[0]&&(Y="enabledPlaylistReps"),Ef(`choosing ${Fw(z)} using ${Y} with options`,h),z.playlist}return Ef("could not choose a playlist with options",h),null}const C=E.filter(z=>z.width&&z.height);sc(C,(z,Y)=>z.width-Y.width);const M=C.filter(z=>z.width===n&&z.height===s);w=M[M.length-1];const O=M.filter(z=>z.bandwidth===w.bandwidth)[0];let $,B,U;O||($=C.filter(z=>o==="cover"?z.width>n&&z.height>s:z.width>n||z.height>s),B=$.filter(z=>z.width===$[0].width&&z.height===$[0].height),w=B[B.length-1],U=B.filter(z=>z.bandwidth===w.bandwidth)[0]);let j;if(c.leastPixelDiffSelector){const z=C.map(Y=>(Y.pixelDiff=Math.abs(Y.width-n)+Math.abs(Y.height-s),Y));sc(z,(Y,L)=>Y.pixelDiff===L.pixelDiff?L.bandwidth-Y.bandwidth:Y.pixelDiff-L.pixelDiff),j=z[0]}const W=j||U||O||A||_[0]||m[0];if(W&&W.playlist){let z="sortedPlaylistReps";return j?z="leastPixelDiffRep":U?z="resolutionPlusOneRep":O?z="resolutionBestRep":A?z="bandwidthBestRep":_[0]&&(z="enabledPlaylistReps"),Ef(`choosing ${Fw(W)} using ${z} with options`,h),W.playlist}return Ef("could not choose a playlist with options",h),null};const qw=function(){let t=this.useDevicePixelRatio&&te.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(t=this.customPixelRatio),dk({main:this.playlists.main,bandwidth:this.systemBandwidth,playerWidth:parseInt(rc(this.tech_.el(),"width"),10)*t,playerHeight:parseInt(rc(this.tech_.el(),"height"),10)*t,playerObjectFit:this.usePlayerObjectFit?rc(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})},C5=function(t){let e=-1,i=-1;if(t<0||t>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){let n=this.useDevicePixelRatio&&te.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(n=this.customPixelRatio),e<0&&(e=this.systemBandwidth,i=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==i&&(e=t*this.systemBandwidth+(1-t)*e,i=this.systemBandwidth),dk({main:this.playlists.main,bandwidth:e,playerWidth:parseInt(rc(this.tech_.el(),"width"),10)*n,playerHeight:parseInt(rc(this.tech_.el(),"height"),10)*n,playerObjectFit:this.usePlayerObjectFit?rc(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})}},A5=function(t){const{main:e,currentTime:i,bandwidth:n,duration:s,segmentDuration:o,timeUntilRebuffer:l,currentTimeline:c,syncController:h}=t,f=e.playlists.filter(A=>!cr.isIncompatible(A));let m=f.filter(cr.isEnabled);m.length||(m=f.filter(A=>!cr.isDisabled(A)));const E=m.filter(cr.hasAttribute.bind(null,"BANDWIDTH")).map(A=>{const M=h.getSyncPoint(A,s,c,i)?1:2,$=cr.estimateSegmentRequestTime(o,n,A)*M-l;return{playlist:A,rebufferingImpact:$}}),w=E.filter(A=>A.rebufferingImpact<=0);return sc(w,(A,C)=>j_(C.playlist,A.playlist)),w.length?w[0]:(sc(E,(A,C)=>A.rebufferingImpact-C.rebufferingImpact),E[0]||null)},D5=function(){const t=this.playlists.main.playlists.filter(cr.isEnabled);return sc(t,(i,n)=>j_(i,n)),t.filter(i=>!!Wd(this.playlists.main,i).video)[0]||null},k5=t=>{let e=0,i;return t.bytes&&(i=new Uint8Array(t.bytes),t.segments.forEach(n=>{i.set(n,e),e+=n.byteLength})),i};function hk(t){try{return new URL(t).pathname.split("/").slice(-2).join("/")}catch{return""}}const $5=function(t,e,i){if(!t[i]){e.trigger({type:"usage",name:"vhs-608"});let n=i;/^cc708_/.test(i)&&(n="SERVICE"+i.split("_")[1]);const s=e.textTracks().getTrackById(n);if(s)t[i]=s;else{const o=e.options_.vhs&&e.options_.vhs.captionServices||{};let l=i,c=i,h=!1;const f=o[n];f&&(l=f.label,c=f.language,h=f.default),t[i]=e.addRemoteTextTrack({kind:"captions",id:n,default:h,label:l,language:c},!1).track}}},O5=function({inbandTextTracks:t,captionArray:e,timestampOffset:i}){if(!e)return;const n=te.WebKitDataCue||te.VTTCue;e.forEach(s=>{const o=s.stream;s.content?s.content.forEach(l=>{const c=new n(s.startTime+i,s.endTime+i,l.text);c.line=l.line,c.align="left",c.position=l.position,c.positionAlign="line-left",t[o].addCue(c)}):t[o].addCue(new n(s.startTime+i,s.endTime+i,s.text))})},I5=function(t){Object.defineProperties(t.frame,{id:{get(){return _e.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),t.value.key}},value:{get(){return _e.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),t.value.data}},privateData:{get(){return _e.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),t.value.data}}})},R5=({inbandTextTracks:t,metadataArray:e,timestampOffset:i,videoDuration:n})=>{if(!e)return;const s=te.WebKitDataCue||te.VTTCue,o=t.metadataTrack_;if(!o||(e.forEach(m=>{const _=m.cueTime+i;typeof _!="number"||te.isNaN(_)||_<0||!(_<1/0)||!m.frames||!m.frames.length||m.frames.forEach(E=>{const w=new s(_,_,E.value||E.url||E.data||"");w.frame=E,w.value=E,I5(w),o.addCue(w)})}),!o.cues||!o.cues.length))return;const l=o.cues,c=[];for(let m=0;m<l.length;m++)l[m]&&c.push(l[m]);const h=c.reduce((m,_)=>{const E=m[_.startTime]||[];return E.push(_),m[_.startTime]=E,m},{}),f=Object.keys(h).sort((m,_)=>Number(m)-Number(_));f.forEach((m,_)=>{const E=h[m],w=isFinite(n)?n:m,A=Number(f[_+1])||w;E.forEach(C=>{C.endTime=A})})},M5={id:"ID",class:"CLASS",startDate:"START-DATE",duration:"DURATION",endDate:"END-DATE",endOnNext:"END-ON-NEXT",plannedDuration:"PLANNED-DURATION",scte35Out:"SCTE35-OUT",scte35In:"SCTE35-IN"},N5=new Set(["id","class","startDate","duration","endDate","endOnNext","startTime","endTime","processDateRange"]),B5=({inbandTextTracks:t,dateRanges:e})=>{const i=t.metadataTrack_;if(!i)return;const n=te.WebKitDataCue||te.VTTCue;e.forEach(s=>{for(const o of Object.keys(s)){if(N5.has(o))continue;const l=new n(s.startTime,s.endTime,"");l.id=s.id,l.type="com.apple.quicktime.HLS",l.value={key:M5[o],data:s[o]},(o==="scte35Out"||o==="scte35In")&&(l.value.data=new Uint8Array(l.value.data.match(/[\da-f]{2}/gi)).buffer),i.addCue(l)}s.processDateRange()})},jw=(t,e,i)=>{t.metadataTrack_||(t.metadataTrack_=i.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,_e.browser.IS_ANY_SAFARI||(t.metadataTrack_.inBandMetadataTrackDispatchType=e))},zd=function(t,e,i){let n,s;if(i&&i.cues)for(n=i.cues.length;n--;)s=i.cues[n],s.startTime>=t&&s.endTime<=e&&i.removeCue(s)},L5=function(t){const e=t.cues;if(!e)return;const i={};for(let n=e.length-1;n>=0;n--){const s=e[n],o=`${s.startTime}-${s.endTime}-${s.text}`;i[o]?t.removeCue(s):i[o]=s}},U5=(t,e,i)=>{if(typeof e>"u"||e===null||!t.length)return[];const n=Math.ceil((e-i+3)*Vl.ONE_SECOND_IN_TS);let s;for(s=0;s<t.length&&!(t[s].pts>n);s++);return t.slice(s)},P5=(t,e,i)=>{if(!e.length)return t;if(i)return e.slice();const n=e[0].pts;let s=0;for(s;s<t.length&&!(t[s].pts>=n);s++);return t.slice(0,s).concat(e)},z5=(t,e,i,n)=>{const s=Math.ceil((e-n)*Vl.ONE_SECOND_IN_TS),o=Math.ceil((i-n)*Vl.ONE_SECOND_IN_TS),l=t.slice();let c=t.length;for(;c--&&!(t[c].pts<=o););if(c===-1)return l;let h=c+1;for(;h--&&!(t[h].pts<=s););return h=Math.max(h,0),l.splice(h,c-h+1),l},F5=function(t,e){if(!t&&!e||!t&&e||t&&!e)return!1;if(t===e)return!0;const i=Object.keys(t).sort(),n=Object.keys(e).sort();if(i.length!==n.length)return!1;for(let s=0;s<i.length;s++){const o=i[s];if(o!==n[s]||t[o]!==e[o])return!1}return!0},q5=function(t,e,i){e=e||[];const n=[];let s=0;for(let o=0;o<e.length;o++){const l=e[o];if(t===l.timeline&&(n.push(o),s+=l.duration,s>i))return o}return n.length===0?0:n[n.length-1]},Rd=1,j5=500,Hw=t=>typeof t=="number"&&isFinite(t),Cf=1/60,H5=(t,e,i)=>t!=="main"||!e||!i?null:!i.hasAudio&&!i.hasVideo?"Neither audio nor video found in segment.":e.hasVideo&&!i.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!e.hasVideo&&i.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null,V5=(t,e,i)=>{let n=e-hn.BACK_BUFFER_LENGTH;t.length&&(n=Math.max(n,t.start(0)));const s=e-i;return Math.min(s,n)},Gu=t=>{const{startOfSegment:e,duration:i,segment:n,part:s,playlist:{mediaSequence:o,id:l,segments:c=[]},mediaIndex:h,partIndex:f,timeline:m}=t,_=c.length-1;let E="mediaIndex/partIndex increment";t.getMediaInfoForTime?E=`getMediaInfoForTime (${t.getMediaInfoForTime})`:t.isSyncRequest&&(E="getSyncSegmentCandidate (isSyncRequest)"),t.independent&&(E+=` with independent ${t.independent}`);const w=typeof f=="number",A=t.segment.uri?"segment":"pre-segment",C=w?$4({preloadSegment:n})-1:0;return`${A} [${o+h}/${o+_}]`+(w?` part [${f}/${C}]`:"")+` segment start/end [${n.start} => ${n.end}]`+(w?` part start/end [${s.start} => ${s.end}]`:"")+` startOfSegment [${e}] duration [${i}] timeline [${m}] selected by [${E}] playlist [${l}]`},Vw=t=>`${t}TimingInfo`,G5=({segmentTimeline:t,currentTimeline:e,startOfSegment:i,buffered:n,overrideCheck:s})=>!s&&t===e?null:t<e?i:n.length?n.end(n.length-1):i,Cy=({timelineChangeController:t,currentTimeline:e,segmentTimeline:i,loaderType:n,audioDisabled:s})=>{if(e===i)return!1;if(n==="audio"){const o=t.lastTimelineChange({type:"main"});return!o||o.to!==i}if(n==="main"&&s){const o=t.pendingTimelineChange({type:"audio"});return!(o&&o.to===i)}return!1},W5=t=>{if(!t)return!1;const e=t.pendingTimelineChange({type:"audio"}),i=t.pendingTimelineChange({type:"main"}),n=e&&i,s=n&&e.to!==i.to;return!!(n&&e.from!==-1&&i.from!==-1&&s)},X5=t=>{const e=t.timelineChangeController_.pendingTimelineChange({type:"audio"}),i=t.timelineChangeController_.pendingTimelineChange({type:"main"});return e&&i&&e.to<i.to},Ko=t=>{const e=t.pendingSegment_;if(!e)return;if(Cy({timelineChangeController:t.timelineChangeController_,currentTimeline:t.currentTimeline_,segmentTimeline:e.timeline,loaderType:t.loaderType_,audioDisabled:t.audioDisabled_})&&W5(t.timelineChangeController_)){if(X5(t)){t.timelineChangeController_.trigger("audioTimelineBehind");return}t.timelineChangeController_.trigger("fixBadTimelineChange")}},K5=t=>{let e=0;return["video","audio"].forEach(function(i){const n=t[`${i}TimingInfo`];if(!n)return;const{start:s,end:o}=n;let l;typeof s=="bigint"||typeof o=="bigint"?l=te.BigInt(o)-te.BigInt(s):typeof s=="number"&&typeof o=="number"&&(l=o-s),typeof l<"u"&&l>e&&(e=l)}),typeof e=="bigint"&&e<Number.MAX_SAFE_INTEGER&&(e=Number(e)),e},Gw=({segmentDuration:t,maxDuration:e})=>t?Math.round(t)>e+ra:!1,Y5=(t,e)=>{if(e!=="hls")return null;const i=K5({audioTimingInfo:t.audioTimingInfo,videoTimingInfo:t.videoTimingInfo});if(!i)return null;const n=t.playlist.targetDuration,s=Gw({segmentDuration:i,maxDuration:n*2}),o=Gw({segmentDuration:i,maxDuration:n}),l=`Segment with index ${t.mediaIndex} from playlist ${t.playlist.id} has a duration of ${i} when the reported duration is ${t.duration} and the target duration is ${n}. For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1`;return s||o?{severity:s?"warn":"info",message:l}:null},Hl=({type:t,segment:e})=>{if(!e)return;const i=!!(e.key||e.map&&e.map.ke),n=!!(e.map&&!e.map.bytes),s=e.startOfSegment===void 0?e.start:e.startOfSegment;return{type:t||e.type,uri:e.resolvedUri||e.uri,start:s,duration:e.duration,isEncrypted:i,isMediaInitialization:n}};class Ay extends _e.EventTarget{constructor(e,i={}){if(super(),!e)throw new TypeError("Initialization settings are required");if(typeof e.currentTime!="function")throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");this.bandwidth=e.bandwidth,this.throughput={rate:0,count:0},this.roundTrip=NaN,this.resetStats_(),this.mediaIndex=null,this.partIndex=null,this.hasPlayed_=e.hasPlayed,this.currentTime_=e.currentTime,this.seekable_=e.seekable,this.seeking_=e.seeking,this.duration_=e.duration,this.mediaSource_=e.mediaSource,this.vhs_=e.vhs,this.loaderType_=e.loaderType,this.currentMediaInfo_=void 0,this.startingMediaInfo_=void 0,this.segmentMetadataTrack_=e.segmentMetadataTrack,this.goalBufferLength_=e.goalBufferLength,this.sourceType_=e.sourceType,this.sourceUpdater_=e.sourceUpdater,this.inbandTextTracks_=e.inbandTextTracks,this.state_="INIT",this.timelineChangeController_=e.timelineChangeController,this.shouldSaveSegmentTimingInfo_=!0,this.parse708captions_=e.parse708captions,this.useDtsForTimestampOffset_=e.useDtsForTimestampOffset,this.captionServices_=e.captionServices,this.exactManifestTimings=e.exactManifestTimings,this.addMetadataToTextTrack=e.addMetadataToTextTrack,this.checkBufferTimeout_=null,this.error_=void 0,this.currentTimeline_=-1,this.shouldForceTimestampOffsetAfterResync_=!1,this.pendingSegment_=null,this.xhrOptions_=null,this.pendingSegments_=[],this.audioDisabled_=!1,this.isPendingTimestampOffset_=!1,this.gopBuffer_=[],this.timeMapping_=0,this.safeAppend_=!1,this.appendInitSegment_={audio:!0,video:!0},this.playlistOfLastInitSegment_={audio:null,video:null},this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_={id3:[],caption:[]},this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=null,this.activeInitSegmentId_=null,this.initSegments_={},this.cacheEncryptionKeys_=e.cacheEncryptionKeys,this.keyCache_={},this.decrypter_=e.decrypter,this.syncController_=e.syncController,this.syncPoint_={segmentIndex:0,time:0},this.transmuxer_=this.createTransmuxer_(),this.triggerSyncInfoUpdate_=()=>this.trigger("syncinfoupdate"),this.syncController_.on("syncinfoupdate",this.triggerSyncInfoUpdate_),this.mediaSource_.addEventListener("sourceopen",()=>{this.isEndOfStream_()||(this.ended_=!1)}),this.fetchAtBuffer_=!1,this.logger_=ns(`SegmentLoader[${this.loaderType_}]`),Object.defineProperty(this,"state",{get(){return this.state_},set(n){n!==this.state_&&(this.logger_(`${this.state_} -> ${n}`),this.state_=n,this.trigger("statechange"))}}),this.sourceUpdater_.on("ready",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():Ko(this)}),this.sourceUpdater_.on("codecschange",n=>{this.trigger(Li({type:"codecschange"},n))}),this.loaderType_==="main"&&this.timelineChangeController_.on("pendingtimelinechange",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():Ko(this)}),this.loaderType_==="audio"&&this.timelineChangeController_.on("timelinechange",n=>{this.trigger(Li({type:"timelinechange"},n)),this.hasEnoughInfoToLoad_()?this.processLoadQueue_():Ko(this),this.hasEnoughInfoToAppend_()?this.processCallQueue_():Ko(this)})}get mediaSequenceSync_(){return this.syncController_.getMediaSequenceSync(this.loaderType_)}createTransmuxer_(){return P0.createTransmuxer({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})}resetStats_(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0}dispose(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&te.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()}setAudio(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())}abort(){if(this.state!=="WAITING"){this.pendingSegment_&&(this.pendingSegment_=null),this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_);return}this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()}abort_(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,te.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null}checkForAbort_(e){return this.state==="APPENDING"&&!this.pendingSegment_?(this.state="READY",!0):!this.pendingSegment_||this.pendingSegment_.requestId!==e}error(e){return typeof e<"u"&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_}endOfStream(){this.ended_=!0,this.transmuxer_&&P0.reset(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")}buffered_(){const e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return pn();if(this.loaderType_==="main"){const{hasAudio:i,hasVideo:n,isMuxed:s}=e;if(n&&i&&!this.audioDisabled_&&!s)return this.sourceUpdater_.buffered();if(n)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()}initSegmentForMap(e,i=!1){if(!e)return null;const n=rp(e);let s=this.initSegments_[n];return i&&!s&&e.bytes&&(this.initSegments_[n]=s={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),s||e}segmentKey(e,i=!1){if(!e)return null;const n=K4(e);let s=this.keyCache_[n];this.cacheEncryptionKeys_&&i&&!s&&e.bytes&&(this.keyCache_[n]=s={resolvedUri:e.resolvedUri,bytes:e.bytes});const o={resolvedUri:(s||e).resolvedUri};return s&&(o.bytes=s.bytes),o}couldBeginLoading_(){return this.playlist_&&!this.paused()}load(){if(this.monitorBuffer_(),!!this.playlist_){if(this.state==="INIT"&&this.couldBeginLoading_())return this.init_();!this.couldBeginLoading_()||this.state!=="READY"&&this.state!=="INIT"||(this.state="READY")}}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}playlist(e,i={}){if(!e||this.playlist_&&this.playlist_.endList&&e.endList&&this.playlist_.uri===e.uri)return;const n=this.playlist_,s=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=i,this.state==="INIT"&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},this.loaderType_==="main"&&this.syncController_.setDateTimeMappingForStart(e));let o=null;if(n&&(n.id?o=n.id:n.uri&&(o=n.uri)),this.logger_(`playlist update [${o} => ${e.id||e.uri}]`),this.mediaSequenceSync_&&(this.mediaSequenceSync_.update(e,this.currentTime_()),this.logger_(`Playlist update:
currentTime: ${this.currentTime_()}
bufferedEnd: ${L0(this.buffered_())}
`,this.mediaSequenceSync_.diagnostics)),this.trigger("syncinfoupdate"),this.state==="INIT"&&this.couldBeginLoading_())return this.init_();if(!n||n.uri!==e.uri){this.mediaIndex!==null&&(!e.endList&&typeof e.partTargetDuration=="number"?this.resetLoader():this.resyncLoader()),this.currentMediaInfo_=void 0,this.trigger("playlistupdate");return}const l=e.mediaSequence-n.mediaSequence;if(this.logger_(`live window shift [${l}]`),this.mediaIndex!==null)if(this.mediaIndex-=l,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{const c=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!c.parts||!c.parts.length||!c.parts[this.partIndex])){const h=this.mediaIndex;this.logger_(`currently processing part (index ${this.partIndex}) no longer exists.`),this.resetLoader(),this.mediaIndex=h}}s&&(s.mediaIndex-=l,s.mediaIndex<0?(s.mediaIndex=null,s.partIndex=null):(s.mediaIndex>=0&&(s.segment=e.segments[s.mediaIndex]),s.partIndex>=0&&s.segment.parts&&(s.part=s.segment.parts[s.partIndex]))),this.syncController_.saveExpiredSegmentInfo(n,e)}pause(){this.checkBufferTimeout_&&(te.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}paused(){return this.checkBufferTimeout_===null}resetEverything(e){this.ended_=!1,this.activeInitSegmentId_=null,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))}resetLoader(){this.fetchAtBuffer_=!1,this.mediaSequenceSync_&&this.mediaSequenceSync_.resetAppendedStatus(),this.resyncLoader()}resyncLoader(){this.transmuxer_&&P0.reset(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1;const e=this.currentMediaInfo_&&this.currentMediaInfo_.isFmp4;this.sourceType_==="hls"&&!e&&(this.shouldForceTimestampOffsetAfterResync_=!0),this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}remove(e,i,n=()=>{},s=!1){if(i===1/0&&(i=this.duration_()),i<=e){this.logger_("skipping remove because end ${end} is <= start ${start}");return}if(!this.sourceUpdater_||!this.getMediaInfo_()){this.logger_("skipping remove because no source updater or starting media info");return}let o=1;const l=()=>{o--,o===0&&n()};(s||!this.audioDisabled_)&&(o++,this.sourceUpdater_.removeAudio(e,i,l)),(s||this.loaderType_==="main")&&(this.gopBuffer_=z5(this.gopBuffer_,e,i,this.timeMapping_),o++,this.sourceUpdater_.removeVideo(e,i,l));for(const c in this.inbandTextTracks_)zd(e,i,this.inbandTextTracks_[c]);zd(e,i,this.segmentMetadataTrack_),l()}monitorBuffer_(){this.checkBufferTimeout_&&te.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=te.setTimeout(this.monitorBufferTick_.bind(this),1)}monitorBufferTick_(){this.state==="READY"&&this.fillBuffer_(),this.checkBufferTimeout_&&te.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=te.setTimeout(this.monitorBufferTick_.bind(this),j5)}fillBuffer_(){if(this.sourceUpdater_.updating())return;const e=this.chooseNextRequest_();if(!e)return;const i={segmentInfo:Hl({type:this.loaderType_,segment:e})};this.trigger({type:"segmentselected",metadata:i}),typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e)}isEndOfStream_(e=this.mediaIndex,i=this.playlist_,n=this.partIndex){if(!i||!this.mediaSource_)return!1;const s=typeof e=="number"&&i.segments[e],o=e+1===i.segments.length,l=!s||!s.parts||n+1===s.parts.length;return i.endList&&this.mediaSource_.readyState==="open"&&o&&l}chooseNextRequest_(){const e=this.buffered_(),i=L0(e)||0,n=U_(e,this.currentTime_()),s=!this.hasPlayed_()&&n>=1,o=n>=this.goalBufferLength_(),l=this.playlist_.segments;if(!l.length||s||o)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_(),this.loaderType_);const c={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:!this.syncPoint_};if(c.isSyncRequest)c.mediaIndex=q5(this.currentTimeline_,l,i),this.logger_(`choose next request. Can not find sync point. Fallback to media Index: ${c.mediaIndex}`);else if(this.mediaIndex!==null){const E=l[this.mediaIndex],w=typeof this.partIndex=="number"?this.partIndex:-1;c.startOfSegment=E.end?E.end:i,E.parts&&E.parts[w+1]?(c.mediaIndex=this.mediaIndex,c.partIndex=w+1):c.mediaIndex=this.mediaIndex+1}else{let E,w,A;const C=this.fetchAtBuffer_?i:this.currentTime_();if(this.mediaSequenceSync_&&this.logger_(`chooseNextRequest_ request after Quality Switch:
For TargetTime: ${C}.
CurrentTime: ${this.currentTime_()}
BufferedEnd: ${i}
Fetch At Buffer: ${this.fetchAtBuffer_}
`,this.mediaSequenceSync_.diagnostics),this.mediaSequenceSync_&&this.mediaSequenceSync_.isReliable){const M=this.getSyncInfoFromMediaSequenceSync_(C);if(!M){const O="No sync info found while using media sequence sync";return this.error({message:O,metadata:{errorType:_e.Error.StreamingFailedToSelectNextSegment,error:new Error(O)}}),this.logger_("chooseNextRequest_ - no sync info found using media sequence sync"),null}this.logger_(`chooseNextRequest_ mediaSequence syncInfo (${M.start} --> ${M.end})`),E=M.segmentIndex,w=M.partIndex,A=M.start}else{this.logger_("chooseNextRequest_ - fallback to a regular segment selection algorithm, based on a syncPoint.");const M=cr.getMediaInfoForTime({exactManifestTimings:this.exactManifestTimings,playlist:this.playlist_,currentTime:C,startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time});E=M.segmentIndex,w=M.partIndex,A=M.startTime}c.getMediaInfoForTime=this.fetchAtBuffer_?`bufferedEnd ${C}`:`currentTime ${C}`,c.mediaIndex=E,c.startOfSegment=A,c.partIndex=w,this.logger_(`choose next request. Playlist switched and we have a sync point. Media Index: ${c.mediaIndex} `)}const h=l[c.mediaIndex];let f=h&&typeof c.partIndex=="number"&&h.parts&&h.parts[c.partIndex];if(!h||typeof c.partIndex=="number"&&!f)return null;typeof c.partIndex!="number"&&h.parts&&(c.partIndex=0,f=h.parts[0]);const m=this.vhs_.playlists&&this.vhs_.playlists.main&&this.vhs_.playlists.main.independentSegments||this.playlist_.independentSegments;if(!n&&f&&!m&&!f.independent)if(c.partIndex===0){const E=l[c.mediaIndex-1],w=E.parts&&E.parts.length&&E.parts[E.parts.length-1];w&&w.independent&&(c.mediaIndex-=1,c.partIndex=E.parts.length-1,c.independent="previous segment")}else h.parts[c.partIndex-1].independent&&(c.partIndex-=1,c.independent="previous part");const _=this.mediaSource_&&this.mediaSource_.readyState==="ended";return c.mediaIndex>=l.length-1&&_&&!this.seeking_()?null:(this.shouldForceTimestampOffsetAfterResync_&&(this.shouldForceTimestampOffsetAfterResync_=!1,c.forceTimestampOffset=!0,this.logger_("choose next request. Force timestamp offset after loader resync")),this.generateSegmentInfo_(c))}getSyncInfoFromMediaSequenceSync_(e){if(!this.mediaSequenceSync_)return null;const i=Math.max(e,this.mediaSequenceSync_.start);e!==i&&this.logger_(`getSyncInfoFromMediaSequenceSync_. Pulled target time from ${e} to ${i}`);const n=this.mediaSequenceSync_.getSyncInfoForTime(i);if(!n)return null;if(!n.isAppended)return n;const s=this.mediaSequenceSync_.getSyncInfoForTime(n.end);return s?(s.isAppended&&this.logger_("getSyncInfoFromMediaSequenceSync_: We encounter unexpected scenario where next media sequence sync info is also appended!"),s):null}generateSegmentInfo_(e){const{independent:i,playlist:n,mediaIndex:s,startOfSegment:o,isSyncRequest:l,partIndex:c,forceTimestampOffset:h,getMediaInfoForTime:f}=e,m=n.segments[s],_=typeof c=="number"&&m.parts[c],E={requestId:"segment-loader-"+Math.random(),uri:_&&_.resolvedUri||m.resolvedUri,mediaIndex:s,partIndex:_?c:null,isSyncRequest:l,startOfSegment:o,playlist:n,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:m.timeline,duration:_&&_.duration||m.duration,segment:m,part:_,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:f,independent:i},w=typeof h<"u"?h:this.isPendingTimestampOffset_;E.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:m.timeline,currentTimeline:this.currentTimeline_,startOfSegment:o,buffered:this.buffered_(),overrideCheck:w});const A=L0(this.sourceUpdater_.audioBuffered());return typeof A=="number"&&(E.audioAppendStart=A-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(E.gopsToAlignWith=U5(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),E}timestampOffsetForSegment_(e){return G5(e)}earlyAbortWhenNeeded_(e){if(this.vhs_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH||Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return;const i=this.currentTime_(),n=e.bandwidth,s=this.pendingSegment_.duration,o=cr.estimateSegmentRequestTime(s,n,this.playlist_,e.bytesReceived),l=pN(this.buffered_(),i,this.vhs_.tech_.playbackRate())-1;if(o<=l)return;const c=A5({main:this.vhs_.playlists.main,currentTime:i,bandwidth:n,duration:this.duration_(),segmentDuration:s,timeUntilRebuffer:l,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(!c)return;const f=o-l-c.rebufferingImpact;let m=.5;l<=ra&&(m=1),!(!c.playlist||c.playlist.uri===this.playlist_.uri||f<m)&&(this.bandwidth=c.playlist.attributes.BANDWIDTH*hn.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}handleAbort_(e){this.logger_(`Aborting ${Gu(e)}`),this.mediaRequestsAborted+=1}handleProgress_(e,i){this.earlyAbortWhenNeeded_(i.stats),!this.checkForAbort_(i.requestId)&&this.trigger("progress")}handleTrackInfo_(e,i){const{hasAudio:n,hasVideo:s}=i,o={segmentInfo:Hl({type:this.loaderType_,segment:e}),trackInfo:{hasAudio:n,hasVideo:s}};this.trigger({type:"segmenttransmuxingtrackinfoavailable",metadata:o}),this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)&&(this.checkForIllegalMediaSwitch(i)||(i=i||{},F5(this.currentMediaInfo_,i)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=i,this.currentMediaInfo_=i,this.logger_("trackinfo update",i),this.trigger("trackinfo")),!this.checkForAbort_(e.requestId)&&(this.pendingSegment_.trackInfo=i,this.hasEnoughInfoToAppend_()?this.processCallQueue_():Ko(this))))}handleTimingInfo_(e,i,n,s){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;const o=this.pendingSegment_,l=Vw(i);o[l]=o[l]||{},o[l][n]=s,this.logger_(`timinginfo: ${i} - ${n} - ${s}`),this.hasEnoughInfoToAppend_()?this.processCallQueue_():Ko(this)}handleCaptions_(e,i){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(i.length===0){this.logger_("SegmentLoader received no captions from a caption event");return}if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,i));return}const s=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),o={};i.forEach(l=>{o[l.stream]=o[l.stream]||{startTime:1/0,captions:[],endTime:0};const c=o[l.stream];c.startTime=Math.min(c.startTime,l.startTime+s),c.endTime=Math.max(c.endTime,l.endTime+s),c.captions.push(l)}),Object.keys(o).forEach(l=>{const{startTime:c,endTime:h,captions:f}=o[l],m=this.inbandTextTracks_;this.logger_(`adding cues from ${c} -> ${h} for ${l}`),$5(m,this.vhs_.tech_,l),zd(c,h,m[l]),O5({captionArray:f,inbandTextTracks:m,timestampOffset:s})}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}handleId3_(e,i,n){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,i,n));return}this.addMetadataToTextTrack(n,i,this.duration_())}processMetadataQueue_(){this.metadataQueue_.id3.forEach(e=>e()),this.metadataQueue_.caption.forEach(e=>e()),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]}processCallQueue_(){const e=this.callQueue_;this.callQueue_=[],e.forEach(i=>i())}processLoadQueue_(){const e=this.loadQueue_;this.loadQueue_=[],e.forEach(i=>i())}hasEnoughInfoToLoad_(){if(this.loaderType_!=="audio")return!0;const e=this.pendingSegment_;return e?this.getCurrentMediaInfo_()?!Cy({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}):!0:!1}getCurrentMediaInfo_(e=this.pendingSegment_){return e&&e.trackInfo||this.currentMediaInfo_}getMediaInfo_(e=this.pendingSegment_){return this.getCurrentMediaInfo_(e)||this.startingMediaInfo_}getPendingSegmentPlaylist(){return this.pendingSegment_?this.pendingSegment_.playlist:null}hasEnoughInfoToAppend_(){if(!this.sourceUpdater_.ready()||this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;const e=this.pendingSegment_,i=this.getCurrentMediaInfo_();if(!e||!i)return!1;const{hasAudio:n,hasVideo:s,isMuxed:o}=i;return!(s&&!e.videoTimingInfo||n&&!this.audioDisabled_&&!o&&!e.audioTimingInfo||Cy({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}handleData_(e,i){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(this.callQueue_.length||!this.hasEnoughInfoToAppend_()){Ko(this),this.callQueue_.push(this.handleData_.bind(this,e,i));return}const n=this.pendingSegment_;if(this.setTimeMapping_(n.timeline),this.updateMediaSecondsLoaded_(n.part||n.segment),this.mediaSource_.readyState!=="closed"){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),n.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),n.isFmp4=e.isFmp4,n.timingInfo=n.timingInfo||{},n.isFmp4)this.trigger("fmp4"),n.timingInfo.start=n[Vw(i.type)].start;else{const s=this.getCurrentMediaInfo_(),o=this.loaderType_==="main"&&s&&s.hasVideo;let l;o&&(l=n.videoTimingInfo.start),n.timingInfo.start=this.trueSegmentStart_({currentStart:n.timingInfo.start,playlist:n.playlist,mediaIndex:n.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:o,firstVideoFrameTimeForData:l,videoTimingInfo:n.videoTimingInfo,audioTimingInfo:n.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(n,i.type),this.updateSourceBufferTimestampOffset_(n),n.isSyncRequest){this.updateTimingInfoEnd_(n),this.syncController_.saveSegmentTimingInfo({segmentInfo:n,shouldSaveTimelineMapping:this.loaderType_==="main"});const s=this.chooseNextRequest_();if(s.mediaIndex!==n.mediaIndex||s.partIndex!==n.partIndex){this.logger_("sync segment was incorrect, not appending");return}this.logger_("sync segment was correct, appending")}n.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(n,i)}}updateAppendInitSegmentStatus(e,i){this.loaderType_==="main"&&typeof e.timestampOffset=="number"&&!e.changedTimestampOffset&&(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[i]!==e.playlist&&(this.appendInitSegment_[i]=!0)}getInitSegmentAndUpdateState_({type:e,initSegment:i,map:n,playlist:s}){if(n){const o=rp(n);if(this.activeInitSegmentId_===o)return null;i=this.initSegmentForMap(n,!0).bytes,this.activeInitSegmentId_=o}return i&&this.appendInitSegment_[e]?(this.playlistOfLastInitSegment_[e]=s,this.appendInitSegment_[e]=!1,this.activeInitSegmentId_=null,i):null}handleQuotaExceededError_({segmentInfo:e,type:i,bytes:n},s){const o=this.sourceUpdater_.audioBuffered(),l=this.sourceUpdater_.videoBuffered();o.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+Gl(o).join(", ")),l.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+Gl(l).join(", "));const c=o.length?o.start(0):0,h=o.length?o.end(o.length-1):0,f=l.length?l.start(0):0,m=l.length?l.end(l.length-1):0;if(h-c<=Rd&&m-f<=Rd){this.logger_(`On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: ${n.byteLength}, audio buffer: ${Gl(o).join(", ")}, video buffer: ${Gl(l).join(", ")}, `),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),this.trigger("error");return}this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:e,type:i,bytes:n}));const E=this.currentTime_()-Rd;this.logger_(`On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to ${E}`),this.remove(0,E,()=>{this.logger_(`On QUOTA_EXCEEDED_ERR, retrying append in ${Rd}s`),this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=te.setTimeout(()=>{this.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),this.quotaExceededErrorRetryTimeout_=null,this.processCallQueue_()},Rd*1e3)},!0)}handleAppendError_({segmentInfo:e,type:i,bytes:n},s){if(s){if(s.code===F4){this.handleQuotaExceededError_({segmentInfo:e,type:i,bytes:n});return}this.logger_("Received non QUOTA_EXCEEDED_ERR on append",s),this.error({message:`${i} append of ${n.length}b failed for segment #${e.mediaIndex} in playlist ${e.playlist.id}`,metadata:{errorType:_e.Error.StreamingFailedToAppendSegment}}),this.trigger("appenderror")}}appendToSourceBuffer_({segmentInfo:e,type:i,initSegment:n,data:s,bytes:o}){if(!o){const c=[s];let h=s.byteLength;n&&(c.unshift(n),h+=n.byteLength),o=k5({bytes:h,segments:c})}const l={segmentInfo:Hl({type:this.loaderType_,segment:e})};this.trigger({type:"segmentappendstart",metadata:l}),this.sourceUpdater_.appendBuffer({segmentInfo:e,type:i,bytes:o},this.handleAppendError_.bind(this,{segmentInfo:e,type:i,bytes:o}))}handleSegmentTimingInfo_(e,i,n){if(!this.pendingSegment_||i!==this.pendingSegment_.requestId)return;const s=this.pendingSegment_.segment,o=`${e}TimingInfo`;s[o]||(s[o]={}),s[o].transmuxerPrependedSeconds=n.prependedContentDuration||0,s[o].transmuxedPresentationStart=n.start.presentation,s[o].transmuxedDecodeStart=n.start.decode,s[o].transmuxedPresentationEnd=n.end.presentation,s[o].transmuxedDecodeEnd=n.end.decode,s[o].baseMediaDecodeTime=n.baseMediaDecodeTime}appendData_(e,i){const{type:n,data:s}=i;if(!s||!s.byteLength||n==="audio"&&this.audioDisabled_)return;const o=this.getInitSegmentAndUpdateState_({type:n,initSegment:i.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:n,initSegment:o,data:s})}loadSegment_(e){if(this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),typeof e.timestampOffset=="number"&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),!this.hasEnoughInfoToLoad_()){Ko(this),this.loadQueue_.push(()=>{const i=Li({},e,{forceTimestampOffset:!0});Li(e,this.generateSegmentInfo_(i)),this.isPendingTimestampOffset_=!1,this.updateTransmuxerAndRequestSegment_(e)});return}this.updateTransmuxerAndRequestSegment_(e)}updateTransmuxerAndRequestSegment_(e){this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));const i=this.createSimplifiedSegmentObj_(e),n=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),s=this.mediaIndex!==null,o=e.timeline!==this.currentTimeline_&&e.timeline>0,l=n||s&&o;this.logger_(`Requesting
${hk(e.uri)}
${Gu(e)}`),i.map&&!i.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=w5({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:i,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:l,endedTimelineFn:()=>{this.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:({message:c,level:h,stream:f})=>{this.logger_(`${Gu(e)} logged from transmuxer stream ${f} as a ${h}: ${c}`)},triggerSegmentEventFn:({type:c,segment:h,keyInfo:f,trackInfo:m,timingInfo:_})=>{const w={segmentInfo:Hl({segment:h})};f&&(w.keyInfo=f),m&&(w.trackInfo=m),_&&(w.timingInfo=_),this.trigger({type:c,metadata:w})}})}trimBackBuffer_(e){const i=V5(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);i>0&&this.remove(0,i)}createSimplifiedSegmentObj_(e){const i=e.segment,n=e.part,s=e.segment.key||e.segment.map&&e.segment.map.key,o=e.segment.map&&!e.segment.map.bytes,l={resolvedUri:n?n.resolvedUri:i.resolvedUri,byterange:n?n.byterange:i.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part,type:this.loaderType_,start:e.startOfSegment,duration:e.duration,isEncrypted:s,isMediaInitialization:o},c=e.playlist.segments[e.mediaIndex-1];if(c&&c.timeline===i.timeline&&(c.videoTimingInfo?l.baseStartTime=c.videoTimingInfo.transmuxedDecodeEnd:c.audioTimingInfo&&(l.baseStartTime=c.audioTimingInfo.transmuxedDecodeEnd)),i.key){const h=i.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);l.key=this.segmentKey(i.key),l.key.iv=h}return i.map&&(l.map=this.initSegmentForMap(i.map)),l}saveTransferStats_(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)}saveBandwidthRelatedStats_(e,i){if(this.pendingSegment_.byteLength=i.bytesReceived,e<Cf){this.logger_(`Ignoring segment's bandwidth because its duration of ${e} is less than the min to record ${Cf}`);return}const n={bandwidthInfo:{from:this.bandwidth,to:i.bandwidth}};this.trigger({type:"bandwidthupdated",metadata:n}),this.bandwidth=i.bandwidth,this.roundTrip=i.roundTripTime}handleTimeout_(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate"),this.trigger("timeout")}segmentRequestFinished_(e,i,n){if(this.callQueue_.length){this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,i,n));return}if(this.saveTransferStats_(i.stats),!this.pendingSegment_||i.requestId!==this.pendingSegment_.requestId)return;if(e){if(this.pendingSegment_=null,this.state="READY",e.code===aa.ABORTED)return;if(this.pause(),e.code===aa.TIMEOUT){this.handleTimeout_();return}this.mediaRequestsErrored+=1,this.error(e),this.trigger("error");return}const s=this.pendingSegment_;this.saveBandwidthRelatedStats_(s.duration,i.stats),s.endOfAllRequests=i.endOfAllRequests,n.gopInfo&&(this.gopBuffer_=P5(this.gopBuffer_,n.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(s)}setTimeMapping_(e){const i=this.syncController_.mappingForTimeline(e);i!==null&&(this.timeMapping_=i)}updateMediaSecondsLoaded_(e){typeof e.start=="number"&&typeof e.end=="number"?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration}shouldUpdateTransmuxerTimestampOffset_(e){return e===null?!1:this.loaderType_==="main"&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset()}trueSegmentStart_({currentStart:e,playlist:i,mediaIndex:n,firstVideoFrameTimeForData:s,currentVideoTimestampOffset:o,useVideoTimingInfo:l,videoTimingInfo:c,audioTimingInfo:h}){if(typeof e<"u")return e;if(!l)return h.start;const f=i.segments[n-1];return n===0||!f||typeof f.start>"u"||f.end!==s+o?s:c.start}waitForAppendsToComplete_(e){const i=this.getCurrentMediaInfo_(e);if(!i){this.error({message:"No starting media returned, likely due to an unsupported media format.",playlistExclusionDuration:1/0}),this.trigger("error");return}const{hasAudio:n,hasVideo:s,isMuxed:o}=i,l=this.loaderType_==="main"&&s,c=!this.audioDisabled_&&n&&!o;if(e.waitingOnAppends=0,!e.hasAppendedData_){!e.timingInfo&&typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),this.checkAppendsDone_(e);return}l&&e.waitingOnAppends++,c&&e.waitingOnAppends++,l&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),c&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))}checkAppendsDone_(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,e.waitingOnAppends===0&&this.handleAppendsDone_())}checkForIllegalMediaSwitch(e){const i=H5(this.loaderType_,this.getCurrentMediaInfo_(),e);return i?(this.error({message:i,playlistExclusionDuration:1/0}),this.trigger("error"),!0):!1}updateSourceBufferTimestampOffset_(e){if(e.timestampOffset===null||typeof e.timingInfo.start!="number"||e.changedTimestampOffset||this.loaderType_!=="main")return;let i=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),i=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),i=!0),i&&this.trigger("timestampoffset")}getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e,audioTimingInfo:i,timingInfo:n}){return this.useDtsForTimestampOffset_?e&&typeof e.transmuxedDecodeStart=="number"?e.transmuxedDecodeStart:i&&typeof i.transmuxedDecodeStart=="number"?i.transmuxedDecodeStart:n.start:n.start}updateTimingInfoEnd_(e){e.timingInfo=e.timingInfo||{};const i=this.getMediaInfo_(),s=this.loaderType_==="main"&&i&&i.hasVideo&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;s&&(e.timingInfo.end=typeof s.end=="number"?s.end:s.start+e.duration)}handleAppendsDone_(){if(this.pendingSegment_){const h={segmentInfo:Hl({type:this.loaderType_,segment:this.pendingSegment_})};this.trigger({type:"appendsdone",metadata:h})}if(!this.pendingSegment_){this.state="READY",this.paused()||this.monitorBuffer_();return}const e=this.pendingSegment_;e.part&&e.part.syncInfo?e.part.syncInfo.markAppended():e.segment.syncInfo&&e.segment.syncInfo.markAppended(),this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:this.loaderType_==="main"});const i=Y5(e,this.sourceType_);if(i&&(i.severity==="warn"?_e.log.warn(i.message):this.logger_(i.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",e.isSyncRequest&&(this.trigger("syncinfoupdate"),!e.hasAppendedData_)){this.logger_(`Throwing away un-appended sync request ${Gu(e)}`);return}this.logger_(`Appended ${Gu(e)}`),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),this.loaderType_==="main"&&!this.audioDisabled_&&this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");const n=e.segment,s=e.part,o=n.end&&this.currentTime_()-n.end>e.playlist.targetDuration*3,l=s&&s.end&&this.currentTime_()-s.end>e.playlist.partTargetDuration*3;if(o||l){this.logger_(`bad ${o?"segment":"part"} ${Gu(e)}`),this.resetEverything();return}this.mediaIndex!==null&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}recordThroughput_(e){if(e.duration<Cf){this.logger_(`Ignoring segment's throughput because its duration of ${e.duration} is less than the min to record ${Cf}`);return}const i=this.throughput.rate,n=Date.now()-e.endOfAllRequests+1,s=Math.floor(e.byteLength/n*8*1e3);this.throughput.rate+=(s-i)/++this.throughput.count}addSegmentMetadataCue_(e){if(!this.segmentMetadataTrack_)return;const i=e.segment,n=i.start,s=i.end;if(!Hw(n)||!Hw(s))return;zd(n,s,this.segmentMetadataTrack_);const o=te.WebKitDataCue||te.VTTCue,l={custom:i.custom,dateTimeObject:i.dateTimeObject,dateTimeString:i.dateTimeString,programDateTime:i.programDateTime,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:n,end:s},c=JSON.stringify(l),h=new o(n,s,c);h.value=l,this.segmentMetadataTrack_.addCue(h)}}function Ya(){}const fk=function(t){return typeof t!="string"?t:t.replace(/./,e=>e.toUpperCase())},Q5=["video","audio"],Dy=(t,e)=>{const i=e[`${t}Buffer`];return i&&i.updating||e.queuePending[t]},Z5=(t,e)=>{for(let i=0;i<e.length;i++){const n=e[i];if(n.type==="mediaSource")return null;if(n.type===t)return i}return null},ac=(t,e)=>{if(e.queue.length===0)return;let i=0,n=e.queue[i];if(n.type==="mediaSource"){!e.updating()&&e.mediaSource.readyState!=="closed"&&(e.queue.shift(),n.action(e),n.doneFn&&n.doneFn(),ac("audio",e),ac("video",e));return}if(t!=="mediaSource"&&!(!e.ready()||e.mediaSource.readyState==="closed"||Dy(t,e))){if(n.type!==t){if(i=Z5(t,e.queue),i===null)return;n=e.queue[i]}if(e.queue.splice(i,1),e.queuePending[t]=n,n.action(t,e),!n.doneFn){e.queuePending[t]=null,ac(t,e);return}}},pk=(t,e)=>{const i=e[`${t}Buffer`],n=fk(t);i&&(i.removeEventListener("updateend",e[`on${n}UpdateEnd_`]),i.removeEventListener("error",e[`on${n}Error_`]),e.codecs[t]=null,e[`${t}Buffer`]=null)},ia=(t,e)=>t&&e&&Array.prototype.indexOf.call(t.sourceBuffers,e)!==-1,Cr={appendBuffer:(t,e,i)=>(n,s)=>{const o=s[`${n}Buffer`];if(ia(s.mediaSource,o)){s.logger_(`Appending segment ${e.mediaIndex}'s ${t.length} bytes to ${n}Buffer`);try{o.appendBuffer(t)}catch(l){s.logger_(`Error with code ${l.code} `+(l.code===F4?"(QUOTA_EXCEEDED_ERR) ":"")+`when appending segment ${e.mediaIndex} to ${n}Buffer`),s.queuePending[n]=null,i(l)}}},remove:(t,e)=>(i,n)=>{const s=n[`${i}Buffer`];if(ia(n.mediaSource,s)){n.logger_(`Removing ${t} to ${e} from ${i}Buffer`);try{s.remove(t,e)}catch{n.logger_(`Remove ${t} to ${e} from ${i}Buffer failed`)}}},timestampOffset:t=>(e,i)=>{const n=i[`${e}Buffer`];ia(i.mediaSource,n)&&(i.logger_(`Setting ${e}timestampOffset to ${t}`),n.timestampOffset=t)},callback:t=>(e,i)=>{t()},endOfStream:t=>e=>{if(e.mediaSource.readyState==="open"){e.logger_(`Calling mediaSource endOfStream(${t||""})`);try{e.mediaSource.endOfStream(t)}catch(i){_e.log.warn("Failed to call media source endOfStream",i)}}},duration:t=>e=>{e.logger_(`Setting mediaSource duration to ${t}`);try{e.mediaSource.duration=t}catch(i){_e.log.warn("Failed to set media source duration",i)}},abort:()=>(t,e)=>{if(e.mediaSource.readyState!=="open")return;const i=e[`${t}Buffer`];if(ia(e.mediaSource,i)){e.logger_(`calling abort on ${t}Buffer`);try{i.abort()}catch(n){_e.log.warn(`Failed to abort on ${t}Buffer`,n)}}},addSourceBuffer:(t,e)=>i=>{const n=fk(t),s=uc(e);i.logger_(`Adding ${t}Buffer with codec ${e} to mediaSource`);const o=i.mediaSource.addSourceBuffer(s);o.addEventListener("updateend",i[`on${n}UpdateEnd_`]),o.addEventListener("error",i[`on${n}Error_`]),i.codecs[t]=e,i[`${t}Buffer`]=o},removeSourceBuffer:t=>e=>{const i=e[`${t}Buffer`];if(pk(t,e),!!ia(e.mediaSource,i)){e.logger_(`Removing ${t}Buffer with codec ${e.codecs[t]} from mediaSource`);try{e.mediaSource.removeSourceBuffer(i)}catch(n){_e.log.warn(`Failed to removeSourceBuffer ${t}Buffer`,n)}}},changeType:t=>(e,i)=>{const n=i[`${e}Buffer`],s=uc(t);if(!ia(i.mediaSource,n))return;const o=t.substring(0,t.indexOf(".")),l=i.codecs[e];if(l.substring(0,l.indexOf("."))===o)return;const h={codecsChangeInfo:{from:l,to:t}};i.trigger({type:"codecschange",metadata:h}),i.logger_(`changing ${e}Buffer codec from ${l} to ${t}`);try{n.changeType(s),i.codecs[e]=t}catch(f){h.errorType=_e.Error.StreamingCodecsChangeError,h.error=f,f.metadata=h,i.error_=f,i.trigger("error"),_e.log.warn(`Failed to changeType on ${e}Buffer`,f)}}},Ar=({type:t,sourceUpdater:e,action:i,doneFn:n,name:s})=>{e.queue.push({type:t,action:i,doneFn:n,name:s}),ac(t,e)},Ww=(t,e)=>i=>{const n=e[`${t}Buffered`](),s=dN(n);if(e.logger_(`received "updateend" event for ${t} Source Buffer: `,s),e.queuePending[t]){const o=e.queuePending[t].doneFn;e.queuePending[t]=null,o&&o(e[`${t}Error_`])}ac(t,e)};class mk extends _e.EventTarget{constructor(e){super(),this.mediaSource=e,this.sourceopenListener_=()=>ac("mediaSource",this),this.mediaSource.addEventListener("sourceopen",this.sourceopenListener_),this.logger_=ns("SourceUpdater"),this.audioTimestampOffset_=0,this.videoTimestampOffset_=0,this.queue=[],this.queuePending={audio:null,video:null},this.delayedAudioAppendQueue_=[],this.videoAppendQueued_=!1,this.codecs={},this.onVideoUpdateEnd_=Ww("video",this),this.onAudioUpdateEnd_=Ww("audio",this),this.onVideoError_=i=>{this.videoError_=i},this.onAudioError_=i=>{this.audioError_=i},this.createdSourceBuffers_=!1,this.initializedEme_=!1,this.triggeredReady_=!1}initializedEme(){this.initializedEme_=!0,this.triggerReady()}hasCreatedSourceBuffers(){return this.createdSourceBuffers_}hasInitializedAnyEme(){return this.initializedEme_}ready(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()}createSourceBuffers(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())}triggerReady(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))}addSourceBuffer(e,i){Ar({type:"mediaSource",sourceUpdater:this,action:Cr.addSourceBuffer(e,i),name:"addSourceBuffer"})}abort(e){Ar({type:e,sourceUpdater:this,action:Cr.abort(e),name:"abort"})}removeSourceBuffer(e){if(!this.canRemoveSourceBuffer()){_e.log.error("removeSourceBuffer is not supported!");return}Ar({type:"mediaSource",sourceUpdater:this,action:Cr.removeSourceBuffer(e),name:"removeSourceBuffer"})}canRemoveSourceBuffer(){return!_e.browser.IS_FIREFOX&&te.MediaSource&&te.MediaSource.prototype&&typeof te.MediaSource.prototype.removeSourceBuffer=="function"}static canChangeType(){return te.SourceBuffer&&te.SourceBuffer.prototype&&typeof te.SourceBuffer.prototype.changeType=="function"}canChangeType(){return this.constructor.canChangeType()}changeType(e,i){if(!this.canChangeType()){_e.log.error("changeType is not supported!");return}Ar({type:e,sourceUpdater:this,action:Cr.changeType(i),name:"changeType"})}addOrChangeSourceBuffers(e){if(!e||typeof e!="object"||Object.keys(e).length===0)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach(i=>{const n=e[i];if(!this.hasCreatedSourceBuffers())return this.addSourceBuffer(i,n);this.canChangeType()&&this.changeType(i,n)})}appendBuffer(e,i){const{segmentInfo:n,type:s,bytes:o}=e;if(this.processedAppend_=!0,s==="audio"&&this.videoBuffer&&!this.videoAppendQueued_){this.delayedAudioAppendQueue_.push([e,i]),this.logger_(`delayed audio append of ${o.length} until video append`);return}const l=i;if(Ar({type:s,sourceUpdater:this,action:Cr.appendBuffer(o,n||{mediaIndex:-1},l),doneFn:i,name:"appendBuffer"}),s==="video"){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;const c=this.delayedAudioAppendQueue_.slice();this.logger_(`queuing delayed audio ${c.length} appendBuffers`),this.delayedAudioAppendQueue_.length=0,c.forEach(h=>{this.appendBuffer.apply(this,h)})}}audioBuffered(){return ia(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:pn()}videoBuffered(){return ia(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:pn()}buffered(){const e=ia(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,i=ia(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return i&&!e?this.audioBuffered():e&&!i?this.videoBuffered():fN(this.audioBuffered(),this.videoBuffered())}setDuration(e,i=Ya){Ar({type:"mediaSource",sourceUpdater:this,action:Cr.duration(e),name:"duration",doneFn:i})}endOfStream(e=null,i=Ya){typeof e!="string"&&(e=void 0),Ar({type:"mediaSource",sourceUpdater:this,action:Cr.endOfStream(e),name:"endOfStream",doneFn:i})}removeAudio(e,i,n=Ya){if(!this.audioBuffered().length||this.audioBuffered().end(0)===0){n();return}Ar({type:"audio",sourceUpdater:this,action:Cr.remove(e,i),doneFn:n,name:"remove"})}removeVideo(e,i,n=Ya){if(!this.videoBuffered().length||this.videoBuffered().end(0)===0){n();return}Ar({type:"video",sourceUpdater:this,action:Cr.remove(e,i),doneFn:n,name:"remove"})}updating(){return!!(Dy("audio",this)||Dy("video",this))}audioTimestampOffset(e){return typeof e<"u"&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(Ar({type:"audio",sourceUpdater:this,action:Cr.timestampOffset(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_}videoTimestampOffset(e){return typeof e<"u"&&this.videoBuffer&&this.videoTimestampOffset_!==e&&(Ar({type:"video",sourceUpdater:this,action:Cr.timestampOffset(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_}audioQueueCallback(e){this.audioBuffer&&Ar({type:"audio",sourceUpdater:this,action:Cr.callback(e),name:"callback"})}videoQueueCallback(e){this.videoBuffer&&Ar({type:"video",sourceUpdater:this,action:Cr.callback(e),name:"callback"})}dispose(){this.trigger("dispose"),Q5.forEach(e=>{this.abort(e),this.canRemoveSourceBuffer()?this.removeSourceBuffer(e):this[`${e}QueueCallback`](()=>pk(e,this))}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()}}const Xw=t=>decodeURIComponent(escape(String.fromCharCode.apply(null,t))),J5=t=>{const e=new Uint8Array(t);return Array.from(e).map(i=>i.toString(16).padStart(2,"0")).join("")},Kw=new Uint8Array(`

`.split("").map(t=>t.charCodeAt(0)));class eB extends Error{constructor(){super("Trying to parse received VTT cues, but there is no WebVTT. Make sure vtt.js is loaded.")}}class tB extends Ay{constructor(e,i={}){super(e,i),this.mediaSource_=null,this.subtitlesTrack_=null,this.featuresNativeTextTracks_=e.featuresNativeTextTracks,this.loadVttJs=e.loadVttJs,this.shouldSaveSegmentTimingInfo_=!1}buffered_(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return pn();const e=this.subtitlesTrack_.cues,i=e[0].startTime,n=e[e.length-1].startTime;return pn([[i,n]])}initSegmentForMap(e,i=!1){if(!e)return null;const n=rp(e);let s=this.initSegments_[n];if(i&&!s&&e.bytes){const o=Kw.byteLength+e.bytes.byteLength,l=new Uint8Array(o);l.set(e.bytes),l.set(Kw,e.bytes.byteLength),this.initSegments_[n]=s={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:l}}return s||e}couldBeginLoading_(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}track(e){return typeof e>"u"?this.subtitlesTrack_:(this.subtitlesTrack_=e,this.state==="INIT"&&this.couldBeginLoading_()&&this.init_(),this.subtitlesTrack_)}remove(e,i){zd(e,i,this.subtitlesTrack_)}fillBuffer_(){const e=this.chooseNextRequest_();if(e){if(this.syncController_.timestampOffsetForTimeline(e.timeline)===null){const i=()=>{this.state="READY",this.paused()||this.monitorBuffer_()};this.syncController_.one("timestampoffset",i),this.state="WAITING_ON_TIMELINE";return}this.loadSegment_(e)}}timestampOffsetForSegment_(){return null}chooseNextRequest_(){return this.skipEmptySegments_(super.chooseNextRequest_())}skipEmptySegments_(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e}stopForError(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")}segmentRequestFinished_(e,i,n){if(!this.subtitlesTrack_){this.state="READY";return}if(this.saveTransferStats_(i.stats),!this.pendingSegment_){this.state="READY",this.mediaRequestsAborted+=1;return}if(e){e.code===aa.TIMEOUT&&this.handleTimeout_(),e.code===aa.ABORTED?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,this.stopForError(e);return}const s=this.pendingSegment_,o=n.mp4VttCues&&n.mp4VttCues.length;o&&(s.mp4VttCues=n.mp4VttCues),this.saveBandwidthRelatedStats_(s.duration,i.stats),i.key&&this.segmentKey(i.key,!0),this.state="APPENDING",this.trigger("appending");const l=s.segment;if(l.map&&(l.map.bytes=i.map.bytes),s.bytes=i.bytes,typeof te.WebVTT!="function"&&typeof this.loadVttJs=="function"){this.state="WAITING_ON_VTTJS",this.loadVttJs().then(()=>this.segmentRequestFinished_(e,i,n),()=>this.stopForError({message:"Error loading vtt.js"}));return}l.requested=!0;try{this.parseVTTCues_(s)}catch(c){this.stopForError({message:c.message,metadata:{errorType:_e.Error.StreamingVttParserError,error:c}});return}if(o||this.updateTimeMapping_(s,this.syncController_.timelines[s.timeline],this.playlist_),s.cues.length?s.timingInfo={start:s.cues[0].startTime,end:s.cues[s.cues.length-1].endTime}:s.timingInfo={start:s.startOfSegment,end:s.startOfSegment+s.duration},s.isSyncRequest){this.trigger("syncinfoupdate"),this.pendingSegment_=null,this.state="READY";return}s.byteLength=s.bytes.byteLength,this.mediaSecondsLoaded+=l.duration,s.cues.forEach(c=>{this.subtitlesTrack_.addCue(this.featuresNativeTextTracks_?new te.VTTCue(c.startTime,c.endTime,c.text):c)}),L5(this.subtitlesTrack_),this.handleAppendsDone_()}handleData_(e,i){const n=e&&e.type==="vtt",s=i&&i.type==="text";n&&s&&super.handleData_(e,i)}updateTimingInfoEnd_(){}parseMp4VttCues_(e){const i=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset();e.mp4VttCues.forEach(n=>{const s=n.start+i,o=n.end+i,l=new te.VTTCue(s,o,n.cueText);n.settings&&n.settings.split(" ").forEach(c=>{const h=c.split(":"),f=h[0],m=h[1];l[f]=isNaN(m)?m:Number(m)}),e.cues.push(l)})}parseVTTCues_(e){let i,n=!1;if(typeof te.WebVTT!="function")throw new eB;if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},e.mp4VttCues){this.parseMp4VttCues_(e);return}typeof te.TextDecoder=="function"?i=new te.TextDecoder("utf8"):(i=te.WebVTT.StringDecoder(),n=!0);const s=new te.WebVTT.Parser(te,te.vttjs,i);if(s.oncue=e.cues.push.bind(e.cues),s.ontimestampmap=l=>{e.timestampmap=l},s.onparsingerror=l=>{_e.log.warn("Error encountered when parsing cues: "+l.message)},e.segment.map){let l=e.segment.map.bytes;n&&(l=Xw(l)),s.parse(l)}let o=e.bytes;n&&(o=Xw(o)),s.parse(o),s.flush()}updateTimeMapping_(e,i,n){const s=e.segment;if(!i)return;if(!e.cues.length){s.empty=!0;return}const{MPEGTS:o,LOCAL:l}=e.timestampmap,h=o/Vl.ONE_SECOND_IN_TS-l+i.mapping;if(e.cues.forEach(f=>{const m=f.endTime-f.startTime,_=this.handleRollover_(f.startTime+h,i.time);f.startTime=Math.max(_,0),f.endTime=Math.max(_+m,0)}),!n.syncInfo){const f=e.cues[0].startTime,m=e.cues[e.cues.length-1].startTime;n.syncInfo={mediaSequence:n.mediaSequence+e.mediaIndex,time:Math.min(f,m-s.duration)}}}handleRollover_(e,i){if(i===null)return e;let n=e*Vl.ONE_SECOND_IN_TS;const s=i*Vl.ONE_SECOND_IN_TS;let o;for(s<n?o=-8589934592:o=8589934592;Math.abs(n-s)>4294967296;)n+=o;return n/Vl.ONE_SECOND_IN_TS}}const iB=function(t,e){const i=t.cues;for(let n=0;n<i.length;n++){const s=i[n];if(e>=s.adStartTime&&e<=s.adEndTime)return s}return null},nB=function(t,e,i=0){if(!t.segments)return;let n=i,s;for(let o=0;o<t.segments.length;o++){const l=t.segments[o];if(s||(s=iB(e,n+l.duration/2)),s){if("cueIn"in l){s.endTime=n,s.adEndTime=n,n+=l.duration,s=null;continue}if(n<s.endTime){n+=l.duration;continue}s.endTime+=l.duration}else if("cueOut"in l&&(s=new te.VTTCue(n,n+l.duration,l.cueOut),s.adStartTime=n,s.adEndTime=n+parseFloat(l.cueOut),e.addCue(s)),"cueOutCont"in l){const[c,h]=l.cueOutCont.split("/").map(parseFloat);s=new te.VTTCue(n,n+l.duration,""),s.adStartTime=n-c,s.adEndTime=s.adStartTime+h,e.addCue(s)}n+=l.duration}};class Yw{constructor({start:e,end:i,segmentIndex:n,partIndex:s=null,appended:o=!1}){this.start_=e,this.end_=i,this.segmentIndex_=n,this.partIndex_=s,this.appended_=o}isInRange(e){return e>=this.start&&e<this.end}markAppended(){this.appended_=!0}resetAppendedStatus(){this.appended_=!1}get isAppended(){return this.appended_}get start(){return this.start_}get end(){return this.end_}get segmentIndex(){return this.segmentIndex_}get partIndex(){return this.partIndex_}}class rB{constructor(e,i=[]){this.segmentSyncInfo_=e,this.partsSyncInfo_=i}get segmentSyncInfo(){return this.segmentSyncInfo_}get partsSyncInfo(){return this.partsSyncInfo_}get hasPartsSyncInfo(){return this.partsSyncInfo_.length>0}resetAppendStatus(){this.segmentSyncInfo_.resetAppendedStatus(),this.partsSyncInfo_.forEach(e=>e.resetAppendedStatus())}}class gk{constructor(){this.storage_=new Map,this.diagnostics_="",this.isReliable_=!1,this.start_=-1/0,this.end_=1/0}get start(){return this.start_}get end(){return this.end_}get diagnostics(){return this.diagnostics_}get isReliable(){return this.isReliable_}resetAppendedStatus(){this.storage_.forEach(e=>e.resetAppendStatus())}update(e,i){const{mediaSequence:n,segments:s}=e;if(this.isReliable_=this.isReliablePlaylist_(n,s),!!this.isReliable_)return this.updateStorage_(s,n,this.calculateBaseTime_(n,s,i))}getSyncInfoForTime(e){for(const{segmentSyncInfo:i,partsSyncInfo:n}of this.storage_.values())if(n.length){for(const s of n)if(s.isInRange(e))return s}else if(i.isInRange(e))return i;return null}getSyncInfoForMediaSequence(e){return this.storage_.get(e)}updateStorage_(e,i,n){const s=new Map;let o=`
`,l=n,c=i;this.start_=l,e.forEach((h,f)=>{const m=this.storage_.get(c),_=l,E=_+h.duration,w=!!(m&&m.segmentSyncInfo&&m.segmentSyncInfo.isAppended),A=new Yw({start:_,end:E,appended:w,segmentIndex:f});h.syncInfo=A;let C=l;const M=(h.parts||[]).map((O,$)=>{const B=C,U=C+O.duration,j=!!(m&&m.partsSyncInfo&&m.partsSyncInfo[$]&&m.partsSyncInfo[$].isAppended),W=new Yw({start:B,end:U,appended:j,segmentIndex:f,partIndex:$});return C=U,o+=`Media Sequence: ${c}.${$} | Range: ${B} --> ${U} | Appended: ${j}
`,O.syncInfo=W,W});s.set(c,new rB(A,M)),o+=`${hk(h.resolvedUri)} | Media Sequence: ${c} | Range: ${_} --> ${E} | Appended: ${w}
`,c++,l=E}),this.end_=l,this.storage_=s,this.diagnostics_=o}calculateBaseTime_(e,i,n){if(!this.storage_.size)return 0;if(this.storage_.has(e))return this.storage_.get(e).segmentSyncInfo.start;const s=Math.min(...this.storage_.keys());if(e<s){const o=s-e;let l=this.storage_.get(s).segmentSyncInfo.start;for(let c=0;c<o;c++){const h=i[c];l-=h.duration}return l}return n}isReliablePlaylist_(e,i){return e!=null&&Array.isArray(i)&&i.length}}class Qw extends gk{constructor(e){super(),this.parent_=e}calculateBaseTime_(e,i,n){if(!this.storage_.size){const s=this.parent_.getSyncInfoForMediaSequence(e);return s?s.segmentSyncInfo.start:0}return super.calculateBaseTime_(e,i,n)}}const sB=86400,z0=[{name:"VOD",run:(t,e,i,n,s)=>i!==1/0?{time:0,segmentIndex:0,partIndex:null}:null},{name:"MediaSequence",run:(t,e,i,n,s,o)=>{const l=t.getMediaSequenceSync(o);if(!l||!l.isReliable)return null;const c=l.getSyncInfoForTime(s);return c?{time:c.start,partIndex:c.partIndex,segmentIndex:c.segmentIndex}:null}},{name:"ProgramDateTime",run:(t,e,i,n,s)=>{if(!Object.keys(t.timelineToDatetimeMappings).length)return null;let o=null,l=null;const c=_y(e);s=s||0;for(let h=0;h<c.length;h++){const f=e.endList||s===0?h:c.length-(h+1),m=c[f],_=m.segment,E=t.timelineToDatetimeMappings[_.timeline];if(!E||!_.dateTimeObject)continue;let A=_.dateTimeObject.getTime()/1e3+E;if(_.parts&&typeof m.partIndex=="number")for(let M=0;M<m.partIndex;M++)A+=_.parts[M].duration;const C=Math.abs(s-A);if(l!==null&&(C===0||l<C))break;l=C,o={time:A,segmentIndex:m.segmentIndex,partIndex:m.partIndex}}return o}},{name:"Segment",run:(t,e,i,n,s)=>{let o=null,l=null;s=s||0;const c=_y(e);for(let h=0;h<c.length;h++){const f=e.endList||s===0?h:c.length-(h+1),m=c[f],_=m.segment,E=m.part&&m.part.start||_&&_.start;if(_.timeline===n&&typeof E<"u"){const w=Math.abs(s-E);if(l!==null&&l<w)break;(!o||l===null||l>=w)&&(l=w,o={time:E,segmentIndex:m.segmentIndex,partIndex:m.partIndex})}}return o}},{name:"Discontinuity",run:(t,e,i,n,s)=>{let o=null;if(s=s||0,e.discontinuityStarts&&e.discontinuityStarts.length){let l=null;for(let c=0;c<e.discontinuityStarts.length;c++){const h=e.discontinuityStarts[c],f=e.discontinuitySequence+c+1,m=t.discontinuities[f];if(m){const _=Math.abs(s-m.time);if(l!==null&&l<_)break;(!o||l===null||l>=_)&&(l=_,o={time:m.time,segmentIndex:h,partIndex:null})}}}return o}},{name:"Playlist",run:(t,e,i,n,s)=>e.syncInfo?{time:e.syncInfo.time,segmentIndex:e.syncInfo.mediaSequence-e.mediaSequence,partIndex:null}:null}];class aB extends _e.EventTarget{constructor(e={}){super(),this.timelines=[],this.discontinuities=[],this.timelineToDatetimeMappings={};const i=new gk,n=new Qw(i),s=new Qw(i);this.mediaSequenceStorage_={main:i,audio:n,vtt:s},this.logger_=ns("SyncController")}getMediaSequenceSync(e){return this.mediaSequenceStorage_[e]||null}getSyncPoint(e,i,n,s,o){if(i!==1/0)return z0.find(({name:h})=>h==="VOD").run(this,e,i);const l=this.runStrategies_(e,i,n,s,o);if(!l.length)return null;for(const c of l){const{syncPoint:h,strategy:f}=c,{segmentIndex:m,time:_}=h;if(m<0)continue;const E=e.segments[m],w=_,A=w+E.duration;if(this.logger_(`Strategy: ${f}. Current time: ${s}. selected segment: ${m}. Time: [${w} -> ${A}]}`),s>=w&&s<A)return this.logger_("Found sync point with exact match: ",h),h}return this.selectSyncPoint_(l,{key:"time",value:s})}getExpiredTime(e,i){if(!e||!e.segments)return null;const n=this.runStrategies_(e,i,e.discontinuitySequence,0);if(!n.length)return null;const s=this.selectSyncPoint_(n,{key:"segmentIndex",value:0});return s.segmentIndex>0&&(s.time*=-1),Math.abs(s.time+Gd({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:s.segmentIndex,endIndex:0}))}runStrategies_(e,i,n,s,o){const l=[];for(let c=0;c<z0.length;c++){const h=z0[c],f=h.run(this,e,i,n,s,o);f&&(f.strategy=h.name,l.push({strategy:h.name,syncPoint:f}))}return l}selectSyncPoint_(e,i){let n=e[0].syncPoint,s=Math.abs(e[0].syncPoint[i.key]-i.value),o=e[0].strategy;for(let l=1;l<e.length;l++){const c=Math.abs(e[l].syncPoint[i.key]-i.value);c<s&&(s=c,n=e[l].syncPoint,o=e[l].strategy)}return this.logger_(`syncPoint for [${i.key}: ${i.value}] chosen with strategy [${o}]: [time:${n.time}, segmentIndex:${n.segmentIndex}`+(typeof n.partIndex=="number"?`,partIndex:${n.partIndex}`:"")+"]"),n}saveExpiredSegmentInfo(e,i){const n=i.mediaSequence-e.mediaSequence;if(n>sB){_e.log.warn(`Not saving expired segment info. Media sequence gap ${n} is too large.`);return}for(let s=n-1;s>=0;s--){const o=e.segments[s];if(o&&typeof o.start<"u"){i.syncInfo={mediaSequence:e.mediaSequence+s,time:o.start},this.logger_(`playlist refresh sync: [time:${i.syncInfo.time}, mediaSequence: ${i.syncInfo.mediaSequence}]`),this.trigger("syncinfoupdate");break}}}setDateTimeMappingForStart(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){const i=e.segments[0],n=i.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[i.timeline]=-n}}saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:i}){const n=this.calculateSegmentTimeMapping_(e,e.timingInfo,i),s=e.segment;n&&(this.saveDiscontinuitySyncInfo_(e),e.playlist.syncInfo||(e.playlist.syncInfo={mediaSequence:e.playlist.mediaSequence+e.mediaIndex,time:s.start}));const o=s.dateTimeObject;s.discontinuity&&i&&o&&(this.timelineToDatetimeMappings[s.timeline]=-(o.getTime()/1e3))}timestampOffsetForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].time}mappingForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].mapping}calculateSegmentTimeMapping_(e,i,n){const s=e.segment,o=e.part;let l=this.timelines[e.timeline],c,h;if(typeof e.timestampOffset=="number")l={time:e.startOfSegment,mapping:e.startOfSegment-i.start},n&&(this.timelines[e.timeline]=l,this.trigger("timestampoffset"),this.logger_(`time mapping for timeline ${e.timeline}: [time: ${l.time}] [mapping: ${l.mapping}]`)),c=e.startOfSegment,h=i.end+l.mapping;else if(l)c=i.start+l.mapping,h=i.end+l.mapping;else return!1;return o&&(o.start=c,o.end=h),(!s.start||c<s.start)&&(s.start=c),s.end=h,!0}saveDiscontinuitySyncInfo_(e){const i=e.playlist,n=e.segment;if(n.discontinuity)this.discontinuities[n.timeline]={time:n.start,accuracy:0};else if(i.discontinuityStarts&&i.discontinuityStarts.length)for(let s=0;s<i.discontinuityStarts.length;s++){const o=i.discontinuityStarts[s],l=i.discontinuitySequence+s+1,c=o-e.mediaIndex,h=Math.abs(c);if(!this.discontinuities[l]||this.discontinuities[l].accuracy>h){let f;c<0?f=n.start-Gd({defaultDuration:i.targetDuration,durationList:i.segments,startIndex:e.mediaIndex,endIndex:o}):f=n.end+Gd({defaultDuration:i.targetDuration,durationList:i.segments,startIndex:e.mediaIndex+1,endIndex:o}),this.discontinuities[l]={time:f,accuracy:h}}}}dispose(){this.trigger("dispose"),this.off()}}class oB extends _e.EventTarget{constructor(){super(),this.pendingTimelineChanges_={},this.lastTimelineChanges_={}}clearPendingTimelineChange(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")}pendingTimelineChange({type:e,from:i,to:n}){return typeof i=="number"&&typeof n=="number"&&(this.pendingTimelineChanges_[e]={type:e,from:i,to:n},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[e]}lastTimelineChange({type:e,from:i,to:n}){if(typeof i=="number"&&typeof n=="number"){this.lastTimelineChanges_[e]={type:e,from:i,to:n},delete this.pendingTimelineChanges_[e];const s={timelineChangeInfo:{from:i,to:n}};this.trigger({type:"timelinechange",metadata:s})}return this.lastTimelineChanges_[e]}dispose(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()}}const lB=tk(ik(function(){var t=(function(){function C(){this.listeners={}}var M=C.prototype;return M.on=function($,B){this.listeners[$]||(this.listeners[$]=[]),this.listeners[$].push(B)},M.off=function($,B){if(!this.listeners[$])return!1;var U=this.listeners[$].indexOf(B);return this.listeners[$]=this.listeners[$].slice(0),this.listeners[$].splice(U,1),U>-1},M.trigger=function($){var B=this.listeners[$];if(B)if(arguments.length===2)for(var U=B.length,j=0;j<U;++j)B[j].call(this,arguments[1]);else for(var W=Array.prototype.slice.call(arguments,1),z=B.length,Y=0;Y<z;++Y)B[Y].apply(this,W)},M.dispose=function(){this.listeners={}},M.pipe=function($){this.on("data",function(B){$.push(B)})},C})();function e(C){return C.subarray(0,C.byteLength-C[C.byteLength-1])}const i=function(){const C=[[[],[],[],[],[]],[[],[],[],[],[]]],M=C[0],O=C[1],$=M[4],B=O[4];let U,j,W;const z=[],Y=[];let L,H,se,ae,ce,fe;for(U=0;U<256;U++)Y[(z[U]=U<<1^(U>>7)*283)^U]=U;for(j=W=0;!$[j];j^=L||1,W=Y[W]||1)for(ae=W^W<<1^W<<2^W<<3^W<<4,ae=ae>>8^ae&255^99,$[j]=ae,B[ae]=j,se=z[H=z[L=z[j]]],fe=se*16843009^H*65537^L*257^j*16843008,ce=z[ae]*257^ae*16843008,U=0;U<4;U++)M[U][j]=ce=ce<<24^ce>>>8,O[U][ae]=fe=fe<<24^fe>>>8;for(U=0;U<5;U++)M[U]=M[U].slice(0),O[U]=O[U].slice(0);return C};let n=null;class s{constructor(M){n||(n=i()),this._tables=[[n[0][0].slice(),n[0][1].slice(),n[0][2].slice(),n[0][3].slice(),n[0][4].slice()],[n[1][0].slice(),n[1][1].slice(),n[1][2].slice(),n[1][3].slice(),n[1][4].slice()]];let O,$,B;const U=this._tables[0][4],j=this._tables[1],W=M.length;let z=1;if(W!==4&&W!==6&&W!==8)throw new Error("Invalid aes key size");const Y=M.slice(0),L=[];for(this._key=[Y,L],O=W;O<4*W+28;O++)B=Y[O-1],(O%W===0||W===8&&O%W===4)&&(B=U[B>>>24]<<24^U[B>>16&255]<<16^U[B>>8&255]<<8^U[B&255],O%W===0&&(B=B<<8^B>>>24^z<<24,z=z<<1^(z>>7)*283)),Y[O]=Y[O-W]^B;for($=0;O;$++,O--)B=Y[$&3?O:O-4],O<=4||$<4?L[$]=B:L[$]=j[0][U[B>>>24]]^j[1][U[B>>16&255]]^j[2][U[B>>8&255]]^j[3][U[B&255]]}decrypt(M,O,$,B,U,j){const W=this._key[1];let z=M^W[0],Y=B^W[1],L=$^W[2],H=O^W[3],se,ae,ce;const fe=W.length/4-2;let be,J=4;const ee=this._tables[1],de=ee[0],ue=ee[1],ve=ee[2],P=ee[3],ne=ee[4];for(be=0;be<fe;be++)se=de[z>>>24]^ue[Y>>16&255]^ve[L>>8&255]^P[H&255]^W[J],ae=de[Y>>>24]^ue[L>>16&255]^ve[H>>8&255]^P[z&255]^W[J+1],ce=de[L>>>24]^ue[H>>16&255]^ve[z>>8&255]^P[Y&255]^W[J+2],H=de[H>>>24]^ue[z>>16&255]^ve[Y>>8&255]^P[L&255]^W[J+3],J+=4,z=se,Y=ae,L=ce;for(be=0;be<4;be++)U[(3&-be)+j]=ne[z>>>24]<<24^ne[Y>>16&255]<<16^ne[L>>8&255]<<8^ne[H&255]^W[J++],se=z,z=Y,Y=L,L=H,H=se}}class o extends t{constructor(){super(t),this.jobs=[],this.delay=1,this.timeout_=null}processJob_(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null}push(M){this.jobs.push(M),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}const l=function(C){return C<<24|(C&65280)<<8|(C&16711680)>>8|C>>>24},c=function(C,M,O){const $=new Int32Array(C.buffer,C.byteOffset,C.byteLength>>2),B=new s(Array.prototype.slice.call(M)),U=new Uint8Array(C.byteLength),j=new Int32Array(U.buffer);let W,z,Y,L,H,se,ae,ce,fe;for(W=O[0],z=O[1],Y=O[2],L=O[3],fe=0;fe<$.length;fe+=4)H=l($[fe]),se=l($[fe+1]),ae=l($[fe+2]),ce=l($[fe+3]),B.decrypt(H,se,ae,ce,j,fe),j[fe]=l(j[fe]^W),j[fe+1]=l(j[fe+1]^z),j[fe+2]=l(j[fe+2]^Y),j[fe+3]=l(j[fe+3]^L),W=H,z=se,Y=ae,L=ce;return U};class h{constructor(M,O,$,B){const U=h.STEP,j=new Int32Array(M.buffer),W=new Uint8Array(M.byteLength);let z=0;for(this.asyncStream_=new o,this.asyncStream_.push(this.decryptChunk_(j.subarray(z,z+U),O,$,W)),z=U;z<j.length;z+=U)$=new Uint32Array([l(j[z-4]),l(j[z-3]),l(j[z-2]),l(j[z-1])]),this.asyncStream_.push(this.decryptChunk_(j.subarray(z,z+U),O,$,W));this.asyncStream_.push(function(){B(null,e(W))})}static get STEP(){return 32e3}decryptChunk_(M,O,$,B){return function(){const U=c(M,O,$);B.set(U,M.byteOffset)}}}var f=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},m;typeof window<"u"?m=window:typeof f<"u"?m=f:typeof self<"u"?m=self:m={};var _=m,E=function(M){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(M):M&&M.buffer instanceof ArrayBuffer},w=_.BigInt||Number;w("0x1"),w("0x100"),w("0x10000"),w("0x1000000"),w("0x100000000"),w("0x10000000000"),w("0x1000000000000"),w("0x100000000000000"),w("0x10000000000000000"),(function(){var C=new Uint16Array([65484]),M=new Uint8Array(C.buffer,C.byteOffset,C.byteLength);return M[0]===255?"big":M[0]===204?"little":"unknown"})();const A=function(C){const M={};return Object.keys(C).forEach(O=>{const $=C[O];E($)?M[O]={bytes:$.buffer,byteOffset:$.byteOffset,byteLength:$.byteLength}:M[O]=$}),M};self.onmessage=function(C){const M=C.data,O=new Uint8Array(M.encrypted.bytes,M.encrypted.byteOffset,M.encrypted.byteLength),$=new Uint32Array(M.key.bytes,M.key.byteOffset,M.key.byteLength/4),B=new Uint32Array(M.iv.bytes,M.iv.byteOffset,M.iv.byteLength/4);new h(O,$,B,function(U,j){self.postMessage(A({source:M.source,decrypted:j}),[j.buffer])})}}));var uB=ek(lB);const cB=t=>{let e=t.default?"main":"alternative";return t.characteristics&&t.characteristics.indexOf("public.accessibility.describes-video")>=0&&(e="main-desc"),e},yk=(t,e)=>{t.abort(),t.pause(),e&&e.activePlaylistLoader&&(e.activePlaylistLoader.pause(),e.activePlaylistLoader=null)},ky=(t,e)=>{e.activePlaylistLoader=t,t.load()},dB=(t,e)=>()=>{const{segmentLoaders:{[t]:i,main:n},mediaTypes:{[t]:s}}=e,o=s.activeTrack(),l=s.getActiveGroup(),c=s.activePlaylistLoader,h=s.lastGroup_;if(!(l&&h&&l.id===h.id)&&(s.lastGroup_=l,s.lastTrack_=o,yk(i,s),!(!l||l.isMainPlaylist))){if(!l.playlistLoader){c&&n.resetEverything();return}i.resyncLoader(),ky(l.playlistLoader,s)}},hB=(t,e)=>()=>{const{segmentLoaders:{[t]:i},mediaTypes:{[t]:n}}=e;n.lastGroup_=null,i.abort(),i.pause()},fB=(t,e)=>()=>{const{mainPlaylistLoader:i,segmentLoaders:{[t]:n,main:s},mediaTypes:{[t]:o}}=e,l=o.activeTrack(),c=o.getActiveGroup(),h=o.activePlaylistLoader,f=o.lastTrack_;if(!(f&&l&&f.id===l.id)&&(o.lastGroup_=c,o.lastTrack_=l,yk(n,o),!!c)){if(c.isMainPlaylist){if(!l||!f||l.id===f.id)return;const m=e.vhs.playlistController_,_=m.selectPlaylist();if(m.media()===_)return;o.logger_(`track change. Switching main audio from ${f.id} to ${l.id}`),i.pause(),s.resetEverything(),m.fastQualityChange_(_);return}if(t==="AUDIO"){if(!c.playlistLoader){s.setAudio(!0),s.resetEverything();return}n.setAudio(!0),s.setAudio(!1)}if(h===c.playlistLoader){ky(c.playlistLoader,o);return}n.track&&n.track(l),n.resetEverything(),ky(c.playlistLoader,o)}},sp={AUDIO:(t,e)=>()=>{const{mediaTypes:{[t]:i},excludePlaylist:n}=e,s=i.activeTrack(),o=i.activeGroup(),l=(o.filter(h=>h.default)[0]||o[0]).id,c=i.tracks[l];if(s===c){n({error:{message:"Problem encountered loading the default audio track."}});return}_e.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(const h in i.tracks)i.tracks[h].enabled=i.tracks[h]===c;i.onTrackChanged()},SUBTITLES:(t,e)=>()=>{const{mediaTypes:{[t]:i}}=e;_e.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track.");const n=i.activeTrack();n&&(n.mode="disabled"),i.onTrackChanged()}},Zw={AUDIO:(t,e,i)=>{if(!e)return;const{tech:n,requestOptions:s,segmentLoaders:{[t]:o}}=i;e.on("loadedmetadata",()=>{const l=e.media();o.playlist(l,s),(!n.paused()||l.endList&&n.preload()!=="none")&&o.load()}),e.on("loadedplaylist",()=>{o.playlist(e.media(),s),n.paused()||o.load()}),e.on("error",sp[t](t,i))},SUBTITLES:(t,e,i)=>{const{tech:n,requestOptions:s,segmentLoaders:{[t]:o},mediaTypes:{[t]:l}}=i;e.on("loadedmetadata",()=>{const c=e.media();o.playlist(c,s),o.track(l.activeTrack()),(!n.paused()||c.endList&&n.preload()!=="none")&&o.load()}),e.on("loadedplaylist",()=>{o.playlist(e.media(),s),n.paused()||o.load()}),e.on("error",sp[t](t,i))}},pB={AUDIO:(t,e)=>{const{vhs:i,sourceType:n,segmentLoaders:{[t]:s},requestOptions:o,main:{mediaGroups:l},mediaTypes:{[t]:{groups:c,tracks:h,logger_:f}},mainPlaylistLoader:m}=e,_=oh(m.main);(!l[t]||Object.keys(l[t]).length===0)&&(l[t]={main:{default:{default:!0}}},_&&(l[t].main.default.playlists=m.main.playlists));for(const E in l[t]){c[E]||(c[E]=[]);for(const w in l[t][E]){let A=l[t][E][w],C;if(_?(f(`AUDIO group '${E}' label '${w}' is a main playlist`),A.isMainPlaylist=!0,C=null):n==="vhs-json"&&A.playlists?C=new Qu(A.playlists[0],i,o):A.resolvedUri?C=new Qu(A.resolvedUri,i,o):A.playlists&&n==="dash"?C=new wy(A.playlists[0],i,o,m):C=null,A=Gt({id:w,playlistLoader:C},A),Zw[t](t,A.playlistLoader,e),c[E].push(A),typeof h[w]>"u"){const M=new _e.AudioTrack({id:w,kind:cB(A),enabled:!1,language:A.language,default:A.default,label:w});h[w]=M}}}s.on("error",sp[t](t,e))},SUBTITLES:(t,e)=>{const{tech:i,vhs:n,sourceType:s,segmentLoaders:{[t]:o},requestOptions:l,main:{mediaGroups:c},mediaTypes:{[t]:{groups:h,tracks:f}},mainPlaylistLoader:m}=e;for(const _ in c[t]){h[_]||(h[_]=[]);for(const E in c[t][_]){if(!n.options_.useForcedSubtitles&&c[t][_][E].forced)continue;let w=c[t][_][E],A;if(s==="hls")A=new Qu(w.resolvedUri,n,l);else if(s==="dash"){if(!w.playlists.filter(M=>M.excludeUntil!==1/0).length)return;A=new wy(w.playlists[0],n,l,m)}else s==="vhs-json"&&(A=new Qu(w.playlists?w.playlists[0]:w.resolvedUri,n,l));if(w=Gt({id:E,playlistLoader:A},w),Zw[t](t,w.playlistLoader,e),h[_].push(w),typeof f[E]>"u"){const C=i.addRemoteTextTrack({id:E,kind:"subtitles",default:w.default&&w.autoselect,language:w.language,label:E},!1).track;f[E]=C}}}o.on("error",sp[t](t,e))},"CLOSED-CAPTIONS":(t,e)=>{const{tech:i,main:{mediaGroups:n},mediaTypes:{[t]:{groups:s,tracks:o}}}=e;for(const l in n[t]){s[l]||(s[l]=[]);for(const c in n[t][l]){const h=n[t][l][c];if(!/^(?:CC|SERVICE)/.test(h.instreamId))continue;const f=i.options_.vhs&&i.options_.vhs.captionServices||{};let m={label:c,language:h.language,instreamId:h.instreamId,default:h.default&&h.autoselect};if(f[m.instreamId]&&(m=Gt(m,f[m.instreamId])),m.default===void 0&&delete m.default,s[l].push(Gt({id:c},h)),typeof o[c]>"u"){const _=i.addRemoteTextTrack({id:m.instreamId,kind:"captions",default:m.default,language:m.language,label:m.label},!1).track;o[c]=_}}}}},_k=(t,e)=>{for(let i=0;i<t.length;i++)if(F_(e,t[i])||t[i].playlists&&_k(t[i].playlists,e))return!0;return!1},mB=(t,e)=>i=>{const{mainPlaylistLoader:n,mediaTypes:{[t]:{groups:s}}}=e,o=n.media();if(!o)return null;let l=null;o.attributes[t]&&(l=s[o.attributes[t]]);const c=Object.keys(s);if(!l)if(t==="AUDIO"&&c.length>1&&oh(e.main))for(let h=0;h<c.length;h++){const f=s[c[h]];if(_k(f,o)){l=f;break}}else s.main?l=s.main:c.length===1&&(l=s[c[0]]);return typeof i>"u"?l:i===null||!l?null:l.filter(h=>h.id===i.id)[0]||null},gB={AUDIO:(t,e)=>()=>{const{mediaTypes:{[t]:{tracks:i}}}=e;for(const n in i)if(i[n].enabled)return i[n];return null},SUBTITLES:(t,e)=>()=>{const{mediaTypes:{[t]:{tracks:i}}}=e;for(const n in i)if(i[n].mode==="showing"||i[n].mode==="hidden")return i[n];return null}},yB=(t,{mediaTypes:e})=>()=>{const i=e[t].activeTrack();return i?e[t].activeGroup(i):null},_B=t=>{["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(f=>{pB[f](f,t)});const{mediaTypes:e,mainPlaylistLoader:i,tech:n,vhs:s,segmentLoaders:{["AUDIO"]:o,main:l}}=t;["AUDIO","SUBTITLES"].forEach(f=>{e[f].activeGroup=mB(f,t),e[f].activeTrack=gB[f](f,t),e[f].onGroupChanged=dB(f,t),e[f].onGroupChanging=hB(f,t),e[f].onTrackChanged=fB(f,t),e[f].getActiveGroup=yB(f,t)});const c=e.AUDIO.activeGroup();if(c){const f=(c.filter(_=>_.default)[0]||c[0]).id;e.AUDIO.tracks[f].enabled=!0,e.AUDIO.onGroupChanged(),e.AUDIO.onTrackChanged(),e.AUDIO.getActiveGroup().playlistLoader?(l.setAudio(!1),o.setAudio(!0)):l.setAudio(!0)}i.on("mediachange",()=>{["AUDIO","SUBTITLES"].forEach(f=>e[f].onGroupChanged())}),i.on("mediachanging",()=>{["AUDIO","SUBTITLES"].forEach(f=>e[f].onGroupChanging())});const h=()=>{e.AUDIO.onTrackChanged(),n.trigger({type:"usage",name:"vhs-audio-change"})};n.audioTracks().addEventListener("change",h),n.remoteTextTracks().addEventListener("change",e.SUBTITLES.onTrackChanged),s.on("dispose",()=>{n.audioTracks().removeEventListener("change",h),n.remoteTextTracks().removeEventListener("change",e.SUBTITLES.onTrackChanged)}),n.clearTracks("audio");for(const f in e.AUDIO.tracks)n.audioTracks().addTrack(e.AUDIO.tracks[f])},vB=()=>{const t={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{t[e]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:Ya,activeTrack:Ya,getActiveGroup:Ya,onGroupChanged:Ya,onTrackChanged:Ya,lastTrack_:null,logger_:ns(`MediaGroups[${e}]`)}}),t};class Jw{constructor(){this.priority_=[],this.pathwayClones_=new Map}set version(e){e===1&&(this.version_=e)}set ttl(e){this.ttl_=e||300}set reloadUri(e){e&&(this.reloadUri_=ur(this.reloadUri_,e))}set priority(e){e&&e.length&&(this.priority_=e)}set pathwayClones(e){e&&e.length&&(this.pathwayClones_=new Map(e.map(i=>[i.ID,i])))}get version(){return this.version_}get ttl(){return this.ttl_}get reloadUri(){return this.reloadUri_}get priority(){return this.priority_}get pathwayClones(){return this.pathwayClones_}}class bB extends _e.EventTarget{constructor(e,i){super(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=!1,this.availablePathways_=new Set,this.steeringManifest=new Jw,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.currentPathwayClones=new Map,this.nextPathwayClones=new Map,this.excludedSteeringManifestURLs=new Set,this.logger_=ns("Content Steering"),this.xhr_=e,this.getBandwidth_=i}assignTagProperties(e,i){this.manifestType_=i.serverUri?"HLS":"DASH";const n=i.serverUri||i.serverURL;if(!n){this.logger_(`steering manifest URL is ${n}, cannot request steering manifest.`),this.trigger("error");return}if(n.startsWith("data:")){this.decodeDataUriManifest_(n.substring(n.indexOf(",")+1));return}this.steeringManifest.reloadUri=ur(e,n),this.defaultPathway=i.pathwayId||i.defaultServiceLocation,this.queryBeforeStart=i.queryBeforeStart,this.proxyServerUrl_=i.proxyServerURL,this.defaultPathway&&!this.queryBeforeStart&&this.trigger("content-steering")}requestSteeringManifest(e){const i=this.steeringManifest.reloadUri;if(!i)return;const n=e?i:this.getRequestURI(i);if(!n){this.logger_("No valid content steering manifest URIs. Stopping content steering."),this.trigger("error"),this.dispose();return}const s={contentSteeringInfo:{uri:n}};this.trigger({type:"contentsteeringloadstart",metadata:s}),this.request_=this.xhr_({uri:n,requestType:"content-steering-manifest"},(o,l)=>{if(o){if(l.status===410){this.logger_(`manifest request 410 ${o}.`),this.logger_(`There will be no more content steering requests to ${n} this session.`),this.excludedSteeringManifestURLs.add(n);return}if(l.status===429){const f=l.responseHeaders["retry-after"];this.logger_(`manifest request 429 ${o}.`),this.logger_(`content steering will retry in ${f} seconds.`),this.startTTLTimeout_(parseInt(f,10));return}this.logger_(`manifest failed to load ${o}.`),this.startTTLTimeout_();return}this.trigger({type:"contentsteeringloadcomplete",metadata:s});let c;try{c=JSON.parse(this.request_.responseText)}catch(f){const m={errorType:_e.Error.StreamingContentSteeringParserError,error:f};this.trigger({type:"error",metadata:m})}this.assignSteeringProperties_(c);const h={contentSteeringInfo:s.contentSteeringInfo,contentSteeringManifest:{version:this.steeringManifest.version,reloadUri:this.steeringManifest.reloadUri,priority:this.steeringManifest.priority}};this.trigger({type:"contentsteeringparsed",metadata:h}),this.startTTLTimeout_()})}setProxyServerUrl_(e){const i=new te.URL(e),n=new te.URL(this.proxyServerUrl_);return n.searchParams.set("url",encodeURI(i.toString())),this.setSteeringParams_(n.toString())}decodeDataUriManifest_(e){const i=JSON.parse(te.atob(e));this.assignSteeringProperties_(i)}setSteeringParams_(e){const i=new te.URL(e),n=this.getPathway(),s=this.getBandwidth_();if(n){const o=`_${this.manifestType_}_pathway`;i.searchParams.set(o,n)}if(s){const o=`_${this.manifestType_}_throughput`;i.searchParams.set(o,s)}return i.toString()}assignSteeringProperties_(e){if(this.steeringManifest.version=e.VERSION,!this.steeringManifest.version){this.logger_(`manifest version is ${e.VERSION}, which is not supported.`),this.trigger("error");return}this.steeringManifest.ttl=e.TTL,this.steeringManifest.reloadUri=e["RELOAD-URI"],this.steeringManifest.priority=e["PATHWAY-PRIORITY"]||e["SERVICE-LOCATION-PRIORITY"],this.steeringManifest.pathwayClones=e["PATHWAY-CLONES"],this.nextPathwayClones=this.steeringManifest.pathwayClones,this.availablePathways_.size||(this.logger_("There are no available pathways for content steering. Ending content steering."),this.trigger("error"),this.dispose());const n=(s=>{for(const o of s)if(this.availablePathways_.has(o))return o;return[...this.availablePathways_][0]})(this.steeringManifest.priority);this.currentPathway!==n&&(this.currentPathway=n,this.trigger("content-steering"))}getPathway(){return this.currentPathway||this.defaultPathway}getRequestURI(e){if(!e)return null;const i=s=>this.excludedSteeringManifestURLs.has(s);if(this.proxyServerUrl_){const s=this.setProxyServerUrl_(e);if(!i(s))return s}const n=this.setSteeringParams_(e);return i(n)?null:n}startTTLTimeout_(e=this.steeringManifest.ttl){const i=e*1e3;this.ttlTimeout_=te.setTimeout(()=>{this.requestSteeringManifest()},i)}clearTTLTimeout_(){te.clearTimeout(this.ttlTimeout_),this.ttlTimeout_=null}abort(){this.request_&&this.request_.abort(),this.request_=null}dispose(){this.off("content-steering"),this.off("error"),this.abort(),this.clearTTLTimeout_(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=null,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.excludedSteeringManifestURLs=new Set,this.availablePathways_=new Set,this.steeringManifest=new Jw}addAvailablePathway(e){e&&this.availablePathways_.add(e)}clearAvailablePathways(){this.availablePathways_.clear()}excludePathway(e){return this.availablePathways_.delete(e)}didDASHTagChange(e,i){return!i&&this.steeringManifest.reloadUri||i&&(ur(e,i.serverURL)!==this.steeringManifest.reloadUri||i.defaultServiceLocation!==this.defaultPathway||i.queryBeforeStart!==this.queryBeforeStart||i.proxyServerURL!==this.proxyServerUrl_)}getAvailablePathways(){return this.availablePathways_}}const TB=(t,e)=>{let i=null;return(...n)=>{clearTimeout(i),i=setTimeout(()=>{t.apply(null,n)},e)}},xB=10;let Yo;const SB=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],wB=function(t){return this.audioSegmentLoader_[t]+this.mainSegmentLoader_[t]},EB=function({currentPlaylist:t,buffered:e,currentTime:i,nextPlaylist:n,bufferLowWaterLine:s,bufferHighWaterLine:o,duration:l,bufferBasedABR:c,log:h}){if(!n)return _e.log.warn("We received no playlist to switch to. Please check your stream."),!1;const f=`allowing switch ${t&&t.id||"null"} -> ${n.id}`;if(!t)return h(`${f} as current playlist is not set`),!0;if(n.id===t.id)return!1;const m=!!Yu(e,i).length;if(!t.endList)return!m&&typeof t.partTargetDuration=="number"?(h(`not ${f} as current playlist is live llhls, but currentTime isn't in buffered.`),!1):(h(`${f} as current playlist is live`),!0);const _=U_(e,i),E=c?hn.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:hn.MAX_BUFFER_LOW_WATER_LINE;if(l<E)return h(`${f} as duration < max low water line (${l} < ${E})`),!0;const w=n.attributes.BANDWIDTH,A=t.attributes.BANDWIDTH;if(w<A&&(!c||_<o)){let C=`${f} as next bandwidth < current bandwidth (${w} < ${A})`;return c&&(C+=` and forwardBuffer < bufferHighWaterLine (${_} < ${o})`),h(C),!0}if((!c||w>A)&&_>=s){let C=`${f} as forwardBuffer >= bufferLowWaterLine (${_} >= ${s})`;return c&&(C+=` and next bandwidth > current bandwidth (${w} > ${A})`),h(C),!0}return h(`not ${f} as no switching criteria met`),!1};class CB extends _e.EventTarget{constructor(e){super(),this.fastQualityChange_=TB(this.fastQualityChange_.bind(this),100);const{src:i,withCredentials:n,tech:s,bandwidth:o,externVhs:l,useCueTags:c,playlistExclusionDuration:h,enableLowInitialPlaylist:f,sourceType:m,cacheEncryptionKeys:_,bufferBasedABR:E,leastPixelDiffSelector:w,captionServices:A,experimentalUseMMS:C}=e;if(!i)throw new Error("A non-empty playlist URL or JSON manifest string is required");let{maxPlaylistRetries:M}=e;(M===null||typeof M>"u")&&(M=1/0),Yo=l,this.bufferBasedABR=!!E,this.leastPixelDiffSelector=!!w,this.withCredentials=n,this.tech_=s,this.vhs_=s.vhs,this.player_=e.player_,this.sourceType_=m,this.useCueTags_=c,this.playlistExclusionDuration=h,this.maxPlaylistRetries=M,this.enableLowInitialPlaylist=f,this.usingManagedMediaSource_=!1,this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType=""),this.requestOptions_={withCredentials:n,maxPlaylistRetries:M,timeout:null},this.on("error",this.pauseLoading),this.mediaTypes_=vB(),C&&te.ManagedMediaSource?(this.tech_.el_.disableRemotePlayback=!0,this.mediaSource=new te.ManagedMediaSource,this.usingManagedMediaSource_=!0,_e.log("Using ManagedMediaSource")):te.MediaSource&&(this.mediaSource=new te.MediaSource),this.handleDurationChange_=this.handleDurationChange_.bind(this),this.handleSourceOpen_=this.handleSourceOpen_.bind(this),this.handleSourceEnded_=this.handleSourceEnded_.bind(this),this.load=this.load.bind(this),this.pause=this.pause.bind(this),this.mediaSource.addEventListener("durationchange",this.handleDurationChange_),this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.addEventListener("sourceended",this.handleSourceEnded_),this.mediaSource.addEventListener("startstreaming",this.load),this.mediaSource.addEventListener("endstreaming",this.pause),this.seekable_=pn(),this.hasPlayed_=!1,this.syncController_=new aB(e),this.segmentMetadataTrack_=s.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,this.segmentMetadataTrack_.mode="hidden",this.decrypter_=new uB,this.sourceUpdater_=new mk(this.mediaSource),this.inbandTextTracks_={},this.timelineChangeController_=new oB,this.keyStatusMap_=new Map;const O={vhs:this.vhs_,parse708captions:e.parse708captions,useDtsForTimestampOffset:e.useDtsForTimestampOffset,captionServices:A,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:()=>this.seekable(),seeking:()=>this.tech_.seeking(),duration:()=>this.duration(),hasPlayed:()=>this.hasPlayed_,goalBufferLength:()=>this.goalBufferLength(),bandwidth:o,syncController:this.syncController_,decrypter:this.decrypter_,sourceType:this.sourceType_,inbandTextTracks:this.inbandTextTracks_,cacheEncryptionKeys:_,sourceUpdater:this.sourceUpdater_,timelineChangeController:this.timelineChangeController_,exactManifestTimings:e.exactManifestTimings,addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)};this.mainPlaylistLoader_=this.sourceType_==="dash"?new wy(i,this.vhs_,Gt(this.requestOptions_,{addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)})):new Qu(i,this.vhs_,Gt(this.requestOptions_,{addDateRangesToTextTrack:this.addDateRangesToTextTrack_.bind(this)})),this.setupMainPlaylistLoaderListeners_(),this.mainSegmentLoader_=new Ay(Gt(O,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),e),this.audioSegmentLoader_=new Ay(Gt(O,{loaderType:"audio"}),e),this.subtitleSegmentLoader_=new tB(Gt(O,{loaderType:"vtt",featuresNativeTextTracks:this.tech_.featuresNativeTextTracks,loadVttJs:()=>new Promise((U,j)=>{function W(){s.off("vttjserror",z),U()}function z(){s.off("vttjsloaded",W),j()}s.one("vttjsloaded",W),s.one("vttjserror",z),s.addWebVttScript_()})}),e);const $=()=>this.mainSegmentLoader_.bandwidth;this.contentSteeringController_=new bB(this.vhs_.xhr,$),this.setupSegmentLoaderListeners_(),this.bufferBasedABR&&(this.mainPlaylistLoader_.one("loadedplaylist",()=>this.startABRTimer_()),this.tech_.on("pause",()=>this.stopABRTimer_()),this.tech_.on("play",()=>this.startABRTimer_())),SB.forEach(U=>{this[U+"_"]=wB.bind(this,U)}),this.logger_=ns("pc"),this.triggeredFmp4Usage=!1,this.tech_.preload()==="none"?(this.loadOnPlay_=()=>{this.loadOnPlay_=null,this.mainPlaylistLoader_.load()},this.tech_.one("play",this.loadOnPlay_)):this.mainPlaylistLoader_.load(),this.timeToLoadedData__=-1,this.mainAppendsToLoadedData__=-1,this.audioAppendsToLoadedData__=-1;const B=this.tech_.preload()==="none"?"play":"loadstart";this.tech_.one(B,()=>{const U=Date.now();this.tech_.one("loadeddata",()=>{this.timeToLoadedData__=Date.now()-U,this.mainAppendsToLoadedData__=this.mainSegmentLoader_.mediaAppends,this.audioAppendsToLoadedData__=this.audioSegmentLoader_.mediaAppends})})}mainAppendsToLoadedData_(){return this.mainAppendsToLoadedData__}audioAppendsToLoadedData_(){return this.audioAppendsToLoadedData__}appendsToLoadedData_(){const e=this.mainAppendsToLoadedData_(),i=this.audioAppendsToLoadedData_();return e===-1||i===-1?-1:e+i}timeToLoadedData_(){return this.timeToLoadedData__}checkABR_(e="abr"){const i=this.selectPlaylist();i&&this.shouldSwitchToMedia_(i)&&this.switchMedia_(i,e)}switchMedia_(e,i,n){const s=this.media(),o=s&&(s.id||s.uri),l=e&&(e.id||e.uri);if(o&&o!==l){this.logger_(`switch media ${o} -> ${l} from ${i}`);const c={renditionInfo:{id:l,bandwidth:e.attributes.BANDWIDTH,resolution:e.attributes.RESOLUTION,codecs:e.attributes.CODECS},cause:i};this.trigger({type:"renditionselected",metadata:c}),this.tech_.trigger({type:"usage",name:`vhs-rendition-change-${i}`})}this.mainPlaylistLoader_.media(e,n)}switchMediaForDASHContentSteering_(){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{const i=this.mediaTypes_[e],n=i?i.activeGroup():null,s=this.contentSteeringController_.getPathway();if(n&&s){const l=(n.length?n[0].playlists:n.playlists).filter(c=>c.attributes.serviceLocation===s);l.length&&this.mediaTypes_[e].activePlaylistLoader.media(l[0])}})}startABRTimer_(){this.stopABRTimer_(),this.abrTimer_=te.setInterval(()=>this.checkABR_(),250)}stopABRTimer_(){this.tech_.scrubbing&&this.tech_.scrubbing()||(te.clearInterval(this.abrTimer_),this.abrTimer_=null)}getAudioTrackPlaylists_(){const e=this.main(),i=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return i;const n=e.mediaGroups.AUDIO,s=Object.keys(n);let o;if(Object.keys(this.mediaTypes_.AUDIO.groups).length)o=this.mediaTypes_.AUDIO.activeTrack();else{const c=n.main||s.length&&n[s[0]];for(const h in c)if(c[h].default){o={label:h};break}}if(!o)return i;const l=[];for(const c in n)if(n[c][o.label]){const h=n[c][o.label];if(h.playlists&&h.playlists.length)l.push.apply(l,h.playlists);else if(h.uri)l.push(h);else if(e.playlists.length)for(let f=0;f<e.playlists.length;f++){const m=e.playlists[f];m.attributes&&m.attributes.AUDIO&&m.attributes.AUDIO===c&&l.push(m)}}return l.length?l:i}setupMainPlaylistLoaderListeners_(){this.mainPlaylistLoader_.on("loadedmetadata",()=>{const i=this.mainPlaylistLoader_.media(),n=i.targetDuration*1.5*1e3;vy(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=n,i.endList&&this.tech_.preload()!=="none"&&(this.mainSegmentLoader_.playlist(i,this.requestOptions_),this.mainSegmentLoader_.load()),_B({sourceType:this.sourceType_,segmentLoaders:{AUDIO:this.audioSegmentLoader_,SUBTITLES:this.subtitleSegmentLoader_,main:this.mainSegmentLoader_},tech:this.tech_,requestOptions:this.requestOptions_,mainPlaylistLoader:this.mainPlaylistLoader_,vhs:this.vhs_,main:this.main(),mediaTypes:this.mediaTypes_,excludePlaylist:this.excludePlaylist.bind(this)}),this.triggerPresenceUsage_(this.main(),i),this.setupFirstPlay(),!this.mediaTypes_.AUDIO.activePlaylistLoader||this.mediaTypes_.AUDIO.activePlaylistLoader.media()?this.trigger("selectedinitialmedia"):this.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",()=>{this.trigger("selectedinitialmedia")})}),this.mainPlaylistLoader_.on("loadedplaylist",()=>{this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_);let i=this.mainPlaylistLoader_.media();if(!i){this.attachContentSteeringListeners_(),this.initContentSteeringController_(),this.excludeUnsupportedVariants_();let n;if(this.enableLowInitialPlaylist&&(n=this.selectInitialPlaylist()),n||(n=this.selectPlaylist()),!n||!this.shouldSwitchToMedia_(n)||(this.initialMedia_=n,this.switchMedia_(this.initialMedia_,"initial"),!(this.sourceType_==="vhs-json"&&this.initialMedia_.segments)))return;i=this.initialMedia_}this.handleUpdatedMediaPlaylist(i)}),this.mainPlaylistLoader_.on("error",()=>{const i=this.mainPlaylistLoader_.error;this.excludePlaylist({playlistToExclude:i.playlist,error:i})}),this.mainPlaylistLoader_.on("mediachanging",()=>{this.mainSegmentLoader_.abort(),this.mainSegmentLoader_.pause()}),this.mainPlaylistLoader_.on("mediachange",()=>{const i=this.mainPlaylistLoader_.media(),n=i.targetDuration*1.5*1e3;vy(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=n,this.sourceType_==="dash"&&this.mainPlaylistLoader_.isPaused&&this.mainPlaylistLoader_.load(),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(i,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_?this.runFastQualitySwitch_():this.mainSegmentLoader_.load(),this.tech_.trigger({type:"mediachange",bubbles:!0})}),this.mainPlaylistLoader_.on("playlistunchanged",()=>{const i=this.mainPlaylistLoader_.media();if(i.lastExcludeReason_==="playlist-unchanged")return;this.stuckAtPlaylistEnd_(i)&&(this.excludePlaylist({error:{message:"Playlist no longer updating.",reason:"playlist-unchanged"}}),this.tech_.trigger("playliststuck"))}),this.mainPlaylistLoader_.on("renditiondisabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"})}),this.mainPlaylistLoader_.on("renditionenabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"})}),["manifestrequeststart","manifestrequestcomplete","manifestparsestart","manifestparsecomplete","playlistrequeststart","playlistrequestcomplete","playlistparsestart","playlistparsecomplete","renditiondisabled","renditionenabled"].forEach(i=>{this.mainPlaylistLoader_.on(i,n=>{this.player_.trigger(Li({},n))})})}handleUpdatedMediaPlaylist(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_&&this.runFastQualitySwitch_(),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())}triggerPresenceUsage_(e,i){const n=e.mediaGroups||{};let s=!0;const o=Object.keys(n.AUDIO);for(const l in n.AUDIO)for(const c in n.AUDIO[l])n.AUDIO[l][c].uri||(s=!1);s&&this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),Object.keys(n.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),Yo.Playlist.isAes(i)&&this.tech_.trigger({type:"usage",name:"vhs-aes"}),o.length&&Object.keys(n.AUDIO[o[0]]).length>1&&this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"})}shouldSwitchToMedia_(e){const i=this.mainPlaylistLoader_.media()||this.mainPlaylistLoader_.pendingMedia_,n=this.tech_.currentTime(),s=this.bufferLowWaterLine(),o=this.bufferHighWaterLine(),l=this.tech_.buffered();return EB({buffered:l,currentTime:n,currentPlaylist:i,nextPlaylist:e,bufferLowWaterLine:s,bufferHighWaterLine:o,duration:this.duration(),bufferBasedABR:this.bufferBasedABR,log:this.logger_})}setupSegmentLoaderListeners_(){this.mainSegmentLoader_.on("bandwidthupdate",()=>{this.checkABR_("bandwidthupdate"),this.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("timeout",()=>{this.bufferBasedABR&&this.mainSegmentLoader_.load()}),this.bufferBasedABR||this.mainSegmentLoader_.on("progress",()=>{this.trigger("progress")}),this.mainSegmentLoader_.on("error",()=>{const n=this.mainSegmentLoader_.error();this.excludePlaylist({playlistToExclude:n.playlist,error:n})}),this.mainSegmentLoader_.on("appenderror",()=>{this.error=this.mainSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",()=>{this.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",()=>{this.error=this.audioSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("ended",()=>{this.logger_("main segment loader ended"),this.onEndOfStream()}),this.timelineChangeController_.on("audioTimelineBehind",()=>{const n=this.audioSegmentLoader_.pendingSegment_;if(!n||!n.segment||!n.segment.syncInfo)return;const s=n.segment.syncInfo.end+.01;this.tech_.setCurrentTime(s)}),this.timelineChangeController_.on("fixBadTimelineChange",()=>{this.logger_("Fix bad timeline change. Restarting al segment loaders..."),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}),this.mainSegmentLoader_.on("earlyabort",n=>{this.bufferBasedABR||(this.delegateLoaders_("all",["abort"]),this.excludePlaylist({error:{message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},playlistExclusionDuration:xB}))});const e=()=>{if(!this.sourceUpdater_.hasCreatedSourceBuffers())return this.tryToCreateSourceBuffers_();const n=this.getCodecsOrExclude_();n&&this.sourceUpdater_.addOrChangeSourceBuffers(n)};this.mainSegmentLoader_.on("trackinfo",e),this.audioSegmentLoader_.on("trackinfo",e),this.mainSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",()=>{this.logger_("audioSegmentLoader ended"),this.onEndOfStream()}),["segmentselected","segmentloadstart","segmentloaded","segmentkeyloadstart","segmentkeyloadcomplete","segmentdecryptionstart","segmentdecryptioncomplete","segmenttransmuxingstart","segmenttransmuxingcomplete","segmenttransmuxingtrackinfoavailable","segmenttransmuxingtiminginfoavailable","segmentappendstart","appendsdone","bandwidthupdated","timelinechange","codecschange"].forEach(n=>{this.mainSegmentLoader_.on(n,s=>{this.player_.trigger(Li({},s))}),this.audioSegmentLoader_.on(n,s=>{this.player_.trigger(Li({},s))}),this.subtitleSegmentLoader_.on(n,s=>{this.player_.trigger(Li({},s))})})}mediaSecondsLoaded_(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}load(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}pause(){this.mainSegmentLoader_.pause(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.pause(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.pause()}fastQualityChange_(e=this.selectPlaylist()){if(e&&e===this.mainPlaylistLoader_.media()){this.logger_("skipping fastQualityChange because new media is same as old");return}this.switchMedia_(e,"fast-quality"),this.waitingForFastQualityPlaylistReceived_=!0}runFastQualitySwitch_(){this.waitingForFastQualityPlaylistReceived_=!1,this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}play(){if(this.setupFirstPlay())return;this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();const e=this.tech_.seekable();if(this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0))return this.tech_.setCurrentTime(e.end(e.length-1))}setupFirstPlay(){const e=this.mainPlaylistLoader_.media();if(!e||this.tech_.paused()||this.hasPlayed_)return!1;if(!e.endList||e.start){const i=this.seekable();if(!i.length)return!1;const n=i.end(0);let s=n;if(e.start){const o=e.start.timeOffset;o<0?s=Math.max(n+o,i.start(0)):s=Math.min(n,o)}this.trigger("firstplay"),this.tech_.setCurrentTime(s)}return this.hasPlayed_=!0,this.load(),!0}handleSourceOpen_(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){const e=this.tech_.play();typeof e<"u"&&typeof e.then=="function"&&e.then(null,i=>{})}this.trigger("sourceopen")}handleSourceEnded_(){if(!this.inbandTextTracks_.metadataTrack_)return;const e=this.inbandTextTracks_.metadataTrack_.cues;if(!e||!e.length)return;const i=this.duration();e[e.length-1].endTime=isNaN(i)||Math.abs(i)===1/0?Number.MAX_VALUE:i}handleDurationChange_(){this.tech_.trigger("durationchange")}onEndOfStream(){let e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){const i=this.mainSegmentLoader_.getCurrentMediaInfo_();!i||i.hasVideo?e=e&&this.audioSegmentLoader_.ended_:e=this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())}stuckAtPlaylistEnd_(e){if(!this.seekable().length)return!1;const n=this.syncController_.getExpiredTime(e,this.duration());if(n===null)return!1;const s=Yo.Playlist.playlistEnd(e,n),o=this.tech_.currentTime(),l=this.tech_.buffered();if(!l.length)return s-o<=sa;const c=l.end(l.length-1);return c-o<=sa&&s-c<=sa}excludePlaylist({playlistToExclude:e=this.mainPlaylistLoader_.media(),error:i={},playlistExclusionDuration:n}){if(e=e||this.mainPlaylistLoader_.media(),n=n||i.playlistExclusionDuration||this.playlistExclusionDuration,!e){this.error=i,this.mediaSource.readyState!=="open"?this.trigger("error"):this.sourceUpdater_.endOfStream("network");return}e.playlistErrors_++;const s=this.mainPlaylistLoader_.main.playlists,o=s.filter($p),l=o.length===1&&o[0]===e;if(s.length===1&&n!==1/0)return _e.log.warn(`Problem encountered with playlist ${e.id}. Trying again since it is the only playlist.`),this.tech_.trigger("retryplaylist"),this.mainPlaylistLoader_.load(l);if(l){if(this.main().contentSteering){const A=this.pathwayAttribute_(e),C=this.contentSteeringController_.steeringManifest.ttl*1e3;this.contentSteeringController_.excludePathway(A),this.excludeThenChangePathway_(),setTimeout(()=>{this.contentSteeringController_.addAvailablePathway(A)},C);return}let w=!1;s.forEach(A=>{if(A===e)return;const C=A.excludeUntil;typeof C<"u"&&C!==1/0&&(w=!0,delete A.excludeUntil)}),w&&(_e.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}let c;e.playlistErrors_>this.maxPlaylistRetries?c=1/0:c=Date.now()+n*1e3,e.excludeUntil=c,i.reason&&(e.lastExcludeReason_=i.reason),this.tech_.trigger("excludeplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-excluded"});const h=this.selectPlaylist();if(!h){this.error="Playback cannot continue. No available working or supported playlists.",this.trigger("error");return}const f=i.internal?this.logger_:_e.log.warn,m=i.message?" "+i.message:"";f(`${i.internal?"Internal problem":"Problem"} encountered with playlist ${e.id}.${m} Switching to playlist ${h.id}.`),h.attributes.AUDIO!==e.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),h.attributes.SUBTITLES!==e.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);const _=h.targetDuration/2*1e3||5*1e3,E=typeof h.lastRequest=="number"&&Date.now()-h.lastRequest<=_;return this.switchMedia_(h,"exclude",l||E)}pauseLoading(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()}delegateLoaders_(e,i){const n=[],s=e==="all";(s||e==="main")&&n.push(this.mainPlaylistLoader_);const o=[];(s||e==="audio")&&o.push("AUDIO"),(s||e==="subtitle")&&(o.push("CLOSED-CAPTIONS"),o.push("SUBTITLES")),o.forEach(l=>{const c=this.mediaTypes_[l]&&this.mediaTypes_[l].activePlaylistLoader;c&&n.push(c)}),["main","audio","subtitle"].forEach(l=>{const c=this[`${l}SegmentLoader_`];c&&(e===l||e==="all")&&n.push(c)}),n.forEach(l=>i.forEach(c=>{typeof l[c]=="function"&&l[c]()}))}setCurrentTime(e){const i=Yu(this.tech_.buffered(),e);if(!(this.mainPlaylistLoader_&&this.mainPlaylistLoader_.media())||!this.mainPlaylistLoader_.media().segments)return 0;if(i&&i.length)return e;this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}duration(){if(!this.mainPlaylistLoader_)return 0;const e=this.mainPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:Yo.Playlist.duration(e):1/0:0}seekable(){return this.seekable_}getSeekableRange_(e,i){const n=e.media();if(!n)return null;const s=this.syncController_.getMediaSequenceSync(i);if(s&&s.isReliable){const c=s.start,h=s.end;if(!isFinite(c)||!isFinite(h))return null;const f=Yo.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,n),m=Math.max(c,h-f);return pn([[c,m]])}const o=this.syncController_.getExpiredTime(n,this.duration());if(o===null)return null;const l=Yo.Playlist.seekable(n,o,Yo.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,n));return l.length?l:null}computeFinalSeekable_(e,i){if(!i)return e;const n=e.start(0),s=e.end(0),o=i.start(0),l=i.end(0);return o>s||n>l?e:pn([[Math.max(n,o),Math.min(s,l)]])}onSyncInfoUpdate_(){if(!this.mainPlaylistLoader_)return;const e=this.getSeekableRange_(this.mainPlaylistLoader_,"main");if(!e)return;let i;if(this.mediaTypes_.AUDIO.activePlaylistLoader&&(i=this.getSeekableRange_(this.mediaTypes_.AUDIO.activePlaylistLoader,"audio"),!i))return;const n=this.seekable_;if(this.seekable_=this.computeFinalSeekable_(e,i),!this.seekable_||n&&n.length&&this.seekable_.length&&n.start(0)===this.seekable_.start(0)&&n.end(0)===this.seekable_.end(0))return;this.logger_(`seekable updated [${D4(this.seekable_)}]`);const s={seekableRanges:this.seekable_};this.trigger({type:"seekablerangeschanged",metadata:s}),this.tech_.trigger("seekablechanged")}updateDuration(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),this.mediaSource.readyState!=="open"){this.updateDuration_=this.updateDuration.bind(this,e),this.mediaSource.addEventListener("sourceopen",this.updateDuration_);return}if(e){const s=this.seekable();if(!s.length)return;(isNaN(this.mediaSource.duration)||this.mediaSource.duration<s.end(s.length-1))&&this.sourceUpdater_.setDuration(s.end(s.length-1));return}const i=this.tech_.buffered();let n=Yo.Playlist.duration(this.mainPlaylistLoader_.media());i.length>0&&(n=Math.max(n,i.end(i.length-1))),this.mediaSource.duration!==n&&this.sourceUpdater_.setDuration(n)}dispose(){this.trigger("dispose"),this.decrypter_.terminate(),this.mainPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.contentSteeringController_.dispose(),this.keyStatusMap_.clear(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(e=>{const i=this.mediaTypes_[e].groups;for(const n in i)i[n].forEach(s=>{s.playlistLoader&&s.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()}main(){return this.mainPlaylistLoader_.main}media(){return this.mainPlaylistLoader_.media()||this.initialMedia_}areMediaTypesKnown_(){const e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,i=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),n=e?!!this.audioSegmentLoader_.getCurrentMediaInfo_():!0;return!(!i||!n)}getCodecsOrExclude_(){const e={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}},i=this.mainSegmentLoader_.getPendingSegmentPlaylist()||this.media();e.video=e.main;const n=Wd(this.main(),i),s={},o=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(e.main.hasVideo&&(s.video=n.video||e.main.videoCodec||pR),e.main.isMuxed&&(s.video+=`,${n.audio||e.main.audioCodec||qS}`),(e.main.hasAudio&&!e.main.isMuxed||e.audio.hasAudio||o)&&(s.audio=n.audio||e.main.audioCodec||e.audio.audioCodec||qS,e.audio.isFmp4=e.main.hasAudio&&!e.main.isMuxed?e.main.isFmp4:e.audio.isFmp4),!s.audio&&!s.video){this.excludePlaylist({playlistToExclude:i,error:{message:"Could not determine codecs for playlist."},playlistExclusionDuration:1/0});return}const l=(f,m)=>f?qd(m,this.usingManagedMediaSource_):b0(m),c={};let h;if(["video","audio"].forEach(function(f){if(s.hasOwnProperty(f)&&!l(e[f].isFmp4,s[f])){const m=e[f].isFmp4?"browser":"muxer";c[m]=c[m]||[],c[m].push(s[f]),f==="audio"&&(h=m)}}),o&&h&&i.attributes.AUDIO){const f=i.attributes.AUDIO;this.main().playlists.forEach(m=>{(m.attributes&&m.attributes.AUDIO)===f&&m!==i&&(m.excludeUntil=1/0)}),this.logger_(`excluding audio group ${f} as ${h} does not support codec(s): "${s.audio}"`)}if(Object.keys(c).length){const f=Object.keys(c).reduce((m,_)=>(m&&(m+=", "),m+=`${_} does not support codec(s): "${c[_].join(",")}"`,m),"")+".";this.excludePlaylist({playlistToExclude:i,error:{internal:!0,message:f},playlistExclusionDuration:1/0});return}if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){const f=[];if(["video","audio"].forEach(m=>{const _=(ta(this.sourceUpdater_.codecs[m]||"")[0]||{}).type,E=(ta(s[m]||"")[0]||{}).type;_&&E&&_.toLowerCase()!==E.toLowerCase()&&f.push(`"${this.sourceUpdater_.codecs[m]}" -> "${s[m]}"`)}),f.length){this.excludePlaylist({playlistToExclude:i,error:{message:`Codec switching not supported: ${f.join(", ")}.`,internal:!0},playlistExclusionDuration:1/0});return}}return s}tryToCreateSourceBuffers_(){if(this.mediaSource.readyState!=="open"||this.sourceUpdater_.hasCreatedSourceBuffers()||!this.areMediaTypesKnown_())return;const e=this.getCodecsOrExclude_();if(!e)return;this.sourceUpdater_.createSourceBuffers(e);const i=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(i)}excludeUnsupportedVariants_(){const e=this.main().playlists,i=[];Object.keys(e).forEach(n=>{const s=e[n];if(i.indexOf(s.id)!==-1)return;i.push(s.id);const o=Wd(this.main,s),l=[];o.audio&&!b0(o.audio)&&!qd(o.audio,this.usingManagedMediaSource_)&&l.push(`audio codec ${o.audio}`),o.video&&!b0(o.video)&&!qd(o.video,this.usingManagedMediaSource_)&&l.push(`video codec ${o.video}`),o.text&&o.text==="stpp.ttml.im1t"&&l.push(`text codec ${o.text}`),l.length&&(s.excludeUntil=1/0,this.logger_(`excluding ${s.id} for unsupported: ${l.join(", ")}`))})}excludeIncompatibleVariants_(e){const i=[],n=this.main().playlists,s=eh(ta(e)),o=Nw(s),l=s.video&&ta(s.video)[0]||null,c=s.audio&&ta(s.audio)[0]||null;Object.keys(n).forEach(h=>{const f=n[h];if(i.indexOf(f.id)!==-1||f.excludeUntil===1/0)return;i.push(f.id);const m=[],_=Wd(this.mainPlaylistLoader_.main,f),E=Nw(_);if(!(!_.audio&&!_.video)){if(E!==o&&m.push(`codec count "${E}" !== "${o}"`),!this.sourceUpdater_.canChangeType()){const w=_.video&&ta(_.video)[0]||null,A=_.audio&&ta(_.audio)[0]||null;w&&l&&w.type.toLowerCase()!==l.type.toLowerCase()&&m.push(`video codec "${w.type}" !== "${l.type}"`),A&&c&&A.type.toLowerCase()!==c.type.toLowerCase()&&m.push(`audio codec "${A.type}" !== "${c.type}"`)}m.length&&(f.excludeUntil=1/0,this.logger_(`excluding ${f.id}: ${m.join(" && ")}`))}})}updateAdCues_(e){let i=0;const n=this.seekable();n.length&&(i=n.start(0)),nB(e,this.cueTagsTrack_,i)}goalBufferLength(){const e=this.tech_.currentTime(),i=hn.GOAL_BUFFER_LENGTH,n=hn.GOAL_BUFFER_LENGTH_RATE,s=Math.max(i,hn.MAX_GOAL_BUFFER_LENGTH);return Math.min(i+e*n,s)}bufferLowWaterLine(){const e=this.tech_.currentTime(),i=hn.BUFFER_LOW_WATER_LINE,n=hn.BUFFER_LOW_WATER_LINE_RATE,s=Math.max(i,hn.MAX_BUFFER_LOW_WATER_LINE),o=Math.max(i,hn.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(i+e*n,this.bufferBasedABR?o:s)}bufferHighWaterLine(){return hn.BUFFER_HIGH_WATER_LINE}addDateRangesToTextTrack_(e){jw(this.inbandTextTracks_,"com.apple.streaming",this.tech_),B5({inbandTextTracks:this.inbandTextTracks_,dateRanges:e})}addMetadataToTextTrack(e,i,n){const s=this.sourceUpdater_.videoBuffer?this.sourceUpdater_.videoTimestampOffset():this.sourceUpdater_.audioTimestampOffset();jw(this.inbandTextTracks_,e,this.tech_),R5({inbandTextTracks:this.inbandTextTracks_,metadataArray:i,timestampOffset:s,videoDuration:n})}pathwayAttribute_(e){return e.attributes["PATHWAY-ID"]||e.attributes.serviceLocation}initContentSteeringController_(){const e=this.main();if(e.contentSteering){for(const i of e.playlists)this.contentSteeringController_.addAvailablePathway(this.pathwayAttribute_(i));if(this.contentSteeringController_.assignTagProperties(e.uri,e.contentSteering),this.contentSteeringController_.queryBeforeStart){this.contentSteeringController_.requestSteeringManifest(!0);return}this.tech_.one("canplay",()=>{this.contentSteeringController_.requestSteeringManifest()})}}resetContentSteeringController_(){this.contentSteeringController_.clearAvailablePathways(),this.contentSteeringController_.dispose(),this.initContentSteeringController_()}attachContentSteeringListeners_(){this.contentSteeringController_.on("content-steering",this.excludeThenChangePathway_.bind(this)),["contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"].forEach(i=>{this.contentSteeringController_.on(i,n=>{this.trigger(Li({},n))})}),this.sourceType_==="dash"&&this.mainPlaylistLoader_.on("loadedplaylist",()=>{const i=this.main();(this.contentSteeringController_.didDASHTagChange(i.uri,i.contentSteering)||(()=>{const o=this.contentSteeringController_.getAvailablePathways(),l=[];for(const c of i.playlists){const h=c.attributes.serviceLocation;if(h&&(l.push(h),!o.has(h)))return!0}return!!(!l.length&&o.size)})())&&this.resetContentSteeringController_()})}excludeThenChangePathway_(){const e=this.contentSteeringController_.getPathway();if(!e)return;this.handlePathwayClones_();const n=this.main().playlists,s=new Set;let o=!1;Object.keys(n).forEach(l=>{const c=n[l],h=this.pathwayAttribute_(c),f=h&&e!==h;c.excludeUntil===1/0&&c.lastExcludeReason_==="content-steering"&&!f&&(delete c.excludeUntil,delete c.lastExcludeReason_,o=!0);const _=!c.excludeUntil&&c.excludeUntil!==1/0;!s.has(c.id)&&f&&_&&(s.add(c.id),c.excludeUntil=1/0,c.lastExcludeReason_="content-steering",this.logger_(`excluding ${c.id} for ${c.lastExcludeReason_}`))}),this.contentSteeringController_.manifestType_==="DASH"&&Object.keys(this.mediaTypes_).forEach(l=>{const c=this.mediaTypes_[l];if(c.activePlaylistLoader){const h=c.activePlaylistLoader.media_;h&&h.attributes.serviceLocation!==e&&(o=!0)}}),o&&this.changeSegmentPathway_()}handlePathwayClones_(){const i=this.main().playlists,n=this.contentSteeringController_.currentPathwayClones,s=this.contentSteeringController_.nextPathwayClones;if(n&&n.size||s&&s.size){for(const[l,c]of n.entries())s.get(l)||(this.mainPlaylistLoader_.updateOrDeleteClone(c),this.contentSteeringController_.excludePathway(l));for(const[l,c]of s.entries()){const h=n.get(l);if(!h){i.filter(m=>m.attributes["PATHWAY-ID"]===c["BASE-ID"]).forEach(m=>{this.mainPlaylistLoader_.addClonePathway(c,m)}),this.contentSteeringController_.addAvailablePathway(l);continue}this.equalPathwayClones_(h,c)||(this.mainPlaylistLoader_.updateOrDeleteClone(c,!0),this.contentSteeringController_.addAvailablePathway(l))}this.contentSteeringController_.currentPathwayClones=new Map(JSON.parse(JSON.stringify([...s])))}}equalPathwayClones_(e,i){if(e["BASE-ID"]!==i["BASE-ID"]||e.ID!==i.ID||e["URI-REPLACEMENT"].HOST!==i["URI-REPLACEMENT"].HOST)return!1;const n=e["URI-REPLACEMENT"].PARAMS,s=i["URI-REPLACEMENT"].PARAMS;for(const o in n)if(n[o]!==s[o])return!1;for(const o in s)if(n[o]!==s[o])return!1;return!0}changeSegmentPathway_(){const e=this.selectPlaylist();this.pauseLoading(),this.contentSteeringController_.manifestType_==="DASH"&&this.switchMediaForDASHContentSteering_(),this.switchMedia_(e,"content-steering")}excludeNonUsablePlaylistsByKeyId_(){if(!this.mainPlaylistLoader_||!this.mainPlaylistLoader_.main)return;let e=0;const i="non-usable";this.mainPlaylistLoader_.main.playlists.forEach(n=>{const s=this.mainPlaylistLoader_.getKeyIdSet(n);!s||!s.size||s.forEach(o=>{const l="usable",c=this.keyStatusMap_.has(o)&&this.keyStatusMap_.get(o)===l,h=n.lastExcludeReason_===i&&n.excludeUntil===1/0;c?c&&h&&(delete n.excludeUntil,delete n.lastExcludeReason_,this.logger_(`enabling playlist ${n.id} because key ID ${o} is ${l}`)):(n.excludeUntil!==1/0&&n.lastExcludeReason_!==i&&(n.excludeUntil=1/0,n.lastExcludeReason_=i,this.logger_(`excluding playlist ${n.id} because the key ID ${o} doesn't exist in the keyStatusMap or is not ${l}`)),e++)})}),e>=this.mainPlaylistLoader_.main.playlists.length&&this.mainPlaylistLoader_.main.playlists.forEach(n=>{const s=n&&n.attributes&&n.attributes.RESOLUTION&&n.attributes.RESOLUTION.height<720,o=n.excludeUntil===1/0&&n.lastExcludeReason_===i;s&&o&&(delete n.excludeUntil,_e.log.warn(`enabling non-HD playlist ${n.id} because all playlists were excluded due to ${i} key IDs`))})}addKeyStatus_(e,i){const o=(typeof e=="string"?e:J5(e)).slice(0,32).toLowerCase();this.logger_(`KeyStatus '${i}' with key ID ${o} added to the keyStatusMap`),this.keyStatusMap_.set(o,i)}updatePlaylistByKeyStatus(e,i){this.addKeyStatus_(e,i),this.waitingForFastQualityPlaylistReceived_||this.excludeNonUsableThenChangePlaylist_(),this.mainPlaylistLoader_.off("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this)),this.mainPlaylistLoader_.on("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this))}excludeNonUsableThenChangePlaylist_(){this.excludeNonUsablePlaylistsByKeyId_(),this.fastQualityChange_()}}const AB=(t,e,i)=>n=>{const s=t.main.playlists[e],o=z_(s),l=$p(s);if(typeof n>"u")return l;n?delete s.disabled:s.disabled=!0;const c={renditionInfo:{id:e,bandwidth:s.attributes.BANDWIDTH,resolution:s.attributes.RESOLUTION,codecs:s.attributes.CODECS},cause:"fast-quality"};return n!==l&&!o&&(n?(i(s),t.trigger({type:"renditionenabled",metadata:c})):t.trigger({type:"renditiondisabled",metadata:c})),n};class DB{constructor(e,i,n){const{playlistController_:s}=e,o=s.fastQualityChange_.bind(s);if(i.attributes){const l=i.attributes.RESOLUTION;this.width=l&&l.width,this.height=l&&l.height,this.bandwidth=i.attributes.BANDWIDTH,this.frameRate=i.attributes["FRAME-RATE"]}this.codecs=Wd(s.main(),i),this.playlist=i,this.id=n,this.enabled=AB(e.playlists,i.id,o)}}const kB=function(t){t.representations=()=>{const e=t.playlistController_.main(),i=oh(e)?t.playlistController_.getAudioTrackPlaylists_():e.playlists;return i?i.filter(n=>!z_(n)).map((n,s)=>new DB(t,n,n.id)):[]}},eE=["seeking","seeked","pause","playing","error"];class $B extends _e.EventTarget{constructor(e){super(),this.playlistController_=e.playlistController,this.tech_=e.tech,this.seekable=e.seekable,this.allowSeeksWithinUnsafeLiveWindow=e.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=e.liveRangeSafeTimeDelta,this.media=e.media,this.playedRanges_=[],this.consecutiveUpdates=0,this.lastRecordedTime=null,this.checkCurrentTimeTimeout_=null,this.logger_=ns("PlaybackWatcher"),this.logger_("initialize");const i=()=>this.monitorCurrentTime_(),n=()=>this.monitorCurrentTime_(),s=()=>this.techWaiting_(),o=()=>this.resetTimeUpdate_(),l=this.playlistController_,c=["main","subtitle","audio"],h={};c.forEach(m=>{h[m]={reset:()=>this.resetSegmentDownloads_(m),updateend:()=>this.checkSegmentDownloads_(m)},l[`${m}SegmentLoader_`].on("appendsdone",h[m].updateend),l[`${m}SegmentLoader_`].on("playlistupdate",h[m].reset),this.tech_.on(["seeked","seeking"],h[m].reset)});const f=m=>{["main","audio"].forEach(_=>{l[`${_}SegmentLoader_`][m]("appended",this.seekingAppendCheck_)})};this.seekingAppendCheck_=()=>{this.fixesBadSeeks_()&&(this.consecutiveUpdates=0,this.lastRecordedTime=this.tech_.currentTime(),f("off"))},this.clearSeekingAppendCheck_=()=>f("off"),this.watchForBadSeeking_=()=>{this.clearSeekingAppendCheck_(),f("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",s),this.tech_.on(eE,o),this.tech_.on("canplay",n),this.tech_.one("play",i),this.dispose=()=>{this.clearSeekingAppendCheck_(),this.logger_("dispose"),this.tech_.off("waiting",s),this.tech_.off(eE,o),this.tech_.off("canplay",n),this.tech_.off("play",i),this.tech_.off("seeking",this.watchForBadSeeking_),this.tech_.off("seeked",this.clearSeekingAppendCheck_),c.forEach(m=>{l[`${m}SegmentLoader_`].off("appendsdone",h[m].updateend),l[`${m}SegmentLoader_`].off("playlistupdate",h[m].reset),this.tech_.off(["seeked","seeking"],h[m].reset)}),this.checkCurrentTimeTimeout_&&te.clearTimeout(this.checkCurrentTimeTimeout_),this.resetTimeUpdate_()}}monitorCurrentTime_(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&te.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=te.setTimeout(this.monitorCurrentTime_.bind(this),250)}resetSegmentDownloads_(e){const i=this.playlistController_[`${e}SegmentLoader_`];this[`${e}StalledDownloads_`]>0&&this.logger_(`resetting possible stalled download count for ${e} loader`),this[`${e}StalledDownloads_`]=0,this[`${e}Buffered_`]=i.buffered_()}checkSegmentDownloads_(e){const i=this.playlistController_,n=i[`${e}SegmentLoader_`],s=n.buffered_(),o=mN(this[`${e}Buffered_`],s);if(this[`${e}Buffered_`]=s,o){const l={bufferedRanges:s};i.trigger({type:"bufferedrangeschanged",metadata:l}),this.resetSegmentDownloads_(e);return}this[`${e}StalledDownloads_`]++,this.logger_(`found #${this[`${e}StalledDownloads_`]} ${e} appends that did not increase buffer (possible stalled download)`,{playlistId:n.playlist_&&n.playlist_.id,buffered:Gl(s)}),!(this[`${e}StalledDownloads_`]<10)&&(this.logger_(`${e} loader stalled download exclusion`),this.resetSegmentDownloads_(e),this.tech_.trigger({type:"usage",name:`vhs-${e}-download-exclusion`}),e!=="subtitle"&&i.excludePlaylist({error:{message:`Excessive ${e} segment downloading detected.`},playlistExclusionDuration:1/0}))}checkCurrentTime_(){if(this.tech_.paused()||this.tech_.seeking())return;const e=this.tech_.currentTime(),i=this.tech_.buffered();if(this.lastRecordedTime===e&&(!i.length||e+sa>=i.end(i.length-1)))return this.techWaiting_();if(this.consecutiveUpdates>=5&&e===this.lastRecordedTime)this.consecutiveUpdates++,this.waiting_();else if(e===this.lastRecordedTime)this.consecutiveUpdates++;else{this.playedRanges_.push(pn([this.lastRecordedTime,e]));const n={playedRanges:this.playedRanges_};this.playlistController_.trigger({type:"playedrangeschanged",metadata:n}),this.consecutiveUpdates=0,this.lastRecordedTime=e}}resetTimeUpdate_(){this.consecutiveUpdates=0}fixesBadSeeks_(){if(!this.tech_.seeking())return!1;const i=this.seekable(),n=this.tech_.currentTime(),s=this.afterSeekableWindow_(i,n,this.media(),this.allowSeeksWithinUnsafeLiveWindow);let o;if(s&&(o=i.end(i.length-1)),this.beforeSeekableWindow_(i,n)){const A=i.start(0);o=A+(A===i.end(0)?0:sa)}if(typeof o<"u")return this.logger_(`Trying to seek outside of seekable at time ${n} with seekable range ${D4(i)}. Seeking to ${o}.`),this.tech_.setCurrentTime(o),!0;const l=this.playlistController_.sourceUpdater_,c=this.tech_.buffered(),h=l.audioBuffer?l.audioBuffered():null,f=l.videoBuffer?l.videoBuffered():null,m=this.media(),_=m.partTargetDuration?m.partTargetDuration:(m.targetDuration-ra)*2,E=[h,f];for(let A=0;A<E.length;A++){if(!E[A])continue;if(U_(E[A],n)<_)return!1}const w=wf(c,n);return w.length===0?!1:(o=w.start(0)+sa,this.logger_(`Buffered region starts (${w.start(0)})  just beyond seek point (${n}). Seeking to ${o}.`),this.tech_.setCurrentTime(o),!0)}waiting_(){if(this.techWaiting_())return;const e=this.tech_.currentTime(),i=this.tech_.buffered(),n=Yu(i,e);if(n.length&&e+3<=n.end(0)){this.resetTimeUpdate_(),this.tech_.setCurrentTime(e),this.logger_(`Stopped at ${e} while inside a buffered region [${n.start(0)} -> ${n.end(0)}]. Attempting to resume playback by seeking to the current time.`),this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"});return}}techWaiting_(){const e=this.seekable(),i=this.tech_.currentTime();if(this.tech_.seeking())return!0;if(this.beforeSeekableWindow_(e,i)){const c=e.end(e.length-1);return this.logger_(`Fell out of live window at time ${i}. Seeking to live point (seekable end) ${c}`),this.resetTimeUpdate_(),this.tech_.setCurrentTime(c),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),!0}const n=this.tech_.vhs.playlistController_.sourceUpdater_,s=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:n.audioBuffered(),videoBuffered:n.videoBuffered(),currentTime:i}))return this.resetTimeUpdate_(),this.tech_.setCurrentTime(i),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),!0;const l=wf(s,i);return l.length>0?(this.logger_(`Stopped at ${i} and seeking to ${l.start(0)}`),this.resetTimeUpdate_(),this.skipTheGap_(i),!0):!1}afterSeekableWindow_(e,i,n,s=!1){if(!e.length)return!1;let o=e.end(e.length-1)+sa;const l=!n.endList,c=typeof n.partTargetDuration=="number";return l&&(c||s)&&(o=e.end(e.length-1)+n.targetDuration*3),i>o}beforeSeekableWindow_(e,i){return!!(e.length&&e.start(0)>0&&i<e.start(0)-this.liveRangeSafeTimeDelta)}videoUnderflow_({videoBuffered:e,audioBuffered:i,currentTime:n}){if(!e)return;let s;if(e.length&&i.length){const o=Yu(e,n-3),l=Yu(e,n),c=Yu(i,n);c.length&&!l.length&&o.length&&(s={start:o.end(0),end:c.end(0)})}else wf(e,n).length||(s=this.gapFromVideoUnderflow_(e,n));return s?(this.logger_(`Encountered a gap in video from ${s.start} to ${s.end}. Seeking to current time ${n}`),!0):!1}skipTheGap_(e){const i=this.tech_.buffered(),n=this.tech_.currentTime(),s=wf(i,n);if(this.resetTimeUpdate_(),s.length===0||n!==e)return;this.logger_("skipTheGap_:","currentTime:",n,"scheduled currentTime:",e,"nextRange start:",s.start(0)),this.tech_.setCurrentTime(s.start(0)+ra);const o={gapInfo:{from:n,to:s.start(0)}};this.playlistController_.trigger({type:"gapjumped",metadata:o}),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"})}gapFromVideoUnderflow_(e,i){const n=hN(e);for(let s=0;s<n.length;s++){const o=n.start(s),l=n.end(s);if(i-o<4&&i-o>2)return{start:o,end:l}}return null}}const OB={errorInterval:30,getSource(t){const i=this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource();return t(i)}},vk=function(t,e){let i=0,n=0;const s=Gt(OB,e);t.ready(()=>{t.trigger({type:"usage",name:"vhs-error-reload-initialized"})});const o=function(){n&&t.currentTime(n)},l=function(m){m!=null&&(n=t.duration()!==1/0&&t.currentTime()||0,t.one("loadedmetadata",o),t.src(m),t.trigger({type:"usage",name:"vhs-error-reload"}),t.play())},c=function(){if(Date.now()-i<s.errorInterval*1e3){t.trigger({type:"usage",name:"vhs-error-reload-canceled"});return}if(!s.getSource||typeof s.getSource!="function"){_e.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!");return}return i=Date.now(),s.getSource.call(t,l)},h=function(){t.off("loadedmetadata",o),t.off("error",c),t.off("dispose",h)},f=function(m){h(),vk(t,m)};t.on("error",c),t.on("dispose",h),t.reloadSourceOnError=f},IB=function(t){vk(this,t)};var bk="3.17.2",RB="7.1.0",MB="1.3.1",NB="7.2.0",BB="4.0.2";const wi={PlaylistLoader:Qu,Playlist:cr,utils:FN,STANDARD_PLAYLIST_SELECTOR:qw,INITIAL_PLAYLIST_SELECTOR:D5,lastBandwidthSelector:qw,movingAverageBandwidthSelector:C5,comparePlaylistBandwidth:j_,comparePlaylistResolution:E5,xhr:W4()};Object.keys(hn).forEach(t=>{Object.defineProperty(wi,t,{get(){return _e.log.warn(`using Vhs.${t} is UNSAFE be sure you know what you are doing`),hn[t]},set(e){if(_e.log.warn(`using Vhs.${t} is UNSAFE be sure you know what you are doing`),typeof e!="number"||e<0){_e.log.warn(`value of Vhs.${t} must be greater than or equal to 0`);return}hn[t]=e}})});const Tk="videojs-vhs",xk=function(t,e){const i=e.media();let n=-1;for(let s=0;s<t.length;s++)if(t[s].id===i.id){n=s;break}t.selectedIndex_=n,t.trigger({selectedIndex:n,type:"change"})},LB=function(t,e){e.representations().forEach(i=>{t.addQualityLevel(i)}),xk(t,e.playlists)};wi.canPlaySource=function(){return _e.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const UB=(t,e,i)=>{if(!t)return t;let n={};e&&e.attributes&&e.attributes.CODECS&&(n=eh(ta(e.attributes.CODECS))),i&&i.attributes&&i.attributes.CODECS&&(n.audio=i.attributes.CODECS);const s=uc(n.video),o=uc(n.audio),l={};for(const c in t)l[c]={},o&&(l[c].audioContentType=o),s&&(l[c].videoContentType=s),e.contentProtection&&e.contentProtection[c]&&e.contentProtection[c].pssh&&(l[c].pssh=e.contentProtection[c].pssh),typeof t[c]=="string"&&(l[c].url=t[c]);return Gt(t,l)},PB=(t,e)=>t.reduce((i,n)=>{if(!n.contentProtection)return i;const s=e.reduce((o,l)=>{const c=n.contentProtection[l];return c&&c.pssh&&(o[l]={pssh:c.pssh}),o},{});return Object.keys(s).length&&i.push(s),i},[]),zB=({player:t,sourceKeySystems:e,audioMedia:i,mainPlaylists:n})=>{if(!t.eme.initializeMediaKeys)return Promise.resolve();const s=i?n.concat([i]):n,o=PB(s,Object.keys(e)),l=[],c=[];return o.forEach(h=>{c.push(new Promise((f,m)=>{t.tech_.one("keysessioncreated",f)})),l.push(new Promise((f,m)=>{t.eme.initializeMediaKeys({keySystems:h},_=>{if(_){m(_);return}f()})}))}),Promise.race([Promise.all(l),Promise.race(c)])},FB=({player:t,sourceKeySystems:e,media:i,audioMedia:n})=>{const s=UB(e,i,n);return s?(t.currentSource().keySystems=s,s&&!t.eme?(_e.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),!1):!0):!1},Sk=()=>{if(!te.localStorage)return null;const t=te.localStorage.getItem(Tk);if(!t)return null;try{return JSON.parse(t)}catch{return null}},qB=t=>{if(!te.localStorage)return!1;let e=Sk();e=e?Gt(e,t):t;try{te.localStorage.setItem(Tk,JSON.stringify(e))}catch{return!1}return e},jB=t=>t.toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")===0?JSON.parse(t.substring(t.indexOf(",")+1)):t,wk=(t,e)=>{t._requestCallbackSet||(t._requestCallbackSet=new Set),t._requestCallbackSet.add(e)},Ek=(t,e)=>{t._responseCallbackSet||(t._responseCallbackSet=new Set),t._responseCallbackSet.add(e)},Ck=(t,e)=>{t._requestCallbackSet&&(t._requestCallbackSet.delete(e),t._requestCallbackSet.size||delete t._requestCallbackSet)},Ak=(t,e)=>{t._responseCallbackSet&&(t._responseCallbackSet.delete(e),t._responseCallbackSet.size||delete t._responseCallbackSet)};wi.supportsNativeHls=(function(){if(!Fe||!Fe.createElement)return!1;const t=Fe.createElement("video");return _e.getTech("Html5").isSupported()?["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(i){return/maybe|probably/i.test(t.canPlayType(i))}):!1})();wi.supportsNativeDash=(function(){return!Fe||!Fe.createElement||!_e.getTech("Html5").isSupported()?!1:/maybe|probably/i.test(Fe.createElement("video").canPlayType("application/dash+xml"))})();wi.supportsTypeNatively=t=>t==="hls"?wi.supportsNativeHls:t==="dash"?wi.supportsNativeDash:!1;wi.isSupported=function(){return _e.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};wi.xhr.onRequest=function(t){wk(wi.xhr,t)};wi.xhr.onResponse=function(t){Ek(wi.xhr,t)};wi.xhr.offRequest=function(t){Ck(wi.xhr,t)};wi.xhr.offResponse=function(t){Ak(wi.xhr,t)};const HB=_e.getComponent("Component");class Dk extends HB{constructor(e,i,n){if(super(i,n.vhs),typeof n.initialBandwidth=="number"&&(this.options_.bandwidth=n.initialBandwidth),this.logger_=ns("VhsHandler"),i.options_&&i.options_.playerId){const s=_e.getPlayer(i.options_.playerId);this.player_=s}if(this.tech_=i,this.source_=e,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&i.overrideNativeAudioTracks&&i.overrideNativeVideoTracks)i.overrideNativeAudioTracks(!0),i.overrideNativeVideoTracks(!0);else if(this.options_.overrideNative&&(i.featuresNativeVideoTracks||i.featuresNativeAudioTracks))throw new Error("Overriding native VHS requires emulated tracks. See https://git.io/vMpjB");this.on(Fe,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],s=>{const o=Fe.fullscreenElement||Fe.webkitFullscreenElement||Fe.mozFullScreenElement||Fe.msFullscreenElement;o&&o.contains(this.tech_.el())?this.playlistController_.fastQualityChange_():this.playlistController_.checkABR_()}),this.on(this.tech_,"seeking",function(){if(this.ignoreNextSeekingEvent_){this.ignoreNextSeekingEvent_=!1;return}this.setCurrentTime(this.tech_.currentTime())}),this.on(this.tech_,"error",function(){this.tech_.error()&&this.playlistController_&&this.playlistController_.pauseLoading()}),this.on(this.tech_,"play",this.play)}setOptions_(e={}){if(this.options_=Gt(this.options_,e),this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions!==!1,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.usePlayerObjectFit=this.options_.usePlayerObjectFit||!1,this.options_.useBandwidthFromLocalStorage=typeof this.source_.useBandwidthFromLocalStorage<"u"?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useForcedSubtitles=this.options_.useForcedSubtitles||!1,this.options_.useNetworkInformationApi=typeof this.options_.useNetworkInformationApi<"u"?this.options_.useNetworkInformationApi:!0,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,this.options_.llhls=this.options_.llhls!==!1,this.options_.bufferBasedABR=this.options_.bufferBasedABR||!1,typeof this.options_.playlistExclusionDuration!="number"&&(this.options_.playlistExclusionDuration=60),typeof this.options_.bandwidth!="number"&&this.options_.useBandwidthFromLocalStorage){const n=Sk();n&&n.bandwidth&&(this.options_.bandwidth=n.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"})),n&&n.throughput&&(this.options_.throughput=n.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}))}typeof this.options_.bandwidth!="number"&&(this.options_.bandwidth=hn.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===hn.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","usePlayerObjectFit","customPixelRatio","limitRenditionByPlayerDimensions","bandwidth","customTagParsers","customTagMappers","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","bufferBasedABR","liveRangeSafeTimeDelta","llhls","useForcedSubtitles","useNetworkInformationApi","useDtsForTimestampOffset","exactManifestTimings","leastPixelDiffSelector"].forEach(n=>{typeof this.source_[n]<"u"&&(this.options_[n]=this.source_[n])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio,this.usePlayerObjectFit=this.options_.usePlayerObjectFit;const i=this.options_.customPixelRatio;typeof i=="number"&&i>=0&&(this.customPixelRatio=i)}setOptions(e={}){this.setOptions_(e)}src(e,i){if(!e)return;this.setOptions_(),this.options_.src=jB(this.source_.src),this.options_.tech=this.tech_,this.options_.externVhs=wi,this.options_.sourceType=K3(i),this.options_.seekTo=o=>{this.tech_.setCurrentTime(o)},this.options_.player_=this.player_,this.playlistController_=new CB(this.options_);const n=Gt({liveRangeSafeTimeDelta:sa},this.options_,{seekable:()=>this.seekable(),media:()=>this.playlistController_.media(),playlistController:this.playlistController_});this.playbackWatcher_=new $B(n),this.attachStreamingEventListeners_(),this.playlistController_.on("error",()=>{const o=_e.players[this.tech_.options_.playerId];let l=this.playlistController_.error;typeof l=="object"&&!l.code?l.code=3:typeof l=="string"&&(l={message:l,code:3}),o.error(l)});const s=this.options_.bufferBasedABR?wi.movingAverageBandwidthSelector(.55):wi.STANDARD_PLAYLIST_SELECTOR;this.playlistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):s.bind(this),this.playlistController_.selectInitialPlaylist=wi.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.playlistController_.mainPlaylistLoader_,this.mediaSource=this.playlistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get(){return this.playlistController_.selectPlaylist},set(o){this.playlistController_.selectPlaylist=o.bind(this)}},throughput:{get(){return this.playlistController_.mainSegmentLoader_.throughput.rate},set(o){this.playlistController_.mainSegmentLoader_.throughput.rate=o,this.playlistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get(){let o=this.playlistController_.mainSegmentLoader_.bandwidth;const l=te.navigator.connection||te.navigator.mozConnection||te.navigator.webkitConnection,c=1e7;if(this.options_.useNetworkInformationApi&&l){const h=l.downlink*1e3*1e3;h>=c&&o>=c?o=Math.max(o,h):o=h}return o},set(o){this.playlistController_.mainSegmentLoader_.bandwidth=o,this.playlistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get(){const o=1/(this.bandwidth||1);let l;return this.throughput>0?l=1/this.throughput:l=0,Math.floor(1/(o+l))},set(){_e.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:()=>this.bandwidth||0,enumerable:!0},mediaRequests:{get:()=>this.playlistController_.mediaRequests_()||0,enumerable:!0},mediaRequestsAborted:{get:()=>this.playlistController_.mediaRequestsAborted_()||0,enumerable:!0},mediaRequestsTimedout:{get:()=>this.playlistController_.mediaRequestsTimedout_()||0,enumerable:!0},mediaRequestsErrored:{get:()=>this.playlistController_.mediaRequestsErrored_()||0,enumerable:!0},mediaTransferDuration:{get:()=>this.playlistController_.mediaTransferDuration_()||0,enumerable:!0},mediaBytesTransferred:{get:()=>this.playlistController_.mediaBytesTransferred_()||0,enumerable:!0},mediaSecondsLoaded:{get:()=>this.playlistController_.mediaSecondsLoaded_()||0,enumerable:!0},mediaAppends:{get:()=>this.playlistController_.mediaAppends_()||0,enumerable:!0},mainAppendsToLoadedData:{get:()=>this.playlistController_.mainAppendsToLoadedData_()||0,enumerable:!0},audioAppendsToLoadedData:{get:()=>this.playlistController_.audioAppendsToLoadedData_()||0,enumerable:!0},appendsToLoadedData:{get:()=>this.playlistController_.appendsToLoadedData_()||0,enumerable:!0},timeToLoadedData:{get:()=>this.playlistController_.timeToLoadedData_()||0,enumerable:!0},buffered:{get:()=>Gl(this.tech_.buffered()),enumerable:!0},currentTime:{get:()=>this.tech_.currentTime(),enumerable:!0},currentSource:{get:()=>this.tech_.currentSource_,enumerable:!0},currentTech:{get:()=>this.tech_.name_,enumerable:!0},duration:{get:()=>this.tech_.duration(),enumerable:!0},main:{get:()=>this.playlists.main,enumerable:!0},playerDimensions:{get:()=>this.tech_.currentDimensions(),enumerable:!0},seekable:{get:()=>Gl(this.tech_.seekable()),enumerable:!0},timestamp:{get:()=>Date.now(),enumerable:!0},videoPlaybackQuality:{get:()=>this.tech_.getVideoPlaybackQuality(),enumerable:!0}}),this.tech_.one("canplay",this.playlistController_.setupFirstPlay.bind(this.playlistController_)),this.tech_.on("bandwidthupdate",()=>{this.options_.useBandwidthFromLocalStorage&&qB({bandwidth:this.bandwidth,throughput:Math.round(this.throughput)})}),this.playlistController_.on("selectedinitialmedia",()=>{kB(this)}),this.playlistController_.sourceUpdater_.on("createdsourcebuffers",()=>{this.setupEme_()}),this.on(this.playlistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.playlistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=te.URL.createObjectURL(this.playlistController_.mediaSource),(_e.browser.IS_ANY_SAFARI||_e.browser.IS_IOS)&&this.options_.overrideNative&&this.options_.sourceType==="hls"&&typeof this.tech_.addSourceElement=="function"?(this.tech_.addSourceElement(this.mediaSourceUrl_),this.tech_.addSourceElement(this.source_.src)):this.tech_.src(this.mediaSourceUrl_))}createKeySessions_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),zB({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:e&&e.media(),mainPlaylists:this.playlists.main.playlists}).then(()=>{this.logger_("created EME key session"),this.playlistController_.sourceUpdater_.initializedEme()}).catch(i=>{this.logger_("error while creating EME key session",i),this.player_.error({message:"Failed to initialize media keys for EME",code:3})})}handleWaitingForKey_(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()}setupEme_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader,i=FB({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:e&&e.media()});if(this.player_.tech_.on("keystatuschange",n=>{this.playlistController_.updatePlaylistByKeyStatus(n.keyId,n.status)}),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),!i){this.playlistController_.sourceUpdater_.initializedEme();return}this.createKeySessions_()}setupQualityLevels_(){const e=_e.players[this.tech_.options_.playerId];!e||!e.qualityLevels||this.qualityLevels_||(this.qualityLevels_=e.qualityLevels(),this.playlistController_.on("selectedinitialmedia",()=>{LB(this.qualityLevels_,this)}),this.playlists.on("mediachange",()=>{xk(this.qualityLevels_,this.playlists)}))}static version(){return{"@videojs/http-streaming":bk,"mux.js":RB,"mpd-parser":MB,"m3u8-parser":NB,"aes-decrypter":BB}}version(){return this.constructor.version()}canChangeType(){return mk.canChangeType()}play(){this.playlistController_.play()}setCurrentTime(e){this.playlistController_.setCurrentTime(e)}duration(){return this.playlistController_.duration()}seekable(){return this.playlistController_.seekable()}dispose(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.playlistController_&&this.playlistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.mediaSourceUrl_&&te.URL.revokeObjectURL&&(te.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),super.dispose()}convertToProgramTime(e,i){return XN({playlist:this.playlistController_.media(),time:e,callback:i})}seekToProgramTime(e,i,n=!0,s=2){return Z4({programTime:e,playlist:this.playlistController_.media(),retryCount:s,pauseAfterSeek:n,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:i})}setupXhrHooks_(){this.xhr.onRequest=e=>{wk(this.xhr,e)},this.xhr.onResponse=e=>{Ek(this.xhr,e)},this.xhr.offRequest=e=>{Ck(this.xhr,e)},this.xhr.offResponse=e=>{Ak(this.xhr,e)},this.player_.trigger("xhr-hooks-ready")}attachStreamingEventListeners_(){const e=["seekablerangeschanged","bufferedrangeschanged","contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"],i=["gapjumped","playedrangeschanged"];e.forEach(n=>{this.playlistController_.on(n,s=>{this.player_.trigger(Li({},s))})}),i.forEach(n=>{this.playbackWatcher_.on(n,s=>{this.player_.trigger(Li({},s))})})}}const ap={name:"videojs-http-streaming",VERSION:bk,canHandleSource(t,e={}){const i=Gt(_e.options,e);return!i.vhs.experimentalUseMMS&&!qd("avc1.4d400d,mp4a.40.2",!1)?!1:ap.canPlayType(t.type,i)},handleSource(t,e,i={}){const n=Gt(_e.options,i);return e.vhs=new Dk(t,e,n),e.vhs.xhr=W4(),e.vhs.setupXhrHooks_(),e.vhs.src(t.src,t.type),e.vhs},canPlayType(t,e){const i=K3(t);if(!i)return"";const n=ap.getOverrideNative(e);return!wi.supportsTypeNatively(i)||n?"maybe":""},getOverrideNative(t={}){const{vhs:e={}}=t,i=!(_e.browser.IS_ANY_SAFARI||_e.browser.IS_IOS),{overrideNative:n=i}=e;return n}},VB=()=>qd("avc1.4d400d,mp4a.40.2",!0);VB()&&_e.getTech("Html5").registerSourceHandler(ap,0);_e.VhsHandler=Dk;_e.VhsSourceHandler=ap;_e.Vhs=wi;_e.use||_e.registerComponent("Vhs",wi);_e.options.vhs=_e.options.vhs||{};(!_e.getPlugin||!_e.getPlugin("reloadSourceOnError"))&&_e.registerPlugin("reloadSourceOnError",IB);const GB=["person","bicycle","car","motorcycle","airplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis racket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","couch","potted plant","bed","dining table","toilet","tv","laptop","mouse","remote","keyboard","cell phone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"],WB=t=>{const e=["#FF3838","#FF9933","#FFCC33","#CCFF33","#66FF33","#33FF66","#33FFCC","#33CCFF","#3366FF","#6633FF","#CC33FF","#FF33CC"];return e[t%e.length]},XB=t=>{const e=document.createElement("canvas");e.width=Qa,e.height=Za;const i=e.getContext("2d");if(!i)throw new Error("Gagal mendapatkan konteks 2D kanvas sementara");i.drawImage(t,0,0,Qa,Za);const n=i.getImageData(0,0,Qa,Za).data,s=[],o=[],l=[];for(let c=0;c<n.length;c+=4)s.push(n[c]/255),o.push(n[c+1]/255),l.push(n[c+2]/255);return[...s,...o,...l]},KB=(t,e,i)=>{t.lineWidth=3,t.font="18px Arial";const n={};if(e.forEach(s=>{const[o,l,c,h]=s.bounding,f=s.label,m=s.probability,_=s.classId;i&&(n[f]=(n[f]||0)+1);const E=WB(_);t.strokeStyle=E,t.strokeRect(o,l,c,h),t.fillStyle=E;const w=`${f} (${(m*100).toFixed(1)}%)`,A=t.measureText(w).width;t.fillRect(o,l,A+10,25),t.fillStyle="#000000",t.fillText(w,o+5,l+18)}),i){t.font="20px Arial",t.fillStyle="rgba(0, 0, 0, 0.7)";const s=Object.entries(n),o=s.length*28+15;t.fillRect(10,10,200,o),t.fillStyle="#FFFFFF";let l=35;s.forEach(([c,h])=>{t.fillText(`${c}: ${h}`,20,l),l+=28})}},YB=async(t,e,i,n)=>{const s=e.current;if(!s)return;const o=s.getContext("2d");if(!o)return;const l=s.width/Qa,c=s.height/Za,h=.25,f=async()=>{if(t.paused||t.ended){requestAnimationFrame(f);return}const m=XB(t),_=new Zr("float32",new Float32Array(m),F3),E={};E[i.inputNames[0]]=_;const A=(await i.run(E))[i.outputNames[0]],C=[],M=A.data,O=A.dims[1],$=A.dims[2];for(let B=0;B<O;B++){const U=M.slice(B*$,(B+1)*$),j=U[0],W=U[1],z=U[2],Y=U[3],L=U[4],H=Math.round(U[5]);if(L<h)continue;const se=j*l,ae=W*c,ce=(z-j)*l,fe=(Y-W)*c;C.push({bounding:[se,ae,ce,fe],label:GB[H],probability:L,classId:H})}o.clearRect(0,0,s.width,s.height),KB(o,C,n),requestAnimationFrame(f)};f()};function QB({session:t}){const[e,i]=gi.useState(null),[n,s]=gi.useState(!1),[o,l]=gi.useState(!1),c=gi.useRef(null),h=gi.useRef(null),f=gi.useRef(null),m=gi.useRef(null),_=w=>{w.target.files&&w.target.files[0]&&(i(w.target.files[0]),l(!1))};gi.useEffect(()=>{if(!c.current||!e)return;const w=c.current;m.current&&URL.revokeObjectURL(m.current);const A=URL.createObjectURL(e);m.current=A,f.current&&(f.current.dispose(),f.current=null);const C=setTimeout(()=>{const M=_e(w,{controls:!0,preload:"auto",responsive:!0,fluid:!0,sources:[{src:A,type:e.type}]});f.current=M,M.on("loadedmetadata",()=>{l(!0)}),M.load()},100);return()=>{clearTimeout(C),f.current&&(f.current.dispose(),f.current=null),m.current&&(URL.revokeObjectURL(m.current),m.current=null)}},[e]);const E=()=>{if(!f.current||!h.current||!t){alert("Komponen belum siap.");return}const w=f.current,A=h.current,C=w.tech().el();A.width=C.videoWidth,A.height=C.videoHeight,w.play(),YB(C,h,t,n)};return He.jsxs("div",{className:"mx-auto max-w-5xl space-y-6",children:[He.jsx("h2",{className:"text-4xl font-bold text-gray-800",children:"Deteksi Video"}),He.jsx("p",{className:"text-gray-600",children:"Unggah video untuk deteksi standar, atau aktifkan counting opsional."}),He.jsxs("form",{children:[e?He.jsxs(He.Fragment,{children:[He.jsxs("div",{className:"relative mx-auto w-full overflow-hidden rounded-lg bg-black shadow-lg",children:[He.jsx("div",{"data-vjs-player":!0,children:He.jsx("video",{ref:c,className:"video-js vjs-big-play-centered"})},e.name),He.jsx("canvas",{ref:h,className:"pointer-events-none absolute top-0 left-0 z-10 max-h-full w-full object-contain",style:{width:"100%",height:"100%"}})]}),He.jsxs("div",{children:[He.jsxs("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:["File terpilih: ",e.name]}),He.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Ukuran: ",(e.size/1024/1024).toFixed(2)," MB"]}),He.jsxs("label",{htmlFor:"input_file",className:"mt-4 inline-block w-full cursor-pointer rounded-md border border-gray-300 bg-white px-4 py-2 text-center text-sm font-medium text-gray-700 shadow-sm transition-colors hover:bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none",children:[He.jsx("input",{type:"file",onChange:_,className:"hidden",id:"input_file",accept:"video/mp4, video/avi, video/quicktime, .mov"}),"Ganti video"]})]})]}):He.jsx(He.Fragment,{children:He.jsxs("label",{className:"block cursor-pointer rounded-lg border-2 border-dashed border-gray-300 bg-white p-12 text-center transition-colors hover:border-green-500",htmlFor:"input_file",children:[He.jsx("input",{type:"file",onChange:_,className:"hidden",accept:"video/mp4, video/avi, video/quicktime, .mov",id:"input_file"}),He.jsx(nE,{className:"mx-auto h-12 w-12 text-gray-400"}),He.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Seret & Lepas file video"}),He.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"MP4, AVI, MOV hingga 50MB"})]})}),He.jsx("h3",{className:"mb-2 pt-4 text-xl font-semibold text-gray-700",children:"Counting"}),He.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm",children:He.jsxs("label",{htmlFor:"counting-checkbox-v1",className:"flex cursor-pointer items-center",children:[He.jsx("input",{id:"counting-checkbox-v1",type:"checkbox",checked:n,onChange:w=>s(w.target.checked),className:"h-5 w-5 rounded border-gray-300 text-green-600 focus:ring-green-500"}),He.jsxs("div",{className:"ml-3",children:[He.jsx("span",{className:"font-bold text-gray-800",children:"Object Counting"}),He.jsx("p",{className:"text-sm text-gray-500",children:"Menghitung jumlah objek."})]})]})}),He.jsx("button",{type:"button",onClick:E,disabled:!e||!o,className:"mt-4 flex w-full items-center justify-center rounded-lg bg-green-600 px-4 py-3 text-lg font-bold text-white transition-colors hover:bg-green-700 disabled:cursor-not-allowed disabled:opacity-50",children:o?"Mulai deteksi video":"Memuat Player..."})]})]})}function ZB(){return He.jsx("div",{className:"fixed inset-0 z-1000 flex items-center justify-center bg-black/30 backdrop-blur-sm transition-all",children:He.jsxs("div",{className:"flex w-64 flex-col items-center justify-center rounded-2xl bg-white p-6 shadow-2xl ring-1 ring-black/5",children:[He.jsx(rE,{className:"mb-4 h-10 w-10 animate-spin text-blue-600"}),He.jsx("div",{className:"text-center",children:He.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Loading Model..."})})]})})}const tE="https://github.com/vntion/chicken-part-detection/assets/yolo11n-nms-CHTMiJiq.onnx";ui.wasm.wasmPaths="/";function JB(){const[t,e]=gi.useState(!1),i=gi.useRef(null),{mode:n}=j3();return gi.useEffect(()=>{(async()=>{try{e(!0),console.log("Mencoba load model dari:",tE);const o=await Ry.create(tE);i.current=o}catch(o){alert(o)}finally{e(!1)}})()},[]),He.jsxs(J$,{children:[He.jsx(zI,{}),He.jsxs(UI,{children:[t&&He.jsx(ZB,{}),n==="image"&&He.jsx(LI,{session:i.current}),n==="video"&&He.jsx(QB,{session:i.current})]})]})}Z$.createRoot(document.getElementById("root")).render(He.jsx(gi.StrictMode,{children:He.jsx(PI,{children:He.jsx(JB,{})})}));
